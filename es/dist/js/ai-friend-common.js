function getHost(){let e=document.location.pathname,t="";return"/novia-virtual.html"==e?t="girl":"/ai-boyfriend.html"==e&&(t="boy"),t}function debounce(e,t){let o;return function(){let n=this,i=arguments;clearTimeout(o),o=setTimeout((function(){e.apply(n,i)}),t)}}var pathUrlName=getHost();let breakTime=0,lastUrl="";var isSendMsgFn;function fetchPost(e,t={},o={},n=!0){return isSendMsgFn=sendErrorMsgXPF(e),new Promise(((i,r)=>{fetch(TOOL_API+e,{method:"POST",headers:{"Content-Type":"application/json","X-TASK-VERSION":"2.0.0","Request-Origin":"vidqu","Request-Language":"es","Request-Project":"girl"==pathUrlName?"girlfriend":"boyfriend",Sesid:ttsBlank(getCookie("SsToken"))?"":getCookie("SsToken"),"Sesid-sign":ttsBlank(getCookie("SsToken-sign"))?"":getCookie("SsToken-sign"),Authorization:ttsBlank(getCookie("access_token"))?"":"Bearer "+getCookie("access_token"),...o},body:JSON.stringify(t)}).then((t=>{if(setCookieSesid(t),0!=breakTime&&isSendMsgFn&&t.status>=500){const t={url:e,data:JSON.stringify(t),token:ttsBlank(getCookie("access_token"))?"":"Bearer "+getCookie("access_token"),Sesid:ttsBlank(getCookie("SsToken"))?"":getCookie("SsToken")};isSendMsgFn(e,t)}t.json().then((async e=>{401===e.code?(localStorage.removeItem("user_info"),setCookie("loginProduct",""),setSessionCookie("st",""),setCookie("refresh_token",""),setCookie("user_info",""),setCookie("access_token",""),isLogin(!1),n&&showLoginWindow(),await aiGirlFriend.initCharacters(),aiGirlFriend.GetRecentChatting(),aiGirlFriend.GetMyCharacters(),i(e)):i(e)}))})).catch((e=>{$Popup({type:"error",errorType:"network"}),r(e)}))}))}var fetchGet=function(e,t={},o=!0){let n;return isSendMsgFn=sendErrorMsgXPF(e),"chat/user/get-setting"==e&&(n=(new Date).getTime()),new Promise(((i,r)=>{fetch(TOOL_API+e,{method:"GET",headers:{"Content-Type":"application/json","X-TASK-VERSION":"2.0.0","Request-Origin":"vidqu","Request-Language":"es","Request-Project":"girl"==pathUrlName?"girlfriend":"boyfriend",Sesid:ttsBlank(getCookie("SsToken"))?"":getCookie("SsToken"),"Sesid-sign":ttsBlank(getCookie("SsToken-sign"))?"":getCookie("SsToken-sign"),Authorization:ttsBlank(getCookie("access_token"))?"":"Bearer "+getCookie("access_token"),...t}}).then((t=>{if("chat/user/get-setting"==e&&(breakTime=(new Date).getTime()-n),0!=breakTime&&isSendMsgFn&&t.status>=500){const t={url:e,token:ttsBlank(getCookie("access_token"))?"":"Bearer "+getCookie("access_token"),Sesid:ttsBlank(getCookie("SsToken"))?"":getCookie("SsToken")};isSendMsgFn(e,t)}setCookieSesid(t),t.json().then((async e=>{401===e.code?(aiChatting.closeChat(),localStorage.removeItem("user_info"),setCookie("loginProduct",""),setSessionCookie("st",""),setCookie("refresh_token",""),setCookie("user_info",""),setCookie("access_token",""),isLogin(!1),o&&showLoginWindow(),await aiGirlFriend.initCharacters(),aiGirlFriend.GetRecentChatting(),aiGirlFriend.GetMyCharacters(),r(e)):i(e)}))})).catch((e=>{$Popup({type:"error",errorType:"network"}),r(e)}))}))};function sendErrorMsgXPF(e){if(0===breakTime&&e!=lastUrl&&"chat/public/add-log"==e)return;let t=(new Date).getTime();const o=debounce((function(e,n){const i=(new Date).getTime()-t;if(console.log(e,lastUrl,"lastUrl"),e==lastUrl)return lastUrl="",void o(e);n={isTimeout:i>4e3,data:n},console.error("add-log"),fetchPost("chat/public/add-log",n)}),1e3);return o}function uploadImagePromise(e,t=""){return new Promise((async(o,n)=>{try{var i=await getUploadFileUrl(e,t);console.log(i,"res"),uploadFile({url:i.data.upload_url,file:e}).then((e=>{200!==e?n():o({res:i,code:e})})).catch((e=>n(e)))}catch(e){n(e),console.log(e)}}))}function getUploadFileUrl(e,t){let o=e.type,n=e.name;try{o=o.split("/")[1]||"png",t=t||n.split(".")[0]||"defaultName"}catch(e){o="png"}return fetchPost("ai/source/get-upload-url",{file_name:`${n}.${o}`})}function uploadFile(e){return new Promise((async(t,o)=>{try{t(await fetchPut(e.url,e.file,""))}catch(e){console.error(e.message),o(e)}}))}function getCountryType(){fetchGet("ai/public/get-country-type").then((e=>{if(200!==e.code)return;const t=e.data.name;"T1"!==t&&"T2"!==t||"ios"!==judgeClient()||"/pricing.html"===document.location.pathname||($(".fix-footer").css("bottom","0.88rem"),$("#iosFooter").show(),$("#ios_footer_btn").click((function(){gtag("event","en_faceappclick_fcios"),window.location.href="https://apps.apple.com/app/apple-store/id6497986083?pt=127019031&ct=from_es_vidq&mt=8"})))})).catch((e=>{console.log(e)}))}function lazyLoad(e=100){const t=document.querySelectorAll("[data-original]"),o=judgeClient(),n=function(e){if("IMG"==e.nodeName||"IFRAME"==e.nodeName)e.src?e.src=e.getAttribute("data-original"):e.setAttribute("src",e.getAttribute("data-original")),e.addEventListener("load",(function(){e.removeAttribute("data-original")}));else{const n=e.getAttribute("data-original");if(n.includes("`")){const t=n.split("`");let o="";t.forEach((e=>{o+="url("+e+"),"})),o=o.substring(0,o.lastIndexOf(",")),e.style.backgroundImage=o}else e.style.backgroundImage="url("+e.getAttribute("data-original")+")";if(n.includes("---")){var t=n.split("---");e.style.backgroundImage="pc"===o?"url("+t[0]+")":"url("+t[1]+")"}e.addEventListener("load",(function(){e.removeAttribute("data-original")}))}};let i=new IntersectionObserver((function(e,t){e.forEach((function(e){if(e.isIntersecting){if(e.target.className.includes("allin_bg")){e.target.parentNode.parentNode.parentNode.querySelectorAll("li").forEach((e=>{let t=e.querySelector("img");t.getAttribute("data-original")&&n(t)}))}else if(e.target.className.includes("comment_person")||e.target.className.includes("comment_star")){let t=e.target.parentNode.parentNode.parentNode.parentNode.querySelectorAll("li");t.length&&t.forEach((e=>{e.querySelectorAll("img").forEach((e=>{e.getAttribute("data-original")&&n(e)}))}))}else n(e.target);t.unobserve(e.target)}}))}),{rootMargin:`0px 0px ${e}px 0px`});t.forEach((e=>{i.observe(e)}))}$((function(){lazyLoad(),getCountryType()}));