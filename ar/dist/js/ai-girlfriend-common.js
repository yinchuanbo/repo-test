var TOOL_API=location.host.includes("vidqu.ai")&&!location.host.includes("test")?"https://tool-api.vidqu.ai/":"https://tool-api-test.vidqu.ai/";function judgeClient(){let e="";return e=/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)?"ios":/(Android)/i.test(navigator.userAgent)?"android":"pc",e}function ttsBlank(e){return null==e||"null"===e||""===e||void 0===e||"undefined"===e||"unknown"===e}const addScripTag=e=>{const o=document.createElement("script");o.src=e,o.type="module";(document.head||document.getElementsByTagName("head")[0]).appendChild(o)},addcssTag=e=>{const o=document.createElement("link");o.rel="stylesheet",o.href=e;(document.head||document.getElementsByTagName("head")[0]).appendChild(o)};function Modal(e){const{iconType:o="",titleText:t="",isCancel:n="false",submitType:i="",content:a="",contentList:s="[]",isClose:r="true",submitText:l=""}=e;$("body").append(`\n      <confirm-dialog\n        titleText="${t}"\n        contentList='${s}'\n        iconType="${o}"\n        isClose=${r}\n        isCancel="${n}"\n        submitType="${i}"\n        content="${a}"\n        submitText="${l}">\n      </confirm-dialog>`)}function initLoginDialog(e=""){const o="/dist/js";addScripTag(o+"/commonSignin/login-dialog.js"),addScripTag(o+"/confirm-dialog/index.js");const t=document.createElement("link");t.rel="stylesheet",t.href=o+"/commonSignin/aiChatLogin.css";(document.head||document.getElementsByTagName("head")[0]).appendChild(t);document.querySelector("body").innerHTML+="<my-component></my-component>"}function showLoginWindow(e={}){const{fn:o=(()=>{}),isReloading:t=!1,closeFn:n=(()=>{})}=e;document.body.style.overflow="hidden",$("my-component").off("loginsuccess").on("loginsuccess",(async()=>{o(),console.log("login successful")})).off("closeLoginDialog").on("closeLoginDialog",(()=>{n(),console.log("login closed"),document.body.style.overflow="auto"})),t?localStorage.setItem("toolsPosition",t):localStorage.setItem("toolsPosition","false"),$("my-component").length&&$("my-component")[0].showLoginDialog()}function goApp(){window.location.href="/app"}function goFaceSwap(){window.location.href="/face-swap.html"}function setCookieSesid(e){let o=e.headers.get("Sesid"),t=e.headers.get("Sesid-sign"),n=getCookie("SsToken"),i=getCookie("SsToken-sign");o=ttsBlank(o)?n:o,t=ttsBlank(o)?i:t,setCookie("SsToken",o),setCookie("SsToken-sign",t)}function fetchPost(e,o={},t={},n=!0){return new Promise(((i,a)=>{fetch(TOOL_API+e,{method:"POST",headers:{"Content-Type":"application/json","X-TASK-VERSION":"2.0.0","Request-Origin":"vidqu",Sesid:ttsBlank(getCookie("SsToken"))?"":getCookie("SsToken"),"Sesid-sign":ttsBlank(getCookie("SsToken-sign"))?"":getCookie("SsToken-sign"),Authorization:ttsBlank(getCookie("access_token"))?"":"Bearer "+getCookie("access_token"),...t},body:JSON.stringify(o)}).then((e=>{setCookieSesid(e),e.json().then((async e=>{401===e.code?(localStorage.removeItem("user_info"),setCookie("loginProduct",""),setSessionCookie("st",""),setCookie("refresh_token",""),setCookie("user_info",""),setCookie("access_token",""),isLogin(!1),n&&showLoginWindow(),await aiGirlFriend.initCharacters(),aiGirlFriend.GetRecentChatting(),aiGirlFriend.GetMyCharacters(),i(e)):i(e)}))})).catch((e=>{$Popup({type:"error",errorType:"network"}),a(e)}))}))}initLoginDialog();var fetchPut=function(e,o,t={}){return new Promise(((n,i)=>{fetch(e,{method:"PUT",headers:{"X-TASK-VERSION":"2.0.0",...t},body:o}).then((e=>n(e.status))).catch((e=>i(e)))}))},fetchGet=function(e,o={},t=!0){return new Promise(((n,i)=>{fetch(TOOL_API+e,{method:"GET",headers:{"Content-Type":"application/json","X-TASK-VERSION":"2.0.0","Request-Origin":"vidqu",Sesid:ttsBlank(getCookie("SsToken"))?"":getCookie("SsToken"),"Sesid-sign":ttsBlank(getCookie("SsToken-sign"))?"":getCookie("SsToken-sign"),Authorization:ttsBlank(getCookie("access_token"))?"":"Bearer "+getCookie("access_token"),...o}}).then((e=>{setCookieSesid(e),e.json().then((async e=>{401===e.code?(aiChatting.closeChat(),localStorage.removeItem("user_info"),setCookie("loginProduct",""),setSessionCookie("st",""),setCookie("refresh_token",""),setCookie("user_info",""),setCookie("access_token",""),isLogin(!1),t&&showLoginWindow(),await aiGirlFriend.initCharacters(),aiGirlFriend.GetRecentChatting(),aiGirlFriend.GetMyCharacters(),i(e)):n(e)}))})).catch((e=>{$Popup({type:"error",errorType:"network"}),i(e)}))}))};function setCookie(e,o,t=30){var n=new Date;n.setDate(n.getDate()+t);var i=location.hostname.includes(".vidqu.ai")?".vidqu.ai":location.hostname,a=encodeURIComponent(o)+(null==t?"":";expires="+n.toUTCString())+";path=/;domain="+i;document.cookie=e+"="+a}function getCookie(e){const o=document.cookie.split(";");for(const t of o){const[o,n]=t.trim().split("=");if(o===e)return decodeURIComponent(n)}return null}const isSeo=()=>{let e=!1,o=["google.","baidu.","yandex.","bing.","yahoo.","duckduckgo.",".naver.","go.mail.ru","qwant.","sougou.",".so.","rambler.",".ask.","daum.",".ecosia.",".startsiden.",".onetonline.","search.smt.docomo",".biglobe.","seznam."];for(let t of o)if(document.referrer.includes(t))return e=!0,e},getinsurValue=()=>{let e="";return"/ai-girlfriend.html"==document.location.pathname&&(e="en_vidq_aigirlfriend"),isSeo()&&(e=e.replace("en","enseo")),e};function getUrlParam(e){var o=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),t=window.location.search.substr(1).match(o);return null!=t?encodeURI(t[2]):null}const setInsurCookie=()=>{getCookie("insur")||isSeo()||getUrlParam("insur")||getCookie("insurLevel")||setCookie("insur",getinsurValue(),30),isSeo()&&(getCookie("insur")&&(getCookie("insur").includes("seo")||getUrlParam("insur")||getCookie("insurLevel"))||setCookie("insur",getinsurValue(),30)),getUrlParam("insur")&&(getCookie("insurLevel")||(setCookie("insur",getUrlParam("insur"),30),setCookie("insurLevel","strong",30),getCookie("aff")&&JSON.parse(getCookie("aff"))&&JSON.parse(getCookie("aff")).a_aid&&getCookie("insur")&&getCookie("insur").includes("googlecamp")&&(document.cookie="aff=; expires=Thu, 01 Jan 1971 00:00:00 UTC; path=/;domain=.vidqu.ai"))),null!==getUrlParam("a_aid")&&(cookieObj={a_aid:getUrlParam("a_aid"),chan:getUrlParam("chan"),data1:getUrlParam("data1"),data2:getUrlParam("data2")},getCookie("insur")&&getCookie("insur").includes("googlecamp")&&(document.cookie="insur=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;domain=.vidqu.ai",document.cookie="insurLevel=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;domain=.vidqu.ai"),setCookie("aff",JSON.stringify(cookieObj),120))};function getPreferredLanguage(){let e="";e=$("html").attr("lang").substring(0,2);var o=["en","de","es","fr","it","pt","ja","ar","kr","tw"].filter((function(o){return o===e}));return o.length>0?"ja"==o[0]?"jp":o[0]:"en"}const transtoBlob=({b64data:e,contentType:o="image/png"})=>{o=o||"";let t=1024,n=atob(e.split(",")[1]),i=n.length,a=Math.ceil(i/t),s=new Array(a);for(let e=0;e<a;++e){let o=e*t,a=Math.min(o+t,i),r=new Array(a-o);for(let e=o,t=0;e<a;++t,++e)r[t]=n[e].charCodeAt(0);s[e]=new Uint8Array(r)}return new Blob(s,{type:o})};function setSessionCookie(e,o){var t=location.hostname.includes(".vidqu.ai")?".vidqu.ai":location.hostname,n=escape(o)+";path=/;domain="+t;document.cookie=e+"="+n}function handleScrollAnimation(){$(".scroll-animation").each((function(e,o){o.getBoundingClientRect().top<.66*window.innerHeight&&$(o).addClass("on")}))}function chatLogin(){isLogin(!!(getCookie("access_token")?getCookie("access_token"):""))}window.addEventListener("scroll",(function(){handleScrollAnimation()}));var defaultHeadImg="https://www.vidnoz.com/img/_common/head.png";function isLogin(e){if(e){$("#header_login").hide(),$("#header_user").show();const e=JSON.parse(getCookie("user_info"));$("#header_user .header_avator").attr("src",e.head_portrait||defaultHeadImg),$(".meau_item.signout").show()}else $("#header_login").show(),$("#header_user").hide(),$(".meau_item.signout").hide()}function resizeImageByFile(e){return new Promise(((o,t)=>{var n=new FileReader;n.onloadend=()=>{let e=new Image;e.onload=()=>{let t=document.createElement("canvas"),n=t.getContext("2d"),i=Math.max(e.width,e.height);if(i>3072){let o=3072/i;t.width=e.width*o,t.height=e.height*o}else t.width=e.width,t.height=e.height;n.drawImage(e,0,0,t.width,t.height);var a=t.toDataURL(),s=transtoBlob({b64data:a,contentType:"image/png"});let r="width";t.width<t.height&&(r="height"),o({blog:s,imgType:r})},e.onerror=()=>{o({blog:null})},e.src=n.result},n.onerror=t,n.readAsDataURL(e)}))}$(".meau_item.user img").click((function(){$(this).hasClass("active")?$("#header_user .signout").hide():$("#header_user .signout").css("display","flex"),$(this).toggleClass("active")})),$("body").on("mouseup",(function(e){0==$(e.target).parents(".meau_item.user").length&&($(".meau_item.user img").removeClass("active"),$("#header_user .signout").hide())}));const currentDate=new Date,timezoneOffset=currentDate.getTimezoneOffset(),browserLanguage=navigator.language||navigator.userLanguage,getWhiteList=()=>{fetchPost(`api/site/mio-config?t=${(new Date).getTime()}`,{}).then((e=>{200===e.code?e.data.is_in_ip_whitelist||-480!==timezoneOffset||"zh-cn"!==browserLanguage.toLowerCase()||(document.body.innerHTML='<div class="shield-page">The website is not available</div>',document.head.innerHTML="\n          <style>\n               *{\n                   padding:0;\n                   margin:0;\n                 }\n               body{\n                 background-image: linear-gradient(to right, rgb(241,238,255), rgb(254,254,255));\n                 display: flex;\n                 align-items: center;\n                 justify-content: center;\n                 width: 100vw;\n                 height: 100vh;\n                 overflow: hidden;\n               }\n               .shield-page{\n                 font: normal normal 600 30px/30px Poppins;\n                 color: #785EEE;\n               }\n               @media (max-width: 768px){\n                 .shield-page{\n                   font: normal normal 600 20px/20px Poppins;\n                 }\n               }\n          </style>"):console.log("err")}))};function areObjectsEqual(e,o){const t=Object.keys(e),n=Object.keys(o);if(t.length!==n.length)return console.log("length unlike"),!1;for(const n of t){if(!o.hasOwnProperty(n))return console.log("key is not +",n),!1;if(e[n]!=o[n])return console.log("value is not +",n,e[n],o[n]),!1}return!0}function randomchoice(e){let o=null;return function(){let t=e.filter((e=>e!==o)),n=t[Math.floor(Math.random()*t.length)];return o=n,n}}function isBlob(e){return e instanceof Blob}function debounce(e,o){let t;return function(){let n=this,i=arguments;clearTimeout(t),t=setTimeout((function(){e.apply(n,i)}),o)}}fetchPost(`api/site/mio-config?t=${(new Date).getTime()}`,{}).then((e=>{200===e.code?e.data.is_in_ip_whitelist||-480!==timezoneOffset||"zh-cn"!==browserLanguage.toLowerCase()||(document.body.innerHTML='<div class="shield-page">The website is not available</div>',document.head.innerHTML="\n          <style>\n               *{\n                   padding:0;\n                   margin:0;\n                 }\n               body{\n                 background-image: linear-gradient(to right, rgb(241,238,255), rgb(254,254,255));\n                 display: flex;\n                 align-items: center;\n                 justify-content: center;\n                 width: 100vw;\n                 height: 100vh;\n                 overflow: hidden;\n               }\n               .shield-page{\n                 font: normal normal 600 30px/30px Poppins;\n                 color: #785EEE;\n               }\n               @media (max-width: 768px){\n                 .shield-page{\n                   font: normal normal 600 20px/20px Poppins;\n                 }\n               }\n          </style>"):console.log("err")})),$("#header_login").click((()=>{gtag("event","login_aigirlfriend_header"),showLoginWindow({fn:()=>{chatLogin()}})})),$(".signout").click((()=>{$(".meau_icon").hasClass("active")&&$(".meau_icon").click(),gtag("event","signout_aigirlfriend_header"),localStorage.removeItem("user_info"),setCookie("loginProduct",""),setSessionCookie("st",""),setCookie("refresh_token",""),setCookie("user_info",""),setCookie("access_token",""),isLogin(!1)})),$(document).ready((function(){chatLogin(),getCookie("insur")||isSeo()||getUrlParam("insur")||getCookie("insurLevel")||setCookie("insur",getinsurValue(),30),isSeo()&&(getCookie("insur")&&(getCookie("insur").includes("seo")||getUrlParam("insur")||getCookie("insurLevel"))||setCookie("insur",getinsurValue(),30)),getUrlParam("insur")&&(getCookie("insurLevel")||(setCookie("insur",getUrlParam("insur"),30),setCookie("insurLevel","strong",30),getCookie("aff")&&JSON.parse(getCookie("aff"))&&JSON.parse(getCookie("aff")).a_aid&&getCookie("insur")&&getCookie("insur").includes("googlecamp")&&(document.cookie="aff=; expires=Thu, 01 Jan 1971 00:00:00 UTC; path=/;domain=.vidqu.ai"))),null!==getUrlParam("a_aid")&&(cookieObj={a_aid:getUrlParam("a_aid"),chan:getUrlParam("chan"),data1:getUrlParam("data1"),data2:getUrlParam("data2")},getCookie("insur")&&getCookie("insur").includes("googlecamp")&&(document.cookie="insur=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;domain=.vidqu.ai",document.cookie="insurLevel=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;domain=.vidqu.ai"),setCookie("aff",JSON.stringify(cookieObj),120))})),$(".meau_icon").click((function(){let e=getCookie("access_token")?getCookie("access_token"):"";console.log(e,"access_token"),e?$(".meau_item.signout").show():$(".meau_item.signout").hide(),$(this).hasClass("active")?($(".meau_list").slideUp(),document.body.style.overflow="auto"):($(".meau_list").slideDown(),document.body.style.overflow="hidden"),$(this).toggleClass("active")})),$(".meau_list.mobile_show").click((function(e){$(e.target).hasClass("meau_list")&&$(".meau_icon").click()})),uploadImagePromise=(e,o="")=>new Promise((async(t,n)=>{try{var i=await getUploadFileUrl(e,o);console.log(i,"res"),uploadFile({url:i.data.upload_url,file:e}).then((e=>{200!==e?n():t({res:i,code:e})})).catch((e=>n(e)))}catch(e){n(e),console.log(e)}})),getUploadFileUrl=(e,o)=>{let t=e.type,n=e.name;try{t=t.split("/")[1]||"png",o=o||n.split(".")[0]||"defaultName"}catch(e){t="png"}return fetchPost("ai/source/get-upload-url",{file_name:`${n}.${t}`})},uploadFile=e=>new Promise((async(o,t)=>{try{o(await fetchPut(e.url,e.file,""))}catch(e){console.error(e.message),t(e)}})),window.questLanguage=getPreferredLanguage(),window.userModel=judgeClient();