var controllers=[],mulPhotoDownloadData=null;function getFSMCreditsText(e,t={},a=!1){a&&t.val>1&&(e+="_p");let i=lan.faceSwapPop02[e];for(let e in t){const a=new RegExp(`{{${e}}}`,"g");i=i.replace(a,t[e])}return i}function getfsCreditsText(e,t={},a=!1){a&&t.val>1&&(e+="_p");let i=lan.faceSwapPop[e];for(let e in t){const a=new RegExp(`{{${e}}}`,"g");i=i.replace(a,t[e])}return i}let multitextContentObj=lan;function getMultiText(e,t={},a=!1){let i=lan[e];for(let e in t){const a=new RegExp(`{{${e}}}`,"g");i=i.replace(a,t[e])}return i}let show_ppriority=0,textContentObj=lan.faceSwapPop01;function setTextContentObj(e,t={}){let a=textContentObj[e];for(let e in t){const i=new RegExp(`{{${e}}}`,"g");a=a.replace(i,t[e])}return a}function getNumberNow(){return multiAiFace?multiAiFace.formdata.avatar_main_key.filter((e=>e.main_part_key)).length:0}function isMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function setmultitextContentObj(e,t={}){let a=lan[e];for(let e in t){const i=new RegExp(`{{${e}}}`,"g");a=a.replace(i,t[e])}return a}var photo_task_id=null,canMultiFaceData={},isShowBtnCredit=!1;window.multiphotoAiFaceChanging={};class MultiAiFace{constructor(e){var t=this;this.multimodel=e.multimodel,t.setMaskUnlockPriority(),Object.setPrototypeOf(MultiAiFace.prototype,this.data()),this.form=new Proxy(t.proxyData,{set:(e,a,i)=>(e[a]=i,e.originImage?t.handleOriginImageExist():($("#multiple_Face_swapper_container .multi_upload_before").show(),$("#multiple_Face_swapper_container .multi_upload_after").hide(),$("#multiple_Face_swapper_container .change_multi_face_btn").addClass("disabled")),e.firstPicLoading?($("#multiple_Face_swapper_container .multi_Input").addClass("disabled"),$("#multiple_Face_swapper_container .random_btn").addClass("disabled")):($("#multiple_Face_swapper_container .multi_Input").removeClass("disabled"),$("#multiple_Face_swapper_container .random_btn").removeClass("disabled")),!0),get:(e,t)=>e[t]})}data(){return{mergeImg:{width:0,height:0},proxyData:{originImage:null,firstPicLoading:!1},tryCount:0,multipleIndex:null,delay:2e3,lastCall:0,lastSuccessTaskid:null,taskid:null,imgList:[],mergeImgUrl:null,mergeKey:null,changeFaceLoading:!1,canMultiFaceData:{},showCreditBannerBool:!0,uploadFacesNumber:0,costCoins:0,formdata:{avatar_obey_key:null,get_face_id:null,watermark_type:2,avatar_main_key:[]},itemLoading:[]}}resizeImageByFile(e){var t=this;return new Promise(((a,i)=>{var n=new FileReader;n.onloadend=()=>{let e=new Image;e.onload=()=>{let i=document.createElement("canvas"),n=i.getContext("2d"),o=Math.max(e.width,e.height);if(o>1920){let t=1920/o;i.width=e.width*t,i.height=e.height*t}else i.width=e.width,i.height=e.height;n.drawImage(e,0,0,i.width,i.height);var l=i.toDataURL(),s=t.transtoBlob({b64data:l,contentType:"image/png"});let r="width";i.width<i.height&&(r="height"),a({blog:s,imgType:r})},e.onerror=()=>{i(new Error("Image load failed"))},e.src=n.result},n.onerror=i,n.readAsDataURL(e)}))}getUploadFileUrl=e=>{let t=e;try{t=e.split("/")[1]||"png"}catch(e){t="png"}return fetchPost("ai/source/temp-upload-url",{file_name:"Vidnoz_AiFaceSwap_"+(new Date).getTime()+"."+t},TOOL_API)};uploadFile=({url:e,file:t})=>new Promise((async(a,i)=>{try{a(await fetchPut(e,t,""))}catch(e){console.error(e.message),i(e)}}));handleOriginImageExist(){$("#multiple_Face_swapper_container .multi_upload_before").hide(),$("#multiple_Face_swapper_container .multi_upload_after").show(),$("#multiple_Face_swapper_container .drag_loadbox").addClass("height160")}async addMultiImage({addData:e={},file:t,callback:a,ourPicsIndex:i=null}){const n=e?.demoKey||void 0;if(this.setFirstStart(!0),showRemoveWatemark_btn(!1),"string"==typeof t||this.checkFileType(t))try{if(this.setLiLoading(!0),"string"!=typeof t)if(await this.checkFacePicMulti(t)<1)return $("#multiple_Face_swapper_container .multi_uploader_multi")[0].value="",this.setFirstStart(!1),this.setLiLoading(!1),void this.showModalAboutFaceNumber();this.showToolBtn(!1),$("#multiple_Face_swapper_container .change_multi_face_btn").addClass("disabled");let l,s,r,c=t.type;if(n)l=e.demoSrc,s=e.demoSrc,this.formdata.avatar_obey_key=n;else{const{blog:e,res:a,imgType:i}=await this.uploadMultiImagePromise(t);this.formdata.avatar_obey_key=a.data.key,l=e,r=i,s=URL.createObjectURL(l)}this.mergeKey=null;var o={file:l,showUrl:s,suffix:c,demoKey:n};this.uploadFacesNumber=0,showBtnCreditsMultiImage(!1),a&&a(o,r,i)}catch(e){console.error(e);let t=multitextContentObj.faceSwapPop01.upload_file_failed;window.userRuleConfig.credit&&(t=multitextContentObj.faceSwapPop01.upload_file_failed_credits),this.multimodel.errorMessage({conText:`\n        <h1>${multitextContentObj.faceSwapPop01.processImageTitle}</h1>\n        <p>${textContentObj.filereadfail}</p>\n        `,btnText:multitextContentObj.OK}),this.checkMultiChangeFaceStatus(),this.multimodel.options.visible=!0,$("#multiple_Face_swapper_container .multi_uploader_multi")[0].value="",this.setFirstStart(!1),this.setLiLoading(!1)}}async addFindFacesTask(e){try{this.changeFaceLoading=!0;let{data:t,code:a}=await fetchPost("ai/ai-tool/add-task",{action:"multiple_get_face",param:{avatar_obey_key:this.formdata.avatar_obey_key}},TOOL_API,{"X-TASK-VERSION":"2.0.0"});200===a?(this.formdata.get_face_id=t.task_id,this.getFindFacesTask(e)):3014===a?(this.changeFaceLoading=!1,showMaximumM(),this.checkMultiChangeFaceStatus(),this.setFirstStart(!1),this.setLiLoading(!1)):(this.changeFaceLoading=!1,this.multimodel.errorMessage({conText:`\n            <h1>${multitextContentObj.faceSwapPop01.processImageTitle}</h1>\n          `,btnText:multitextContentObj.OK}),this.multimodel.options.visible=!0,this.setFirstStart(!1),this.setLiLoading(!1),this.checkMultiChangeFaceStatus())}catch(e){this.changeFaceLoading=!1,console.error(e)}}async getFindFacesTask(e){const t=this,a=this.formdata.get_face_id;a?fetchPost("ai/tool/get-task",{id:a},TOOL_API).then((a=>{if(a.message.includes("no face"))return this.changeFaceLoading=!1,this.multimodel.errorMessage({conText:`\n            <h1>${multitextContentObj.faceSwapPop01.processImageTitle}</h1>\n            <p>${multitextContentObj.NoFaceMulti}</p>\n          `,btnText:multitextContentObj.OK}),this.multimodel.options.visible=!0,this.setLoadingStart(!1),this.setLoadingMaskTip(!1),$("#multiple_Face_swapper_container .change_multi_face_btn").addClass("disabled"),this.formdata.avatar_main_key=[],t.setMultipleListImgs(),void $("#multiple_Face_swapper_container .people_recognized_box").hide();if(200!==a.code){this.changeFaceLoading=!1;let e=multitextContentObj.faceSwapPop01.processImage;this.multimodel.errorMessage({conText:`\n            <h1>${multitextContentObj.faceSwapPop01.processImageTitle}</h1>\n            <p>${e}</p>\n          `,btnText:multitextContentObj.OK}),this.multimodel.options.visible=!0,this.setLoadingStart(!1),this.setLoadingMaskTip(!1)}else this.tryCount=0,0===a.data.status?(this.formdata.avatar_main_key=a.data.additional_data.map((e=>({obey_part_key:e.avatar_part_key,obey_part_url:e.avatar_part_url}))),t.setMultipleListImgs(),e?.(),setTimeout((()=>{this.changeFaceLoading=!1,$("#multiple_Face_swapper_container .people_recognized_box").show(),this.setFirstStart(!1),this.setLiLoading(!1)}),1e3)):setTimeout((()=>{this.getFindFacesTask(e)}),2e3)})).catch((e=>{this.changeFaceLoading=!1,this.tryCount>=3?(this.multimodel.errorMessage({conText:`\n            <h1>${multitextContentObj.faceSwapPop01.processImageTitle}</h1>\n            <p>${multitextContentObj.processImage}</p>\n          `,btnText:multitextContentObj.OK}),this.multimodel.options.visible=!0,this.setLoadingStart(!1)):(console.log("retrying"),setTimeout((()=>{this.getFinalImg(a),this.tryCount++}),5e3))})):this.changeFaceLoading=!1}urlToFile(e){return new Promise(((t,a)=>{fetch(e).then((e=>e.blob())).then((e=>{t(e)})).catch((e=>{a(e)}))}))}setLoadingStart(e){e?($("#multiple_Face_swapper_container .random_btn").addClass("disabled"),this.setFirstStart(!0),$("#multiple_Face_swapper_container .change_multi_face_btn ._multi_step3_btn").text(multitextContentObj.Generating),$("#multiple_Face_swapper_container .multi-generating-animate").show(),this.changeFaceLoading=!0,$("#multiple_Face_swapper_container #mult_main_face_change_img").attr("style","filter: blur(5px) brightness(0.7)"),$("#multiple_Face_swapper_container .change_multi_face_btn").addClass("disabled"),this.setLiLoading(!0),$("#multiple_Face_swapper_container .loading_multi_box p").text(getMultiText("Loading2")),$("#multiple_Face_swapper_container .loading_multi_box").show(),$("#multiple_Face_swapper_container .people_recognized_list").addClass("inter_loading"),$(".high_quality_append_dom").attr("style","pointer-events:none")):(this.setFirstStart(!1),$("#multiple_Face_swapper_container .random_btn").removeClass("disabled"),$("#multiple_Face_swapper_container .change_multi_face_btn ._multi_step3_btn").text(multitextContentObj.step3_btn),$("#multiple_Face_swapper_container .multi-generating-animate").hide(),$("#multiple_Face_swapper_container .change_multi_face_btn").removeClass("disabled"),this.changeFaceLoading=!1,this.setLiLoading(!1),$("#multiple_Face_swapper_container #mult_main_face_change_img").attr("style",""),$("#multiple_Face_swapper_container .loading_multi_box").hide(),$("#multiple_Face_swapper_container .people_recognized_list").removeClass("inter_loading"),$(".high_quality_append_dom").attr("style",""))}setLiLoading=e=>{e?$("#multiple_Face_swapper_container .multi_pics li").attr("style","filter: blur(3px);pointer-events: none;"):$("#multiple_Face_swapper_container .multi_pics li").attr("style","")};setBigImageStart=e=>{e?($("#multiple_Face_swapper_container #mult_main_face_change_img").attr("style","filter: blur(5px) brightness(0.7)"),$("#multiple_Face_swapper_container .loading_multi_box p").text(multitextContentObj.Loading),$("#multiple_Face_swapper_container .loading_multi_box").show()):($("#multiple_Face_swapper_container #mult_main_face_change_img").attr("style",""),$("#multiple_Face_swapper_container .loading_multi_box").hide())};transtoBlob=({b64data:e,contentType:t="image/png"})=>{t=t||"";let a=1024,i=atob(e.split(",")[1]),n=i.length,o=Math.ceil(n/a),l=new Array(o);for(let e=0;e<o;++e){let t=e*a,o=Math.min(t+a,n),s=new Array(o-t);for(let e=t,a=0;e<o;++a,++e)s[a]=i[e].charCodeAt(0);l[e]=new Uint8Array(s)}return new Blob(l,{type:t})};setFirstStart=e=>{e?($("#multiple_Face_swapper_container .multi_upload_before").addClass("loading"),$("#multiple_Face_swapper_container .multi_upload_after").addClass("loading"),$("#multiple_Face_swapper_container .multi_Input").addClass("disabled"),$("#multiple_Face_swapper_container .multi_Input .multi_uploader_btn_con").removeClass("show_btn_con").hide(),$("#multiple_Face_swapper_container .multi_Input .multi_uploader_btn_loading").show(),$("#multiple_Face_swapper_container .multi_uploader_btn .multi_uploader_btn_con").hide(),$("#multiple_Face_swapper_container .multi_uploader_btn .multi_uploader_btn_loading").show(),$("#multiple_Face_swapper_container .people_recognized_list").addClass("inter_loading"),this.form.firstPicLoading=!0,this.setBigImageStart(!0)):($("#multiple_Face_swapper_container .multi_upload_before").removeClass("loading"),$("#multiple_Face_swapper_container .multi_upload_after").removeClass("loading"),$("#multiple_Face_swapper_container .multi_Input").removeClass("disabled"),$("#multiple_Face_swapper_container .multi_Input .multi_uploader_btn_con").show().addClass("show_btn_con"),$("#multiple_Face_swapper_container .multi_Input .multi_uploader_btn_loading").hide(),$("#multiple_Face_swapper_container .multi_uploader_btn .multi_uploader_btn_loading").hide(),$("#multiple_Face_swapper_container .multi_uploader_btn .multi_uploader_btn_con").show(),$("#multiple_Face_swapper_container .people_recognized_list").removeClass("inter_loading"),this.form.firstPicLoading=!1,this.setBigImageStart(!1))};checkMultiChangeFaceStatus=()=>{this.formdata.avatar_main_key.some((e=>e.main_part_key))?($("#multiple_Face_swapper_container .change_multi_face_btn ._multi_step3_btn").text(multitextContentObj.step3_btn),$("#multiple_Face_swapper_container .multi-generating-animate").hide(),$("#multiple_Face_swapper_container .change_multi_face_btn").removeClass("disabled"),this.changeFaceLoading=!1):$("#multiple_Face_swapper_container .change_multi_face_btn").addClass("disabled")};changeMultiFace=async()=>{if(this.changeFaceLoading)return;this.setLoadingStart(!0),this.showToolBtn(!1);if(!await this.getCanSwapFaceBool())return void this.setLoadingStart(!1);const e={...this.formdata,avatar_main_key:this.formdata.avatar_main_key.filter((e=>e.main_part_key)),is_hd:multicreditSystem?.is_hd};fetchPost("ai/ai-tool/add-task",{param:e,action:"multiple_face_swap"},TOOL_API,{"X-TASK-VERSION":"2.0.0"}).then((async e=>{200===e.code?(showBtnCreditsMultiImage(!0),1===e.data.is_wateremark?showRemoveWatemark_btn(!0):showRemoveWatemark_btn(!1),this.getFinalImg(e.data.task_id)):3014===e.code?(showMaximumM(),this.checkMultiChangeFaceStatus(),(this.mergeKey||"multi_img"!==$("#multiple_Face_swapper_container #mult_main_face_change_img").attr("data-key"))&&this.showToolBtn(!0,!0),this.setFirstStart(!1),this.setLiLoading(!1)):401===e.code?(this.multimodel.errorMessage({conText:multitextContentObj.loginFirst,btnText:multitextContentObj.OK}),this.multimodel.options.visible=!0,this.setLoadingStart(!1)):3001===e.code?("multi_img"!==$("#multiple_Face_swapper_container #mult_main_face_change_img").attr("data-key")&&this.showToolBtn(!0,!0),$("#multiple_Face_swapper_container .multi_stpe3_upload .v_step3_btn_credits").show(),multicreditSystem.showCreditBanner(!1),showMaximumM(),this.setLoadingStart(!1)):3008===e.code?showNotEnoughCreditsM():(this.multimodel.errorMessage({conText:`\n              <h1>${multitextContentObj.faceSwapPop01.errorUploadTitle}</h1>\n              <p>${multitextContentObj.faceSwapPop01.errorUpload}</p>\n            `,btnText:multitextContentObj.OK}),this.multimodel.options.visible=!0,this.setLoadingStart(!1))})).catch((e=>{console.error(e),this.multimodel.errorMessage({conText:`\n            <h1>${multitextContentObj.faceSwapPop01.errorUploadTitle}</h1>\n            <p>${multitextContentObj.faceSwapPop01.errorUpload}</p>\n          `,btnText:multitextContentObj.OK}),this.checkMultiChangeFaceStatus(),this.multimodel.options.visible=!0,this.setLoadingStart(!1)}))};checkFileType=e=>{if("string"==typeof e)return!0;var t=e.type;return isMobileDevice()&&e.size>104857600?(this.multimodel.errorMessage({conText:`\n          <h1>${multitextContentObj.faceSwapPop01.processImageTitle}</h1>\n          <p>${getFSMCreditsText("toolarge",{val:100})}</p>\n        `,btnText:textContentObj.ok}),this.multimodel.options.visible=!0,this.setBigImageStart(!1),this.setFirstStart(!1),!1):!!["image/jpeg","image/png","image/webp","application/octet-stream"].includes(t)||(this.multimodel.errorMessage({conText:`\n          <h1>${multitextContentObj.faceSwapPop01.processImageTitle}</h1>\n          <p>${multitextContentObj.faceSwapPop01.limit}</p>\n        `,btnText:multitextContentObj.OK}),this.multimodel.options.visible=!0,this.setBigImageStart(!1),this.setFirstStart(!1),$("#multiple_Face_swapper_container #multi_uploader")[0].value="",!1)};showToolBtn(e){if(e){var t=window.getComputedStyle(document.querySelector("#mult_main_face_change_img"));this.mergeImg={width:t.getPropertyValue("width").split("px")[0],height:t.getPropertyValue("height").split("px")[0]},$("#multiple_Face_swapper_container .multi_img_btns").attr("style","display: flex;"),$("#multiple_Face_swapper_container .my_files_tips").attr("style","display: flex;"),gtag("event","show_vidqmyfiles_imgtipsfile_m")}else $("#multiple_Face_swapper_container .multi_img_btns").hide(),$("#multiple_Face_swapper_container .my_files_tips").hide()}getFinalImg=e=>{const t=this;this.showToolBtn(!1),this.setLoadingStart(!0),this.taskid=e,fetchPost("ai/tool/get-task",{id:e},TOOL_API).then((async a=>{if(a.message.includes("nsfw")){let e=multitextContentObj.nsfw_photo;return t.canMultiFaceData.data?.credit&&(e=multitextContentObj.faceSwapPop01.Credits_failed_nsfw),this.multimodel.errorMessage({conText:`\n              <h1>${multitextContentObj.faceSwapPop01.processImageTitle}</h1>\n              <p>${e}</p>\n            `,btnText:multitextContentObj.OK}),this.multimodel.options.visible=!0,this.setLoadingStart(!1),t.setLoadingMaskTip(!1),void("multi_img"!==$("#multiple_Face_swapper_container #mult_main_face_change_img").attr("data-key")&&this.showToolBtn(!0,!0))}if(a.message.includes("celebrity")){let e=multitextContentObj.faceSwapPop01.Target_Photo;return t.canMultiFaceData.data?.credit&&(e=multitextContentObj.faceSwapPop01.Credits_failed_celebrity),this.multimodel.errorMessage({conText:`\n              <h1>${multitextContentObj.faceSwapPop01.processImageTitle}</h1>\n              <p>${e}</p>\n            `,btnText:multitextContentObj.OK}),this.multimodel.options.visible=!0,this.setLoadingStart(!1),t.setLoadingMaskTip(!1),void("multi_img"!==$("#multiple_Face_swapper_container #mult_main_face_change_img").attr("data-key")&&this.showToolBtn(!0,!0))}if(a.message.includes("faces=")&&a.message.includes("faces=0")){let e=multitextContentObj.NoFaceMulti;return t.canMultiFaceData.data?.credit&&(e=multitextContentObj.faceSwapPop01.Credits_failed_NoFaceMulti),this.multimodel.errorMessage({conText:`\n                <h1>${multitextContentObj.faceSwapPop01.processImageTitle}</h1>\n                <p>${e}</p>\n              `,btnText:multitextContentObj.OK}),this.multimodel.options.visible=!0,this.setLoadingStart(!1),t.setLoadingMaskTip(!1),void("multi_img"!==$("#multiple_Face_swapper_container #mult_main_face_change_img").attr("data-key")&&this.showToolBtn(!0,!0))}if(200!==a.code){let e=multitextContentObj.faceSwapPop01.processImage;this.canMultiFaceData.data?.credit&&(e=multitextContentObj.faceSwapPop01.Credits_failed),this.multimodel.errorMessage({conText:`\n              <h1>${multitextContentObj.faceSwapPop01.processImageTitle}</h1>\n              <p>${e}</p>\n            `,btnText:multitextContentObj.OK}),this.multimodel.options.visible=!0,this.setLoadingStart(!1),t.setLoadingMaskTip(!1)}else{if(1===a.data.wait?.show_wait){0==show_ppriority&&(gtag("event","show_mulfaceswap_imgpriority"),show_ppriority++);let{num:e,second:i}=a.data.wait;t.setLoadingMaskTip(!0,{show_wait:1,num:e,second:i})}else t.setLoadingMaskTip(!1);this.tryCount=0,0===a.data.status?(mulPhotoDownloadData=await setDownloadData("multiple_face_swap",a),show_ppriority=0,this.mergeImgUrl=a.data.additional_data?.merge_url,this.mergeKey=a.data.additional_data?.merge_key,setCookie("faceSwapTime_swap",Date.now(),2),window.userRuleConfig.credit=a.data.credit,multicreditSystem.showCreditBanner({bool:!0}),multiVcreditSystem.showCreditBanner({bool:!0}),changeHeaderCredit(a.data.credit),$("#multiple_Face_swapper_container #mult_main_face_change_img").attr("data-key",""),$("#multiple_Face_swapper_container #mult_main_face_change_img").attr("src",this.mergeImgUrl),gtag("event","succ_mulfaceswap_imgswapbtn"),this.lastSuccessTaskid=this.taskid,setTimeout((()=>{this.setLoadingStart(!1),$("#multiple_Face_swapper_container .change_multi_face_btn").removeClass("disabled"),this.showToolBtn(!0)}),1e3)):setTimeout((()=>{this.getFinalImg(e)}),2e3)}})).catch((t=>{if(console.error(t),this.tryCount>=3){let e=multitextContentObj.faceSwapPop01.processImage;this.canMultiFaceData.data?.credit&&(e=multitextContentObj.faceSwapPop01.Credits_failed),this.multimodel.errorMessage({conText:`\n                <h1>${multitextContentObj.faceSwapPop01.processImageTitle}</h1>\n                <p>${e}</p>\n              `,btnText:multitextContentObj.OK}),this.multimodel.options.visible=!0,this.setLoadingStart(!1),this.setLoadingMaskTip(!1)}else console.log("retrying"),setTimeout((()=>{this.getFinalImg(e),this.tryCount++}),5e3)}))};faceCheck=async({blobUrl:e=""})=>new Promise(((t,a)=>{var i=new Image;i.src=e,i.onload=async()=>{try{const e=await faceapi.detectAllFaces(i,new faceapi.SsdMobilenetv1Options);if(e.length)t(e.length);else{const e=await faceapi.detectAllFaces(i,new faceapi.TinyFaceDetectorOptions({inputSize:416}));t(e.length)}}catch(e){console.log(e),a(e)}},i.onerror=async()=>{console.log(error),a(error)}}));checkFacePicMulti=e=>new Promise((async(t,a)=>{try{let a=e;"string"!=typeof e&&(a=URL.createObjectURL(e)),t(1)}catch(e){a(e)}}));showModalAboutFaceNumber=(e,t)=>{$("#multiple_Face_swapper_container .multi_uploader_multi")[0].value="";let a=multitextContentObj.NoFaceMulti;e&&e>1&&(a=multitextContentObj.faceSwapPop01.manyFace),this.multimodel.errorMessage({conText:`\n        <h1>${multitextContentObj.faceSwapPop01.processImageTitle}</h1>\n        <p>${a}</p>\n      `,btnText:multitextContentObj.faceSwapPop01.replaceImg,btnClick:()=>{"faces_recognized"===t?$("#multiple_Face_swapper_container #multi_uploader").click():$("#multiple_Face_swapper_container .multi_uploader_multi").click()}}),this.multimodel.options.visible=!0};getImgList(){var e=this;fetchGet("ai/public/pic-example?action=multiple_face_swap&water_type=2").then((t=>{if(401===t.code)return this.multimodel.errorMessage({conText:multitextContentObj.loginFirst,btnText:multitextContentObj.OK}),this.multimodel.options.visible=!0,void $("#multiple_Face_swapper_container .multi_pics").html(multitextContentObj.loginFirst);e.imgList=t.data,t.data.forEach(((e,t)=>{$("#multiple_face_swapper_try .photo-content-box .content-box").append(`\n            <li><img src="${e.pic_url}" data-key="${e.pic_key}" data-index="${t+1}"/></li> \n          `)})),$("#multiple_face_swapper_try .photo-content-box .content-box li").each((function(){$(this).on("click",(t=>{var a=$(this).find("img").attr("src"),i=$(this).find("img").attr("data-key");a&&!e.changeFaceLoading&&(gtag("event","click_mulfaceswap_imgtpl"),e.showToolBtn(!1),e.addMultiImage({addData:{demoKey:i,demoSrc:a},file:a,callback:(t,a,i)=>{var n="width"===a?"height":"width";$("#multiple_Face_swapper_container #mult_main_face_change_img").attr("data-key","multi_img"),$("#multiple_Face_swapper_container .multi_img").find("img").attr("src",t.showUrl).removeClass(n).addClass(`${a}`),$("#multiple_Face_swapper_container #mult_main_face_change_img").attr("src",t.showUrl),e.form.originImage=t,e.addFindFacesTask((()=>{i||$("#multiple_Face_swapper_container #multi_img").attr("data-index",null),i&&$("#multiple_Face_swapper_container #multi_img").attr("data-index",i)}))},ourPicsIndex:$(this).index()+1}))}))}))})).catch((e=>{console.error("fail",e)}))}uploadMultiImagePromise(e){return new Promise((async(t,a)=>{try{var i=await this.getUploadFileUrl(e.type),{blog:n,imgType:o}=await this.resizeImageByFile(e);this.uploadFile({url:i.data.upload_url,file:n}).then((e=>{t({res:i,blog:n,imgType:o})})).catch((e=>a(e)))}catch(e){console.log(e),a(!1)}}))}getSourceUrl(e){return fetchPost("ai/source/get-access-url",{key:e,file_name:"Vidnoz_AiFaceSwap_"+(new Date).getTime()+".png"})}setDragLoading(e,t){t?(this.proxyData.originImage?$(`.${e} .can_drag_box`).addClass("blur"):$(`.${e} .other_box`).addClass("blur"),$(`.${e} .drag_loadbox`).show()):($(`.${e} .other_box`).removeClass("blur"),$(`.${e} .can_drag_box`).removeClass("blur"),$(`.${e} .drag_loadbox`).hide())}throttle(e,t){let a=0;return function(...i){const n=(new Date).getTime();n-a>=t&&(e(...i),a=n)}}getCanSwapFaceBool(){return new Promise((async(e,t)=>{if(await this.getCanSwapFaceData(),getCookie("access_token"))if(200===this.canMultiFaceData?.code){if(1===this.canMultiFaceData.data?.last_use_credit&&0===this.canMultiFaceData.data?.credit){e(await showRemoveWatermarkM())}e(!0)}else{if(3008===this.canMultiFaceData.code)return showNotEnoughCreditsM(),void e(!1);showMaximumM(),e(!1)}else 200!==this.canMultiFaceData.code?(showMaximumM(),e(!1)):e(!0)}))}setLoadingMaskTip(e,t={}){const{maskSpan:a,show_wait:i,num:n,second:o}=t;let l=$("#multiple_Face_swapper_container #createTaskMaskPhoto"),s=$("#multiple_Face_swapper_container #multiple_Face_swapper_container .v_mask_background");if(e){if(1===i){l.find(".v_mask_content2").show();let e=o,t="wait_minutes";o>=60?e=Math.ceil(o/60):t="wait_seconds",l.find(".v_mask_content2 .v_mask_span").html(setTextContentObj("estimated_wait_time",{val:n,val2:e,val3:setTextContentObj(t)}))}else l.find(".v_mask_content2").hide();l.show(),s.show()}else l.hide(),s.hide()}setMaskUnlockPriority(){$("#multiple_Face_swapper_container #createTaskMaskPhoto .v_mask_unlock_priority").on("click",(e=>{setSessionCookie("st","mulcreditpriority"),gtag("event","click_mulfaceswap_imgpriority")}))}setMultipleListImgs(){const e=this,t=$("#multiple_Face_swapper_container #people_recognized_list");if(t){let a="";t.html(),e.itemLoading=[],this.formdata.avatar_main_key.forEach((t=>{e.itemLoading.push(!1),a+=`\n          <div class="people_recognized_item">\n            <img src="${t.obey_part_url}" />\n            <div class="add_icon_box">\n              <img class="add_icon_img" src="" style="display: none" />\n              <img class="add_icon" src="/dist/img/face-swap/icon_add_i.svg" />\n              <div class="add_icon_loading" style="display: none"></div>\n              <div class="add_icon_change"></div>\n            </div>\n            <div class="add_icon_close" style="display: none"></div>\n          </div>\n        `})),t.html(a),$("#multiple_Face_swapper_container .people_recognized_item").each((function(t){const a=$(this).index(),i=$(this);i.find(".add_icon_box").on("click",(function(){e.multipleIndex=a,gtag("event","up_mulfaceswap_targetimg"),$("#multiple_Face_swapper_container #multi_uploader").click()})),i.find(".add_icon_close").on("click",(function(){i.find(".add_icon").show(),i.find(".add_icon_img").hide(),i.find(".add_icon_close").hide(),e.formdata.avatar_main_key[a]&&(e.formdata.avatar_main_key[a].main_part_key=void 0),e.checkMultiChangeFaceStatus();const t=e.formdata.avatar_main_key.filter((e=>e.main_part_key))?.length;showBtnCreditsMultiImage(t>0)})),i.on("dragover",(function(e){e.preventDefault(),i.find(".add_icon_loading").attr("style").includes("display: none")&&i.addClass("draggable")})),i.on("dragenter",(function(e){e.preventDefault(),i.find(".add_icon_loading").attr("style").includes("display: none")&&i.addClass("draggable")})),i.on("dragleave",(function(e){e.preventDefault(),i.find(".add_icon_loading").attr("style").includes("display: none")&&i.removeClass("draggable")})),i.on("drop",(function(t){if(t.preventDefault(),i.removeClass("draggable"),i.find(".add_icon_loading").attr("style").includes("display: none")){if(1!==t.originalEvent.dataTransfer.files.length)return e.multimodel.errorMessage({conText:`<h1>${textContentObj.processImageTitle}</h1>\n              <p>${multitextContentObj.faceSwapPop01.onlyone}</p>`,btnText:multitextContentObj.OK}),void(e.multimodel.options.visible=!0);gtag("event","up_mulfaceswap_targetimg"),e.multipleIndex=a,e.itemUploading(t.originalEvent.dataTransfer.files[0])}}))}))}}setCurrentImgLoading(e,t){const a=this.itemLoading;e?(a[t]=!0,$("#multiple_Face_swapper_container .people_recognized_item").eq(t).find(".add_icon_loading").show(),$("#multiple_Face_swapper_container .people_recognized_item").eq(t).find(".add_icon_close").hide(),$("#multiple_Face_swapper_container .people_recognized_item").eq(t).find(".add_icon").hide(),$("#multiple_Face_swapper_container .people_recognized_item").eq(t).find(".add_icon_img").hide(),$("#multiple_Face_swapper_container .change_multi_face_btn").addClass("disabled"),$("#multiple_Face_swapper_container .people_recognized_item").eq(t).find(".add_icon_box").addClass("disabled")):(a[t]=!1,a.some((e=>!0===e))||this.form.firstPicLoading?$("#multiple_Face_swapper_container .change_multi_face_btn").addClass("disabled"):$("#multiple_Face_swapper_container .change_multi_face_btn").removeClass("disabled"),this.formdata.avatar_main_key[t].main_part_key||$("#multiple_Face_swapper_container .people_recognized_item").eq(t).find(".add_icon").show(),$("#multiple_Face_swapper_container .people_recognized_item").eq(t).find(".add_icon_loading").hide(),$("#multiple_Face_swapper_container .people_recognized_item").eq(t).find(".add_icon_box").removeClass("disabled"))}async itemUploading(e){this.itemLoading;if("string"!=typeof e&&!this.checkFileType(e))return void($("#multiple_Face_swapper_container #multi_uploader")[0].value="");const t=$("#multiple_Face_swapper_container .people_recognized_item .add_icon").eq(this.multipleIndex),a=$("#multiple_Face_swapper_container .people_recognized_item .add_icon_img").eq(this.multipleIndex),i=($("#multiple_Face_swapper_container .people_recognized_item .add_icon_close").eq(this.multipleIndex),this.multipleIndex);if(!t)return;this.setCurrentImgLoading(!0,i);await this.checkFacePicMulti(e);let n={};var o,l;try{n=await this.uploadMultiImagePromise(e)}catch(e){let t=multitextContentObj.faceSwapPop01.upload_file_failed;return $("#multiple_Face_swapper_container #multi_uploader")[0].value="",this.multimodel.errorMessage({conText:`\n        <h1>${multitextContentObj.faceSwapPop01.processImageTitle}</h1>\n        <p>${t}</p>\n        `,btnText:multitextContentObj.OK}),this.multimodel.options.visible=!0,this.setCurrentImgLoading(!1,i),void this.checkMultiChangeFaceStatus()}const{blog:s,res:r,imgType:c}=n;o=s,l=URL.createObjectURL(o),t.hide(),a.attr("src",l),a.show(),console.log(r),this.formdata.avatar_main_key[i]={...this.formdata.avatar_main_key[i],main_part_key:r.data.key},$("#multiple_Face_swapper_container .change_multi_face_btn").removeClass("disabled"),this.setCurrentImgLoading(!1,i),$("#multiple_Face_swapper_container .people_recognized_item").eq(i).find(".add_icon_close").show(),$("#multiple_Face_swapper_container #multi_uploader")[0].value="",showBtnCreditsMultiImage(!0)}async getCanSwapFaceData(){const e=this;return new Promise((async(t,a)=>{try{let t=await fetchPost("ai/tool/can-face",{action:"multiple_face_swap"},TOOL_API);e.canMultiFaceData=t,changeHeaderCredit(t.data.credit)}catch(e){console.error(e)}t()}))}eventLoginsuccess(){const e=this;document.querySelector("my-component").addEventListener("loginsuccess",(async function(t){await multiAiFace.getCanSwapFaceData();const a=e.formdata.avatar_main_key.filter((e=>e.main_part_key))?.length;e.formdata?.avatar_main_key&&a>0&&showBtnCreditsMultiImage(!0),isLogin(!0),multicreditSystem.showCreditBanner({bool:!0}),multiVcreditSystem.showCreditBanner({bool:!0}),multiVcreditSystem.setHighQualityHtml($(".high_quality_append_dom_multiv"),1!==window.userRuleConfig?.is_subscriber,(()=>{gtag("event","alert_faceswap_hd_v"),showHdCredits({clickfn:()=>{gtag("event","click_faceswap_hd_v")},type:"multiv"})}),"multiv"),multicreditSystem.setHighQualityHtml($(".high_quality_append_dom"),1!==window.userRuleConfig?.is_subscriber,(()=>{gtag("event","alert_faceswap_hd_m"),showHdCredits({clickfn:()=>{gtag("event","click_faceswap_hd_m")},type:"multi"})}),"multi")}))}}class MutiModel{constructor(){var e=this;this.options=new Proxy({visible:!1,type:"error",downloading:!1,downloadUrl:null,downloadType:0},{set(t,a,i){if(t[a]=i,"visible"===a)e.controlVisible(i);return!0},get:(e,t)=>e[t]})}controlVisible(e){e?$("#multiple_Face_swapper_container #multi_change_face_modal").show():$("#multiple_Face_swapper_container #multi_change_face_modal").hide()}errorMessage({conText:e,btnText:t,btnClick:a}){$("#multiple_Face_swapper_container .change_face_modal_content").html(`\n      <div class="error_con">\n          <div class="error_p">${e}</div>\n          </div>\n      `),$("#multiple_Face_swapper_container .change_face_modal_btns").html(`\n      <div class="change_face_modal_btn">${t}</div>\n    `),$("#multiple_Face_swapper_container .change_face_modal_btn").on("click",(()=>{a&&a(),$("#multiple_Face_swapper_container #multi_change_face_modal").hide()}))}downloadMessage(){$("#multiple_Face_swapper_container #multi_change_face_modal").attr("style","width: 550px;height: 125px"),$("#multiple_Face_swapper_container .change_face_modal_btns").hide(),$("#multiple_Face_swapper_container .close_btn").hide(),$("#multiple_Face_swapper_container .change_face_modal_content").html(`\n      <div class="download_multi_con">\n        <p class="loading_download_title">${multitextContentObj.faceSwapPop01.downloading}</p>\n        <div class="loading_prograss">\n          <div class="loading_prograss_con"></div>\n        </div>\n      </div>\n    `);let e=0;var t=setInterval((()=>{if(e+=1,e>=90&&(e=90),!this.options.downloading)return $("#multiple_Face_swapper_container .close_btn").show(),clearInterval(t),void(1===this.options.downloadType?($("#multiple_Face_swapper_container .loading_prograss_con").attr("style","width: 100%"),setTimeout((()=>{this.options.visible=!1,this.downloadSuccess(),this.options.visible=!0}),500)):2===this.options.downloadType&&setTimeout((()=>{this.options.visible=!1,this.downloadError(),this.options.visible=!0}),500));$("#multiple_Face_swapper_container .loading_prograss_con").attr("style",`width: ${e}%`)}),50)}downloadSuccess(){var e=this;$("#multiple_Face_swapper_container .change_face_modal_btns").show(),$("#multiple_Face_swapper_container .close_btn").show(),$("#multiple_Face_swapper_container #multi_change_face_modal").attr("style","padding: 20px 25px;"),$("#multiple_Face_swapper_container .change_face_modal_content").html(`\n      <div class="download_con">\n        <h1>${multitextContentObj.faceSwapPop01.downloadH1}</h1>\n        <p class="download_con_p">${multitextContentObj.faceSwapPop01.downloadTips}</p>\n      </div>\n    `),$("#multiple_Face_swapper_container .change_face_modal_btns").html(`\n      <div class="change_face_modal_btn">${multitextContentObj.faceSwapPop01.continue}</div>\n    `),$("#multiple_Face_swapper_container .change_face_modal_btn").on("click",(()=>{e.options.visible=!1,$("#multiple_Face_swapper_container #multi_change_face_modal").hide()})),$("#multiple_Face_swapper_container .click_multi_me").on("click",(async function(){if(!await checkFileExpired(e.options.downloadUrl))return e.errorMessage({conText:`\n            <h1>${multitextContentObj.faceSwapPop01.processImageTitle}</h1>\n            <p>${multitextContentObj.expired_file}</p>\n          `,btnText:multitextContentObj.OK}),e.options.downloadType=0,e.options.downloading=!1,void(e.options.visible=!0);$(this).attr("href",e.options.downloadUrl),$(this).click()}))}downloadError(){$("#multiple_Face_swapper_container #multi_change_face_modal").attr("style",""),$("#multiple_Face_swapper_container .change_face_modal_btns").show(),this.errorMessage({conText:`\n        <h1>${multitextContentObj.faceSwapPop01.downloadError}</h1>\n        <p>${multitextContentObj.faceSwapPop01.errorUpload}</p>\n      `,btnText:multitextContentObj.OK})}}class MutiCreditPhotoModel{constructor(e,t,a){this.element=e,this.showModelIndex=0,this.data=t,this.type=a,this.onloadMessage()}onloadMessage(){const e=this;this.element.find(".win_icon_close").click((()=>{e.data.setLoadingStart(!1),this.closeModel(),4===this.showModelIndex&&this.buttonClick1()})),this.element.find(".v_other_button").click((()=>{this.buttonClick()})),this.element.find(".v_other_button1").click((()=>{this.buttonClick1()}))}buttonClick(){}buttonClick1(){}showNotEnoughCredits(e=1){this.showModelIndex=1,this.type?gtag("event","show_miofs_mulnocredit_mv"):gtag("event","show_miofs_mulnocredit");const t=this;let a=getFSMCreditsText("Model_not_credits_title"),i=getFSMCreditsText("Model_not_credit_span",{val:e},!0),n=getFSMCreditsText("Model_not_credits_btn");this.element.find(".v_message_icon_notCredits").css({display:"block"}),this.buttonClick=function(){this.type?(gtag("event","click_miofs_mulnocredit_mv"),setSessionCookie("st","mulnocreditmv"),multiAiFaceV.uploadFacesNumber>3?(gtag("event","click_miofs_mulnocredit_10mv"),setCookie("st","mulnocreditm_10mv")):(gtag("event","click_miofs_mulnocredit_3mv"),setCookie("st","mulnocreditm_3mv"))):(getNumberNow()>6?(gtag("event","click_miofs_mulnocredit_10m"),setCookie("st","mulnocreditm_10m")):(gtag("event","click_miofs_mulnocredit_6m"),setCookie("st","mulnocreditm_6m")),gtag("event","click_miofs_mulnocredit"),setSessionCookie("st","mulnocredit")),t.data.setLoadingStart(!1),setTimeout((()=>{t.closeModel()}),500)},this.showModel({title:a,spanHtml:i,buttonText:n})}showModel(e){let{title:t,spanHtml:a,buttonText:i,buttonText1:n}=e;this.element.find(".v_error_title").text(t),this.element.find(".v_error_span").html(a),this.element.find(".v_button_text").text(i),this.element.find(".v_button_text1").text(n),this.element.css({display:"block"})}closeModel(){this.element.css({display:"none"}),this.element.find(".v_message_icon").css({display:"none"}),this.element.find(".v_other_button1").css({display:"none"}),this.showModelIndex=0}}var createMultiDialog=(e,t)=>{$("#large_multi_face_modal .large_multi_img").attr("src",e),t.mergeImg.width>t.mergeImg.height?$("#large_multi_face_modal .large_multi_img").removeClass("height").addClass("width"):$("#large_multi_face_modal .large_multi_img").removeClass("width").addClass("height");var a=document.querySelector(".large_multi_img");window.getComputedStyle(a);$("#large_multi_face_modal .multi_img_btns").attr("style","display: flex;"),$("#large_multi_face_modal").attr("style","display: flex")},muticreditsPhotoModel=null;function showNotEnoughCreditsM(e=1){gtag("event","alert_mulfaceswap_imgnocredit"),multicreditSystem.showCreditPopup({title:getfsCreditsText("Model_not_credits_title"),content:getfsCreditsText("Model_not_credit_span",{val:e},!0),btn:getfsCreditsText("Model_not_credits_btn"),btnFn:()=>{gtag("event","click_mulfaceswap_imgnocredit"),setCookie("st","mulfsimgnocredit")},modalCoins:"notenough"})}function showMaximumM(){gtag("event","alert_mulfaceswap_imgmaxlimit"),multicreditSystem.showCreditPopup({title:textContentObj.exceedTitle,content:getfsCreditsText("Model_Maximum_span",{val:window?.userRuleConfig?.m_times},!0),btn:getfsCreditsText("Model_Unlock_btn"),btnFn:()=>{gtag("event","click_mulfaceswap_imgmaxlimit")},modalCoins:"timesmax"})}function showRemoveWatermarkM(){return new Promise(((e,t)=>{multicreditSystem.showCreditPopup({title:getfsCreditsText("Model_Remove_Watermark_title"),content:getfsCreditsText("Model_Remove_Watermark_span"),btn:getfsCreditsText("Model_Remove_Watermark_btn"),btnWater:getfsCreditsText("Model_Remove_Watermark_btn1"),btnWaterFn:()=>{gtag("event","click_faceswap_stock_m"),e(!0)},closeClick:()=>{e(!0)},btnFn:()=>{setCookie("st","removewatermark_m"),gtag("event","click_faceswap_no_m"),e(!1)},modalCoins:"watermarker"})}))}function showRemoveWatemark_btn(e){if(e){$("#multiple_Face_swapper_container #multiple_Face_swapper_container .removeWatemark_btn").show(),$("#large_multi_face_modal .removeWatemark_btn").show(),$("#multiple_Face_swapper_container .removeWatemark_btn").parent().addClass("img_btns_group2"),$("#large_multi_face_modal .multi_img_btns").addClass("img_btns2_r")}else{$("#multiple_Face_swapper_container #multiple_Face_swapper_container .removeWatemark_btn").hide(),$("#large_multi_face_modal .removeWatemark_btn").hide(),$("#multiple_Face_swapper_container .removeWatemark_btn").parent().removeClass("img_btns_group2"),$("#large_multi_face_modal .multi_img_btns").removeClass("img_btns2_r")}}function tabbarItemClick(){$(".tab__bar_item").each((function(){const e=$(this).index();$(this).on("click",(function(t){$(".tab__bar_item").removeClass("active"),$(this).addClass("active"),$("#multiple_face_swapper_try").removeClass("photo video"),1===e&&(gtag("event","click_mulfaceswap_videotab"),$("#multiple_Face_swapper_container_v").show(),$("#multiple_Face_swapper_container").hide(),$("#multiple_face_swapper_try").addClass("video"),setNewTag()),0===e&&(gtag("event","click_mulfaceswap_phototab"),$("#multiple_Face_swapper_container_v").hide(),$("#multiple_Face_swapper_container").show(),$("#multiple_face_swapper_try").addClass("photo"))}))}))}const checkImg=new Image;function checkFileExpired(e){return new Promise(((t,a)=>{checkImg.src=e,checkImg.onload=()=>{t(!0)},checkImg.onerror=()=>{t(!1)}}))}function showBtnCreditsMultiImage(e){if(200===multiAiFace.canMultiFaceData.code&&0===multiAiFace.canMultiFaceData?.data?.credit)return;const t=multiAiFace.formdata.avatar_main_key.filter((e=>e.main_part_key)).length;multiAiFace.uploadFacesNumber=t,multicreditSystem.showBtnCredits({bool:e,credits:getCreditsFromVideoOrPic(multiAiFace,"image"),appendDom:$("#multiple_Face_swapper_container .change_multi_face_btn"),type:"image"})}function getCountryConfig(){return new Promise(((e,t)=>{fetchPost("ai/tool/videoface-user",{},TOOL_API).then((a=>{200===a.code?(window.userRuleConfig=a.data,initCreditsComponents(),changeHeaderCredit(a.data.credit),e()):(console.error("Error getCountryConfig",a),ToolTip({type:"error",title:textContentObj.Failed,content:textContentObj.processImage,btn:textContentObj.ok}),t())})).catch((e=>{console.error(e),ToolTip({type:"error",title:textContentObj.errorNetworkTitle,content:textContentObj.errorNetwork,btn:textContentObj.ok}),t()}))}))}let btnLoading1=!1;var multimodel=new MutiModel,multiAiFace=new MultiAiFace({multimodel:multimodel});muticreditsPhotoModel=new MutiCreditPhotoModel($("#multiple_Face_swapper_container .multi_credits_messageModel"),multiAiFace),window.multiphotoAiFaceChanging=multiAiFace,$(document).ready((function(){gtag("event","open_mulfaceswap_page"),multiAiFace.eventLoginsuccess(),multiAiFace.getImgList(),multiAiFace.getCanSwapFaceData(),setFsNewTag(),setNewTag(!0),tabbarItemClick(),getCountryConfig();const e=$(".appsigninbtn"),t=($(".signupfootbtn"),$(".signupnavbtn")),a=$(".appsignupbtn");function i(e){e?($("#multiple_Face_swapper_container .multi_Input").addClass("draggable"),$("#multiple_Face_swapper_container .multi_Input").find("svg").hide(),$("#multiple_Face_swapper_container .multi_Input").find(".change_image_text").text(getMultiText("drag_btn"))):($("#multiple_Face_swapper_container .multi_Input").removeClass("draggable"),$("#multiple_Face_swapper_container .multi_Input").find("svg").show(),$("#multiple_Face_swapper_container .multi_Input").find(".change_image_text").text(getMultiText("change_btn")))}e.attr("product-position","isTool-no-reloading"),t.attr("product-position","isTool-no-reloading"),a.attr("product-position","isTool-no-reloading"),$("#multiple_Face_swapper_container .multi_uploader_btn").on("click",(function(e){e.stopPropagation(),$("#multiple_Face_swapper_container .multi_uploader_multi").click()})),$("#multiple_Face_swapper_container .upload_step").on("dragover",(function(e){e.preventDefault()})),$("#multiple_Face_swapper_container .multi_upload .can_drag_box").on("dragenter",(function(e){e.preventDefault(),multiAiFace.form.firstPicLoading||(multiAiFace.setDragLoading("multi_upload",!0),multiAiFace.setDragLoading("change_upload",!1))})),$("#multiple_Face_swapper_container .multi_upload .uploader_loading_mask").on("dragleave",(function(e){multiAiFace.setDragLoading("multi_upload",!1)})),$("#multiple_Face_swapper_container .multi_upload .uploader_loading_mask").on("dragenter",(function(e){e.preventDefault(),multiAiFace.form.firstPicLoading||multiAiFace.setDragLoading("multi_upload",!0)})),$("#multiple_Face_swapper_container .multi_upload .uploader_loading_mask").on("dragover",(function(e){e.preventDefault(),multiAiFace.form.firstPicLoading||multiAiFace.setDragLoading("multi_upload",!0)})),$("#large_multi_face_modal").on("wheel",(function(e){e.preventDefault()})),$("#multiple_Face_swapper_container .multi_uploader_multi").on("change",(function(e){if(gtag("event","up_mulfaceswap_img"),e.target.files&&e.target.files[0]){if(1!==e.target.files.length)return multiAiFace.multimodel.errorMessage({conText:`<h1>${textContentObj.processImageTitle}</h1>\n          <p>${multitextContentObj.faceSwapPop01.onlyone}</p>`,btnText:multitextContentObj.OK}),void(multiAiFace.multimodel.options.visible=!0);var t=e.target.files[0],a=$(this)[0];multiAiFace.addMultiImage({file:t,callback:(e,t,i)=>{a.value="";let n="width"===t?"height":"width";$("#multiple_Face_swapper_container #mult_main_face_change_img").attr("data-key","multi_img"),$("#multiple_Face_swapper_container .multi_img").find("img").attr("src",e.showUrl).removeClass(n).addClass(`${t}`),$("#multiple_Face_swapper_container #mult_main_face_change_img").attr("src",e.showUrl),multiAiFace.form.originImage=e,multiAiFace.addFindFacesTask((()=>{multiAiFace.showToolBtn(!1),i||$("#multiple_Face_swapper_container #multi_img").attr("data-index",null)}))}})}})),$("#multiple_Face_swapper_container .multi_upload .uploader_loading_mask, .multi_uploader_btn_con_mask").on("drop",(function(e){if(e.preventDefault(),i(!1),multiAiFace.setDragLoading("multi_upload",!1),!multiAiFace.form.firstPicLoading){if(1!==e.originalEvent.dataTransfer.files.length)return multiAiFace.multimodel.errorMessage({conText:`<h1>${textContentObj.processImageTitle}</h1>\n            <p>${multitextContentObj.faceSwapPop01.onlyone}</p>`,btnText:multitextContentObj.OK}),void(multiAiFace.multimodel.options.visible=!0);gtag("event","up_mulfaceswap_img");var t=e.originalEvent.dataTransfer.files[0];$("#multiple_Face_swapper_container .multi_upload").addClass("loading_mask"),multiAiFace.addMultiImage({file:t,callback:(e,t,a)=>{let i="width"===t?"height":"width";$("#multiple_Face_swapper_container #mult_main_face_change_img").attr("data-key","multi_img"),$("#multiple_Face_swapper_container .multi_img").find("img").attr("src",e.showUrl).removeClass(i).addClass(`${t}`),$("#multiple_Face_swapper_container #mult_main_face_change_img").attr("src",e.showUrl),multiAiFace.form.originImage=e,multiAiFace.addFindFacesTask((()=>{a||$("#multiple_Face_swapper_container #multi_img").attr("data-index",null)}))}})}})),$("#multiple_Face_swapper_container .multi_Input").on("click",(function(e){e.stopPropagation(),btnLoading1||(btnLoading1=!0,setTimeout((()=>{btnLoading1=!1}),2e3),$("#multiple_Face_swapper_container .multi_uploader_multi").click())})),$("#multiple_Face_swapper_container .multi_Input .multi_uploader_btn_con_mask").on("dragover",(function(e){e.preventDefault(),i(!0)})).on("dragenter",(function(e){e.preventDefault(),i(!0)})).on("dragleave",(function(e){e.preventDefault(),i(!1)})),$("#multiple_Face_swapper_container .multi_Input").on("dragover",(function(e){e.preventDefault(),i(!0)})).on("dragenter",(function(e){e.preventDefault(),i(!0)})),$("#large_multi_face_modal .removeWatemark_btn").on("click",(function(e){})),$("#large_multi_face_modal .removeWatemark_btn").on("click",(function(e){})),$("#large_multi_face_modal .compare_multi_btn, #multiple_Face_swapper_container .compare_multi_btn").on("pointerdown",(function(e){e.preventDefault(),gtag("event","compare_mulfaceswap_imgres"),multimodel.options.downloading||multiAiFace.changeFaceLoading||2!==e.button&&(multiAiFace.form?.originImage?.showUrl&&($("#multiple_Face_swapper_container #mult_main_face_change_img").attr("src",multiAiFace.form?.originImage.showUrl),$("#large_multi_face_modal .large_multi_img").attr("src",multiAiFace.form?.originImage.showUrl)),document.addEventListener("pointerup",(function(e){$("#multiple_Face_swapper_container #mult_main_face_change_img").attr("data-key")||n(e)})))})),$("#multiple_Face_swapper_container .share_multi_btn, #large_multi_face_modal .share_multi_btn").on("click",(e=>{gtag("event","share_mulfaceswap_imgres");let t=document.querySelector("#shareDialogEl");t.changeTips({title:multitextContentObj.faceSwapPop01.share__Tile,content:getMultiText("share__box__text")}),t.showShare({url:multiAiFace.mergeImgUrl,action:"multiplefaceswapmioshare",imageKey:multiAiFace.mergeKey,text:getMultiText("share__text"),title:multitextContentObj.faceSwapPop01.share__Tile,id:multiAiFace.lastSuccessTaskid,task_id:multiAiFace.lastSuccessTaskid,btoaUrl:btoa(multiAiFace.mergeKey+","+multiAiFace.lastSuccessTaskid),backParams:function(e){return{id:multiAiFace.lastSuccessTaskid,key:e?.merge_key}}})})),$("#large_multi_face_modal .compare_multi_btn, #multiple_Face_swapper_container .compare_multi_btn").on("pointerleave",(e=>{n(e)}));const n=function(e){e.preventDefault(),multimodel.options.downloading||multiAiFace.changeFaceLoading||2!==e.button&&($("#multiple_Face_swapper_container #mult_main_face_change_img").attr("src",multiAiFace.mergeImgUrl),$("#large_multi_face_modal .large_multi_img").attr("src",multiAiFace.mergeImgUrl),document.removeEventListener("pointerup",(function(e){n(e)})))};$("#multiple_Face_swapper_container #mult_main_face_change_img").on("contextmenu",(e=>{e.originalEvent.preventDefault()})),$("#large_multi_face_modal .large_multi_img width").on("contextmenu",(e=>{e.originalEvent.preventDefault()})),$("#multiple_Face_swapper_container .large_multi_image").on("click",(function(e){e.preventDefault(),gtag("event","zoomin_mulfaceswap_imgres"),multimodel.options.downloading||multiAiFace.changeFaceLoading||2!==e.button&&createMultiDialog(multiAiFace.mergeImgUrl,multiAiFace)})),$(".download_multi_btn_p").on("click",(async e=>{e.preventDefault(),gtag("event","download_mulfaceswap_imgres"),multimodel.options.downloading||multiAiFace.changeFaceLoading||2!==e.button&&(getCookie("access_token")?(multimodel.options.downloading=!0,multimodel.downloadMessage(),multimodel.options.visible=!0,mulPhotoDownloadData?fetchPost("ai/source/get-access-url",{key:multiAiFace.mergeKey,action:"download",file_name:"Vidqu_faceswap.png"},TOOL_API).then((async e=>{if(401===e.code)return multimodel.errorMessage({conText:multitextContentObj.loginFirst,btnText:multitextContentObj.OK}),multimodel.options.visible=!0,multimodel.options.downloadType=2,void(multimodel.options.downloading=!1);if(!await checkFileExpired(e.data.url))return $("#multiple_Face_swapper_container #multi_change_face_modal").attr("style",""),$("#multiple_Face_swapper_container .change_face_modal_btns").show(),multimodel.errorMessage({conText:`\n                <h1>${multitextContentObj.faceSwapPop01.processImageTitle}</h1>\n                <p>${multitextContentObj.expired_file}</p>\n              `,btnText:multitextContentObj.OK}),multimodel.options.downloadType=0,multimodel.options.downloading=!1,void(multimodel.options.visible=!0);{multimodel.options.downloadType=1,multimodel.options.downloading=!1;let t=document.createElement("a");multimodel.options.downloadUrl=e.data.url,t.href=e.data.url,t.download="Vidqu_faceswap.png",document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(t.href),gtag("event","dwsucc_miofs_res_m")}})).catch((e=>{multimodel.options.downloadType=2,multimodel.options.downloading=!1,console.error("fail",e)})):mulPhotoDownloadData=await newDownloadFile(multiAiFace.taskid)):showLoginWindow({isReloading:!1,wait:[multiAiFace.taskid],fn:async(e=null)=>{e&&(mulPhotoDownloadData=e)}}))})),$("#multiple_Face_swapper_container #change_face_login").on("click",(function(){window.location.href=thGotoApplibraryUrl+"signup?page_name=face-swap&name=ai"})),$("#multiple_Face_swapper_container .modal__main_close").on("click",(function(){$("#multiple_Face_swapper_container .vocalRemover__modal").hide()})),$("#multiple_Face_swapper_container .close_btn").on("click",(function(){multimodel.options.visible=!1,$("#multiple_Face_swapper_container #multi_change_face_modal").hide(),$("#multiple_Face_swapper_container #multi_change_face_modal").hide()})),$("#large_multi_face_modal .multi_close_btn").on("click",(function(){$("#large_multi_face_modal").hide()})),$("#multiple_Face_swapper_container .change_multi_face_btn").on("click",(function(e){gtag("event","click_mulfaceswap_imgswapbtn"),getNumberNow()>6?gtag("event","succ_mulfaceswap_img10"):gtag("event","succ_mulfaceswap_img6"),multiAiFace.changeMultiFace($(this))})),$("#multiple_Face_swapper_container .face_swap_now").on("click",(function(){scrollToPositions(".ai-change-face")})),$("#multiple_Face_swapper_container .see_more_multi").on("click",(function(){$("#multiple_Face_swapper_container .multi_pics").removeClass("hide_other_pics"),$("#multiple_Face_swapper_container .see_more_multi").hide(),$("#multiple_Face_swapper_container .fold_multi").show()})),$("#multiple_Face_swapper_container .fold_multi").on("click",(function(){$("#multiple_Face_swapper_container .multi_pics").addClass("hide_other_pics"),$("#multiple_Face_swapper_container .see_more_multi").show(),$("#multiple_Face_swapper_container .fold_multi").hide()})),$("#multiple_Face_swapper_container #multi_uploader").on("change",(async function(e){e.target.files&&e.target.files[0]&&multiAiFace.itemUploading(e.target.files[0])})),$("#multiple_Face_swapper_container .face_random_multi").on("click",(function(){gtag("event","img_miofs_quickbtn_m");const e=randomchoice(multiAiFace.imgList);if(0===multiAiFace.imgList?.length)return;if(multiAiFace.form.firstPicLoading||multiAiFace.changeFaceLoading)return;const t=e();multiAiFace.showToolBtn(!1),multiAiFace.addMultiImage({addData:{demoKey:t.pic_key,demoSrc:t.pic_url},file:t.pic_url,callback:(e,t,a)=>{var i="width"===t?"height":"width";$("#multiple_Face_swapper_container #mult_main_face_change_img").attr("data-key","multi_img"),$("#multiple_Face_swapper_container .multi_img").find("img").attr("src",e.showUrl).removeClass(i).addClass(`${t}`),$("#multiple_Face_swapper_container #mult_main_face_change_img").attr("src",e.showUrl),multiAiFace.form.originImage=e,multiAiFace.addFindFacesTask((()=>{a||$("#multiple_Face_swapper_container #multi_img").attr("data-index",null),a&&$("#multiple_Face_swapper_container #multi_img").attr("data-index",a)}))},ourPicsIndex:$(this).index()+1})})),$("#header_user").on("mouseenter",(()=>{gtag("event","show_mulfaceswap_profilepopover")})),$("#header_user #go_credits").click((()=>{gtag("event","click_mulfaceswap_profileaccount")})),$("#header_user .signout").click((()=>{gtag("event","click_mulfaceswap_profilesignout")}))}));const initScrollBarPos=()=>{document.querySelector(".recommende__article_swiper .swiper-wrapper").scrollTo(300,0)};function setGtag(e){e.className.includes("_compare")?gtag("event","upclick_miomfs_compare"):e.className.includes("_one")?gtag("event","upclick_miomfs_one"):e.className.includes("_two")?gtag("event","upclick_miomfs_two"):e.className.includes("_three")||(e.className.includes("_four")?gtag("event","upclick_miomfs_four"):e.className.includes("_step")?gtag("event","upclick_miomfs_step"):e.className.includes("_scroll")&&gtag("event","upclick_miomfs_scroll"))}function photo_isSameDay(){let e=Date.now(),t=getCookie("faceSwapTime_swap");if(!t)return!1;const a=new Date(e),i=new Date(Number(t)),n=a.getFullYear(),o=a.getMonth(),l=a.getDate(),s=i.getFullYear(),r=i.getMonth(),c=i.getDate();return n===s&&o===r&&l===c}$((function(){$("#multiple_Face_swapper_container .head-portrait .appsigninbtn").click((function(e){e.stopPropagation(),e.preventDefault()})),$("#multiple_Face_swapper_container .swap_credit_btn_multiphoto").on("click",(function(){getCookie("access_token")?(setSessionCookie("st","mulloggedcreditbanner"),gtag("event","logged_credit_mulbannerbtn")):(setSessionCookie("st","mulnotcreditbanner"),gtag("event","notlogged_credit_mulbannerbtn"))})),new Swiper(".seo_section1_swiper_continer",{initialSlide:0,spaceBetween:20,allowTouchMove:!1,autoplay:"pc"!=judgeClient()&&{delay:6e3,disableOnInteraction:!1},speed:800,slidesPerView:1,navigation:{nextEl:".swiper-button-next1",prevEl:".swiper-button-prev1",disabledClass:"disabled"},pagination:{el:".swiper-pagination",clickable:!0}});const e=document.querySelectorAll(".right_line_button");document.querySelectorAll(".right_line_button_big").forEach(((t,a)=>{t.onmousedown=function(i){const n=t.parentNode.querySelector(".right_line"),o=t.parentNode.querySelector(".right_imgB");var l=i.clientX-e[a].getBoundingClientRect().left;document.onmousemove=function(i){var s=i.clientX-l-t.parentNode.getBoundingClientRect().left;const r=e[a].offsetWidth/2;var c=t.parentNode.offsetWidth-r;s<r&&(s=r),s>c&&(s=c),e[a].style.left=s+"px",t.style.left=s+"px",n.style.left=s+"px",o.style.width=s+"px"},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}},t.ondragstart=function(){return!1},t.addEventListener("touchstart",(function(i){var n=i.touches[0];const o=t.parentNode.querySelector(".right_line"),l=t.parentNode.querySelector(".right_imgB");var s=n.clientX-e[a].getBoundingClientRect().left;function r(i){!function(i){var n=i.clientX-s-t.parentNode.getBoundingClientRect().left;const r=e[a].offsetWidth/2;var c=t.parentNode.offsetWidth-r;n<r&&(n=r),n>c&&(n=c),e[a].style.left=n+"px",t.style.left=n+"px",o.style.left=n+"px",l.style.width=n+"px"}(i.touches[0])}function c(){document.removeEventListener("touchmove",r)}document.addEventListener("touchmove",r),t.addEventListener("touchend",(function(){document.removeEventListener("touchmove",r),t.removeEventListener("touchend",c)})),t.addEventListener("touchend",c)})),t.ondragstart=function(){return!1}})),"pc"==judgeClient()&&new Swiper(".recommende__article_swiper",{width:1088,slidesPerView:4,spaceBetween:16,speed:800,navigation:{nextEl:".recommende__article .swiper-button-next",prevEl:".recommende__article .swiper-button-prev",disabledClass:"disabled"}});const t=document.querySelectorAll(".faqs__translator_item");function a(){for(let e=0;e<t.length;e++){const a=t[e],i=a.querySelector(".faqs__translator_item-header"),n=a.querySelector(".faqs__translator_item-body");i.onclick=()=>{const e="0px"===n.style.maxHeight||""===n.style.maxHeight;n.style.maxHeight=e?n.scrollHeight+"px":"0",e?i.classList.add("show"):i.classList.remove("show")}}}a();const i=document.querySelectorAll(".seo_section4_item"),n=document.querySelectorAll(".seo_section4_item_body"),o=document.querySelectorAll(".seo_section4_item h3"),l=document.querySelectorAll(".imgBox img"),s=document.querySelectorAll(".seo_section4_itemBox_mob .section4_img");a(),function(){for(let e=0;e<i.length;e++){const t=i[e],a=t.querySelector("h3"),r=t.querySelector(".seo_section4_item_body");a.onclick=()=>{const t="0px"===r.style.maxHeight||""===r.style.maxHeight;n.forEach(((e,t)=>{e.style.maxHeight="0",o[t].classList.remove("show"),"pc"==judgeClient()&&t<l.length?l[t].style.zIndex="0":s[t]&&(s[t].style.maxHeight="0")})),r.style.maxHeight=t?r.scrollHeight+"px":"0",t?a.classList.add("show"):a.classList.remove("show"),"pc"==judgeClient()?l[e].style.zIndex="1":(s[e-4].style.maxHeight=t?"calc(641 / 750 * 100vw)":"0",s[e-4].style.marginTop=t?"calc(38.5 / 750 * 100vw)":"0")}}}();[...document.querySelectorAll(".seo_button")].forEach((e=>{e.onclick=()=>{window.scrollTo({top:0,left:0,behavior:"smooth"}),setGtag(e)}})),$("#multiple_Face_swapper_container .my_files_tips .myfiles_check_Now_btn").on("click",(()=>{gtag("event","click_vidqmyfiles_imgtipsfile_m"),getCookie("access_token")?window.open("/my-files.html"):showLoginWindow({isReloading:!1,wait:[multiAiFace.taskid],fn:async(e=null)=>{e&&(mulPhotoDownloadData=e),window.open("/my-files.html")}})}))}));