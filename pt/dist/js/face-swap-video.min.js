"use strict";function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _regeneratorRuntime(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */_regeneratorRuntime=function(){return t};var e,t={},n=Object.prototype,o=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function d(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(e){d=function(e,t,n){return e[t]=n}}function u(e,t,n,o){var r=t&&t.prototype instanceof m?t:m,a=Object.create(r.prototype),s=new D(o||[]);return i(a,"_invoke",{value:F(e,n,s)}),a}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var p="suspendedStart",v="suspendedYield",f="executing",h="completed",_={};function m(){}function g(){}function w(){}var b={};d(b,a,(function(){return this}));var y=Object.getPrototypeOf,k=y&&y(y(L([])));k&&k!==n&&o.call(k,a)&&(b=k);var C=w.prototype=m.prototype=Object.create(b);function x(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function n(i,r,a,s){var c=l(e[i],e,r);if("throw"!==c.type){var d=c.arg,u=d.value;return u&&"object"==_typeof(u)&&o.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(u).then((function(e){d.value=e,a(d)}),(function(e){return n("throw",e,a,s)}))}s(c.arg)}var r;i(this,"_invoke",{value:function(e,o){function i(){return new t((function(t,i){n(e,o,t,i)}))}return r=r?r.then(i,i):i()}})}function F(t,n,o){var i=p;return function(r,a){if(i===f)throw Error("Generator is already running");if(i===h){if("throw"===r)throw a;return{value:e,done:!0}}for(o.method=r,o.arg=a;;){var s=o.delegate;if(s){var c=R(s,o);if(c){if(c===_)continue;return c}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(i===p)throw i=h,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);i=f;var d=l(t,n,o);if("normal"===d.type){if(i=o.done?h:v,d.arg===_)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(i=h,o.method="throw",o.arg=d.arg)}}}function R(t,n){var o=n.method,i=t.iterator[o];if(i===e)return n.delegate=null,"throw"===o&&t.iterator.return&&(n.method="return",n.arg=e,R(t,n),"throw"===n.method)||"return"!==o&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+o+"' method")),_;var r=l(i,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,_;var a=r.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,_):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,_)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function L(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,r=function n(){for(;++i<t.length;)if(o.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return r.next=r}}throw new TypeError(_typeof(t)+" is not iterable")}return g.prototype=w,i(C,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:g,configurable:!0}),g.displayName=d(w,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,d(e,c,"GeneratorFunction")),e.prototype=Object.create(C),e},t.awrap=function(e){return{__await:e}},x(T.prototype),d(T.prototype,s,(function(){return this})),t.AsyncIterator=T,t.async=function(e,n,o,i,r){void 0===r&&(r=Promise);var a=new T(u(e,n,o,i),r);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},x(C),d(C,c,"Generator"),d(C,a,(function(){return this})),d(C,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var o in t)n.push(o);return n.reverse(),function e(){for(;n.length;){var o=n.pop();if(o in t)return e.value=o,e.done=!1,e}return e.done=!0,e}},t.values=L,D.prototype={constructor:D,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(o,i){return s.type="throw",s.arg=t,n.next=o,i&&(n.method="next",n.arg=e),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var c=o.call(a,"catchLoc"),d=o.call(a,"finallyLoc");if(c&&d){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!d)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=e,a.arg=t,r?(this.method="next",this.next=r.finallyLoc,_):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),_},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),_}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var o=n.completion;if("throw"===o.type){var i=o.arg;P(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,n,o){return this.delegate={iterator:L(t),resultName:n,nextLoc:o},"next"===this.method&&(this.arg=e),_}},t}function asyncGeneratorStep(e,t,n,o,i,r,a){try{var s=e[r](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(o,i)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise((function(o,i){var r=e.apply(t,n);function a(e){asyncGeneratorStep(r,o,i,a,s,"next",e)}function s(e){asyncGeneratorStep(r,o,i,a,s,"throw",e)}a(void 0)}))}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function setTextContentObj(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=lan.faceSwapPop[e];for(var o in t){var i=new RegExp("{{".concat(o,"}}"),"g");n=n.replace(i,t[o])}return n}var show_priority=0,actTab="tab_photo",UploadVideo=function(){return _createClass((function e(t,n){_classCallCheck(this,e);var o=this;this.element=t,this.videoSrc="",this.videoCoverImgSrc="",this.uploadFile=null,this.submit=n,this.data={loading:!1},this.demo_key="",this.demo_coverImg="",this.videoDuration=0,this.videoLoading=!0,this.videoData=new Proxy(this.data,{set:function(e,t,n){return e[t]=n,"loading"===t&&(n?($("#video_Face_swapper_container .change_video_btn").addClass("disabled"),o.element.find(".stepBox").addClass("loading"),o.element.find(".step_loadingBox").css("display","flex"),console.log("that.submit.submitData.isVideoSubmit",o.submit.submitData.isVideoSubmit),o.submit.submitData.isVideoSubmit||$("#video_Face_swapper_container .spread_box_container").addClass("uploading")):(o.element.find(".stepBox").removeClass("loading").find(".step_V").addClass("active"),o.element.find(".step_loadingBox").hide(),o.element.find(".btn_changer").show(),o.element.find(".icon_video").show(),$("#video_Face_swapper_container .spread_box_container").removeClass("uploading"),null!==o.uploadFile&&o.submit.isSubmit())),!0},get:function(e,t){return e[t]}})}),[{key:"initFace",value:function(){var e=this,t=$(".video_upload_input_step1");this.element.find(".stepBox").on("dragover",(function(t){t.preventDefault(),t.stopPropagation(),e.showDropMask(!0),e.submit.imgContainer.showDropMask(!1)})),this.element.find(".uploader_loading_mask").on("dragleave",(function(t){t.preventDefault(),t.stopPropagation(),e.showDropMask(!1)})),this.element.find(".uploader_loading_mask").on("drop",(function(t){t.preventDefault(),t.stopPropagation(),e.showDropMask(!1),e.submit.imgContainer.showDropMask(!1);var n=t.originalEvent.dataTransfer.files[0];gtag("event","up_faceswap_videostep1"),e.uploadFileRule(n)})),this.element.find(".step_V").on("click",(function(){gtag("event","up_faceswap_videostep1"),t.click()})),$("#video_Face_swapper_container .stepA .btn_changer").on("click",(function(){gtag("event","up_faceswap_videostep1"),t.click()})),t.on("change",(function(){var n=t[0].files[0];e.uploadFileRule(n),setTimeout((function(){t[0].value=""}),500)}))}},{key:"showDropMask",value:function(e){this.loading||(e?this.element.find(".uploader_loading_mask").show():this.element.find(".uploader_loading_mask").hide())}},{key:"showUploading",value:function(e){console.log("showUploading",e),this.videoData.loading=e}},{key:"uploadFileRule",value:function(e,t){if(!this.loading){null!=t&&t.demo_key?(this.demo_coverImg=t.demo_coverImg,this.demo_key=t.demo_key):(this.demo_key="",this.demo_coverImg="");var n=1048576*userRuleConfig.limit;if(e){console.log(e,"file");var o=e.name.split(".").pop().toLowerCase();this.submit.videoRandom=!1,["m4v","mp4","mov","webm","gif"].includes(o)||["video/mp4","video/quicktime","video/webm","image/gif"].includes(e.type)?e.size>n?showMaximumFileSizeV():"image/gif"===e.type?this.uploadGifFile(e):this.uploadVideoRule(e):(this.value="",ToolTip({type:"error",title:textContentObj.Failed,content:setTextContentObj("support_formats_v"),btn:textContentObj.ok}))}}}},{key:"uploadGifFile",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this,this.showUploading(!0),this.submit.videoDemo.domeLoadDisabled(!0),(o=new FileReader).onload=function(e){setTimeout((function(){n.videoDuration=userRuleConfig.duration,n.submit.uploadType="gif",n.submit.PreviewVideoTool.setVideoOrGifSrc("gif",e.target.result),$("#video_Face_swapper_container .step_V")[0].src=e.target.result,$(".video_img").addClass("active"),n.showUploading(!1),n.submit.videoDemo.domeLoadDisabled(!1),n.submit.videoDemo.setCheckedDemo("video"),n.submit.PreviewVideoTool.showVideoControls(!1)}),1e3)},o.readAsDataURL(t),this.uploadFile=t;case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"uploadVideoRule",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,o,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.next=3,createObjectURLFun(t);case 3:n=e.sent,console.log(n),(o=document.getElementById("getLoadedDom_video")).src=n,i=this,this.showUploading(!0),this.submit.videoDemo.domeLoadDisabled(!0),o.addEventListener("loadedmetadata",(function(){var e=o.duration;userRuleConfig.duration,setTimeout((function(){i.uploadFile=t,i.videoDuration=e,i.setVideoFileSrc(n),i.submit.videoDemo.setCheckedDemo("video"),i.showUploading(!1),i.submit.videoDemo.domeLoadDisabled(!1)}),1e3)}),{once:!0});case 11:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"setVideoFileSrc",value:function(e){var t=this;return new Promise(function(){var n=_asyncToGenerator(_regeneratorRuntime().mark((function n(o,i){var r;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.submit.uploadType="video",n.next=3,t.submit.PreviewVideoTool.setVideoOrGifSrc("video",e);case 3:r=n.sent,URL.revokeObjectURL(t.videoSrc),t.videoSrc=e,t.videoCoverImgSrc=r,t.element.find(".step_V")[0].src=r,t.element.find(".video_img").addClass("active"),t.submit.PreviewVideoTool.showVideoControls(!1),o();case 11:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getConsumeCredit",value:(e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t/(userRuleConfig.duration||10),o=5*Math.ceil(n),getCookie("access_token")){e.next=7;break}this.submit.showBtnCredits(!1,o),t>userRuleConfig.duration+1||this.submit.videoDemo.showMoreVideoDuration(!1),e.next=15;break;case 7:if(!userRuleConfig.credit){e.next=11;break}this.submit.showBtnCredits(!0,o),e.next=15;break;case 11:return e.next=13,fetchPost("ai/tool/can-face",{action:"video_face_changing",duration:t},TOOL_API);case 13:200===e.sent.code?this.submit.showBtnCredits(!1,o):this.submit.showBtnCredits(!0,o);case 15:case"end":return e.stop()}}),e,this)}))),function(t){return e.apply(this,arguments)})}]);var e,t,n}(),UploadImage=function(){return _createClass((function e(t,n){_classCallCheck(this,e),_defineProperty(this,"transtoBlob",(function(e){var t=e.b64data,n=e.contentType,o=void 0===n?"image/png":n;o=o||"";for(var i=1024,r=atob(t.split(",")[1]),a=r.length,s=Math.ceil(a/i),c=new Array(s),d=0;d<s;++d){for(var u=d*i,l=Math.min(u+i,a),p=new Array(l-u),v=u,f=0;v<l;++f,++v)p[f]=r[v].charCodeAt(0);c[d]=new Uint8Array(p)}return new Blob(c,{type:o})}));var o=this;this.element=t,this.imageSrc="",this.uploadFile=null,this.data={loading:!1},this.submit=n,this.imageLoading=!0,this.photoData=new Proxy(this.data,{set:function(e,t,n){return e[t]=n,"loading"===t&&(n?($("#video_Face_swapper_container .change_video_btn").addClass("disabled"),o.element.find(".stepBox").addClass("loading"),o.element.find(".step_loadingBox").css("display","flex")):(o.element.find(".step_loadingBox").hide(),o.element.find(".stepBox").removeClass("loading"),null!==o.uploadFile&&($("#video_Face_swapper_container .faceSwapProgress").text(textContentObj.Loading),o.element.find(".stepBox").find(".step_P").addClass("active"),o.element.find(".btn_changer").show(),o.element.find(".step_P")[0].src=o.imageSrc,o.submit.isSubmit()))),!0},get:function(e,t){return e[t]}})}),[{key:"initFace",value:function(){var e=this,t=this,n=$(".video_upload_input_step2");this.element.on("dragover",(function(t){t.preventDefault(),e.showDropMask(!0)})),this.element.find(".uploader_loading_mask").on("dragleave",(function(t){t.preventDefault(),t.stopPropagation(),e.showDropMask(!1)})),this.element.find(".uploader_loading_mask").on("drop",(function(n){n.preventDefault(),n.stopPropagation(),gtag("event","up_faceswap_videostep2"),e.showDropMask(!1);var o=n.originalEvent.dataTransfer.files[0];t.uploadFileRule(o)})),this.element.find(".step_P").on("click",(function(e){gtag("event","up_faceswap_videostep2"),n.click()})),this.element.find(".btn_changer").on("click",(function(e){gtag("event","up_faceswap_videostep2"),n.click()})),n.on("change",(function(){var e=n[0].files[0];t.uploadFileRule(e),setTimeout((function(){n[0].value=""}),500)}))}},{key:"checkFileType",value:function(e){for(var t=e,n=0;n<t.length;n++){var o=t[n].name.split(".").pop().toLowerCase();if(!["png","jpg","webp","jpeg"].includes(o))return!1}return!0}},{key:"uploadFileRule",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,o,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.loading&&t){e.next=2;break}return e.abrupt("return");case 2:if(this.checkFileType([t])){e.next=5;break}return ToolTip({type:"error",title:textContentObj.Failed,content:setTextContentObj("support_formats_p"),btn:textContentObj.ok}),e.abrupt("return");case 5:return e.next=7,this.imgMinWidth(t);case 7:return n=e.sent,this.submit.videoDemo.domeLoadDisabled(!0),this.showUploading(!0),this.submit.imageRandom=!1,e.next=13,this.detectionFace(n);case 13:if(1===(o=e.sent).status){e.next=28;break}i="",e.t0=o.status,e.next=0===e.t0?19:2===e.t0?21:3===e.t0?23:25;break;case 19:return i=setTextContentObj("No_face"),e.abrupt("break",25);case 21:return i=setTextContentObj("Mutiple_face"),e.abrupt("break",25);case 23:return i=setTextContentObj("face_small"),e.abrupt("break",25);case 25:ToolTip({type:"error",title:textContentObj.Failed,content:i,btn:textContentObj.ok}),e.next=31;break;case 28:URL.revokeObjectURL(this.imageSrc),this.uploadFile=t,this.imageSrc=n;case 31:this.showUploading(!1),this.submit.videoDemo.domeLoadDisabled(!1);case 33:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"detectionFace",value:function(e){return new Promise((function(t,n){setTimeout((function(){var o=new Image;o.src=e,console.log(e),o.onload=function(){try{faceapi.detectAllFaces(o,new faceapi.TinyFaceDetectorOptions({inputSize:416})).then((function(e){console.log(e);var n={};1===e.length?(n.status=1,n.box=e[0].box,t(n)):e.length>1?(n.status=2,t(n)):faceapi.detectAllFaces(o,new faceapi.SsdMobilenetv1Options).then((function(e){console.log(e),1===e.length?(n.status=1,n.box=e[0].box):e.length>1?n.status=2:n.status=0,t(n)}))}))}catch(e){console.log("err",e),n(e)}}}),50)}))}},{key:"imgMinWidth",value:(e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,createObjectURLFun(t);case 3:return n=e.sent,e.abrupt("return",new Promise((function(e){var t=new Image;t.src=n,t.onload=function(){this.width,this.height,e(n)}})));case 5:case"end":return e.stop()}}),e)}))),function(t){return e.apply(this,arguments)})},{key:"resizeImageByFile",value:function(e){var t=this;return new Promise((function(n,o){var i=new FileReader;i.onloadend=function(){var e=new Image;e.onload=function(){var o=document.createElement("canvas"),i=o.getContext("2d"),r=Math.max(e.width,e.height);if(r>1080){var a=1080/r;o.width=e.width*a,o.height=e.height*a}else o.width=e.width,o.height=e.height;i.drawImage(e,0,0,o.width,o.height);var s=o.toDataURL(),c=t.transtoBlob({b64data:s,contentType:"image/png"}),d="width";o.width<o.height&&(d="height"),n({blog:c,imgType:d})},e.onerror=function(){o(new Error("Image load failed"))},e.src=i.result},i.onerror=o,i.readAsDataURL(e)}))}},{key:"showDropMask",value:function(e){this.loading||(e?this.element.find(".uploader_loading_mask").show():this.element.find(".uploader_loading_mask").hide())}},{key:"showUploading",value:function(e){this.photoData.loading=e}},{key:"showImageChange",value:function(e){}}]);var e,t}(),SubmitFaceSwap=function(){return _createClass((function e(t){_classCallCheck(this,e);var n=this;this.element=t,this.disabled=!0,this.videoContainer=null,this.imgContainer=null,this.PreviewVideoTool=null,this.clearTimeout=null,this.initGtag=!1,this.initGtag2=!1,this.task_id=null,this.swapCredits=0,this.isShowControl=!1,this.uploadType="",this.videoRandom=!1,this.imageRandom=!1,this.timerLoading=null,this.task_credits=!1,this.data={isVideoSubmit:!1},this.submitData=new Proxy(this.data,{set:function(e,t,o){return"isVideoSubmit"===t&&(o?(setTimeout((function(){$(".v_preview_playIcon").fadeOut()}),100),n.element.find("#v_swap_face_Now").addClass("submit"),$("#video_Face_swapper_container .spread_box_container").addClass("loading"),$("#video_Face_swapper_container .change_video_btn .submit_text").text(textContentObj.Swapping_setp),n.setLoadingStep(!0),$(".high_quality_append_dom_video").css("pointer-events","none")):("gif"!=n.uploadType&&$(".v_preview_playIcon").fadeIn(),$("#video_Face_swapper_container .change_video_btn .submit_text").text(textContentObj.step3_btn),$("#video_Face_swapper_container .spread_box_container").removeClass("loading"),n.element.find("#v_swap_face_Now").removeClass("submit"),$(".high_quality_append_dom_video").css("pointer-events","auto"))),e[t]=o,!0},get:function(e,t){return e[t]}})}),[{key:"initFace",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.videoContainer=new UploadVideo($("#video_Face_swapper_container .stepA"),this),this.creditModel=new CreditsMessageModel,this.videoContainer.initFace(),this.imgContainer=new UploadImage($("#video_Face_swapper_container .stepB"),this),this.PreviewVideoTool=new PreviewVideoTool($("#video_Face_swapper_container .spread_box"),this),this.videoDemo=new VideoDemo($("#v_face_swap_Demo"),this),this.PreviewVideoTool.initFace(),this.imgContainer.initFace(),this.showBtnCredits(!1),this.setMaskUnlockPriority(),this.element.find("#v_swap_face_Now").on("click",_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(gtag("event","click_faceswap_videostep3"),t.PreviewVideoTool.video_preview_dom.pause(),!t.disabled){e.next=4;break}return e.abrupt("return");case 4:t.faceSwapLoading(!0),t.videoDemo.domeLoadDisabled(!0),t.videoContainer.showUploading(!0),t.imgContainer.showUploading(!0),t.PreviewVideoTool.showControls?t.isShowControl=!0:t.isShowControl=!1,t.PreviewVideoTool.showVideoControls(!1),getCountryConfig().then((function(){t.submitFun()})).catch((function(){t.videoContainer.showUploading(!1),t.imgContainer.showUploading(!1),t.faceSwapLoading(!1),t.videoDemo.domeLoadDisabled(!1),t.isShowControl&&t.PreviewVideoTool.showVideoControls(!0)}));case 11:case"end":return e.stop()}}),e)}))));case 11:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"setLoadingStep",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,o,i,r,a,s,c,d;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.step,r=t.createTask,a=this,s=null==r||null===(n=r.data)||void 0===n?void 0:n.progress,c=null==r||null===(o=r.data)||void 0===o?void 0:o.status,d=setTextContentObj("loading_text"),i&&0!==i){e.next=8;break}return a.PreviewVideoTool.setLoadingText(d),e.abrupt("return");case 8:if(1!=i){e.next=12;break}return d=setTextContentObj("Preparing_step"),a.PreviewVideoTool.setLoadingText(d),e.abrupt("return");case 12:-1==c&&(d="% "+setTextContentObj("Analyzing_setp")),-2==c&&(d="% "+setTextContentObj("Swapping_step")),a.PreviewVideoTool.setLoadingText(parseInt(s)+d);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"submitDisabled",value:function(e){e?(this.element.find(".video_upload_button").css({opacity:.4,"pointer-events":"none"}),this.element.find(".video_upload_button img").hide(),this.disabled=!0):(this.element.find(".video_upload_button").css({opacity:1,"pointer-events":"auto"}),this.element.find(".video_upload_button img").show(),this.disabled=!1)}},{key:"submitFun",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,n,o,i,r,a,s,c,d,u,l,p,v,f,h;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,e.next=3,this.uploadFile({videoFile:this.videoContainer.uploadFile,imgFile:this.imgContainer.uploadFile});case 3:if(n=e.sent,console.log(n),!n.bool){e.next=21;break}return 1!==window.userRuleConfig.is_subscriber&&this.videoContainer.videoDuration&&this.videoContainer.videoDuration>userRuleConfig.duration+1?this.videoDemo.showMoreVideoDuration(!0):this.videoDemo.showMoreVideoDuration(!1),o=n.data.additional_data.merge_key.includes(".gif")?"gif":"video",e.next=10,this.PreviewVideoTool.setVideoOrGifSrc(o,n.data.additional_data.merge_url,n.data.additional_data.cover_url);case 10:i=e.sent,this.task_id=n.data.id,r=(r=n.data.additional_data.merge_key.split("."))[r.length-1],console.log(111),this.PreviewVideoTool.downloadData={key:n.data.additional_data.merge_key,coverImg:i,type:r,url:n.data.additional_data.merge_url},this.videoContainer.videoCoverImgSrc=n.data.additional_data.cover_url,gtag("event","succ_faceswap_videoswapbtn"),this.PreviewVideoTool.showVideoControls(!0),e.next=23;break;case 21:"3005"==(null==n||null===(a=n.data)||void 0===a?void 0:a.code)?showMaximumV():"3008"==(null==n||null===(s=n.data)||void 0===s?void 0:s.code)?showNotEnoughCreditsVideo(t.swapCredits):null!=n&&null!==(c=n.message)&&void 0!==c&&c.includes("faces=0")||null!=n&&null!==(d=n.message)&&void 0!==d&&d.includes("no face")?(p=textContentObj.No_face,t.task_credits&&(p=textContentObj.Credits_failed_no_face),ToolTip({type:"error",title:textContentObj.Failed,content:p,btn:textContentObj.ok})):null!=n&&null!==(u=n.message)&&void 0!==u&&u.includes("celebrity")?(v=textContentObj.celebrity,t.task_credits&&(v=textContentObj.Credits_failed_celebrity),ToolTip({type:"error",title:textContentObj.Failed,content:v,btn:textContentObj.ok})):null!=n&&null!==(l=n.message)&&void 0!==l&&l.includes("faces=")?(f=textContentObj.Mutiple_face,t.task_credits&&(f=textContentObj.Credits_failed_multi_face),ToolTip({type:"error",title:textContentObj.Failed,content:f,btn:textContentObj.ok})):(h=textContentObj.processImage,t.task_credits&&(h=textContentObj.Credits_failed),ToolTip({type:"error",title:textContentObj.Failed,content:h,btn:textContentObj.ok}),console.log(n.message)),this.isShowControl&&this.PreviewVideoTool.showVideoControls(!0);case 23:this.setLoadingStep({step:0}),this.videoContainer.showUploading(!1),this.imgContainer.showUploading(!1),this.videoDemo.domeLoadDisabled(!1),this.faceSwapLoading(!1);case 28:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"uploadFile",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,o,i,r,a,s=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t,this.videoRandom,this.imageRandom,"uploadFile"),n=t.videoFile,o=t.imgFile,i=this.videoRandom?(null==n?void 0:n.video_url.split(".").pop())||"mp4":(null==n?void 0:n.name.split(".").pop())||"mp4",r=this.imageRandom?(null==o?void 0:o.pic_url.split(".").pop())||"jpg":(null==o?void 0:o.name.split(".").pop())||"jpg",(a=this).setLoadingStep({step:1}),e.abrupt("return",new Promise(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,c){var d,u,l,p,v;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s.videoRandom){e.next=5;break}return e.next=4,fetchPost("ai/source/temp-upload-url",{file_name:"vidqu_faceswap."+i},TOOL_API);case 4:d=e.sent;case 5:if(s.imageRandom){e.next=9;break}return e.next=8,fetchPost("ai/source/temp-upload-url",{file_name:"vidqu_faceswap."+r},TOOL_API);case 8:u=e.sent;case 9:e.next=16;break;case 11:return e.prev=11,e.t0=e.catch(0),console.log("获取上传地址失败",e.t0),t({bool:!1}),e.abrupt("return");case 16:if(s.videoRandom){e.next=19;break}return e.next=19,s.testUploadFile(d.data.upload_url,n,t);case 19:if(s.imageRandom){e.next=22;break}return e.next=22,s.testUploadFile(u.data.upload_url,o,t);case 22:if(s.videoRandom){e.next=26;break}return e.next=25,getFileUrlRequest(d.data.access_url);case 25:l=e.sent;case 26:if(s.imageRandom){e.next=30;break}return e.next=29,getFileUrlRequest(u.data.access_url);case 29:l=e.sent;case 30:if(s.videoRandom&&s.imageRandom){e.next=38;break}if(l){e.next=37;break}return console.log("failed ",u),t({bool:!1,type:"upload"}),e.abrupt("return");case 37:console.log("success ",u);case 38:return v=a.videoContainer.videoDuration,e.prev=39,e.next=42,a.createTaskFun({video_key:a.videoRandom?n.video_key:d.data.key,avatar_key:a.imageRandom?o.pic_key:u.data.key,duration:v,size:(a.videoRandom,n.size)});case 42:p=e.sent,e.next=50;break;case 45:return e.prev=45,e.t1=e.catch(39),console.log("创建任务失败",e.t1),t({bool:!1,message:e.t1.message,data:e.t1}),e.abrupt("return");case 50:t(p);case 51:case"end":return e.stop()}}),e,null,[[0,11],[39,45]])})));return function(t,n){return e.apply(this,arguments)}}()));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"createTaskFun",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,o,i,r,a,s;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.video_key,o=t.avatar_key,i=t.demo_key,r=t.duration,a=t.size,s=this,e.abrupt("return",new Promise(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,c){var d,u,l;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetchPost("ai/tool/video-face-changing",{video_key:n,avatar_key:o,demo_key:i,duration:r,size:a,watertype:5,is_hd:null===(d=photocreditSystem)||void 0===d?void 0:d.is_hd},TOOL_API,{"X-TASK-VERSION":"2.0.0"});case 2:if(200!==(u=e.sent).code){e.next=13;break}return e.next=6,s.intervalGetTask(u.data.task_id);case 6:l=e.sent,userRuleConfig.credit=u.data.credit,show_priority=0,changeHeaderCredit(userRuleConfig.credit),t(l),e.next=14;break;case 13:c(u);case 14:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"setMaskUnlockPriority",value:function(){$("#createTaskMaskVideo .v_mask_unlock_priority").on("click",(function(e){gtag("event","click_faceswap_videopriority"),setCookie("st","fsvideocreditpriority")}))}},{key:"setLoadingMaskTip",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(t.maskSpan,t.show_wait),o=t.num,i=t.second,r=$("#createTaskMaskVideo"),a=$("#video_Face_swapper_container .v_mask_background");if(e){if(1===n){r.find(".v_mask_content2").show();var s=i,c="wait_minutes";i>=60?s=Math.ceil(i/60):c="wait_seconds",r.find(".v_mask_content2 .v_mask_span").html(setTextContentObj("estimated_wait_time",{val:o,val2:s,val3:setTextContentObj(c)}))}else r.find(".v_mask_content2").hide();r.show(),a.show()}else r.hide(),a.hide()}},{key:"isSubmit",value:function(){null!==this.videoContainer.uploadFile&&null!==this.imgContainer.uploadFile&&(this.videoContainer.getConsumeCredit(this.videoContainer.videoDuration),this.element.find(".change_video_btn").removeClass("disabled"),this.disabled=!1)}},{key:"intervalGetTask",value:function(e){var t=this,n=3;return new Promise((function(o){var i=setInterval((function(){fetchPost("ai/tool/get-task",{id:e},TOOL_API).then((function(e){if(200===e.code){var n;if(t.setLoadingStep({step:2,createTask:e}),1===(null===(n=e.data.wait)||void 0===n?void 0:n.show_wait)){0==show_priority&&(show_priority++,gtag("event","show_faceswap_videopriority"));var r=e.data.wait,a=r.num,s=r.second;t.setLoadingMaskTip(!0,{show_wait:1,num:a,second:s})}else t.setLoadingMaskTip(!1);0===e.data.status&&(setCookie("faceSwapTime_swap",Date.now(),2),clearInterval(i),showCreditBannerP(!0),o({bool:!0,data:e.data}))}else t.setLoadingMaskTip(!1),clearInterval(i),o({bool:!1,message:e.message})})).catch((function(e){0===--n&&(clearInterval(i),o({bool:!1,message:e}))}))}),3e3)}))}},{key:"testUploadFile",value:(e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n,o){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetchPut(t,n,"");case 3:e.next=10;break;case 5:return e.prev=5,e.t0=e.catch(0),console.log("failed upload file",e.t0),o({bool:!1,message:"exception_occurred"}),e.abrupt("return");case 10:case"end":return e.stop()}}),e,null,[[0,5]])}))),function(t,n,o){return e.apply(this,arguments)})},{key:"setInitGtag",value:function(e){"tab_video"===e?this.initGtag||(this.initGtag=!0):this.initGtag2||(this.initGtag2=!0)}},{key:"faceSwapLoading",value:function(e){this.submitData.isVideoSubmit=e}},{key:"showBtnCredits",value:function(e,t){this.swapCredits=t,this.task_credits=e,videocreditSystem.showBtnCredits({bool:e,credits:t,appendDom:$("#video_Face_swapper_container .change_video_btn"),type:"video"})}},{key:"eventLoginsuccess",value:function(){var e=this;document.querySelector("my-component").addEventListener("loginsuccess",(function(t){getCountryConfig().then((function(t){userRuleConfig=t,e.videoContainer.uploadFile?e.videoContainer.getConsumeCredit(e.videoContainer.videoDuration):showCreditBannerP(!0),isLogin(!0)}))}))}}]);var e,t,n,o,i,r}(),PreviewVideoTool=function(){return _createClass((function e(t,n){_classCallCheck(this,e),this.element=t,this.submit=n,this.video_preview_dom=this.element.find("#video_preview_dom")[0],this.video_larger_preview_dom=$("#v_preview_larger_video")[0],this.gif_larger_preview_dom=$("#v_preview_larger_gif")[0],this.downloadData=null,this.showControls=!1}),[{key:"initFace",value:function(){var e=this;this.element.find(".zoomIn").on("click",(function(){e.pauseVideoPreview(),gtag("event","zoomin_faceswap_videores"),e.showPreviewVideo(!0)})),$("#large_modal.video_large .close_large").on("click",(function(){this.showPreviewVideo(!1),this.pauseLargerVideoPreview()})),this.element.find(".download").on("click",(function(){e.downloadVideo()})),this.element.find(".v_preview_playIcon").fadeOut(),this.element.find(".v_preview_playIcon").on("click",(function(t){e.playerVideoPreview(),t.originalEvent.stopPropagation()})),this.element.find("#video_preview_dom").on("click",(function(t){e.pauseVideoPreview(),t.originalEvent.stopPropagation()})),this.element.find("#video_preview_dom").on("contextmenu",(function(e){e.originalEvent.preventDefault()})),$("#v_preview_larger_video").on("contextmenu",(function(e){e.originalEvent.preventDefault()})),$(".v_preview_larger_playIcon").on("click",(function(t){e.playerLargerVideoPreview(),t.originalEvent.stopPropagation()}));var t=this.element.find(".video_preview_larger .v_preview_waitingIcon");this.video_larger_preview_dom.addEventListener("waiting",(function(){t.fadeIn()})),this.video_larger_preview_dom.addEventListener("playing",(function(){t.fadeOut()})),$("#v_preview_larger_video").on("click",(function(n){e.pauseLargerVideoPreview(),t.fadeOut(),n.originalEvent.stopPropagation()}));var n=$("#shareDialogEl").find(".v_preview_waitingIcon"),o=$("#shareDialogEl").find(".preview-video-box .show-video")[0];o.addEventListener("waiting",(function(){n.fadeIn()})),o.addEventListener("playing",(function(){n.fadeOut()})),o.addEventListener("pause",(function(){n.fadeOut()}));var i=this.element.find(".v_preview_playIcon");this.video_preview_dom.addEventListener("pause",(function(){i.fadeIn()})),this.video_preview_dom.addEventListener("play",(function(){i.fadeOut()})),this.element.find("#createTaskMask .v_mask_unlock_priority").on("click",(function(e){})),this.showVideoControls(!1)}},{key:"showShareDom",value:function(){console.log("showShareDom");this.submit.videoContainer;this.videoSrc="",this.videoCoverImgSrc="",console.log(this.submit.videoContainer),shareFun({url:this.downloadData.url,text:setTextContentObj("share_text_v"),imageKey:this.downloadData.key,title:setTextContentObj("share_title_v"),content:setTextContentObj("share_title_centent")})}},{key:"setLoadingText",value:function(e){this.element.find(".loading_box").find(".faceSwapProgress").text(e)}},{key:"playerVideoPreview",value:function(){this.element.find(".v_preview_playIcon").fadeOut(),this.video_preview_dom.play()}},{key:"playerLargerVideoPreview",value:function(){var e=$(".v_preview_larger_playIcon");e.fadeOut(),this.video_larger_preview_dom.play(),this.video_larger_preview_dom.addEventListener("pause",(function(){e.fadeIn()}),{once:!0})}},{key:"pauseVideoPreview",value:function(){this.video_preview_dom.paused||this.video_preview_dom.pause()}},{key:"pauseLargerVideoPreview",value:function(){this.video_larger_preview_dom.paused||this.video_larger_preview_dom.pause()}},{key:"setLoading",value:function(e){e?(this.element.find(".video_dom_container").css("filter","blur(4px)"),this.element.find(".preview_upload_loading").css("display","flex")):(this.element.find(".video_dom_container").css("filter",""),this.element.find(".preview_upload_loading").css("display","none"))}},{key:"setVideoOrGifSrc",value:function(e,t,n){var o=this,i=this;return new Promise((function(r,a){if("video"===e){var s=o.element.find(".video_node")[0],c=n||i.submit.videoContainer.videoCoverImgSrc;c&&(i.element.find(".img_gif_node")[0].src=c,i.element.find(".video_node").css("display","none"),i.element.find(".img_gif_node").css("display","")),s.addEventListener("loadedmetadata",_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:setTimeout(_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.element.find(".video_node").css("display",""),i.element.find(".img_gif_node").css("display","none"),!n){e.next=6;break}r(n),e.next=11;break;case 6:return e.next=8,getVideoCoverImage(s);case 8:t=e.sent,i.element.find(".img_gif_node")[0].src=t,r(t);case 11:case"end":return e.stop()}}),e)}))),200);case 1:case"end":return e.stop()}}),e)}))),{once:!0}),s.src=t,s.load(),o.video_larger_preview_dom.src=t,o.video_larger_preview_dom.load(),$(o.gif_larger_preview_dom).hide(),$(o.video_larger_preview_dom).show(),o.element.find(".v_preview_playIcon").fadeIn(),$(".v_preview_larger_playIcon").fadeIn(),n&&r(n)}else"gif"===e&&(o.element.find(".video_node").css("display","none"),o.element.find(".img_gif_node").css("display",""),o.element.find(".img_gif_node")[0].src=t,o.gif_larger_preview_dom.src=t,$(o.gif_larger_preview_dom).show(),$(o.video_larger_preview_dom).hide(),o.element.find(".v_preview_playIcon").fadeOut(),$(".v_preview_larger_playIcon").fadeOut(),o.element.find(".img_gif_node")[0].onload=function(){r()})}))}},{key:"showVideoControls",value:function(e){var t=this.showControls;return this.showControls=e,e?$("#video_Face_swapper_container .spread_box_controls").css("visibility","visible"):$("#video_Face_swapper_container .spread_box_controls").css("visibility","hidden"),t}},{key:"showPreviewVideo",value:function(e){var t=this;e?($("#v_preview_larger_video")[0].currentTime=0,$("#large_modal").addClass("video_large").fadeIn(),$("#large_modal.video_large .download").on("click",function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(n){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.downloadVideo();case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())):($("#large_modal").fadeOut().removeClass("video_large"),$("#large_modal .download").off("click"))}},{key:"downloadVideo",value:(e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,n,o,i,r,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(getCookie("access_token")){e.next=3;break}return showLoginWindow({isReloading:!1}),e.abrupt("return");case 3:return gtag("event","download_faceswap_videores"),t=this.downloadData,n=t.key,o=t.type,i=function(){ToolTip({type:"success",title:textContentObj.Download_success,content:textContentObj.Download_sucess_text,btn:textContentObj.ok})},r=function(){ToolTip({type:"error",title:textContentObj.Failed,content:textContentObj.downloadError,btn:textContentObj.ok})},a=function(){ToolTip({type:"error",title:textContentObj.failedTitle,content:textContentObj.file_download_exist,btn:textContentObj.ok})},e.next=11,fetchPost("ai/source/get-access-url",{key:n,action:"download",file_name:"Vidqu_faceswap."+o},TOOL_API).then((function(e){ToolTip({type:"progress",content:textContentObj.downloading,progressType:"fetch",url:e.data.url,name:"Vidqu_faceswap."+o,sucessCallback:i,failedCallback:r,NoExistCallback:a})})).catch((function(e){ToolTip({type:"error",title:textContentObj.errorNetworkTitle,content:textContentObj.errorNetwork,btn:textContentObj.ok})}));case 11:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})}]);var e}(),CreditsMessageModel=function(){return _createClass((function e(){_classCallCheck(this,e)}),[{key:"showNotEnoughCredits",value:function(){ToolTip({type:"error",title:textContentObj.Failed,content:getfsCreditsText("Model_not_credit_span",{val:credits}),btn:textContentObj.ok})}},{key:"showMaximum",value:function(){gtag("event","alert_faceswap_videomaxlimit");var e=getfsCreditsText("Model_Maximum_span",{val:userRuleConfig.v_times},!0);ToolTip({type:"error",title:textContentObj.exceedTitle,content:e,btn:textContentObj.ok})}},{key:"showMaximumFileSize",value:function(){var e=getfsCreditsText("Model_MaximumFile_span",{val:userRuleConfig.limit});ToolTip({type:"error",title:textContentObj.Failed,content:e,btn:textContentObj.ok})}}])}(),TabsChange=function(){return _createClass((function e(t,n,o){_classCallCheck(this,e),this.element=t,this.tabs=n,this.submit=o,this.actTab="tab_photo"}),[{key:"initFace",value:function(){var e=this;e.changeTabs("tab_photo"),this.element.find(".faceSwap_tab").click((function(){var t=$(this).attr("tabName");"tab_multiple"!=t&&e.changeTabs(t)}))}},{key:"changeTabs",value:function(e){this.actTab=e,actTab=e,this.element.find(".faceSwap_tab").removeClass("active");for(var t=this.element.find(".faceSwap_tab"),n=0;n<t.length;n++){var o=t[n];$(o).attr("tabName")===e&&$(o).addClass("active")}this.tabs.tab_all.forEach((function(e){e.hide()})),this.tabs[e].dom.forEach((function(e){e.show()})),"tab_video"===e?("T1"===userRuleConfig.countrycode&&$(".our_pics li[data-type='video'][data-vp='v']").show(),$(".our_pics li[data-type='video'][data-vp='p']").show(),$(".our_pics li[data-type='photo']").hide(),this.submit.setInitGtag("tab_video"),gtag("event","click_faceswap_videotab")):"tab_multiple"===e?gtag("event","click_faceswap_multitab"):($(".our_pics li[data-type='photo']").show(),$(".our_pics li[data-type='video']").hide(),this.submit.setInitGtag("tab_photo"),gtag("event","click_faceswap_phototab"))}}])}(),VideoDemo=function(){return _createClass((function e(t,n){_classCallCheck(this,e),this.submit=n,this.element=t,this.demoType="video",this.checkedDemo={},this.demoObj={video:{},photo:{}},this.extendDurationEl=$("#video_Face_swapper_container .video_extend_duration"),this.initFace(),this.showMoreVideoDuration(!1)}),[{key:"initFace",value:function(){this.extendDurationEl.find(".v_other_button").on("click",(function(){console.log("Extend Video duration")})),this.getVideoOrImgDemo()}},{key:"setTabs",value:function(){"T1"!==userRuleConfig.countrycode&&(this.element.find(".v_demo_photoTab").click(),this.element.find(".v_demo_videoTab").css("display","none"))}},{key:"setCheckedDemo",value:function(e,t){var n=this;return new Promise(function(){var o=_asyncToGenerator(_regeneratorRuntime().mark((function o(i,r){var a,s,c,d;return _regeneratorRuntime().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(t){o.next=4;break}return n.checkedDemo[e]={},i(),o.abrupt("return");case 4:if(a=t.key,s=t.url,c=t.cover_url,d=t.f_key,"video"!==e){o.next=15;break}return n.checkedDemo.video={key:a,cover_url:c,url:s,f_key:d},n.submit.videoContainer.showUploading(!0),n.submit.videoContainer.videoDuration=15,n.submit.videoContainer.uploadFile=null,o.next=12,n.submit.videoContainer.setVideoFileSrc(n.checkedDemo.video.url);case 12:setTimeout((function(){n.submit.videoContainer.showUploading(!1),n.submit.PreviewVideoTool.showVideoControls(!1),i()}),2e3),o.next=16;break;case 15:"photo"===e?(n.checkedDemo.photo={key:a,url:s,f_key:d},n.submit.imgContainer.imageSrc=s,n.submit.imgContainer.uploadFile=null,n.submit.PreviewVideoTool.showVideoControls(!1),i()):(n.checkedDemo={},i());case 16:case"end":return o.stop()}}),o)})));return function(e,t){return o.apply(this,arguments)}}())}},{key:"domeLoadDisabled",value:function(e){e?($('.our_pics li[data-type="video"]').css({filter:"brightness(0.5)","pointer-events":" none"}),$('.our_pics li[data-type="video"]').css({filter:"brightness(0.5)","pointer-events":" none"})):($('.our_pics li[data-type="video"]').css({filter:"","pointer-events":""}),$('.our_pics li[data-type="video"]').css({filter:"","pointer-events":""}))}},{key:"changeDemoLoading",value:function(e,t){e?$('.our_pics li[data-type="video"]').css({filter:"brightness(0.5)","pointer-events":" none"}):$('.our_pics li[data-type="video"]').css({filter:"","pointer-events":""})}},{key:"downloadVideoDemoFile",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this,e.abrupt("return",new Promise(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(o,i){var r,a,s,c;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.url,a=t.f_key,s=t.cover_url,n.demoObj.video[a]){e.next=21;break}return e.next=4,srcToFile(r,"video");case 4:if(!(c=e.sent)){e.next=17;break}if(200!==(null==c?void 0:c.code)){e.next=13;break}return n.demoObj.video[a]={key:c.data.key,url:r,cover_url:s,f_key:a},e.next=10,n.setCheckedDemo("video",n.demoObj.video[a]);case 10:o(),e.next=15;break;case 13:console.error(c),o();case 15:e.next=19;break;case 17:console.error(c),o();case 19:e.next=24;break;case 21:return e.next=23,n.setCheckedDemo("video",n.demoObj.video[a]);case 23:o();case 24:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"downloadPhotoDemoFile",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this,e.abrupt("return",new Promise(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(o,i){var r,a,s;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.url,a=t.f_key,n.demoObj.photo[a]){e.next=8;break}return e.next=4,srcToFile(r,"photo");case 4:(s=e.sent)&&200===(null==s?void 0:s.code)?(n.demoObj.photo[a]={key:s.data.key,url:r,f_key:a},n.setCheckedDemo("photo",n.demoObj.photo[a])):console.error(s),e.next=9;break;case 8:n.setCheckedDemo("photo",n.demoObj.photo[a]);case 9:o();case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getVideoOrImgDemo",value:(e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this,document.querySelector(".our_pics").addEventListener("click",(function(e){var n=e.target.parentNode;if("video"==n.getAttribute("data-type"))if("p"===n.getAttribute("data-vp")){t.submit.imageRandom=!0,t.submit.PreviewVideoTool.showVideoControls(!1),t.submit.imgContainer.showUploading(!0);var o=n.getAttribute("pic-url"),i=n.getAttribute("pic-key");t.changeDemoLoading(!0,"photo"),t.submit.imgContainer.uploadFile={pic_key:i,pic_url:o},t.submit.imgContainer.imageSrc=o,t.submit.imgContainer.element.find(".step_P")[0].src=o,$(".head_portrait_container").addClass("active"),t.changeDemoLoading(!1,"photo"),gtag("event","clickvid_faceswap_imgtpl"),t.submit.imgContainer.showUploading(!1)}else{t.submit.videoRandom=!0,t.submit.PreviewVideoTool.showVideoControls(!1);var r=n.getAttribute("video-url"),a=n.getAttribute("video-key"),s=n.getAttribute("cover-url"),c=n.getAttribute("video-duration"),d=n.getAttribute("video-size");t.changeDemoLoading(!0,"video"),t.submit.videoContainer.showUploading(!0),t.submit.videoContainer.videoDuration=c,t.submit.videoContainer.uploadFile={cover_url:s,video_key:a,video_url:r,size:d,duration:c},t.submit.PreviewVideoTool.setVideoOrGifSrc("video",r,s),$("#video_Face_swapper_container .step_V")[0].src=s,$(".video_img").addClass("active");var u="video/"+a.split(".")[1];"video/mp4"===u&&"video/webm"===u||(u="video/quicktime"),t.changeDemoLoading(!1,"video"),t.submit.videoContainer.showUploading(!1),gtag("event","clickvid_faceswap_vidtpl")}}));case 2:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})},{key:"showMoreVideoDuration",value:function(e){e?0==userRuleConfig.credit&&(this.element.hide(),this.extendDurationEl.find(".v_duration_content").html(setTextContentObj("More_duration_span",{val:userRuleConfig.duration})),this.extendDurationEl.show()):(this.element.show(),this.extendDurationEl.hide())}}]);var e,t,n}();function showMaximumFileSizeV(){var e,t,n;videocreditSystem.showCreditPopup({title:getfsCreditsText("Model_MaximumFile_title"),content:getfsCreditsText(1===(null===(e=userRuleConfig)||void 0===e?void 0:e.is_subscriber)?"Model_MaximumFile_span2":"Model_MaximumFile_span",{val:userRuleConfig.limit}),btn:getfsCreditsText(1===(null===(t=userRuleConfig)||void 0===t?void 0:t.is_subscriber)?"ok":"Model_Unlock_btn"),btnFn:function(){var e;null===(e=userRuleConfig)||void 0===e||e.is_subscriber},isnotNeedPay:1===(null===(n=userRuleConfig)||void 0===n?void 0:n.is_subscriber),modalCoins:"filemax"})}function showMaximumV(){gtag("event","alert_faceswap_videomaxlimit"),videocreditSystem.showCreditPopup({title:textContentObj.exceedTitle,content:getfsCreditsText("Model_Maximum_span",{val:userRuleConfig.v_times},!0),btn:getfsCreditsText("Model_Unlock_btn"),btnFn:function(){gtag("event","click_faceswap_videomaxlimit"),setCookie("st","fsvideomaxlimit")},modalCoins:"timesmax"})}function getVideoCoverImage(e){return _getVideoCoverImage.apply(this,arguments)}function _getVideoCoverImage(){return(_getVideoCoverImage=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){t.play(),setTimeout((function(){t.pause()}),100),setTimeout((function(){try{var n=document.createElement("canvas");n.width=t.videoWidth,n.height=t.videoHeight,n.getContext("2d").drawImage(t,0,0,n.width,n.height);var o=n.toDataURL("image/jpeg");e(o)}catch(t){console.log("获取第一帧失败"),e("")}}),500)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function srcToFile(e,t,n){return _srcToFile.apply(this,arguments)}function _srcToFile(){return _srcToFile=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n,o){var i,r,a,s;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(i="video"===n?[".m4v",".mp4",".mov",".webm"]:[".jpg",".png",".webp",".jpeg"]).filter((function(e){return o.includes(e)})),console.log(i,o,r),a=r[0].split(".")[1],s="video"===n?"video/"+a:"image/"+a,"video"!==n||"video/mp4"===s&&"video/webm"===s||(s="video/quicktime"),e.abrupt("return",new Promise(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(n,o){var i,r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,videoSrcConvertToBlob(t,s);case 2:return i=e.sent,e.next=5,blobUrlToFile(i,{filename:"vidqu_faceswap",type:s});case 5:r=e.sent,console.log(r),n(r);case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 8:case"end":return e.stop()}}),e)}))),_srcToFile.apply(this,arguments)}function srcToFile2(e,t){return _srcToFile2.apply(this,arguments)}function _srcToFile2(){return _srcToFile2=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n){var o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o="video"===n?"video/mp4":"image/jpg",e.abrupt("return",new Promise(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(n,i){var r,a,s,c,d;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,videoSrcConvertToBlob(t,o);case 2:return a=e.sent,e.next=5,blobUrlToFile(a,{filename:"test",type:o});case 5:return s=e.sent,e.next=8,fetchPost("ai/source/temp-upload-url",{file_name:"vidqu_faceswap"},TOOL_API);case 8:if(c=e.sent,null===(r=c.data)||void 0===r||!r.upload_url){e.next=23;break}return d=c.data.upload_url,e.prev=11,e.next=14,fetchPut(d,s,"");case 14:n(c),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(11),console.log(e.t0),n(null);case 21:e.next=25;break;case 23:console.log(c),n(null);case 25:case"end":return e.stop()}}),e,null,[[11,17]])})));return function(t,n){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}),e)}))),_srcToFile2.apply(this,arguments)}function videoSrcConvertToBlob(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"video/mp4";return new Promise((function(n,o){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="blob",i.onload=function(e){if(200==this.status){var o=new Blob([this.response],{type:t}),i=URL.createObjectURL(o);n(i)}},i.send()}))}function blobUrlToFile(e,t){return new Promise((function(n,o){var i=t.filename,r=t.type;fetch(e).then((function(e){return e.blob()})).then((function(e){var t=new File([e],i,{type:r});n(t),console.log("File object:",t)})).catch((function(e){console.error("Error:",e)}))}))}function shareFun(e){var t=document.querySelector("#shareDialogEl");t.changeTips({title:e.title,content:e.content}),t.showShare({url:e.url,action:"videofacechangingshare",imageKey:e.imageKey,text:e.text,title:e.title})}function getCountryConfig(){return new Promise((function(e,t){fetchPost("ai/tool/videoface-user",{},TOOL_API).then((function(n){200===n.code?(userRuleConfig=n.data,initCreditsComponents(),"tab_video"===actTab&&window.faceSwapTab.changeTabs(actTab),changeHeaderCredit(n.data.credit),e(n.data)):(console.error("Error getCountryConfig",n),ToolTip({type:"error",title:textContentObj.Failed,content:textContentObj.processImage,btn:textContentObj.ok}),t())})).catch((function(e){console.error(e),ToolTip({type:"error",title:textContentObj.errorNetworkTitle,content:textContentObj.errorNetwork,btn:textContentObj.ok}),t()}))}))}function getParameterByName(e){e=e.replace(/[\[\]]/g,"\\$&");var t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(window.location.search);return t?t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):"":null}function video_swap_init(){var e={tab_all:[$("#photo_Face_swapper_container"),$("#video_Face_swapper_container")],tab_photo:{dom:[$("#photo_Face_swapper_container")]},tab_video:{dom:[$("#video_Face_swapper_container")]}},t=new SubmitFaceSwap($("#video_Face_swapper_container .step_C"));window.aiFaceVideo=t,t.initFace(),t.eventLoginsuccess();var n=new TabsChange($(".faceSwap_tabBox"),e,t);return n.initFace(),getCountryConfig(),"videofaceSwap"===getParameterByName("openTab")&&n.changeTabs("tab_video"),n}function setCookie(e,t,n){var o=new Date;o.setDate(o.getDate()+n);var i=location.hostname.includes(".vidqu.ai")?".vidqu.ai":location.hostname,r=encodeURIComponent(t)+(null==n?"":";expires="+o.toUTCString())+";path=/;domain="+i;document.cookie=e+"="+r}function isMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function createObjectURLFun(e){return URL.createObjectURL(e)}function createFileUrl(e){e.type;return new Promise((function(t,n){var o=new FileReader;o.onload=function(e){var n=e.target.result;t(n)},o.readAsDataURL(e)}))}function getFileUrlRequest(e){return new Promise((function(t,n){var o=new XMLHttpRequest;o.open("GET",e,!0),o.send(),o.addEventListener("readystatechange",(function(e){if(2==o.readyState){var n=o.getResponseHeader("Content-Length");t(!!(n&&n/1024>1)),o.abort()}}),!1)}))}function showNotEnoughCreditsVideo(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;gtag("event","alert_faceswap_videonocredit"),videocreditSystem.showCreditPopup({title:getfsCreditsText("Model_not_credits_title"),content:getfsCreditsText("Model_not_credit_span",{val:e},!0),btn:getfsCreditsText("Model_not_credits_btn"),btnFn:function(){gtag("event","click_faceswap_videonocredit"),setCookie("st","fsvideonocredit")},modalCoins:"notenough"})}$(window).ready((function(){window.faceSwapTab=video_swap_init()}));