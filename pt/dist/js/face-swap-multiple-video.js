var canMultiFaceData={};function showMaximumFileSizeV(){multiVcreditSystem.showCreditPopup({title:getfsCreditsText("Model_MaximumFile_title"),content:getfsCreditsText(1===userRuleConfig?.is_subscriber?"Model_MaximumFile_span2":"Model_MaximumFile_span",{val:userRuleConfig.limit}),btn:getfsCreditsText(1===userRuleConfig?.is_subscriber?"ok":"Model_Unlock_btn"),btnFn:()=>{userRuleConfig},isnotNeedPay:1===userRuleConfig?.is_subscriber,modalCoins:"filemax"})}window.multiphotoAiFaceChanging={};class MultiVideoAiFace{constructor(e){this.multimodelV=e.multimodelV,this.setMaskUnlockPriority(),Object.setPrototypeOf(MultiVideoAiFace.prototype,this.data()),this.form=new Proxy(this.proxyData,{set:(e,t,i)=>(e[t]=i,e.originImage?($("#multiple_Face_swapper_container_v .multi_upload_before").hide(),$("#multiple_Face_swapper_container_v .multi_upload_after").show(),$("#multiple_Face_swapper_container_v .drag_loadbox").addClass("height160")):($("#multiple_Face_swapper_container_v .multi_upload_before").show(),$("#multiple_Face_swapper_container_v .multi_upload_after").hide(),$("#multiple_Face_swapper_container_v .change_multi_face_btn").addClass("disabled")),e.firstPicLoading?($("#multiple_Face_swapper_container_v .multi_Input").addClass("disabled"),$("#multiple_Face_swapper_container_v .random_btn").addClass("disabled")):($("#multiple_Face_swapper_container_v .multi_Input").removeClass("disabled"),$("#multiple_Face_swapper_container_v .random_btn").removeClass("disabled")),!0),get:(e,t)=>e[t]})}data(){return{mergeImg:{width:0,height:0},proxyData:{originImage:null,firstPicLoading:!1},tryCount:0,multipleIndex:null,delay:2e3,lastCall:0,taskid:null,imgList:[],mergeImgUrl:null,mergeKey:null,changeFaceLoading:!1,canMultiFaceData:{},showCreditBannerBool:!0,uploadFacesNumber:0,formdata:{avatar_obey_key:null,get_face_id:null,watermark_type:2,avatar_main_key:[]},itemLoading:[]}}getUploadFileUrl=e=>{let t=e;try{t=e.split("/")[1]||"png"}catch(e){t="png"}return fetchPost("ai/source/temp-upload-url",{file_name:"Vidnoz_AiFaceSwap_"+(new Date).getTime()+"."+t},TOOL_API)};uploadFile=({url:e,file:t})=>new Promise((async(i,a)=>{try{i(await fetchPut(e,t,""))}catch(e){console.error(e.message),a(e)}}));setLoadingVideoText(e,t){Number(t)<1&&(t=0),1===e&&$("#multiple_Face_swapper_container_v .loading_multi_box p").text(multitextContentObj.faceSwapPop01.Preparing_step),2===e&&$("#multiple_Face_swapper_container_v .loading_multi_box p").text(t+"% "+multitextContentObj.faceSwapPop01.Analyzing_setp),3===e&&$("#multiple_Face_swapper_container_v .loading_multi_box p").text(t+"% "+multitextContentObj.faceSwapPop01.Swapping_setp)}async addMultiVideo({addData:e={},file:t,callback:i}){try{if("string"!=typeof t&&!this.checkVideoType(t))return;if(!this.setLimit(t))return;const n=e?.demoKey||void 0,o=e?.demoSrc||void 0,l=e?.demoDuration||void 0,s=e?.demoImgSrc||void 0;this.setFirstStart(!0);let _=userRuleConfig.duration,r=null,c=r,d=n?"video":"gif";if(this.maintype="video",t?.type?.includes("video")){const e=await this.getVideoInfo(t);_=e.duration,c=e.coverImg,d="video"}if(this.duration=_,this.setLiLoading(!0),this.showToolBtn(!1),$("#multiple_Face_swapper_container_v .change_multi_face_btn").addClass("disabled"),n)c=s,r=o,_=l,this.formdata.avatar_obey_key=n;else{r=URL.createObjectURL(t);const e=await this.uploadMultiVideoPromise(t);this.formdata.avatar_obey_key=e.data.key}"gif"===d?(c=URL.createObjectURL(t),$(".controls").hide()):$(".controls").attr("style","display: flex");var a={file:t,showUrl:c,duration:_,showVideoUrl:r};this.uploadFacesNumber=0,this.addFindFacesTask((()=>{this.form.originImage=a,$("#multiple_Face_swapper_container_v .multi_img").find("#multi_img").attr("src",a.showUrl),$("#multiple_Face_swapper_container_v .multi_img").addClass("video_img"),this.showMultiVideo(d,r,c),i?.(a),showBtnCreditsMultiVideo(!1),this.setLiLoading(!1),this.setFirstStart(!1)}),_)}catch(e){console.error(111),console.error(e),this.multimodelV.errorMessage({conText:`\n        <h1>${textContentObj.errorUploadTitle}</h1>\n        <p>${textContentObj.filereadfail}</p>\n        `,btnText:textContentObj.ok}),this.multimodelV.options.visible=!0,this.setFirstStart(!1)}}ttsBlank(e){return null==e||"null"===e||""===e||void 0===e||"undefined"===e||"unknown"===e}formatTime=e=>{if(0==e)return"00:00";if(this.ttsBlank(e)||Number.isNaN(e))return"00:00";let t=parseInt(e/60);t=t<10?"0"+t:t;var i=parseInt(e%60);return`${t}:${i=i<10?"0"+i:i}`};progressMove(e){let t=0;t=isMobileDevice()?e.targetTouches[0].pageX:e.clientX;const i=document.querySelector(".control_progress"),a=($(".control_progress .control_progress_innter"),i.getBoundingClientRect().left),n=i.offsetWidth;let o,l=t-a;o=l<0?0:l>n?n:l}setPlayControls(e,t){const i=t.find(".control_btn"),a=(t.find(".control_time"),e[0]);a.load();e.off("loadedmetadata").on("loadedmetadata",(function(){e.off("click").on("click",(function(){i.hasClass("pause")?a.pause():a.play()}))})),e.off("ended").on("ended",(function(){console.log("end"),i.removeClass("pause")})),e.off("playing").on("playing",(function(){console.log("play"),i.addClass("pause")})),e.off("pause").on("pause",(function(){console.log("pause"),i.removeClass("pause")}))}showMultiVideo(e="video",t,i){const a=$("#video_preview_dom_multi"),n=$(".video_preview_dom_multi_box"),o=$("#multi_video_con"),l=$("#multi_img_con"),s=$("#img_gif_node_multi"),_=$("#large_multi_video");"video"===e?(a.attr("src",t),n.find("#img_video_cover").attr("src",i),n.show(),s.hide()):(s.attr("src",t),s.show(),n.hide()),o.show(),l.hide(),this.setPlayControls(a,$(".multi_controls")),this.setPlayControls(_,$(".large_multi_controls"))}getUploadVideoUrl=e=>{let t=e;try{t=e.substring(e.lastIndexOf("."))||"mp4"}catch(e){t="mp4"}return fetchPost("ai/source/temp-upload-url",{file_name:"Video Face Swap"+t},TOOL_API)};uploadMultiVideoPromise(e){return new Promise((async(t,i)=>{try{var a=await this.getUploadVideoUrl(e.name);this.uploadFile({url:a.data.upload_url,file:e}).then((e=>{t(a)})).catch((e=>i(e)))}catch(e){console.log(e)}}))}getVideoInfo(e){return new Promise(((t,i)=>{let a=e;"string"!=typeof e&&(a=URL.createObjectURL(e));const n=document.getElementById("multi_video_dom");n.src=a,n.addEventListener("loadedmetadata",(()=>{setTimeout((async()=>{const e=n.duration;let i=await getVideoCoverImage(n);t({duration:e,coverImg:i})}),200)}),{once:!0}),n.addEventListener("error",(e=>{i(e)}),{once:!0})}))}setLimit(e){let t=!0;const i=1048576*window.userRuleConfig.limit;return"string"!=typeof e&&e.size>i&&(gtag("event","alert_mulfaceswap_videomaxlimit"),1===userRuleConfig?.is_subscriber?(this.multimodelV.errorMessage({conText:`\n            <h1>${getFSMCreditsText("Model_MaximumFile_title")}</h1>\n            <p>${getFSMCreditsText("Model_MaximumFile_span2",{val:window.userRuleConfig.limit})}</p>\n          `,btnText:textContentObj.ok}),this.multimodelV.options.visible=!0):showMaximumFileSizeV(),t=!1),t}async addFindFacesTask(e,t){try{const i={avatar_obey_key:this.formdata.avatar_obey_key,duration:Number(t||1)};t||delete i.duration;let{data:a,code:n}=await fetchPost("ai/ai-tool/add-task",{action:"multiple_video_get_face",param:i},TOOL_API,{"X-TASK-VERSION":"2.0.0"});200===n?(this.formdata.get_face_id=a.task_id,this.getFindFacesTask(e)):3014===n?(showMaximumMV(),this.checkMultiChangeFaceStatus(),this.setFirstStart(!1),this.setLiLoading(!1)):(this.multimodelV.errorMessage({conText:`\n            <h1>${multitextContentObj.faceSwapPop01.processImageTitle}</h1>\n          `,btnText:multitextContentObj.OK}),this.multimodelV.options.visible=!0,this.setFirstStart(!1),this.setLiLoading(!1),this.checkMultiChangeFaceStatus())}catch(e){console.error(e)}}async getFindFacesTask(e){const t=this,i=this.formdata.get_face_id;i&&fetchPost("ai/tool/get-task",{id:i},TOOL_API).then((i=>{if(i.message.includes("no face"))return this.multimodelV.errorMessage({conText:`\n            <h1>${multitextContentObj.faceSwapPop01.processImageTitle}</h1>\n            <p>${multitextContentObj.NoFaceMulti}</p>\n          `,btnText:multitextContentObj.OK}),this.multimodelV.options.visible=!0,this.setLoadingStart(!1),this.setLoadingMaskTip(!1),$("#multiple_Face_swapper_container_v .change_multi_face_btn").addClass("disabled"),this.formdata.avatar_main_key=[],t.setMultipleListImgs(),void $("#multiple_Face_swapper_container_v .people_recognized_box").hide();if(200!==i.code){let e=multitextContentObj.faceSwapPop01.processImage;this.multimodelV.errorMessage({conText:`\n            <h1>${multitextContentObj.faceSwapPop01.processImageTitle}</h1>\n            <p>${e}</p>\n          `,btnText:multitextContentObj.OK}),this.multimodelV.options.visible=!0,this.setLoadingStart(!1),this.setLoadingMaskTip(!1)}else this.tryCount=0,0===i.data.status?(console.log(i.data),e?.(),this.formdata.avatar_main_key=i.data.additional_data.map((e=>({obey_part_key:e.avatar_part_key,obey_part_url:e.avatar_part_url}))),console.log(t),t.setMultipleListImgs(),setTimeout((()=>{$("#multiple_Face_swapper_container_v .people_recognized_box").show(),this.setFirstStart(!1),this.setLiLoading(!1)}),1e3)):setTimeout((()=>{this.getFindFacesTask(e)}),2e3)})).catch((t=>{console.error(t),this.tryCount>=3?(this.multimodelV.errorMessage({conText:`\n            <h1>${multitextContentObj.faceSwapPop01.processImageTitle}</h1>\n            <p>${multitextContentObj.processImage}</p>\n          `,btnText:multitextContentObj.OK}),this.multimodelV.options.visible=!0,this.setLoadingStart(!1)):(console.log("retrying"),setTimeout((()=>{this.getFindFacesTask(e),this.tryCount++}),5e3))}))}urlToFile(e){return new Promise(((t,i)=>{fetch(e).then((e=>e.blob())).then((e=>{t(e)})).catch((e=>{i(e)}))}))}setLoadingStart(e){e?($("#multiple_Face_swapper_container_v .random_btn").addClass("disabled"),this.setFirstStart(!0),$("#multiple_Face_swapper_container_v .change_multi_face_btn ._multi_step3_btn").text(multitextContentObj.Generating),$("#multiple_Face_swapper_container_v .multi-generating-animate").show(),this.changeFaceLoading=!0,$("#multiple_Face_swapper_container_v #mult_main_face_change_img").attr("style","filter: blur(5px) brightness(0.7)"),$("#multiple_Face_swapper_container_v .change_multi_face_btn").addClass("disabled"),this.setLiLoading(!0),$("#multiple_Face_swapper_container_v .loading_multi_box").show(),$("#multiple_Face_swapper_container_v .people_recognized_list").addClass("inter_loading"),$(".high_quality_append_dom_multiv").attr("style","pointer-events:none")):(this.setFirstStart(!1),$("#multiple_Face_swapper_container_v .random_btn").removeClass("disabled"),$("#multiple_Face_swapper_container_v .change_multi_face_btn ._multi_step3_btn").text(multitextContentObj.step3_btn),$("#multiple_Face_swapper_container_v .multi-generating-animate").hide(),$("#multiple_Face_swapper_container_v .change_multi_face_btn").removeClass("disabled"),this.changeFaceLoading=!1,this.setLiLoading(!1),$("#multiple_Face_swapper_container_v #mult_main_face_change_img").attr("style",""),$("#multiple_Face_swapper_container_v .loading_multi_box").hide(),$("#multiple_Face_swapper_container_v .people_recognized_list").removeClass("inter_loading"),$(".high_quality_append_dom_multiv").attr("style",""))}setLiLoading=e=>{e?$("#multiple_Face_swapper_container_v .multi_pics li").attr("style","filter: blur(3px);pointer-events: none;"):$("#multiple_Face_swapper_container_v .multi_pics li").attr("style","")};setBigImageStart=e=>{e?($("#multiple_Face_swapper_container_v #mult_main_face_change_img").attr("style","filter: blur(5px) brightness(0.7)"),$("#multiple_Face_swapper_container_v .loading_multi_box").show()):($("#multiple_Face_swapper_container_v #mult_main_face_change_img").attr("style",""),$("#multiple_Face_swapper_container_v .loading_multi_box").hide())};transtoBlob=({b64data:e,contentType:t="image/png"})=>{t=t||"";let i=1024,a=atob(e.split(",")[1]),n=a.length,o=Math.ceil(n/i),l=new Array(o);for(let e=0;e<o;++e){let t=e*i,o=Math.min(t+i,n),s=new Array(o-t);for(let e=t,i=0;e<o;++i,++e)s[i]=a[e].charCodeAt(0);l[e]=new Uint8Array(s)}return new Blob(l,{type:t})};setFirstStart=e=>{e?($("#multiple_Face_swapper_container_v .multi_upload_before").addClass("loading"),$("#multiple_Face_swapper_container_v .multi_upload_after").addClass("loading"),$("#multiple_Face_swapper_container_v .multi_Input").addClass("disabled"),$("#multiple_Face_swapper_container_v .multi_Input .multi_uploader_btn_con").removeClass("show_btn_con").hide(),$("#multiple_Face_swapper_container_v .multi_Input .multi_uploader_btn_loading").show(),$("#multiple_Face_swapper_container_v .multi_uploader_btn .multi_uploader_btn_con").hide(),$("#multiple_Face_swapper_container_v .multi_uploader_btn .multi_uploader_btn_loading").show(),$("#multiple_Face_swapper_container_v .people_recognized_list").addClass("inter_loading"),$("#multi_video_con").addClass("loading"),this.form.firstPicLoading=!0,this.setBigImageStart(!0)):($("#multiple_Face_swapper_container_v .multi_upload_before").removeClass("loading"),$("#multiple_Face_swapper_container_v .multi_upload_after").removeClass("loading"),$("#multiple_Face_swapper_container_v .multi_Input").removeClass("disabled"),$("#multiple_Face_swapper_container_v .multi_Input .multi_uploader_btn_con").show().addClass("show_btn_con"),$("#multiple_Face_swapper_container_v .multi_Input .multi_uploader_btn_loading").hide(),$("#multiple_Face_swapper_container_v .multi_uploader_btn .multi_uploader_btn_loading").hide(),$("#multiple_Face_swapper_container_v .multi_uploader_btn .multi_uploader_btn_con").show(),$("#multiple_Face_swapper_container_v .people_recognized_list").removeClass("inter_loading"),$("#multi_video_con").removeClass("loading"),this.form.firstPicLoading=!1,this.setBigImageStart(!1))};checkMultiChangeFaceStatus=()=>{this.formdata.avatar_main_key.some((e=>e.main_part_key))?($("#multiple_Face_swapper_container_v .change_multi_face_btn ._multi_step3_btn").text(multitextContentObj.step3_btn),$("#multiple_Face_swapper_container_v .multi-generating-animate").hide(),$("#multiple_Face_swapper_container_v .change_multi_face_btn").removeClass("disabled"),this.changeFaceLoading=!1):$("#multiple_Face_swapper_container_v .change_multi_face_btn").addClass("disabled")};changeMultiFace=async()=>{if(this.changeFaceLoading)return;this.setLoadingStart(!0),this.setLoadingVideoText(1),this.showToolBtn(!1);const e={...this.formdata,avatar_main_key:this.formdata.avatar_main_key.filter((e=>e.main_part_key)),is_hd:multiVcreditSystem?.is_hd,duration:this.duration};this.duration||delete e.duration,fetchPost("ai/ai-tool/add-task",{param:e,action:"multiple_video_face_swap"},TOOL_API,{"X-TASK-VERSION":"2.0.0"}).then((async e=>{200===e.code?(showBtnCreditsMultiVideo(!0),this.getFinalImg(e.data.task_id)):3008===e.code?(showNotEnoughCreditsMV(getCreditsFromVideoOrPic(multiAiFaceV,"video")),this.checkMultiChangeFaceStatus(),this.setFirstStart(!1),this.setLiLoading(!1)):3014===e.code?(showMaximumMV(),this.checkMultiChangeFaceStatus(),(this.mergeKey||"multi_img"!==$("#multiple_Face_swapper_container_v #mult_main_face_change_img").attr("data-key"))&&this.showToolBtn(!0,!0),this.setFirstStart(!1),this.setLiLoading(!1)):401===e.code?(this.multimodelV.errorMessage({conText:multitextContentObj.loginFirst,btnText:multitextContentObj.OK}),this.multimodelV.options.visible=!0,this.setLoadingStart(!1)):3001===e.code?("multi_img"!==$("#multiple_Face_swapper_container_v #mult_main_face_change_img").attr("data-key")&&this.showToolBtn(!0,!0),$("#multiple_Face_swapper_container .multi_stpe3_upload .v_step3_btn_credits").show(),this.showCreditBannerV(!1),showMaximumMV(),this.setLoadingStart(!1)):(console.error(e),this.multimodelV.errorMessage({conText:`\n              <h1>${multitextContentObj.faceSwapPop01.errorUploadTitle}</h1>\n              <p>${multitextContentObj.faceSwapPop01.errorUpload}</p>\n            `,btnText:multitextContentObj.OK}),this.multimodelV.options.visible=!0,this.setLoadingStart(!1))})).catch((e=>{console.error(e),this.multimodelV.errorMessage({conText:`\n            <h1>${multitextContentObj.faceSwapPop01.errorUploadTitle}</h1>\n            <p>${multitextContentObj.faceSwapPop01.errorUpload}</p>\n          `,btnText:multitextContentObj.OK}),this.checkMultiChangeFaceStatus(),this.multimodelV.options.visible=!0,this.setLoadingStart(!1)}))};checkFileType=(e,t)=>{var i=e.type;let a=e.name.split(".");var n=a[a.length-1].toLowerCase();return!(!["image/jpeg","image/png","image/webp","application/octet-stream"].includes(i)||!["jpeg","png","webp","jpg"].includes(n))||(this.multimodelV.errorMessage({conText:`\n          <h1>${textContentObj.processImageTitle}</h1>\n          <p>${textContentObj.limit}</p>\n        `,btnText:textContentObj.ok}),this.multimodelV.options.visible=!0,this.setBigImageStart(!1),1===t&&this.setFirstStart(!1),2===t&&this.setSecondStart(!1),!1)};checkVideoType=e=>{if("string"==typeof e)return!0;var t=["video/mp4","video/quicktime","video/webm","video/x-m4v","image/gif","application/octet-stream"];isMacorIos()&&(t=t.filter((e=>!e.includes("webm"))));var i=e.type;if(!t.includes(i)){let e=isMacorIos()?multitextContentObj.faceSwapPop01.limitvios:multitextContentObj.faceSwapPop01.limitv;return this.multimodelV.errorMessage({conText:`\n          <h1>${multitextContentObj.faceSwapPop01.processImageTitle}</h1>\n          <p>${e}</p>\n        `,btnText:multitextContentObj.OK}),this.multimodelV.options.visible=!0,this.setBigImageStart(!1),this.setFirstStart(!1),$("#multiple_Face_swapper_container_v #multi_uploader")[0].value="",!1}return!0};showToolBtn(e){if(e){var t=window.getComputedStyle(document.querySelector("#mult_main_face_change_img"));this.mergeImg={width:t.getPropertyValue("width").split("px")[0],height:t.getPropertyValue("height").split("px")[0]},$("#multiple_Face_swapper_container_v .multi_img_btns").attr("style","display: flex;"),$("#multiple_Face_swapper_container_v .my_files_tips").attr("style","display: flex;"),gtag("event","show_vidqmyfiles_videotipsfile_mv")}else $("#multiple_Face_swapper_container_v .multi_img_btns").hide(),$("#multiple_Face_swapper_container_v .my_files_tips").hide()}getFinalImg=e=>{const t=this;this.showToolBtn(!1),this.setLoadingStart(!0),this.taskid=e,fetchPost("ai/tool/get-task",{id:e},TOOL_API).then((i=>{if(i.message.includes("nsfw")){let e=multitextContentObj.nsfw_photo;return t.canMultiFaceData.data?.credit&&(e=multitextContentObj.faceSwapPop01.Credits_failed_nsfw),this.multimodelV.errorMessage({conText:`\n              <h1>${multitextContentObj.faceSwapPop01.processImageTitle}</h1>\n              <p>${e}</p>\n            `,btnText:multitextContentObj.OK}),this.multimodelV.options.visible=!0,this.setLoadingStart(!1),void t.setLoadingMaskTip(!1)}if(i.message.includes("celebrity")){let e=multitextContentObj.faceSwapPop01.Target_Photo;return t.canMultiFaceData.data?.credit&&(e=multitextContentObj.faceSwapPop01.Credits_failed_celebrity),this.multimodelV.errorMessage({conText:`\n              <h1>${multitextContentObj.faceSwapPop01.processImageTitle}</h1>\n              <p>${e}</p>\n            `,btnText:multitextContentObj.OK}),this.multimodelV.options.visible=!0,this.setLoadingStart(!1),void t.setLoadingMaskTip(!1)}if(i.message.includes("faces=")&&i.message.includes("faces=0")){let e=multitextContentObj.NoFaceMulti;return t.canMultiFaceData.data?.credit&&(e=multitextContentObj.faceSwapPop01.Credits_failed_NoFaceMulti),this.multimodelV.errorMessage({conText:`\n                <h1>${multitextContentObj.faceSwapPop01.processImageTitle}</h1>\n                <p>${e}</p>\n              `,btnText:multitextContentObj.OK}),this.multimodelV.options.visible=!0,this.setLoadingStart(!1),void t.setLoadingMaskTip(!1)}if(200!==i.code){let e=multitextContentObj.faceSwapPop01.processImage;this.canMultiFaceData.data?.credit&&(e=multitextContentObj.faceSwapPop01.Credits_failed),this.multimodelV.errorMessage({conText:`\n              <h1>${multitextContentObj.faceSwapPop01.processImageTitle}</h1>\n              <p>${e}</p>\n            `,btnText:multitextContentObj.OK}),this.multimodelV.options.visible=!0,this.setLoadingStart(!1),t.setLoadingMaskTip(!1)}else{if(1===i.data.wait?.show_wait){0==show_ppriority&&(gtag("event","show_mulfaceswap_videopriority"),show_ppriority++);let{num:e,second:a}=i.data.wait;t.setLoadingMaskTip(!0,{show_wait:1,num:e,second:a})}else t.setLoadingMaskTip(!1);-1===i.data.status?this.setLoadingVideoText(2,i.data.progress):-2===i.data.status&&this.setLoadingVideoText(3,i.data.progress),this.tryCount=0,0===i.data.status?(show_ppriority=0,this.mergeImgUrl=i.data.additional_data?.merge_url,this.mergeKey=i.data.additional_data?.merge_key,setCookie("faceSwapTime_swap",Date.now(),2),window.userRuleConfig.credit=i.data.credit,this.showCreditBannerV(!0),changeHeaderCredit(i.data.credit),gtag("event","succ_mulfaceswap_videoswapbtn"),setTimeout((()=>{this.setLoadingStart(!1),$("#multiple_Face_swapper_container_v .change_multi_face_btn").removeClass("disabled"),$("#large_multi_face_v_modal #large_multi_video").attr("src",i.data.additional_data?.merge_url),this.showMultiVideo("video",i.data.additional_data?.merge_url,i.data.additional_data?.cover_url),$(".controls").attr("style","display: flex"),this.showToolBtn(!0),this.setLoadingVideoText(1)}),1e3)):setTimeout((()=>{this.getFinalImg(e)}),2e3)}})).catch((t=>{if(console.error(t),this.tryCount>=3){let e=multitextContentObj.faceSwapPop01.processImage;this.canMultiFaceData.data?.credit&&(e=multitextContentObj.faceSwapPop01.Credits_failed),this.multimodelV.errorMessage({conText:`\n                <h1>${multitextContentObj.faceSwapPop01.processImageTitle}</h1>\n                <p>${e}</p>\n              `,btnText:multitextContentObj.OK}),this.multimodelV.options.visible=!0,this.setLoadingStart(!1),this.setLoadingMaskTip(!1)}else console.log("retrying"),setTimeout((()=>{this.getFinalImg(e),this.tryCount++}),5e3)}))};faceCheck=async({blobUrl:e=""})=>new Promise(((t,i)=>{var a=new Image;a.src=e,a.onload=async()=>{try{const e=await faceapi.detectAllFaces(a,new faceapi.SsdMobilenetv1Options);if(e.length)t(e.length);else{const e=await faceapi.detectAllFaces(a,new faceapi.TinyFaceDetectorOptions({inputSize:416}));t(e.length)}}catch(e){console.log(e),i(e)}},a.onerror=async()=>{console.log(error),i(error)}}));checkFacePicMulti=e=>new Promise((async(t,i)=>{try{let i=e;"string"!=typeof e&&(i=URL.createObjectURL(e)),t(1)}catch(e){i(e)}}));showModalAboutFaceNumber=(e,t)=>{$("#multiple_Face_swapper_container_v .multi_uploader_multi")[0].value="";let i=multitextContentObj.NoFaceMulti;e&&e>1&&(i=multitextContentObj.faceSwapPop01.manyFace),this.multimodelV.errorMessage({conText:`\n        <h1>${multitextContentObj.faceSwapPop01.processImageTitle}</h1>\n        <p>${i}</p>\n      `,btnText:multitextContentObj.faceSwapPop01.replaceImg,btnClick:()=>{"faces_recognized"===t?$("#multiple_Face_swapper_container_v #multi_uploader").click():$("#multiple_Face_swapper_container_v .multi_uploader_multi").click()}}),this.multimodelV.options.visible=!0};getImgList(){var e=this;fetchGet("ai/public/example?action=multiple_video_face_swap",TOOL_API,{"Request-Origin":"vidqu"}).then((t=>{if(401===t.code)return this.multimodelV.errorMessage({conText:multitextContentObj.loginFirst,btnText:multitextContentObj.OK}),this.multimodelV.options.visible=!0,void $("#multiple_Face_swapper_container_v .multi_pics").html(multitextContentObj.loginFirst);e.domain=t.data.domain,e.imgList=t.data.video,t.data.video.forEach(((t,i)=>{$("#multiple_face_swapper_try .video-content-box .content-box").append(`\n            <li><img src="${e.domain+t.cover_key}" data-key="${t.video_key}" data-index="${i+1}"/></li> \n          `)}))})).catch((e=>{console.error("fail",e)}))}resizeImageByFile(e){var t=this;return new Promise(((i,a)=>{var n=new FileReader;n.onloadend=()=>{let e=new Image;e.onload=()=>{let a=document.createElement("canvas"),n=a.getContext("2d"),o=Math.max(e.width,e.height);if(o>1920){let t=1920/o;a.width=e.width*t,a.height=e.height*t}else a.width=e.width,a.height=e.height;n.drawImage(e,0,0,a.width,a.height);var l=a.toDataURL(),s=t.transtoBlob({b64data:l,contentType:"image/png"});let _="width";a.width<a.height&&(_="height"),i({blog:s,imgType:_})},e.onerror=()=>{a(new Error("Image load failed"))},e.src=n.result},n.onerror=a,n.readAsDataURL(e)}))}uploadMultiImagePromise(e){return new Promise((async(t,i)=>{try{var a=await this.getUploadFileUrl(e.type),{blog:n,imgType:o}=await this.resizeImageByFile(e);this.uploadFile({url:a.data.upload_url,file:n}).then((e=>{t({res:a,blog:n,imgType:o})})).catch((e=>i(e)))}catch(e){console.log(e),i(!1)}}))}getSourceUrl(e){return fetchPost("ai/source/get-access-url",{key:e,file_name:"Vidnoz_AiFaceSwap_"+(new Date).getTime()+".png"},TOOL_API)}setDragLoading(e,t){t?(this.proxyData.originImage?$(`.${e} .can_drag_box`).addClass("blur"):$(`.${e} .other_box`).addClass("blur"),$(`.${e} .drag_loadbox`).show()):($(`.${e} .other_box`).removeClass("blur"),$(`.${e} .can_drag_box`).removeClass("blur"),$(`.${e} .drag_loadbox`).hide())}throttle(e,t){let i=0;return function(...a){const n=(new Date).getTime();n-i>=t&&(e(...a),i=n)}}getCanSwapFaceBool(){return new Promise((async(e,t)=>{if(getCookie("access_token"))if(200===this.canMultiFaceData?.code){if(1===this.canMultiFaceData.data?.last_use_credit&&0===this.canMultiFaceData.data?.credit){await showRemoveWatermarkMV()&&e(!1)}e(!0)}else{if(3008===this.canMultiFaceData.code)return showNotEnoughCreditsMV(getCreditsFromVideoOrPic(multiAiFaceV,"video")),void e(!1);showMaximumMV(),e(!1)}else 200!==this.canMultiFaceData.code?(showMaximumMV(),e(!1)):e(!0)}))}setLoadingMaskTip(e,t={}){const{maskSpan:i,show_wait:a,num:n,second:o}=t;let l=$("#multiple_Face_swapper_container_v #createTaskMaskPhoto"),s=$("#multiple_Face_swapper_container_v #multiple_Face_swapper_container .v_mask_background");if(e){if(1===a){l.find(".v_mask_content2").show();let e=o,t="wait_minutes";o>60?e=Math.ceil(o/60):t="wait_seconds",l.find(".v_mask_content2 .v_mask_span").html(setTextContentObj(n>1?"estimated_wait_times":"estimated_wait_time",{val:n,val2:e,val3:setTextContentObj(t)}))}else l.find(".v_mask_content2").hide();l.show(),s.show()}else l.hide(),s.hide()}setMaskUnlockPriority(){$("#multiple_Face_swapper_container_v #createTaskMaskPhoto .v_mask_unlock_priority").on("click",(e=>{setSessionCookie("st","mulcreditpriority"),gtag("event","click_mulfaceswap_videopriority")}))}setMultipleListImgs(){const e=this,t=$("#multiple_Face_swapper_container_v #people_recognized_list");if(t){let i="";t.html(),e.itemLoading=[],this.formdata.avatar_main_key.forEach((t=>{e.itemLoading.push(!1),i+=`\n          <div class="people_recognized_item">\n            <img src="${t.obey_part_url}" />\n            <div class="add_icon_box">\n              <img class="add_icon_img" src="" style="display: none" />\n              <img class="add_icon" src="/dist/img/face-swap/icon_add_i.svg" />\n              <div class="add_icon_loading" style="display: none"></div>\n              <div class="add_icon_change"></div>\n            </div>\n            <div class="add_icon_close" style="display: none"></div>\n          </div>\n        `})),t.html(i),$("#multiple_Face_swapper_container_v .people_recognized_item").each((function(t){const i=$(this).index(),a=$(this);a.find(".add_icon_box").on("click",(function(){e.multipleIndex=i,gtag("event","up_mulfaceswap_targetvideo"),$("#multiple_Face_swapper_container_v #multi_uploader").click()})),a.find(".add_icon_close").on("click",(function(){a.find(".add_icon").show(),a.find(".add_icon_img").hide(),a.find(".add_icon_close").hide(),e.formdata.avatar_main_key[i]&&(e.formdata.avatar_main_key[i].main_part_key=void 0),e.checkMultiChangeFaceStatus();const t=e.formdata.avatar_main_key.filter((e=>e.main_part_key))?.length;showBtnCreditsMultiVideo(t>0)})),a.on("dragover",(function(e){e.preventDefault(),a.find(".add_icon_loading").attr("style").includes("display: none")&&a.addClass("draggable")})),a.on("dragenter",(function(e){e.preventDefault(),a.find(".add_icon_loading").attr("style").includes("display: none")&&a.addClass("draggable")})),a.on("dragleave",(function(e){e.preventDefault(),a.find(".add_icon_loading").attr("style").includes("display: none")&&a.removeClass("draggable")})),a.on("drop",(function(t){if(t.preventDefault(),a.removeClass("draggable"),a.find(".add_icon_loading").attr("style").includes("display: none")){if(1!==t.originalEvent.dataTransfer.files.length)return e.multimodelV.errorMessage({conText:`<h1>${textContentObj.processImageTitle}</h1>\n              <p>${multitextContentObj.faceSwapPop01.onlyone}</p>`,btnText:multitextContentObj.OK}),void(e.multimodelV.options.visible=!0);gtag("event","up_mulfaceswap_targetvideo"),e.multipleIndex=i,e.itemUploading(t.originalEvent.dataTransfer.files[0])}}))}))}}setCurrentImgLoading(e,t){const i=this.itemLoading;e?(i[t]=!0,$("#multiple_Face_swapper_container_v .people_recognized_item").eq(t).find(".add_icon_loading").show(),$("#multiple_Face_swapper_container_v .people_recognized_item").eq(t).find(".add_icon_close").hide(),$("#multiple_Face_swapper_container_v .people_recognized_item").eq(t).find(".add_icon").hide(),$("#multiple_Face_swapper_container_v .people_recognized_item").eq(t).find(".add_icon_img").hide(),$("#multiple_Face_swapper_container_v .change_multi_face_btn").addClass("disabled"),$("#multiple_Face_swapper_container_v .people_recognized_item").eq(t).find(".add_icon_box").addClass("disabled")):(i[t]=!1,i.some((e=>!0===e))||this.form.firstPicLoading?$("#multiple_Face_swapper_container_v .change_multi_face_btn").addClass("disabled"):$("#multiple_Face_swapper_container_v .change_multi_face_btn").removeClass("disabled"),this.formdata.avatar_main_key[t].main_part_key||$("#multiple_Face_swapper_container_v .people_recognized_item").eq(t).find(".add_icon").show(),$("#multiple_Face_swapper_container_v .people_recognized_item").eq(t).find(".add_icon_loading").hide(),$("#multiple_Face_swapper_container_v .people_recognized_item").eq(t).find(".add_icon_box").removeClass("disabled"))}async itemUploading(e){this.itemLoading;if("string"!=typeof e&&!this.checkFileType(e))return;const t=$("#multiple_Face_swapper_container_v .people_recognized_item .add_icon").eq(this.multipleIndex),i=$("#multiple_Face_swapper_container_v .people_recognized_item .add_icon_img").eq(this.multipleIndex),a=($("#multiple_Face_swapper_container_v .people_recognized_item .add_icon_close").eq(this.multipleIndex),this.multipleIndex);if(console.log(this.multipleIndex),!t)return;this.setCurrentImgLoading(!0,a);await this.checkFacePicMulti(e);let n={};var o,l;try{n=await this.uploadMultiImagePromise(e)}catch(e){let t=multitextContentObj.faceSwapPop01.upload_file_failed;return window.userRuleConfig.credit&&(t=multitextContentObj.faceSwapPop01.upload_file_failed_credits),this.multimodelV.errorMessage({conText:`\n        <h1>${multitextContentObj.faceSwapPop01.processImageTitle}</h1>\n        <p>${t}</p>\n        `,btnText:multitextContentObj.OK}),this.multimodelV.options.visible=!0,this.setCurrentImgLoading(!1,a),void this.checkMultiChangeFaceStatus()}const{blog:s,res:_,imgType:r}=n;o=s,l=URL.createObjectURL(o),t.hide(),i.attr("src",l),i.show(),console.log(_),this.formdata.avatar_main_key[a]={...this.formdata.avatar_main_key[a],main_part_key:_.data.key},$("#multiple_Face_swapper_container_v .change_multi_face_btn").removeClass("disabled"),this.setCurrentImgLoading(!1,a),$("#multiple_Face_swapper_container_v .people_recognized_item").eq(a).find(".add_icon_close").show(),$("#multiple_Face_swapper_container_v #multi_uploader")[0].value="",showBtnCreditsMultiVideo(!0)}eventLoginsuccess(){const e=this;document.querySelector("my-component").addEventListener("loginsuccess",(async function(t){await getCountryConfig();const i=e.formdata.avatar_main_key.filter((e=>e.main_part_key))?.length;console.error(i,e.formdata?.avatar_main_key),e.formdata?.avatar_main_key&&i>0&&showBtnCreditsMultiVideo(!0),multiVcreditSystem.setHighQualityHtml($(".high_quality_append_dom_multiv"),1!==window.userRuleConfig?.is_subscriber,(()=>{gtag("event","alert_faceswap_hd_v"),showHdCredits({clickfn:()=>{gtag("event","click_faceswap_hd_v")},type:"multiv"})}),"multiv"),multicreditSystem.setHighQualityHtml($(".high_quality_append_dom"),1!==window.userRuleConfig?.is_subscriber,(()=>{gtag("event","alert_faceswap_hd_m"),showHdCredits({clickfn:()=>{gtag("event","click_faceswap_hd_m")},type:"multi"})}),"multi"),e.showCreditBannerV(!0)}))}showCreditBannerV(e){this.showCreditBannerBool=e,multiVcreditSystem.showCreditBanner({bool:e}),multicreditSystem.showCreditBanner({bool:e})}}class MutiVideoModel{constructor(){var e=this;this.options=new Proxy({visible:!1,type:"error",downloading:!1,downloadUrl:null,downloadType:0},{set(t,i,a){if(t[i]=a,"visible"===i)e.controlVisible(a);return!0},get:(e,t)=>e[t]})}controlVisible(e){e?$("#multiple_Face_swapper_container_v #multi_change_face_modal").show():$("#multiple_Face_swapper_container_v #multi_change_face_modal").hide()}errorMessage({conText:e,btnText:t,btnClick:i}){$("#multiple_Face_swapper_container_v .change_face_modal_content").html(`\n      <div class="error_con">\n          <div class="error_p">${e}</div>\n          </div>\n      `),$("#multiple_Face_swapper_container_v .change_face_modal_btns").html(`\n      <div class="change_face_modal_btn">${t}</div>\n    `),$("#multiple_Face_swapper_container_v .change_face_modal_btn").on("click",(()=>{i&&i(),$("#multiple_Face_swapper_container_v #multi_change_face_modal").hide()}))}downloadMessage(){$("#multiple_Face_swapper_container_v #multi_change_face_modal").attr("style","width: 550px;height: 125px"),$("#multiple_Face_swapper_container_v .change_face_modal_btns").hide(),$("#multiple_Face_swapper_container_v .close_btn").hide(),$("#multiple_Face_swapper_container_v .change_face_modal_content").html(`\n      <div class="download_multi_con">\n        <p class="loading_download_title">${multitextContentObj.faceSwapPop01.downloading}</p>\n        <div class="loading_prograss">\n          <div class="loading_prograss_con"></div>\n        </div>\n      </div>\n    `);let e=0;var t=setInterval((()=>{if(e+=1,e>=90&&(e=90),!this.options.downloading)return $("#multiple_Face_swapper_container .close_btn").show(),clearInterval(t),void(1===this.options.downloadType?($("#multiple_Face_swapper_container_v .loading_prograss_con").attr("style","width: 100%"),setTimeout((()=>{this.options.visible=!1,this.downloadSuccess(),this.options.visible=!0}),500)):2===this.options.downloadType&&setTimeout((()=>{this.options.visible=!1,this.downloadError(),this.options.visible=!0}),500));$("#multiple_Face_swapper_container_v .loading_prograss_con").attr("style",`width: ${e}%`)}),50)}downloadSuccess(){var e=this;$("#multiple_Face_swapper_container_v .change_face_modal_btns").show(),$("#multiple_Face_swapper_container_v .close_btn").show(),$("#multiple_Face_swapper_container_v #multi_change_face_modal").attr("style","padding: 20px 25px;"),$("#multiple_Face_swapper_container_v .change_face_modal_content").html(`\n      <div class="download_con">\n        <h1>${multitextContentObj.faceSwapPop01.downloadH1}</h1>\n        <p class="download_con_p">${multitextContentObj.faceSwapPop01.downloadTips}</p>\n      </div>\n    `),$("#multiple_Face_swapper_container_v .change_face_modal_btns").html(`\n      <div class="change_face_modal_btn">${multitextContentObj.faceSwapPop01.continue}</div>\n    `),$("#multiple_Face_swapper_container_v .change_face_modal_btn").on("click",(()=>{e.options.visible=!1,$("#multiple_Face_swapper_container_v #multi_change_face_modal").hide()})),$("#multiple_Face_swapper_container_v .click_multi_me").on("click",(async function(){if(!await checkVideoExpired(e.options.downloadUrl))return e.errorMessage({conText:`\n            <h1>${multitextContentObj.faceSwapPop01.processImageTitle}</h1>\n            <p>${multitextContentObj.expired_file}</p>\n          `,btnText:multitextContentObj.OK}),e.options.downloadType=0,e.options.downloading=!1,void(e.options.visible=!0);$(this).attr("href",e.options.downloadUrl),$(this).click()}))}downloadError(){$("#multiple_Face_swapper_container_v #multi_change_face_modal").attr("style",""),$("#multiple_Face_swapper_container_v .change_face_modal_btns").show(),this.errorMessage({conText:`\n        <h1>${multitextContentObj.faceSwapPop01.downloadError}</h1>\n        <p>${multitextContentObj.faceSwapPop01.errorUpload}</p>\n      `,btnText:multitextContentObj.OK})}}function showBtnCreditsMultiVideo(e){const t=multiAiFaceV.formdata.avatar_main_key.filter((e=>e.main_part_key)).length;multiAiFaceV.uploadFacesNumber=t,multiVcreditSystem.showBtnCredits({bool:e,credits:getCreditsFromVideoOrPic(multiAiFaceV,"video"),appendDom:$("#multiple_Face_swapper_container_v .change_multi_face_btn"),type:"video"})}var createMultiDialogV=(e,t)=>{$("#large_multi_face_v_modal .large_multi_img").attr("src",e);document.querySelector(".large_multi_img");$("#large_multi_face_v_modal .multi_img_btns").attr("style","display: flex;"),$("#large_multi_face_v_modal").attr("style","display: flex")};function showNotEnoughCreditsMV(e=1){gtag("event","alert_mulfaceswap_videonocredit"),multiVcreditSystem.showCreditPopup({title:getfsCreditsText("Model_not_credits_title"),content:getfsCreditsText("Model_not_credit_span",{val:e},!0),btn:getfsCreditsText("Model_not_credits_btn"),btnFn:()=>{gtag("event","click_mulfaceswap_videonocredit"),setCookie("st","mulfsvideonocredit")},modalCoins:"notenough"})}function showMaximumMV(){multiVcreditSystem.showCreditPopup({title:textContentObj.exceedTitle,content:getfsCreditsText("Model_Maximum_span",{val:window?.userRuleConfig?.m_times},!0),btn:getfsCreditsText("Model_Unlock_btn"),btnFn:()=>{},modalCoins:"timesmax"})}function showRemoveWatermarkMV(){return new Promise(((e,t)=>{multiVcreditSystem.showCreditPopup({title:getfsCreditsText("Model_Remove_Watermark_title"),content:getfsCreditsText("Model_Remove_Watermark_span"),btn:getfsCreditsText("Model_Remove_Watermark_btn"),btnWater:getfsCreditsText("Model_Remove_Watermark_btn1"),btnWaterFn:()=>{gtag("event","click_faceswap_stock_m"),e(!0)},closeClick:()=>{e(!1)},btnFn:()=>{setCookie("st","removewatermark_m"),gtag("event","click_faceswap_no_m"),e(!1)},modalCoins:"watermarker"})}))}var muticreditsPhotoModelV=null;let btnLoading2=!1;var multimodelV=new MutiVideoModel,multiAiFaceV=new MultiVideoAiFace({multimodelV:multimodelV}),muticreditsPhotoModelVModel=new MutiCreditPhotoModel($("#multiple_Face_swapper_container_v .multi_credits_messageModel"),multiAiFaceV,2);function checkVideoExpired(e){return new Promise(((t,i)=>{const a=$("#multi_video_dom");a.attr("src",e),a.off("loadedmetadata").on("loadedmetadata",(function(){t(!0)})),a.off("error").on("error",(function(){t(!1)}))}))}function photo_isSameDay(){let e=Date.now(),t=getCookie("faceSwapTime_swap");if(!t)return!1;const i=new Date(e),a=new Date(Number(t)),n=i.getFullYear(),o=i.getMonth(),l=i.getDate(),s=a.getFullYear(),_=a.getMonth(),r=a.getDate();return n===s&&o===_&&l===r}window.muticreditsPhotoModelV=multiAiFaceV,$(document).ready((function(){gtag("event","show_miofs_multiphoto"),multiAiFaceV.eventLoginsuccess(),multiAiFaceV.getImgList();const e=$("#multiple_Face_swapper_container_v .appsigninbtn"),t=($("#multiple_Face_swapper_container_v .signupfootbtn"),$("#multiple_Face_swapper_container_v .signupnavbtn")),i=$("#multiple_Face_swapper_container_v .appsignupbtn");function a(e){e?($("#multiple_Face_swapper_container_v .multi_Input").addClass("draggable"),$("#multiple_Face_swapper_container_v .multi_Input").find("svg").hide(),$("#multiple_Face_swapper_container_v .multi_Input").find(".change_image_text").text(getMultiText("drag_btn"))):($("#multiple_Face_swapper_container_v .multi_Input").removeClass("draggable"),$("#multiple_Face_swapper_container_v .multi_Input").find("svg").show(),$("#multiple_Face_swapper_container_v .multi_Input").find(".change_image_text").text(getMultiText("change_btn")))}e.attr("product-position","isTool-no-reloading"),t.attr("product-position","isTool-no-reloading"),i.attr("product-position","isTool-no-reloading"),$("#multiple_Face_swapper_container_v .multi_uploader_btn").on("click",(function(e){e.stopPropagation(),$("#multiple_Face_swapper_container_v .multi_uploader_multi").click()})),$("#multiple_Face_swapper_container_v .upload_step").on("dragover",(function(e){e.preventDefault()})),$("#multiple_Face_swapper_container_v .can_drag_box").on("dragenter",(function(e){e.preventDefault(),multiAiFaceV.form.firstPicLoading||(multiAiFaceV.setDragLoading("multi_upload",!0),multiAiFaceV.setDragLoading("change_upload",!1))})),$("#multiple_Face_swapper_container_v .multi_upload .uploader_loading_mask").on("dragleave",(function(e){multiAiFaceV.setDragLoading("multi_upload",!1)})),$("#multiple_Face_swapper_container_v .multi_upload .uploader_loading_mask").on("dragenter",(function(e){e.preventDefault(),multiAiFaceV.form.firstPicLoading||multiAiFaceV.setDragLoading("multi_upload",!0)})),$("#multiple_Face_swapper_container_v .multi_upload .uploader_loading_mask").on("dragover",(function(e){e.preventDefault(),multiAiFaceV.form.firstPicLoading||multiAiFaceV.setDragLoading("multi_upload",!0)})),$("#large_multi_face_v_modal").on("wheel",(function(e){e.preventDefault()})),$("#multiple_Face_swapper_container_v .multi_uploader_multi").on("change",(function(e){gtag("event","up_mulfaceswap_video");let t=e.target.files,i=t[0];if(t&&i){if(1!==t.length)return multiAiFaceV.multimodelV.errorMessage({conText:`<h1>${textContentObj.processImageTitle}</h1>\n          <p>${multitextContentObj.faceSwapPop01.onlyone}</p>`,btnText:multitextContentObj.OK}),void(multiAiFaceV.multimodelV.options.visible=!0);e.target.value=null,multiAiFaceV.addMultiVideo({file:i})}})),$("#multiple_Face_swapper_container_v .multi_upload .uploader_loading_mask, .multi_uploader_btn_con_mask").on("drop",(function(e){if(e.preventDefault(),a(!1),multiAiFaceV.setDragLoading("multi_upload",!1),!multiAiFaceV.form.firstPicLoading){if(1!==e.originalEvent.dataTransfer.files.length)return multiAiFaceV.multimodelV.errorMessage({conText:`<h1>${textContentObj.processImageTitle}</h1>\n            <p>${multitextContentObj.faceSwapPop01.onlyone}</p>`,btnText:multitextContentObj.OK}),void(multiAiFaceV.multimodelV.options.visible=!0);gtag("event","up_mulfaceswap_video");var t=e.originalEvent.dataTransfer.files[0];$("#multiple_Face_swapper_container_v .multi_upload").addClass("loading_mask"),multiAiFaceV.addMultiVideo({file:t})}})),$("#multiple_Face_swapper_container_v .multi_Input").on("click",(function(e){e.stopPropagation(),btnLoading2||(btnLoading2=!0,setTimeout((()=>{btnLoading2=!1}),2e3),$("#multiple_Face_swapper_container_v .multi_uploader_multi").click())})),$("#multiple_Face_swapper_container_v .multi_Input .multi_uploader_btn_con_mask").on("dragover",(function(e){e.preventDefault(),a(!0)})).on("dragenter",(function(e){e.preventDefault(),a(!0)})).on("dragleave",(function(e){e.preventDefault(),a(!1)})),$("#multiple_Face_swapper_container_v .multi_Input").on("dragover",(function(e){e.preventDefault(),a(!0)})).on("dragenter",(function(e){e.preventDefault(),a(!0)})),$("#multiple_Face_swapper_container_v #multiple_Face_swapper_container .removeWatemark_btn").on("click",(function(e){})),$("#large_multi_face_v_modal .removeWatemark_btn").on("click",(function(e){})),$("#multiple_Face_swapper_container_v .compare_multi_btn").on("pointerdown",(function(e){e.preventDefault(),gtag("event","contrast_miofs_res_m"),multimodelV.options.downloading||multiAiFaceV.changeFaceLoading||2!==e.button&&(multiAiFaceV.form?.originImage?.showUrl&&($("#multiple_Face_swapper_container_v #mult_main_face_change_img").attr("src",multiAiFaceV.form?.originImage.showUrl),$("#large_multi_face_v_modal .large_multi_img").attr("src",multiAiFaceV.form?.originImage.showUrl)),document.addEventListener("pointerup",(function(e){$("#multiple_Face_swapper_container_v #mult_main_face_change_img").attr("data-key")||n(e)})))})),$("#multiple_Face_swapper_container_v .share_multi_btn").on("click",(e=>{gtag("event","share_miofs_res_m");let t=document.querySelector("#shareDialogEl");t.changeTips({title:multitextContentObj.faceSwapPop01.share__Tile,content:getMultiText("share__box__text")}),t.showShare({url:multiAiFaceV.mergeImgUrl,action:"multiplefaceswapmioshare",imageKey:multiAiFaceV.mergeKey,text:getMultiText("share__text"),title:multitextContentObj.faceSwapPop01.share__Tile,id:multiAiFaceV.taskid,task_id:multiAiFaceV.taskid,btoaUrl:btoa(multiAiFaceV.mergeKey+","+multiAiFaceV.taskid),backParams:function(e){return{id:multiAiFaceV.taskid,key:e?.merge_key}}})})),$("#multiple_Face_swapper_container_v .compare_multi_btn").on("pointerleave",(e=>{n(e)}));const n=function(e){e.preventDefault(),multimodelV.options.downloading||multiAiFaceV.changeFaceLoading||2!==e.button&&($("#multiple_Face_swapper_container_v #mult_main_face_change_img").attr("src",multiAiFaceV.mergeImgUrl),$("#large_multi_face_v_modal .large_multi_img").attr("src",multiAiFaceV.mergeImgUrl),document.removeEventListener("pointerup",(function(e){n(e)})))};$("#multiple_Face_swapper_container_v #mult_main_face_change_img").on("contextmenu",(e=>{e.originalEvent.preventDefault()})),$("#large_multi_face_v_modal .large_multi_img width").on("contextmenu",(e=>{e.originalEvent.preventDefault()})),$("#multiple_Face_swapper_container_v .large_multi_image").on("click",(function(e){e.preventDefault(),gtag("event","zoomin_mulfaceswap_videores"),multimodelV.options.downloading||multiAiFaceV.changeFaceLoading||2!==e.button&&createMultiDialogV(multiAiFaceV.mergeImgUrl,multiAiFaceV)})),$(".download_multi_btn_v").on("click",(async e=>{e.preventDefault(),gtag("event","download_mulfaceswap_videores"),multimodelV.options.downloading||multiAiFaceV.changeFaceLoading||2!==e.button&&(getCookie("access_token")?(multimodelV.options.downloading=!0,multimodelV.downloadMessage(),multimodelV.options.visible=!0,fetchPost("ai/source/get-access-url",{key:multiAiFaceV.mergeKey,action:"download",file_name:"Vidqu_faceswap"+multiAiFaceV.mergeKey.substring(multiAiFaceV.mergeKey.lastIndexOf("."))},TOOL_API).then((async e=>{if(401===e.code)return multimodelV.errorMessage({conText:multitextContentObj.loginFirst,btnText:multitextContentObj.OK}),multimodelV.options.visible=!0,multimodelV.options.downloadType=2,void(multimodelV.options.downloading=!1);if(!await checkVideoExpired(e.data.url))return $("#multiple_Face_swapper_container_v #multi_change_face_modal").attr("style",""),$("#multiple_Face_swapper_container_v .change_face_modal_btns").show(),multimodelV.errorMessage({conText:`\n                <h1>${multitextContentObj.faceSwapPop01.processImageTitle}</h1>\n                <p>${multitextContentObj.expired_file}</p>\n              `,btnText:multitextContentObj.OK}),multimodelV.options.downloadType=0,multimodelV.options.downloading=!1,void(multimodelV.options.visible=!0);{multimodelV.options.downloadType=1,multimodelV.options.downloading=!1;let t=document.createElement("a");multimodelV.options.downloadUrl=e.data.url,t.href=e.data.url,t.download="Vidqu_faceswap.png",document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(t.href),gtag("event","dwsucc_miofs_res_mv")}})).catch((e=>{multimodelV.options.downloadType=2,multimodelV.options.downloading=!1,console.error("fail",e)}))):showLoginWindow({isReloading:!1}))})),$("#multiple_Face_swapper_container_v #change_face_login").on("click",(function(){window.location.href=thGotoApplibraryUrl+"signup?page_name=face-swap&name=ai"})),$("#multiple_Face_swapper_container_v .modal__main_close").on("click",(function(){$("#multiple_Face_swapper_container_v .vocalRemover__modal").hide()})),$("#multiple_Face_swapper_container_v .close_btn").on("click",(function(){multimodelV.options.visible=!1,$("#multiple_Face_swapper_container_v #multi_change_face_modal").hide(),$("#multiple_Face_swapper_container_v #multi_change_face_modal").hide()})),$("#large_multi_face_v_modal .multi_close_btn").on("click",(function(){$("#large_multi_face_v_modal").hide(),$("#large_multi_face_v_modal #large_multi_video")[0].pause()})),$("#multiple_Face_swapper_container_v .change_multi_face_btn").on("click",(function(e){gtag("event","click_mulfaceswap_videoswapbtn"),multiAiFaceV.uploadFacesNumber>3?gtag("event","succ_mulfaceswap_video10"):gtag("event","succ_mulfaceswap_video3"),multiAiFaceV.changeMultiFace($(this))})),$("#multiple_Face_swapper_container_v .face_swap_now").on("click",(function(){scrollToPositions(".ai-change-face")})),$("#multiple_Face_swapper_container_v .see_more_multi").on("click",(function(){$("#multiple_Face_swapper_container_v .multi_pics").removeClass("hide_other_pics"),$("#multiple_Face_swapper_container_v .see_more_multi").hide(),$("#multiple_Face_swapper_container_v .fold_multi").show()})),$("#multiple_Face_swapper_container_v .fold_multi").on("click",(function(){$("#multiple_Face_swapper_container_v .multi_pics").addClass("hide_other_pics"),$("#multiple_Face_swapper_container_v .see_more_multi").show(),$("#multiple_Face_swapper_container_v .fold_multi").hide()})),$("#multiple_Face_swapper_container_v #multi_uploader").on("change",(async function(e){e.target.files&&e.target.files[0]&&multiAiFaceV.itemUploading(e.target.files[0])})),$("#multiple_face_swapper_try .video-content-box .content-box").on("click",(function(e){let t=e.target;if("img"!==t.tagName.toLowerCase())return!1;gtag("event","click_mulfaceswap_vidtpl");const i=e=>multiAiFaceV.domain+e;if(0===multiAiFaceV.imgList?.length)return;if(multiAiFaceV.form.firstPicLoading||multiAiFaceV.changeFaceLoading)return;const a=multiAiFaceV.imgList[t.getAttribute("data-index")-1];multiAiFaceV.showToolBtn(!1),multiAiFaceV.addMultiVideo({addData:{demoKey:a.video_key,demoSrc:i(a.video_key),demoDuration:a.duration,demoImgSrc:i(a.cover_key)},file:i(a.video_key),ourPicsIndex:$(this).index()+1})})),isMacorIos()&&($("#multiple_Face_swapper_container_v .multi_upload_before h2")[0].innerText=multitextContentObj.video_tip_ios)})),$((function(){$("#multiple_Face_swapper_container_v .head-portrait .appsigninbtn").click((function(e){e.stopPropagation(),e.preventDefault()})),$("#multiple_Face_swapper_container_v .swap_credit_btn_multiphoto").on("click",(function(){getCookie("access_token")?setSessionCookie("st","mulloggedcreditbanner"):setSessionCookie("st","mulnotcreditbanner")})),$("#multiple_Face_swapper_container_v .my_files_tips .myfiles_check_Now_btn").on("click",(()=>{gtag("event","click_vidqmyfiles_videotipsfile_mv"),getCookie("access_token")?window.open("/my-files.html"):showLoginWindow({isReloading:!1,fn:(e=null)=>{window.open("/my-files.html")}})}))}));