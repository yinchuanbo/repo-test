"use strict";function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _regeneratorRuntime(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */_regeneratorRuntime=function(){return t};var e,t={},n=Object.prototype,o=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",c=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function p(e,t,n,o){var r=t&&t.prototype instanceof m?t:m,i=Object.create(r.prototype),c=new L(o||[]);return a(i,"_invoke",{value:T(e,n,c)}),i}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=p;var g="suspendedStart",d="suspendedYield",_="executing",f="completed",h={};function m(){}function v(){}function w(){}var b={};l(b,i,(function(){return this}));var y=Object.getPrototypeOf,x=y&&y(y(P([])));x&&x!==n&&o.call(x,i)&&(b=x);var C=w.prototype=m.prototype=Object.create(b);function k(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function F(e,t){function n(a,r,i,c){var s=u(e[a],e,r);if("throw"!==s.type){var l=s.arg,p=l.value;return p&&"object"==_typeof(p)&&o.call(p,"__await")?t.resolve(p.__await).then((function(e){n("next",e,i,c)}),(function(e){n("throw",e,i,c)})):t.resolve(p).then((function(e){l.value=e,i(l)}),(function(e){return n("throw",e,i,c)}))}c(s.arg)}var r;a(this,"_invoke",{value:function(e,o){function a(){return new t((function(t,a){n(e,o,t,a)}))}return r=r?r.then(a,a):a()}})}function T(t,n,o){var a=g;return function(r,i){if(a===_)throw Error("Generator is already running");if(a===f){if("throw"===r)throw i;return{value:e,done:!0}}for(o.method=r,o.arg=i;;){var c=o.delegate;if(c){var s=O(c,o);if(s){if(s===h)continue;return s}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(a===g)throw a=f,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a=_;var l=u(t,n,o);if("normal"===l.type){if(a=o.done?f:d,l.arg===h)continue;return{value:l.arg,done:o.done}}"throw"===l.type&&(a=f,o.method="throw",o.arg=l.arg)}}}function O(t,n){var o=n.method,a=t.iterator[o];if(a===e)return n.delegate=null,"throw"===o&&t.iterator.return&&(n.method="return",n.arg=e,O(t,n),"throw"===n.method)||"return"!==o&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+o+"' method")),h;var r=u(a,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,h;var i=r.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,h):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,h)}function j(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function $(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(j,this),this.reset(!0)}function P(t){if(t||""===t){var n=t[i];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,r=function n(){for(;++a<t.length;)if(o.call(t,a))return n.value=t[a],n.done=!1,n;return n.value=e,n.done=!0,n};return r.next=r}}throw new TypeError(_typeof(t)+" is not iterable")}return v.prototype=w,a(C,"constructor",{value:w,configurable:!0}),a(w,"constructor",{value:v,configurable:!0}),v.displayName=l(w,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,l(e,s,"GeneratorFunction")),e.prototype=Object.create(C),e},t.awrap=function(e){return{__await:e}},k(F.prototype),l(F.prototype,c,(function(){return this})),t.AsyncIterator=F,t.async=function(e,n,o,a,r){void 0===r&&(r=Promise);var i=new F(p(e,n,o,a),r);return t.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},k(C),l(C,s,"Generator"),l(C,i,(function(){return this})),l(C,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var o in t)n.push(o);return n.reverse(),function e(){for(;n.length;){var o=n.pop();if(o in t)return e.value=o,e.done=!1,e}return e.done=!0,e}},t.values=P,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach($),!t)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function a(o,a){return c.type="throw",c.arg=t,n.next=o,a&&(n.method="next",n.arg=e),!!a}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],c=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var s=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(s&&l){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&o.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var r=a;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var i=r?r.completion:{};return i.type=e,i.arg=t,r?(this.method="next",this.next=r.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),$(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var o=n.completion;if("throw"===o.type){var a=o.arg;$(n)}return a}}throw Error("illegal catch attempt")},delegateYield:function(t,n,o){return this.delegate={iterator:P(t),resultName:n,nextLoc:o},"next"===this.method&&(this.arg=e),h}},t}function asyncGeneratorStep(e,t,n,o,a,r,i){try{var c=e[r](i),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(o,a)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise((function(o,a){var r=e.apply(t,n);function i(e){asyncGeneratorStep(r,o,a,i,c,"next",e)}function c(e){asyncGeneratorStep(r,o,a,i,c,"throw",e)}i(void 0)}))}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var controllers=[];function getfsCreditsText(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&t.val>1&&(e+="_p");var n=lan.faceSwapPop[e];for(var o in t){var a=new RegExp("{{".concat(o,"}}"),"g");n=n.replace(a,t[o])}return n}var facecheckphotoBool=!1,textContentObj=lan.faceSwapPop,show_ppriority_img=0,AiFace=function(){return _createClass((function e(t){var n=this;_classCallCheck(this,e),_defineProperty(this,"initFace",_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="/dist/js/weights",e.next=3,faceapi.loadTinyFaceDetectorModel(t);case 3:return n=e.sent,e.next=6,faceapi.loadSsdMobilenetv1Model(t);case 6:console.log(n),facecheckphotoBool=!0;case 8:case"end":return e.stop()}}),e)})))),_defineProperty(this,"getUploadFileUrl",(function(e,t){var n=e;try{n=e.split("/")[1]}catch(e){n="png"}return new Promise(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(o,a){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!t){e.next=5;break}o({code:200}),e.next=9;break;case 5:return e.next=7,fetchPost("ai/source/temp-upload-url",{file_name:"vidqu_faceswap."+n},TOOL_API);case 7:r=e.sent,o(r);case 9:e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),console.error(e.t0.message),a(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n){return e.apply(this,arguments)}}())})),_defineProperty(this,"uploadFile",(function(e,t){return new Promise(function(){var n=_asyncToGenerator(_regeneratorRuntime().mark((function n(o,a){var r;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,console.log("isRun",t),!t){n.next=6;break}o(200),n.next=10;break;case 6:return n.next=8,fetchPut(e.upload_url,e.file,"");case 8:r=n.sent,o(r);case 10:n.next=16;break;case 12:n.prev=12,n.t0=n.catch(0),console.error(n.t0.message),a(n.t0);case 16:case"end":return n.stop()}}),n,null,[[0,12]])})));return function(e,t){return n.apply(this,arguments)}}())})),_defineProperty(this,"addImage",function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,o,a,r){var i,c,s,l,p,u,g,d,_,f,h,m,v,w,b,y,x=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=function(){1===a?($(".origin_uploader")[0].value="",i.form.firstPicLoading=!1):($(".change_uploader")[0].value="",i.form.secondPicLoading=!1);var e=$("#photo_Face_swapper_container .spread_image").attr("data-key");(i.mergeKey||"origin_img"!==e)&&$("#photo_Face_swapper_container .spread_box_controls").css("visibility","visible")},i=n,console.log("addImage",a,o),n.setLiLoading(!0),"string"==typeof o||n.checkFileType(o,a)){e.next=7;break}return n.setLiLoading(!1),e.abrupt("return");case 7:if(1===a&&(n.form.firstPicLoading=!0),2===a&&(n.form.secondPicLoading=!0),!("string"!=typeof o&&n.checkFileType(o,a)||"string"==typeof o)){e.next=64;break}if(e.prev=10,"string"==typeof o){e.next=24;break}return e.next=14,aiFaceChanging.initFace();case 14:return e.next=16,n.resizeImageByFile(o).then(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.blog,t.imgType,console.log("then"),e.next=4,n.faceCheck({blobUrl:URL.createObjectURL(o)});case 4:s=e.sent;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch(_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("catch"),e.next=3,n.faceCheck({blobUrl:URL.createObjectURL(o)});case 3:s=e.sent;case 4:case"end":return e.stop()}}),e)}))));case 16:if(!(s>1)){e.next=20;break}return ToolTip({type:"error",title:textContentObj.Failed,content:textContentObj.manyFace,btn:textContentObj.ok}),c(),e.abrupt("return");case 20:if(!(s<=0)){e.next=24;break}return ToolTip({type:"error",title:textContentObj.Failed,content:textContentObj.NoFace,btn:textContentObj.ok}),c(),e.abrupt("return");case 24:return e.next=26,n.getCanSwapFaceData();case 26:if(g=o.type,"string"!=typeof o){e.next=41;break}return e.next=30,n.urlToFile(o);case 30:return d=e.sent,e.next=33,n.resizeImageByUrl(URL.createObjectURL(d));case 33:_=e.sent,f=_.blog,h=_.imgType,l=f,u=h,p=URL.createObjectURL(d),e.next=49;break;case 41:return e.next=43,n.resizeImageByFile(o);case 43:m=e.sent,f=m.blog,h=m.imgType,l=f,u=h,p=URL.createObjectURL(l);case 49:for(v={file:l,showUrl:p,suffix:g},1===a?(n.form.originImage=v,console.log(n.form.originImage,"data"),$("#photo_Face_swapper_container .spread_image").attr({src:v.showUrl}),n.form.firstPicLoading=!1):(n.form.changeImage=v,n.form.secondPicLoading=!1),n.setLiLoading(!1),n.lastType=a,1==a||(n.photoFirstRandom=!1),2==a||(n.photoSecondRandom=!1),w=x.length,b=new Array(w>4?w-4:0),y=4;y<w;y++)b[y-4]=x[y];r&&r(v,u,b),e.next=64;break;case 59:e.prev=59,e.t0=e.catch(10),console.error(e.t0),ToolTip({type:"error",title:textContentObj.Failed,content:textContentObj.file_not_exist,btn:textContentObj.ok}),c();case 64:case"end":return e.stop()}}),e,null,[[10,59]])})));return function(t,n,o,a){return e.apply(this,arguments)}}()),_defineProperty(this,"setLiLoading",(function(e){e?$(".our_pics li[data-type='photo']").css({filter:"brightness(0.5)","pointer-events":"none"}):$(".our_pics li[data-type='photo']").css({filter:"none","pointer-events":"auto"})})),_defineProperty(this,"setBigImageStart",(function(e){var t=0;e?(1===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)?$("#photo_Face_swapper_container .loading_box p .faceSwapProgress").text(textContentObj.Preparing_step):(n.timerLoading&&(window.clearInterval(n.timerLoading),n.timerLoading=null),n.timerLoading=setInterval((function(){t<98&&(t++,$("#photo_Face_swapper_container .loading_box p .faceSwapProgress").text(t+"% "+textContentObj.Swapping_setp))}),100)),$(".high_quality_append_dom_photo").css("pointer-events","none")):($(".high_quality_append_dom_photo").css("pointer-events","auto"),window.clearInterval(n.timerLoading),n.timerLoading=null)})),_defineProperty(this,"transtoBlob",(function(e){var t=e.b64data,n=e.contentType,o=void 0===n?"image/png":n;o=o||"";for(var a=1024,r=atob(t.split(",")[1]),i=r.length,c=Math.ceil(i/a),s=new Array(c),l=0;l<c;++l){for(var p=l*a,u=Math.min(p+a,i),g=new Array(u-p),d=p,_=0;d<u;++_,++d)g[_]=r[d].charCodeAt(0);s[l]=new Uint8Array(g)}return new Blob(s,{type:o})})),_defineProperty(this,"changeFace",_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,o,a,r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n,e.next=3,n.getCanSwapFaceBool();case 3:if(e.sent){e.next=6;break}return n.form.isSubmit=!1,e.abrupt("return");case 6:return e.prev=6,e.next=9,n.uploadImagePromise();case 9:if(!e.sent.some((function(e){return 200!==e}))){e.next=12;break}return e.abrupt("return",!1);case 12:e.next=19;break;case 14:return e.prev=14,e.t0=e.catch(6),ToolTip({type:"error",title:textContentObj.Failed,content:textContentObj.errorUploadText1,btn:textContentObj.ok}),n.form.isSubmit=!1,e.abrupt("return",!1);case 19:n.setBigImageStart(!0,2),fetchPost("ai/tool/face-changing",{avatar_obey_key:null===(t=n.form.originImage)||void 0===t?void 0:t.key,avatar_main_key:null===(o=n.form.changeImage)||void 0===o?void 0:o.key,watertype:5,is_hd:null===(a=photocreditSystem)||void 0===a?void 0:a.is_hd},TOOL_API,{"X-TASK-VERSION":"2.0.0"}).then(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(200!==t.code){e.next=6;break}showBtnCreditsImage(!0),1===t.data.is_wateremark?showRemoveWatemark_btn(!0):showRemoveWatemark_btn(!1),n.getFinalImg(t.data.task_id),e.next=23;break;case 6:if(401!==t.code){e.next=12;break}console.log("log error"),ToolTip({type:"error",title:textContentObj.errorNetworkTitle,content:textContentObj.errorNetwork,btn:textContentObj.ok}),n.form.isSubmit=!1,e.next=23;break;case 12:if(3001!==t.code){e.next=21;break}return e.next=15,r.getCountryConfig();case 15:e.sent,showMaximum(),n.form.isSubmit=!1,showBtnCreditsImage(!0),e.next=23;break;case 21:ToolTip({type:"error",title:textContentObj.errorNetworkTitle,content:textContentObj.errorNetwork,btn:textContentObj.ok}),n.form.isSubmit=!1;case 23:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){ToolTip({type:"error",title:textContentObj.errorNetworkTitle,content:textContentObj.errorNetwork,btn:textContentObj.ok}),n.form.isSubmit=!1}));case 21:case"end":return e.stop()}}),e,null,[[6,14]])})))),_defineProperty(this,"checkFileType",(function(e,t){var o=e.type,a=e.name.split("."),r=a[a.length-1].toLowerCase();return!(!["image/jpeg","image/png","image/webp","application/octet-stream"].includes(o)||!["jpeg","png","webp","jpg"].includes(r))||(ToolTip({type:"error",title:textContentObj.Failed,content:textContentObj.limit,btn:textContentObj.ok}),1===t&&(n.form.firstPicLoading=!1),2===t&&(n.form.secondPicLoading=!1),!1)})),_defineProperty(this,"getFinalImg",(function(e){n.taskid=e;var t=n;fetchPost("ai/tool/get-task",{id:e},TOOL_API).then((function(o){var a;if(1===(null===(a=o.data.wait)||void 0===a?void 0:a.show_wait)){0==show_ppriority_img&&(show_ppriority_img++,gtag("event","show_faceswap_imgpriority"));var r=o.data.wait,i=r.num,c=r.second;t.setLoadingMaskTip(!0,{show_wait:1,num:i,second:c})}if(o.message.includes("nsfw")){var s,l=textContentObj.pornographyMsg;return null!==(s=t.canFaceSwap.data)&&void 0!==s&&s.credit&&(l=textContentObj.Credits_failed_nsfw),ToolTip({type:"error",title:textContentObj.Failed,content:l,btn:textContentObj.ok}),n.form.isSubmit=!1,void n.setLoadingMaskTip(!1)}if(200!==o.code){if(o.message.includes("faces=0")||o.message.includes("no face")){var p,u=textContentObj.No_face;null!==(p=t.canFaceSwap.data)&&void 0!==p&&p.credit&&(u=textContentObj.Credits_failed_no_face),ToolTip({type:"error",title:textContentObj.Failed,content:u,btn:textContentObj.ok})}else if(o.message.includes("celebrity")){var g,d=textContentObj.celebrity;null!==(g=t.canFaceSwap.data)&&void 0!==g&&g.credit&&(d=textContentObj.Credits_failed_celebrity),ToolTip({type:"error",title:textContentObj.Failed,content:d,btn:textContentObj.ok})}else if(o.message.includes("faces=")){var _,f=textContentObj.Mutiple_face;null!==(_=t.canFaceSwap.data)&&void 0!==_&&_.credit&&(f=textContentObj.Credits_failed_multi_face),ToolTip({type:"error",title:textContentObj.Failed,content:f,btn:textContentObj.ok})}else{var h,m=textContentObj.processImage;null!==(h=t.canFaceSwap.data)&&void 0!==h&&h.credit&&(m=textContentObj.Credits_failed),ToolTip({type:"error",title:textContentObj.Failed,content:m,btn:textContentObj.ok})}console.log(o,"error task"),n.form.isSubmit=!1,n.setLoadingMaskTip(!1)}else{var v,w;if(n.tryCount=0,0===o.data.status)gtag("event","succ_faceswap_imgswapbtn"),show_ppriority_img=0,setCookie("faceSwapTime_swap",Date.now(),2),n.mergeImgUrl=null===(v=o.data.additional_data)||void 0===v?void 0:v.merge_url,n.mergeKey=null===(w=o.data.additional_data)||void 0===w?void 0:w.merge_key,userRuleConfig.credit=o.data.credit,changeHeaderCredit(userRuleConfig.credit),$("#photo_Face_swapper_container .spread_image").attr("data-key",""),$("#photo_Face_swapper_container .spread_image").attr("src",n.mergeImgUrl),$(".larger_img").attr("src",n.mergeImgUrl),localStorage.setItem("faceswap_taskid",e),localStorage.setItem("originImage",JSON.stringify(n.form.originImage)),localStorage.setItem("changeImage",JSON.stringify(n.form.changeImage)),showCreditBannerP(!0),setTimeout((function(){n.form.isSubmit=!1,n.setLoadingMaskTip(!1)}),1e3);else setTimeout((function(){n.getFinalImg(e)}),2e3)}})).catch((function(t){n.tryCount>=3?(ToolTip({type:"error",title:textContentObj.Failed,content:textContentObj.processImage,btn:textContentObj.ok}),n.form.isSubmit=!1,n.setLoadingMaskTip(!1)):(console.log("retrying"),setTimeout((function(){n.getFinalImg(e),n.tryCount++}),5e3))}))})),_defineProperty(this,"faceCheck",function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.blobUrl,o=void 0===n?"":n,e.abrupt("return",new Promise((function(e,t){var n=new Image;n.src=o,n.onload=_asyncToGenerator(_regeneratorRuntime().mark((function o(){var a,r;return _regeneratorRuntime().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,faceapi.detectAllFaces(n,new faceapi.SsdMobilenetv1Options);case 3:if(!(a=o.sent).length){o.next=8;break}e(a.length),o.next=12;break;case 8:return o.next=10,faceapi.detectAllFaces(n,new faceapi.TinyFaceDetectorOptions({inputSize:416}));case 10:r=o.sent,e(r.length);case 12:o.next=18;break;case 14:o.prev=14,o.t0=o.catch(0),console.log(o.t0),t(o.t0);case 18:case"end":return o.stop()}}),o,null,[[0,14]])}))),n.onerror=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(n){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log(n),t(n);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),_defineProperty(this,"checkFacePic",(function(e,t){return new Promise(function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function t(o,a){var r,i,c;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=e,"string"!=typeof e&&(r=URL.createObjectURL(e)),t.next=5,n.faceCheck({blobUrl:r});case 5:1===(i=t.sent)?o(!0):($(".origin_uploader")[0].value="",$(".change_uploader")[0].value="",c=textContentObj.NoFace,i>=2&&(c=textContentObj.manyFace),ToolTip({type:"error",title:textContentObj.Failed,content:c,btn:textContentObj.ok}),o(!1)),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),a(t.t0);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})));return function(e,n){return t.apply(this,arguments)}}())}));var o=this;this.imgObjs={firstPicLoading:!1,secondPicLoading:!1,originImage:{},changeImage:{},isSubmit:!1},this.mergeImg={width:0,height:0},this.tryCount=0,this.countryConfig={},this.delay=2e3,this.lastCall=0,this.taskid=null,this.imgList=[],this.isShowTool=!1,this.mergeImgUrl=null,this.mergeKey=null,this.lastType=2,this.canFaceSwap={},this.timerLoading=null,this.photoFirstRandom=!1,this.photoSecondRandom=!1,this.loadingImage="/dist/img/face-swap/btn_loading.png",showBtnCreditsImage(!1),this.form=new Proxy(o.imgObjs,{set:function(e,t,n){function a(){checkNullObj(e.originImage)||checkNullObj(e.changeImage)||(showBtnCreditsImage(!0),$("#photo_Face_swapper_container .change_face_btn").removeClass("disabled"),e.isSubmit?($("#photo_Face_swapper_container .change_face_btn").addClass("submit"),$("#photo_Face_swapper_container .change_face_btn .submit_text").text(textContentObj.Swapping_setp)):($("#photo_Face_swapper_container .change_face_btn").removeClass("submit"),$("#photo_Face_swapper_container .change_face_btn .submit_text").text(textContentObj.step3_btn)))}(e[t]=n,"firstPicLoading"===t&&(n?($("#photo_Face_swapper_container .faceSwapProgress").text(textContentObj.Loading),$("#photo_Face_swapper_container .change_face_btn").addClass("disabled"),$("#photo_Face_swapper_container .spread_box_controls").css("visibility","hidden"),$("#photo_Face_swapper_container .stepA .stepBox").addClass("loading"),$("#photo_Face_swapper_container .stepA .step_loadingBox").css("display","flex"),$("#photo_Face_swapper_container .spread_box_container").addClass("uploading"),o.setLiLoading(!0)):($("#photo_Face_swapper_container .stepA .stepBox").removeClass("loading"),$("#photo_Face_swapper_container .stepA .step_loadingBox").hide(),$("#photo_Face_swapper_container .spread_box_container").removeClass("uploading"),o.setLiLoading(!1),a())),"secondPicLoading"===t&&(n?($("#photo_Face_swapper_container .change_face_btn").addClass("disabled"),$("#photo_Face_swapper_container .stepB .stepBox").addClass("loading"),$("#photo_Face_swapper_container .stepB .step_loadingBox").css("display","flex"),o.setLiLoading(!0)):($("#photo_Face_swapper_container .stepB .stepBox").removeClass("loading"),$("#photo_Face_swapper_container .stepB .step_loadingBox").hide(),o.setLiLoading(!1),a())),"isSubmit"===t)&&(n?($("#photo_Face_swapper_container .stepA .stepBox").addClass("loading"),$("#photo_Face_swapper_container .stepA .step_loadingBox").css("display","flex"),$("#photo_Face_swapper_container .stepB .stepBox").addClass("loading"),$("#photo_Face_swapper_container .stepB .step_loadingBox").css("display","flex"),$("#photo_Face_swapper_container .spread_box_controls").css("visibility","hidden"),$("#photo_Face_swapper_container .spread_box_container").addClass("loading"),o.setBigImageStart(!0,1),o.setLiLoading(!0),a()):($("#photo_Face_swapper_container .spread_box_container").removeClass("loading"),$("#photo_Face_swapper_container .stepA .stepBox").removeClass("loading"),$("#photo_Face_swapper_container .stepA .step_loadingBox").hide(),$("#photo_Face_swapper_container .stepB .stepBox").removeClass("loading"),$("#photo_Face_swapper_container .stepB .step_loadingBox").hide(),o.setBigImageStart(!1),o.setLiLoading(!1),a(),"origin_img"!==$("#photo_Face_swapper_container .spread_image").attr("data-key")&&$("#photo_Face_swapper_container .spread_box_controls").css("visibility","visible")));return!0},get:function(e,t){return e[t]}})}),[{key:"resizeImageByFile",value:function(e){console.log("resizeImageByFile");var t=this;return new Promise((function(n,o){var a=new FileReader;a.onloadend=function(){var e=new Image;e.onload=function(){var o=document.createElement("canvas"),a=o.getContext("2d"),r=Math.max(e.width,e.height);if(r>1080){var i=1080/r;o.width=e.width*i,o.height=e.height*i}else o.width=e.width,o.height=e.height;a.drawImage(e,0,0,o.width,o.height);var c=o.toDataURL(),s=t.transtoBlob({b64data:c,contentType:"image/png"}),l="width";o.width<o.height&&(l="height"),console.log("blog post",s),n({blog:s,imgType:l})},e.onerror=function(){console.log("resizeImageByFile error image",e.src),o(new Error("Image load failed"))},e.src=a.result},a.onerror=o,a.readAsDataURL(e)}))}},{key:"resizeImageByUrl",value:function(e){var t=this;return new Promise((function(n,o){var a=new Image;a.onload=function(){var e=document.createElement("canvas"),o=e.getContext("2d"),r=Math.max(a.width,a.height);if(r>1080){var i=1080/r;e.width=a.width*i,e.height=a.height*i}else e.width=a.width,e.height=a.height;o.drawImage(a,0,0,e.width,e.height);var c=e.toDataURL(),s=t.transtoBlob({b64data:c,contentType:"image/png"}),l="width";e.width<e.height&&(l="height"),n({blog:s,imgType:l})},a.onerror=function(){o(new Error("Image load failed"))},a.src=e}))}},{key:"getBothUploadUrl",value:function(e){var t=e.firstType,n=e.secondType,o=this;return new Promise((function(e,a){try{var r=o.getUploadFileUrl(t,o.photoFirstRandom),i=o.getUploadFileUrl(n,o.photoSecondRandom);Promise.all([r,i]).then((function(t){if(!t||t.some((function(e){return 200!==e.code})))ToolTip({type:"error",title:textContentObj.errorNetworkTitle,content:textContentObj.errorNetwork,btn:textContentObj.ok}),$(".origin_uploader")[0].value="",$(".change_uploader")[0].value="",o.form.isSubmit=!1;else{var n,a;if(!o.photoFirstRandom)o.form.originImage=Object.assign(o.form.originImage,null===(n=t[0])||void 0===n?void 0:n.data);if(!o.photoSecondRandom)o.form.changeImage=Object.assign(o.form.changeImage,null===(a=t[1])||void 0===a?void 0:a.data);e(t)}})).catch((function(e){ToolTip({type:"error",title:textContentObj.Failed,content:textContentObj.exception_occurred,btn:textContentObj.ok}),$(".origin_uploader")[0].value="",$(".change_uploader")[0].value="",o.form.isSubmit=!1}))}catch(e){ToolTip({type:"error",title:textContentObj.Failed,content:textContentObj.exception_occurred,btn:textContentObj.ok}),$(".origin_uploader")[0].value="",$(".change_uploader")[0].value="",o.form.isSubmit=!1}}))}},{key:"imgMinWidth",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=512,e.next=3,createObjectURLFun(t);case 3:return o=e.sent,e.abrupt("return",new Promise((function(e){var t=new Image;t.src=o,t.onload=function(){var t=this.width,a=this.height;e(!(t<n||a<n)&&o)}})));case 5:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"urlToFile",value:function(e){return new Promise((function(t,n){fetch(e).then((function(e){return e.blob()})).then((function(e){t(e)})).catch((function(e){n(e)}))}))}},{key:"isShowToolBtn",value:function(){}},{key:"getImgList",value:function(){var e=this,t=fetchGet("ai/public/example?action=face_changing",TOOL_API).then((function(t){if(401!==t.code){var n=t.data.photo,o=t.data.domain;n.forEach((function(e,t){t>=6||$(".our_pics").append('\n            <li data-type="photo" style="display:none">\n              <img src="'.concat(o+e,'"  data-key="').concat(e,'" data-index="').concat(t+1,'"/>\n            </li>\n          '))})),$(".our_pics li[data-type='photo']").each((function(){var t=this;$(this).on("click",(function(n){var o=$(t).find("img").attr("src"),a=$(t).find("img").attr("data-key"),r=$(t).find("img").attr("src"),i=3-e.lastType;o&&(gtag("event","clickimg_faceswap_imgtpl"),1===i?(e.form.firstPicLoading=!0,e.form.originImage=r,e.photoFirstRandom=!0,e.form.originImage={},e.form.originImage.key=a,e.form.originImage.showUrl=o,e.form.originImage.suffix="png"==a.split(".")[1]?"image/png":"image/jpeg",$("#photo_Face_swapper_container .spread_image").attr("src",o),$("#photo_Face_swapper_container .spread_image").attr("data-key","origin_img"),$("#photo_Face_swapper_container .stepA .stepBox .step_P").addClass("active").attr("src",o).removeClass("width").removeClass("height"),$("#photo_Face_swapper_container .stepA .stepBox .btn_changer").show(),e.form.firstPicLoading=!1):(e.form.secondPicLoading=!0,e.form.changeImage=r,e.photoSecondRandom=!0,e.form.changeImage={},e.form.changeImage.key=a,e.form.changeImage.showUrl=o,e.form.changeImage.suffix="png"==a.split(".")[1]?"image/png":"image/jpeg",$("#photo_Face_swapper_container .stepB .stepBox .step_P").addClass("active").attr("src",o).removeClass("width").removeClass("height"),$("#photo_Face_swapper_container .stepB .stepBox .btn_changer").show(),e.form.secondPicLoading=!1),e.lastType=i)}))}))}else ToolTip({type:"error",title:textContentObj.errorNetworkTitle,content:textContentObj.errorNetwork,btn:textContentObj.ok})})).catch((function(e){ToolTip({type:"error",title:textContentObj.Failed,content:textContentObj.errorText,btn:textContentObj.ok}),console.error("fail",e)})),n=fetchGet("ai/public/example?action=video_face_changing",TOOL_API).then((function(e){if(401!==e.code){var t=e.data.domain,n="",o="";e.data.video_tartget_photo.forEach((function(e,o){o<3&&(n+='\n              <li style="display:none" data-type="video" data-vp="p" photo-index="'.concat(o+1,'" pic-key="').concat(e,'"  pic-url="').concat(t+e,'"> <img src="').concat(t+e,'"> </li> '))})),e.data.video.forEach((function(e,n){n>=3||(o+='\n          <li style="display:none" data-vp="v" data-type="video" video-index="'.concat(n+1,'" video-key="').concat(e.video_key,'" video-size="').concat(e.size,'" cover-url="').concat(t+e.cover_key,'" video-duration="').concat(e.duration,'" video-url="').concat(t+e.video_key,'">\n           <img src="').concat(t+e.cover_key,'">\n           <img class="v_photo_demo_playIcon" src="/dist/img/face-swap/icon_small_video.png" alt="">\n           </li>\n          '))})),$(".our_pics").append(o),$(".our_pics").append(n)}else ToolTip({type:"error",title:textContentObj.errorNetworkTitle,content:textContentObj.errorNetwork,btn:textContentObj.ok})}));Promise.all([n,t]).then((function(){"tab_video"===$(".faceSwap_tab.active").attr("tabName")?$(".our_pics li[data-type='video']").show():$(".our_pics li[data-type='photo']").show()}))}},{key:"uploadImagePromise",value:function(){var e=this;return new Promise(function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function t(n,o){var a,r;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.getBothUploadUrl({firstFile:e.form.originImage.file,secondFile:e.form.changeImage.file,firstType:e.form.originImage.suffix,secondType:e.form.changeImage.suffix});case 3:a=e.uploadFile(e.form.originImage,e.photoFirstRandom),r=e.uploadFile(e.form.changeImage,e.photoSecondRandom),Promise.all([a,r]).then((function(e){n(e)})).catch((function(e){return o(e)})),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(0),console.log(t.t0),o();case 12:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getSourceUrl",value:function(e){return fetchPost("ai/source/get-access-url",{key:e,file_name:"vidqu_faceswap.png"},TOOL_API)}},{key:"setDragLoading",value:function(e,t){console.log(e,t,"setDragLoading"),t?$("".concat(e," .uploader_loading_mask")).show():$("".concat(e," .uploader_loading_mask")).hide()}},{key:"throttle",value:function(e,t){var n=0;return function(){var o=(new Date).getTime();o-n>=t&&(e.apply(void 0,arguments),n=o)}}},{key:"getCountryConfig",value:function(){var e=this;return new Promise((function(t,n){fetchGet("ai/tool/facechanging-country-code",TOOL_API).then((function(o){200===o.code?(e.countryConfig=o.data,t(o.data)):(ToolTip({type:"error",title:textContentObj.errorNetworkTitle,content:textContentObj.errorNetwork,btn:textContentObj.ok}),n("error"))})).catch((function(){ToolTip({type:"error",title:textContentObj.errorNetworkTitle,content:textContentObj.errorNetwork,btn:textContentObj.ok}),n("error")}))}))}},{key:"getCanSwapFaceBool",value:function(){var e=this;return new Promise(function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function t(n,o){var a,r,i;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getCanSwapFaceData();case 2:if(!getCookie("access_token")){t.next=15;break}if(200!==e.canFaceSwap.code){t.next=11;break}if(1!=(null===(a=e.canFaceSwap.data)||void 0===a?void 0:a.last_use_credit)||0!==(null===(r=e.canFaceSwap.data)||void 0===r?void 0:r.credit)){t.next=9;break}return t.next=7,showRemoveWatermark();case 7:i=t.sent,n(i);case 9:t.next=13;break;case 11:3008===e.canFaceSwap.code?showNotEnoughCredits():showMaximum(),n(!1);case 13:t.next=16;break;case 15:200!==e.canFaceSwap.code&&(showMaximum(),n(!1));case 16:n(!0);case 17:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getCanSwapFaceData",value:(e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,e.abrupt("return",new Promise(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(n,o){var a,r,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetchPost("ai/tool/can-face",{action:"face_changing"},TOOL_API);case 3:r=e.sent,t.canFaceSwap=r,i=(null===(a=t.canFaceSwap.data)||void 0===a?void 0:a.credit)||0,userRuleConfig.credit=i,changeHeaderCredit(i),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error(e.t0);case 13:n();case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})},{key:"eventLoginsuccess",value:function(){var e=this;this.getCanSwapFaceData(),document.querySelector("my-component").addEventListener("loginsuccess",function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function t(n){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getCanSwapFaceData();case 2:checkNullObj(e.form.originImage)||checkNullObj(e.form.changeImage)||showBtnCreditsImage(!0),isLogin(!0);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"setLoadingMaskTip",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(t.maskSpan,t.show_wait),o=t.num,a=t.second,r=$("#createTaskMaskPhoto"),i=$("#photo_Face_swapper_container .v_mask_background");if(e){if(1===n){r.find(".v_mask_content2").show();var c=a,s="wait_minutes";a>60?c=Math.ceil(a/60):s="wait_seconds",r.find(".v_mask_content2 .v_mask_span").html(setTextContentObj("estimated_wait_time",{val:o,val2:c,val3:setTextContentObj(s)}))}else r.find(".v_mask_content2").hide();r.show(),i.show()}else r.hide(),i.hide()}},{key:"setMaskUnlockPriority",value:function(){$("#createTaskMaskPhoto .v_mask_unlock_priority").on("click",(function(e){gtag("event","click_faceswap_imgpriority"),setCookie("st","fsimgcreditpriority")}))}}]);var e,t}(),CreditPhotoModel=function(){return _createClass((function e(){_classCallCheck(this,e)}),[{key:"showNotEnoughCredits",value:function(){ToolTip({type:"error",title:textContentObj.Failed,content:getfsCreditsText("Model_not_credit_span",{val:credits}),btn:textContentObj.ok})}},{key:"showMaximum",value:function(){gtag("event","alert_faceswap_imgmaxlimit");var e=getfsCreditsText("Model_Maximum_span",{val:userRuleConfig.p_times},!0);ToolTip({type:"error",title:textContentObj.exceedTitle,content:e,btn:textContentObj.ok})}},{key:"showMaximumFileSize",value:function(){var e=getfsCreditsText("Model_MaximumFile_span",{val:userRuleConfig.limit});ToolTip({type:"error",title:textContentObj.Failed,content:e,btn:textContentObj.ok})}},{key:"showRemoveWatermark",value:function(){ToolTip({type:"error",title:textContentObj.Failed,content:getfsCreditsText("Model_Remove_Watermark_btn"),btn:textContentObj.ok})}}])}();function checkNullObj(e){return 0===Object.keys(e).length}var creditsPhotoModel=null,setDropdown=function(e){var t=1===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)?aiFaceChanging.form.firstPicLoading:aiFaceChanging.form.secondPicLoading;$("".concat(e," .stepBox")).on("dragover",(function(e){e.preventDefault()})),$("".concat(e," .stepBox")).on("dragenter",(function(n){n.preventDefault(),t||aiFaceChanging.setDragLoading("".concat(e," .stepBox"),!0)})),$("".concat(e," .uploader_loading_mask")).on("dragleave",(function(n){t||aiFaceChanging.setDragLoading("".concat(e," .stepBox"),!1)}))};function showCreditBannerP(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];photocreditSystem.showCreditBanner({bool:e,showcallback:function(){gtag("event","show_faceswap_imgbanner")}}),videocreditSystem.showCreditBanner({bool:e,showcallback:function(){gtag("event","show_faceswap_videobanner")}})}function showMaximum(){gtag("event","alert_faceswap_imgmaxlimit"),photocreditSystem.showCreditPopup({title:textContentObj.exceedTitle,content:getfsCreditsText("Model_Maximum_span",{val:userRuleConfig.p_times},!0),btn:getfsCreditsText("Model_Unlock_btn"),btnFn:function(){gtag("event","click_faceswap_imgmaxlimit")},modalCoins:"timesmax"})}function showBtnCreditsImage(e){var t,n;200===(null==aiFaceChanging||null===(t=aiFaceChanging.canFaceSwap)||void 0===t?void 0:t.code)&&0===(null==aiFaceChanging||null===(n=aiFaceChanging.canFaceSwap)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.credit)||photocreditSystem.showBtnCredits({bool:e,credits:1,appendDom:$("#photo_Face_swapper_container .change_face_btn"),type:"image"})}function showRemoveWatemark_btn(e){e?($("#photo_Face_swapper_container .removeWatemark_btn").show(),$("#large_face_modal .removeWatemark_btn").show(),$("#photo_Face_swapper_container .removeWatemark_btn").parent().addClass("img_btns_group2"),$("#large_face_modal .img_btns").addClass("img_btns2_r")):($("#photo_Face_swapper_container .removeWatemark_btn").hide(),$("#large_face_modal .removeWatemark_btn").hide(),$("#photo_Face_swapper_container .removeWatemark_btn").parent().removeClass("img_btns_group2"),$("#large_face_modal .img_btns").removeClass("img_btns2_r"))}function showNotEnoughCredits(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;gtag("event","alert_faceswap_imgnocredit"),photocreditSystem.showCreditPopup({title:getfsCreditsText("Model_not_credits_title"),content:getfsCreditsText("Model_not_credit_span",{val:e},!0),btn:getfsCreditsText("Model_not_credits_btn"),btnFn:function(){gtag("event","click_faceswap_imgnocredit"),setCookie("st","fsimgnocredit")},modalCoins:"notenough"})}function showRemoveWatermark(){return new Promise((function(e,t){photocreditSystem.showCreditPopup({title:getfsCreditsText("Model_Remove_Watermark_title"),content:getfsCreditsText("Model_Remove_Watermark_span"),btn:getfsCreditsText("Model_Remove_Watermark_btn"),btnWater:getfsCreditsText("Model_Remove_Watermark_btn1"),btnWaterFn:function(){gtag("event","click_faceswap_stock_m"),e(!0)},closeClick:function(){e(!0)},btnFn:function(){setCookie("st","removewatermark_m"),gtag("event","click_faceswap_no_m"),e(!1)},modalCoins:"watermarker"})}))}function download(){return _download.apply(this,arguments)}function _download(){return(_download=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,n,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(getCookie("access_token")){e.next=3;break}return showLoginWindow({isReloading:!1}),e.abrupt("return");case 3:return gtag("event","download_faceswap_imgres"),t=function(){ToolTip({type:"downloadsuccess",title:textContentObj.Download_success,content:textContentObj.Download_sucess_text,btn:textContentObj.ok})},n=function(){ToolTip({type:"error",title:textContentObj.Failed,content:textContentObj.downloadError,btn:textContentObj.ok})},o=function(){ToolTip({type:"error",title:textContentObj.Failed,content:textContentObj.file_download_exist,btn:textContentObj.ok})},e.next=9,fetchPost("ai/source/get-access-url",{key:aiFaceChanging.mergeKey,action:"download",file_name:"Vidqu_faceswap.png"},TOOL_API).then((function(e){ToolTip({type:"progress",content:textContentObj.downloading,progressType:"fetch",url:e.data.url,name:"Vidqu_faceswap.png",sucessCallback:t,failedCallback:n,NoExistCallback:o})})).catch((function(e){ToolTip({type:"error",title:textContentObj.errorNetworkTitle,content:textContentObj.errorNetwork,btn:textContentObj.ok})}));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var aiFaceChanging=new AiFace,photoAiFaceChanging=aiFaceChanging;$(document).ready((function(){window.aiFaceChanging=aiFaceChanging,creditsPhotoModel=new CreditPhotoModel,gtag("event","open_faceswap_page"),aiFaceChanging.getImgList(),aiFaceChanging.eventLoginsuccess(),aiFaceChanging.setMaskUnlockPriority(),setFsNewTag(!0),$("#photo_Face_swapper_container .stepA .stepBox img").on("click",(function(e){e.stopPropagation(),$(this).hasClass("active")||(gtag("event","up_faceswap_imgstep1"),$(".origin_uploader").click())})),$("#photo_Face_swapper_container .stepA .stepBox .btn_changer").on("click",(function(e){e.stopPropagation(),$(this).hasClass("active")||(gtag("event","up_faceswap_imgstep1"),$(".origin_uploader").click())})),$("#photo_Face_swapper_container .stepB .stepBox img").on("click",(function(e){e.stopPropagation(),$(this).hasClass("active")||(gtag("event","up_faceswap_imgstep2"),$(".change_uploader").click())})),$("#photo_Face_swapper_container .stepB .stepBox .btn_changer").on("click",(function(e){e.stopPropagation(),$(this).hasClass("active")||(gtag("event","up_faceswap_imgstep2"),$(".change_uploader").click())})),setDropdown("#photo_Face_swapper_container .stepA",1),setDropdown("#photo_Face_swapper_container .stepB",2),$("#large_face_modal").on("wheel",(function(e){e.preventDefault()})),$(".origin_uploader").on("change",(function(e){if(e.target.files&&e.target.files[0])if(1===e.target.files.length){var t=e.target.files[0],n=$(this)[0];console.log(t,n,"file"),aiFaceChanging.addImage(e,t,1,(function(e,t){var o="width"===t?"height":"width";$("#photo_Face_swapper_container .spread_image").attr("data-key","origin_img"),$("#photo_Face_swapper_container .stepA .stepBox .step_P").addClass("active").attr("src",e.showUrl).removeClass(o).addClass("".concat(t)),$("#photo_Face_swapper_container .stepA .stepBox .btn_changer").show(),n.value=""}))}else ToolTip({type:"error",title:textContentObj.Failed,content:textContentObj.onlyone,btn:textContentObj.ok})})),$(".change_uploader").on("change",(function(e){if(e.target.files&&e.target.files[0])if(1===e.target.files.length){var t=e.target.files[0],n=$(this)[0];aiFaceChanging.addImage(e,t,2,(function(e,t){var o="width"===t?"height":"width";$("#photo_Face_swapper_container .stepB .stepBox .step_P").addClass("active").attr("src",e.showUrl).removeClass(o).addClass("".concat(t)),$("#photo_Face_swapper_container .stepB .stepBox .btn_changer").show(),n.value=""}))}else ToolTip({type:"error",title:textContentObj.Failed,content:textContentObj.onlyone,btn:textContentObj.ok})})),$("#photo_Face_swapper_container .stepA .uploader_loading_mask").on("drop",(function(e){if(e.preventDefault(),aiFaceChanging.setDragLoading("#photo_Face_swapper_container .stepA",!1),!aiFaceChanging.form.firstPicLoading)if(gtag("event","up_faceswap_imgstep1"),1===e.originalEvent.dataTransfer.files.length){var t=e.originalEvent.dataTransfer.files[0];$(".origin_upload").addClass("loading_mask"),aiFaceChanging.addImage(e,t,1,(function(e,t){var n="width"===t?"height":"width";$("#photo_Face_swapper_container .spread_image").attr("data-key","origin_img"),$("#photo_Face_swapper_container .stepA .stepBox .step_P").addClass("active").attr("src",e.showUrl).removeClass(n).addClass("".concat(t)),$("#photo_Face_swapper_container .stepA .stepBox .btn_changer").show()}))}else ToolTip({type:"error",title:textContentObj.Failed,content:textContentObj.onlyone,btn:textContentObj.ok})})),$("#photo_Face_swapper_container .stepB .uploader_loading_mask").on("drop",(function(e){if(e.preventDefault(),aiFaceChanging.setDragLoading("#photo_Face_swapper_container .stepB ",!1),!aiFaceChanging.form.secondPicLoading)if(gtag("event","up_faceswap_imgstep2"),1===e.originalEvent.dataTransfer.files.length){var t=e.originalEvent.dataTransfer.files[0];aiFaceChanging.addImage(e,t,2,(function(e,t){var n="width"===t?"height":"width";$("#photo_Face_swapper_container .stepB .stepBox .step_P").addClass("active").attr("src",e.showUrl).removeClass(n).addClass("".concat(t)),$("#photo_Face_swapper_container .stepB .stepBox .btn_changer").show()}))}else ToolTip({type:"error",title:textContentObj.Failed,content:textContentObj.onlyone,btn:textContentObj.ok})})),$("#photo_Face_swapper_container .removeWatemark_btn").on("click",(function(e){})),$("#large_face_modal .removeWatemark_btn").on("click",(function(e){})),$("#photo_Face_swapper_container .contrast,#large_modal .contrast").on("pointerdown",(function(t){var n;if(t.preventDefault(),2!==t.button){var o,a;if(gtag("event","compare_faceswap_imgres"),null!==(n=aiFaceChanging.form)&&void 0!==n&&null!==(n=n.originImage)&&void 0!==n&&n.showUrl)$("#photo_Face_swapper_container .spread_image").attr("src",null===(o=aiFaceChanging.form)||void 0===o?void 0:o.originImage.showUrl),$("#large_modal .larger_img").attr("src",null===(a=aiFaceChanging.form)||void 0===a?void 0:a.originImage.showUrl);document.addEventListener("pointerup",(function(t){$("#photo_Face_swapper_container .spread_image").attr("data-key")||e(t)}))}})),$("#photo_Face_swapper_container .share,#large_modal .share").on("click",(function(e){gtag("event","share_faceswap_imgres");var t=document.querySelector("#shareDialogEl");t.changeTips({title:textContentObj.share_title_v,content:textContentObj.share_title_centent}),t.showShare({url:aiFaceChanging.mergeImgUrl,action:"ismarttafaceshare",imageKey:aiFaceChanging.mergeKey,text:textContentObj.share__text,title:textContentObj.share__Tile,id:aiFaceChanging.taskid,lan:questLanguage,backParams:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{id:aiFaceChanging.taskid,key:null==e?void 0:e.merge_key}},task_id:aiFaceChanging.taskid})})),$(".compare_btn").on("pointerleave",(function(t){e(t)}));var e=function(t){console.error("stopCompare"),t.preventDefault();$("#photo_Face_swapper_container .spread_box_controls").css("visibility");2!==t.button&&($("#photo_Face_swapper_container .spread_image").attr("src",aiFaceChanging.mergeImgUrl),$("#large_modal .larger_img").attr("src",aiFaceChanging.mergeImgUrl),document.removeEventListener("pointerup",(function(t){e(t)})))};$("#photo_Face_swapper_container .zoomIn").on("click",(function(e){e.preventDefault(),2!==e.button&&(gtag("event","zoomin_faceswap_imgres"),$("#large_modal").addClass("photo_large").show(),$("#large_modal.photo_large .download").on("click",(function(e){e.preventDefault(),2!==e.button&&download()})))})),$("#photo_Face_swapper_container .download").on("click",function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),2!==t.button){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,download();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),$(".modal__main_close").on("click",(function(){$(".vocalRemover__modal").hide()})),$("#large_modal .close_large").on("click",(function(){$("#large_modal").hide().removeClass("photo_large").removeClass("video_large"),$("#large_modal .download").off("click")})),$(".change_face_btn").on("click",(function(e){var t=this;gtag("event","click_faceswap_imgstep3");var n=aiFaceChanging;n.form.isSubmit=!0,n.getCountryConfig().then((function(){n.changeFace($(t))})).catch((function(){n.form.isSubmit=!1}))})),$(".face_swap_now").on("click",(function(){scrollToPositions(".ai-change-face")})),$("#header_user").on("mouseenter",(function(){gtag("event","show_faceswap_profilepopover")})),$("#header_user #go_credits").click((function(){gtag("event","click_faceswap_profileaccount")})),$("#header_user .signout").click((function(){gtag("event","click_faceswap_profilesignout")}))}));