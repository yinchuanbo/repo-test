$(document).ready((function(){let t=[];const e=jsonData.creditHistory.javascript;function n(t){$(".history_content").removeClass("payment credit record"),"payment"===t?$(".history_content").addClass("payment"):"credit"===t?$(".history_content").addClass("credit"):"record"===t&&$(".history_content").addClass("record")}function c(t){const e=new Date(1e3*t);return`${e.getFullYear()}/${String(e.getMonth()+1).padStart(2,"0")}/${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`}function i(t){"payment"==t&&v?o(d):"credit"==t&&w&&a(l)}async function o(t){if(!h){h=!0;try{const i=await fetchGet(`api/vidqu-credits/payments?page=${t||""}`);if(200===i.code){const{data:t}=i;t.page?(v=!0,d=t.page):v=!1,f=[...f,...t.list];const o=f.find((t=>"ai-vidqu-credits-subscription"===t.product));m=o;for(const t of f)if(t.id===o.id){t.cancel=!0;break}g=t.next_subscription_status?1:0,f.length?function(t){if(!t.length)return;let i="";t.forEach((t=>{let n,o=e.paid;2==t.pay_status&&(o=e.unpaid),n="ai-vidqu-credits-disposable"==t.product?`${formatter.format(t.credit)} ${e.credits}`:1==t.num?e.type1:6==t.num?e.type2:12==t.num?e.type3:e.unknown,t.cancel&&g&&gtag("event","show_account_cancel"),i+=`\n          <div class="list_item">\n            <div class="pay_info_l">\n              <div class="pay_type">${n}</div>\n              <div class="date_no">\n                <span class="date">${c(t.created_at)}</span>\n                <span class="no">${e.trID} ${t.order_no}</span>\n                ${t.cancel&&g?`<span class="cancel_btn">${e.cancel}</span>`:""}\n                ${t.cancel?`<a target="_blank" href=/pricing.html?st=creditrenew&renew=1 class="renew_btn" style="${t.cancel&&!g?"":"display: none;"}">${e.renew}</a>`:""}\n              </div>\n            </div>\n            <div class="pay_info_r">\n              <div class="pay_state">${o}</div>\n              <div class="pay_price">${t.symbol}${t.price}</div>\n            </div>\n          </div>\n        `,t.cancel&&!g&&gtag("event","show_account_renew")})),$(".payment_list").append(i),$(".cancel_btn").on("click",(function(){const t=1e3*m.created_at;$(".dis_subtime").text(function(t,e){const n=new Date(t),c={year:"numeric",month:"long",day:"numeric"};n.setMonth(n.getMonth()+e);return new Intl.DateTimeFormat(localeArea[getPreferredLanguage()],c).format(n)}(t,m.num)),s("confirm"),gtag("event","click_account_cancel")})),$(".renew_btn").on("click",(function(){setSessionCookie("st","creditrenew"),gtag("event","click_account_renew")})),n("payment")}(t.list):n("record")}}catch(t){console.log(t)}finally{h=!1}}}async function a(t){if(!y){y=!0;try{const i=await fetchGet(`api/vidqu-credits?page=${t||""}`);if(200===i.code){const{data:t}=i;t.page?(w=!0,l=t.page):w=!1,b=[...b,...t.list],b.length?function(t){if(!t.length)return;let n="";t.forEach((t=>{let i;21==t.type?i=e.type4:20==t.type?i=e.type5:14==t.type?i=e.type13:22==t.type||23==t.type?i=e.type14:10==t.type?"ai-sockpuppet-credits-subscription"==t.project.type?1==t.project.num?i=e.type6:6==t.project.num?i=e.type7:12==t.project.num&&(i=e.type8):i=e.type9:i=100==t.type?e.type10:13==t.type?e.type11:11==t.type?e.type12:12==t.type||121==t.type?e.type15:e.other,n+=`\n        <div class="list_item">\n          <div class="use_info_l">\n            <div class="use_type">${i}</div>\n            <div class="use_date">${c(t.created_at)}</div>\n          </div>\n          <div class="use_info_r">\n            <div class="use_num"><span class="credit_change">${String(t.credit).includes("-")?t.credit:`+${t.credit}`}</span> ${1==t.credit||-1==t.credit?e.credit:e.credits}</div>\n          </div>\n        </div>\n      `})),$(".credit_list").append(n)}(t.list):n("record")}}catch(t){console.log(t)}finally{y=!1}}}function s(t){switch($(".dialog_pay_mask").addClass("show"),$(".cancel_dialog").removeClass("showconfirm showsuc showerr"),t){case"confirm":$(".cancel_dialog").addClass("showconfirm"),gtag("event","show_account_cancelpop");break;case"suc":$(".cancel_dialog").addClass("showsuc"),gtag("event","show_account_cancelsucc");break;case"fail":$(".cancel_dialog").addClass("showerr"),gtag("event","show_account_cancelfail")}}function r(t,n,c){$(`#${n} .buy_num`).html(`${formatter.format(t.credit_num)} ${e.credits}`),$(`#${n} .buy_btn`).attr("data-id",c),$(`#${n} .cur_price .symbol`).html(`${t.symbol}`),$(`#${n} .cur_price .price_num`).html(`${t.price}`),$(`#${n} .one_price .symbol`).html(`${t.symbol}`),$(`#${n} .one_price .price_num`).html(`${t.ai_per_minute_dollar}`),$(`#${n} .orign_price`).html(`${t.symbol}${t.save}`),0!=t.discount?$(`#${n} .item_tip`).html(`${t.discount}${e.off}`):($(`#${n} .item_tip`).hide(),$(`#${n} .orign_price`).hide(),$(`#${n} .m_orign_price`).hide()),document.body.clientWidth<1200&&($(`#${n} .m_buy_num`).html(`${t.credit_num} ${e.credits}`),$(`#${n} .m_orign_price`).html(`${t.symbol}${t.save}`))}let d,l,_,u,p,m,g,h=!1,y=!1,f=[],b=[],v=!1,w=!1;async function k(){gtag("event","show_account_history"),getCookie("access_token")?(new Promise(((t,e)=>{fetchPost("ai/tool/videoface-user",{},TOOL_API).then((n=>{200===n.code?(userRuleConfig=n.data,$("#banner_num").text(n.data.credit||0),1===n.data.is_subscriber&&($(".credits_buy_pro").show(),$(".credits_buy").hide()),$("#go_credits .credits_num span").text(n.data.credit),t()):(console.error("Error getCountryConfig",n),ToolTip({type:"error",title:textContentObj.Failed,content:textContentObj.processImage,btn:textContentObj.ok}),e())})).catch((t=>{console.error(t),ToolTip({type:"error",title:textContentObj.errorNetworkTitle,content:textContentObj.errorNetwork,btn:textContentObj.ok}),e()}))})),await async function(){const e=await fetchGet("api/products/lists?action=vidqu_credits&lang=en",TOOL_API);if(200===e.code){const{data:{product:n}}=e;if(t=n,!n?.length)return;_=n[0],u=n[1],p=n[2],r(_,"credit150",n[0].id),r(u,"credit500",n[1].id),r(p,"credit1500",n[2].id),$(".more_credits_list_item .buy_btn").click((function(){if(!getCookie("access_token"))return void showLoginWindow({isReloading:!0});let e=$(this).attr("data-id"),n=t.find((t=>t.id===e));gtag("event",`buyclick_account_${n.credit_num}credit`),changeCarInfo(n,"credit")})),$(".m_buy_btn").on("click",(function(){let t;$(".more_credits_list_item").each(((e,n)=>{$(n).hasClass("active")&&(t=n.id)})),"credit150"==t?(changeCarInfo(_,"credit"),gtag("event","buyclick_account_150credit")):"credit500"==t?(changeCarInfo(u,"credit"),gtag("event","buyclick_account_500credit")):"credit1500"==t&&(changeCarInfo(p,"credit"),gtag("event","buyclick_account_1500credit"))})),$(".more_credits_list_item").on("click",(function(){$(".more_credits_list_item").removeClass("active"),$(this).addClass("active")})),1==window?.userRuleConfig?.is_subscriber&&(gtag("event","show_account_onetime"),$(".more_credits").show())}}(),await a(),await o(),$("#credit_history_loading").hide(),initPay(_)):window.location.href="/"}$((function(){k()})),window.addEventListener("scroll",(async function(){const t=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)-((window.innerHeight||document.documentElement.clientHeight)+(window.scrollY||window.pageYOffset||document.body.scrollTop+(document.documentElement.scrollTop||0)));let e;e=document.body.clientWidth<1200?2153:657,t<=e&&($("#payment_history").hasClass("active")?i("payment"):i("credit"))})),$(".cancel_close, .no_confirm_btn, .ok_btn, .fail_btn").on("click",(function(){$(".dialog_pay_mask").removeClass("show"),$(".cancel_dialog").removeClass("showconfirm showsuc showerr"),$(this).hasClass("no_confirm_btn")?gtag("event","click_account_cancelpop_notnow"):$(this).hasClass("ok_btn")?gtag("event","click_account_cancelsucc_ok"):$(this).hasClass("fail_btn")&&gtag("event","click_account_cancelfail_tryagain")})),$(".confirm_btn").on("click",(function(){gtag("event","click_account_cancelpop_confirm"),$(".confirm_btn").addClass("loading"),fetchPost("api/order/cancel-stripe-subscript",{},TOOL_API).then((t=>{200===t.code?(s("suc"),$(".cancel_btn").remove(),$(".renew_btn").show(),gtag("event","show_credithistory_renew")):s("fail"),$(".confirm_btn").removeClass("loading")})).catch((t=>{s("fail"),$(".confirm_btn").removeClass("loading")}))})),$(".tab_item").on("click",(function(){$(".tab_item").removeClass("active"),$(this).addClass("active"),this.id.includes("payment")?f.length?n("payment"):n("record"):b.length?n("credit"):n("record")})),$(".credits_buy").on("click",(function(){window.open("/pricing.html"),setSessionCookie("st","accountbuy"),gtag("event","click_account_buybtn")})),$(".close_icon, .dialog_pay_mob .close_icon").on("click",(function(){($(".dialog_pay").hasClass("showsuc")||$(".dialog_pay_mob").hasClass("showsuc"))&&window.location.reload(),gtag("event","close_creditpricing_cart")})),$(".signout").click((()=>{setTimeout((()=>{location.reload()}),50)}))}));