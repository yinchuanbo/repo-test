function getHost(){let e=document.location.pathname,t="";return"/ai-girlfriend.html"==e?t="girl":"/ai-boyfriend.html"==e&&(t="boy"),t}function debounce(e,t){let o;return function(){let n=this,i=arguments;clearTimeout(o),o=setTimeout((function(){e.apply(n,i)}),t)}}function toggleValue(e,t){const o=e.indexOf(t);return-1===o?e.push(t):e.splice(o,1),e}var pathUrlName=getHost();let breakTime=0,lastUrl="";var isSendMsgFn;function fetchPost(e,t={},o={},n=!0){return isSendMsgFn=sendErrorMsgXPF(e),new Promise(((i,s)=>{fetch(TOOL_API+e,{method:"POST",headers:{"Content-Type":"application/json","X-TASK-VERSION":"2.0.0","Request-Origin":"vidqu","Request-Project":"girl"==pathUrlName?"girlfriend":"boyfriend",Sesid:ttsBlank(getCookie("SsToken"))?"":getCookie("SsToken"),"Sesid-sign":ttsBlank(getCookie("SsToken-sign"))?"":getCookie("SsToken-sign"),Authorization:ttsBlank(getCookie("access_token"))?"":"Bearer "+getCookie("access_token"),...o},body:JSON.stringify(t)}).then((t=>{if(setCookieSesid(t),0!=breakTime&&isSendMsgFn&&t.status>=500){const t={url:e,data:JSON.stringify(t),token:ttsBlank(getCookie("access_token"))?"":"Bearer "+getCookie("access_token"),Sesid:ttsBlank(getCookie("SsToken"))?"":getCookie("SsToken")};isSendMsgFn(e,t)}t.json().then((async e=>{401===e.code?(localStorage.removeItem("user_info"),setCookie("loginProduct",""),setSessionCookie("st",""),setCookie("refresh_token",""),setCookie("user_info",""),setCookie("access_token",""),isLogin(!1),n&&showLoginWindow(),await aiGirlFriend.initCharacters(),aiGirlFriend.GetRecentChatting(),aiGirlFriend.GetMyCharacters(),i(e)):i(e)}))})).catch((e=>{$Popup({type:"error",errorType:"network"}),s(e)}))}))}var fetchGet=function(e,t={},o=!0){let n;return isSendMsgFn=sendErrorMsgXPF(e),"chat/user/get-setting"==e&&(n=(new Date).getTime()),new Promise(((i,s)=>{fetch(TOOL_API+e,{method:"GET",headers:{"Content-Type":"application/json","X-TASK-VERSION":"2.0.0","Request-Origin":"vidqu","Request-Project":"girl"==pathUrlName?"girlfriend":"boyfriend",Sesid:ttsBlank(getCookie("SsToken"))?"":getCookie("SsToken"),"Sesid-sign":ttsBlank(getCookie("SsToken-sign"))?"":getCookie("SsToken-sign"),Authorization:ttsBlank(getCookie("access_token"))?"":"Bearer "+getCookie("access_token"),...t}}).then((t=>{if("chat/user/get-setting"==e&&(breakTime=(new Date).getTime()-n),0!=breakTime&&isSendMsgFn&&t.status>=500){const t={url:e,token:ttsBlank(getCookie("access_token"))?"":"Bearer "+getCookie("access_token"),Sesid:ttsBlank(getCookie("SsToken"))?"":getCookie("SsToken")};isSendMsgFn(e,t)}setCookieSesid(t),t.json().then((async e=>{401===e.code?(aiChatting.closeChat(),localStorage.removeItem("user_info"),setCookie("loginProduct",""),setSessionCookie("st",""),setCookie("refresh_token",""),setCookie("user_info",""),setCookie("access_token",""),isLogin(!1),o&&showLoginWindow(),await aiGirlFriend.initCharacters(),aiGirlFriend.GetRecentChatting(),aiGirlFriend.GetMyCharacters(),s(e)):i(e)}))})).catch((e=>{$Popup({type:"error",errorType:"network"}),s(e)}))}))};function sendErrorMsgXPF(e){if(0===breakTime&&e!=lastUrl&&"chat/public/add-log"==e)return;let t=(new Date).getTime();const o=debounce((function(e,n){const i=(new Date).getTime()-t;if(console.log(e,lastUrl,"lastUrl"),e==lastUrl)return lastUrl="",void o(e);n={isTimeout:i>4e3,data:n},console.error("add-log"),fetchPost("chat/public/add-log",n)}),1e3);return o}function uploadImagePromise(e,t=""){return new Promise((async(o,n)=>{try{var i=await getUploadFileUrl(e,t);console.log(i,"res"),uploadFile({url:i.data.upload_url,file:e}).then((e=>{200!==e?n():o({res:i,code:e})})).catch((e=>n(e)))}catch(e){n(e),console.log(e)}}))}function getUploadFileUrl(e,t){let o=e.type,n=e.name;try{o=o.split("/")[1]||"png",t=t||n.split(".")[0]||"defaultName"}catch(e){o="png"}return fetchPost("ai/source/get-upload-url",{file_name:`${n}.${o}`})}function uploadFile(e){return new Promise((async(t,o)=>{try{t(await fetchPut(e.url,e.file,""))}catch(e){console.error(e.message),o(e)}}))}$((function(){const e=["/multiple-face-swap.html","/multiple-face-swap.html?openTab=videofs","/face-swap.html","/face-swap.html?openTab=videofs","/ai-girlfriend.html","/ai-boyfriend.html"],t="LOCAL_PATH_STORAGE",o=localStorage.getItem(t),n=o?JSON.parse(o):[];function i(){e.forEach((e=>{e.includes("friend.html")&&$(".chat_tools").show(),$(`a[href="${e}"]`).parent().show()}))}e.filter((e=>new Set(n).has(e))).length>0?i():e.forEach((e=>{$(`a[href="${e}"]`).parent().hide()})),e.includes(location.pathname)&&(localStorage.setItem(t,JSON.stringify([...new Set([...n,location.pathname])])),console.error(o),i())}));