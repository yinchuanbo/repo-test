var userinfo=null,header_credit=null;function getTranslateText(e,t={},a=!1){if(a){let a=t.val;if("string"==typeof a){let e=a.replace(/,/g,"");a=parseFloat(e)}1!==a&&(e+="_p")}let i=videoTransText[e];for(let e in t){const a=new RegExp(`{{${e}}}`,"g");i=i.replace(a,t[e])}return i}function getUserinfo(){return new Promise(((e,t)=>{fetchPost("api/user/info",{},TOOL_API).then((t=>{200===t?.code&&t?.data?e(t.data):(console.error(t),e(t))})).catch((t=>{console.error(t),e()}))}))}window.addEventListener("load",(()=>{header_credit=document.querySelector("header-credit")})),curToken=getCookie("access_token")||"",requesHost="www.vidqu.ai"===location.host?"https://tool-api.vidqu.ai":"https://tool-api-test.vidqu.ai",translateDownloadData=null,translateDownloadDataY=null;const reloadNow=localStorage.getItem("reloadNow_videotranslate");reloadNow?localStorage.removeItem("reloadNow_videotranslate"):(localStorage.setItem("reloadNow_videotranslate",1),location.reload()),$(".credit-box .nav_title").html("");var contryT,tab1_defaultCountry,tab2_defaultCountry,videoDuration1,videoDuration2,curUploadFile,curYoutubeFile,urlObj,uploadVideoRes,youtubeVideoRes,demoList,originalLanList,winRef,youtubeUrl,tab_url1,tab_url2,tab_image1,tab_image2,tab_fileName2,tab_key2,translateLimit,translateUseLimit,tab1_currentVal,tab1_originVal,tab1_targetVal,tab2_currentVal,tab2_originVal,tab2_targetVal,tab1_choose_country,tab2_choose_country,contryList=[],tab1_defaultOriginLan={key:"",name:""},tab2_defaultOriginLan={key:"",name:""},defaultAble="2",defaultIsVideo="2",defaultProofread="1",isFileChange=!1,isYoutubeFileChange=!1,isDownload=!1,shareDialogEl=document.querySelector("#shareDialogEl"),upload_task_id="",youtube_task_id="",curTab="tab1",headMin=0,giveawayMin=0,useMin=0,isUse=!1,tab1_orVideo_script=[],tab1_taVideo_script=[],tab1_edit_orVideo_script=[],tab1_edit_taVideo_script=[],tab2_orVideo_script=[],tab2_taVideo_script=[],tab2_edit_orVideo_script=[],tab2_edit_taVideo_script=[];function getReq(e,t={}){return fetch(e,{method:"GET",headers:{...getHeaders(),...t}}).then((e=>e.json()))}function postReq(e,t,a={}){return fetch(e,{method:"POST",headers:{...getHeaders(),...a},body:JSON.stringify(t)}).then((e=>e.json()))}function putReq(e,t,a={}){var i=new AbortController,{signal:o}=i;return new Promise(((i,n)=>{fetch(e,{method:"PUT",headers:a,signal:o,body:t}).then((e=>i(e.status))).catch((e=>n(e)))}))}function getHeaders(){const e={"Content-Type":"application/json","Request-Language":"ja"==getPreferredLanguage()?"jp":getPreferredLanguage(),"Request-Origin":"vidqu"};return curToken=getCookie("access_token")||"",curToken&&(e.Authorization="Bearer "+curToken),e}function isBlank(e){return null==e||"null"===e||""===e||void 0===e||"undefined"===e||"unknown"===e}function isMobileDevice(){const e=navigator.userAgent;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e)}function isIOSBelowx(e){const t=navigator.userAgent||navigator.vendor||window.opera;if(/iPad|iPhone|iPod/.test(t)&&!window.MSStream){const a=t.match(/OS (\d+)_/);if(a&&a[1]){return parseInt(a[1],10)<=e}}return!1}function isMacOSBelow14(){const e=navigator.userAgent;if(/Macintosh|MacIntel|MacPPC|Mac68K/.test(e)){const t=e.match(/Mac OS X (\d+)[._](\d+)/);if(t){return parseInt(t[1],10)<14}}return!1}function isSafari(){const e=navigator.userAgent,t=navigator.vendor;return/Safari/.test(e)&&/Apple Computer/.test(t)&&!/Chrome/.test(e)}function isMacOS(){const e=navigator.userAgent||navigator.vendor||window.opera;return/Macintosh|MacIntel|MacPPC|Mac68K/.test(e)}function isIOS(){const e=navigator.userAgent||navigator.vendor||window.opera;return/iPad|iPhone|iPod/.test(e)&&!window.MSStream}async function getT(){1===(await postReq(`${requesHost}/ai/public/is-free`,{action:"credit_video_translate"})).data.is_free?(translateLimit=2,translateUseLimit=0):translateUseLimit=translateLimit=2,useMin=60*header_credit.getCreditsData().credits,headMin=getMins(useMin=useMin||0),giveawayMin=0}function getMins(e){return e=Number(e)/60,(e=Math.floor(e)===e||"0.0"===e.toFixed(1)?e.toString():Math.ceil(10*e)/10+"").replace(".0","")}function formatTime(e){let t=parseInt(e,10),a=Math.floor(t/3600),i=Math.floor(t%3600/60),o=t%60;return i<10&&(i="0"+i),o<10&&(o="0"+o),a>0?(a<10&&(a="0"+a),a+":"+i+":"+o):i+":"+o}function hasHH(e){return!!/^([0-1]?[0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9])$/.test(e)||(/^([0-5]?[0-9]):([0-5][0-9])$/.test(e),!1)}async function getContry(){const e=await getReq(`${requesHost}/ai/public/options?type=video-translate`);try{if(200===e.code){originalLanList=e.data.original_language||[];const t=e.data.country||[];renderDemo(demoList=e.data.demos||[]),handleContry(t,originalLanList),$(".select_contry").css("pointer-events",""),$(".demo_video").show(),$("#origin_lan").val("")}}catch(e){console.error(e)}}function handleContry(e,t){e.forEach((e=>{let t;t=e.men_list.length>0?{...e,list_config:[e.men_list[0]]}:{...e,list_config:[e.women_list[0]]},contryList=[...contryList,t]})),renderContryList(contryList),renderOriginLanList(t)}function renderOriginLanList(e){if($(".selectOriginLan").html(""),0===e.length)return void $(".selectOriginLan").html(videoTransText.no_result);let t="",a=-1;a=a<0?0:a,e.forEach(((e,a)=>{t+=`\n      <div class="select_item" data-name="${e.name}">\n        <div class="origin_contry">\n          ${e.name}\n        </div>\n      </div>\n    `})),$(".selectOriginLan").html(t),countryListitemClick("origin_contry")}function renderContryList(e){$(".selectContry").html("");let t="",a=-1;a=a<0?0:a,e.forEach(((e,i)=>{t+=`\n      <div class="select_item ${i===a?"active":""}" data-name="${(e?.country_name||"").trim()}">\n        <img class="contry_icon" src="${e.img_url}" alt="">\n        <div class="contry_name">\n          ${e.country_name}\n        </div>\n      </div>\n    `,i===a&&(tab1_defaultCountry=e,tab2_defaultCountry=e,setDefaultCountryInfo({flag:e.img_url,text:e.country_name,className:"contry_name"}))})),$(".selectContry").html(t),countryListitemClick("contry_name")}function countryListitemClick(e){let t;"contry_name"==e?t=document.querySelector(".select_box.selectContry").querySelectorAll(".select_item"):"origin_contry"==e&&(t=document.querySelector(".select_box.selectOriginLan").querySelectorAll(".select_item")),t.forEach((a=>{a.onclick=()=>{Array.from(a.classList).includes("active")||gtag("event","select_videotranslate_lang"),$(".select_contry1").removeClass("active"),clearListitemActive(t),a.classList.add("active");const i=a.textContent.trim();"contry_name"==e&&("tab1"===curTab?tab1_defaultCountry=contryList.find((e=>e.country_name==i)):tab2_defaultCountry=contryList.find((e=>e.country_name==i))),"origin_contry"==e&&("tab1"===curTab?tab1_defaultOriginLan=originalLanList.find((e=>e.name==i)):tab2_defaultOriginLan=originalLanList.find((e=>e.name==i)),renderOriginLanList(originalLanList)),"tab1"===curTab?(tab1_choose_country=null,tab1_edit_taVideo_script=[]):(tab2_choose_country=null,tab2_edit_taVideo_script=[]),setDefaultCountryInfo({flag:"contry_name"==e?a.querySelector(".contry_icon").src:null,text:i,className:e})}}))}function clearListitemActive(e){e.forEach((e=>{e.classList.remove("active")}))}function setDefaultCountryInfo({flag:e,text:t,className:a}){let i;e&&$(".contry_icon.default").attr("src",e).show(),"origin_contry"==a?($("#origin_lan").val(t),i=document.querySelector(".select_contry1"),langCountryTarget=i.querySelector(".origin_contry.default"),$(".tra_left").hasClass("genertor")||("tab1"===curTab?tab1_defaultOriginLan.key&&curUploadFile&&$(".translate_btn").addClass("active"):tab2_defaultOriginLan.key&&curYoutubeFile&&$(".translate_btn").addClass("active"))):"contry_name"==a&&($(".contry_name.default").html(t),i=document.querySelector(".select_contry2"),langCountryTarget=i.querySelector(".contry_name.default"));langCountryTarget.scrollWidth>langCountryTarget.clientWidth?langCountryTarget.setAttribute("title",t):langCountryTarget.removeAttribute("title")}function ableClick(){const e=document.querySelector(".toggleSwitch1"),t=document.querySelector(".toggleSwitch5"),a=$(".toggleSwitch2_1");$(".subtitle_preview").addClass("Erase_original"),a.on("change",(e=>{$(".toggleSwitch2_1").prop("checked",e.target.checked),e.target.checked?$(".subtitle_preview").removeClass("Erase_original"):$(".subtitle_preview").addClass("Erase_original")})),e.onchange=()=>{const a=e.checked?1:2;t.checked=e.checked,1===a?($(".subtitle_preview").addClass("active"),$(".choose2_1").css({display:"flex"}),$(".choose5_1").css({display:"flex"})):($(".choose2_1").css({display:"none"}),$(".choose5_1").css({display:"none"}),$(".toggleSwitch2_1").prop("checked",!1),$(".subtitle_preview").removeClass("Erase_original"),$(".subtitle_preview").addClass("Erase_original"),$(".subtitle_preview").removeClass("active")),setDefaultAble(a)},t.onchange=()=>{const a=t.checked?1:2;e.checked=t.checked,1===a?($(".subtitle_preview").addClass("active"),$(".choose2_1").css({display:"flex"}),$(".choose5_1").css({display:"flex"})):($(".choose2_1").css({display:"none"}),$(".choose5_1").css({display:"none"}),$(".toggleSwitch2_1").prop("checked",!1),$(".subtitle_preview").removeClass("Erase_original"),$(".subtitle_preview").addClass("Erase_original"),$(".subtitle_preview").removeClass("active")),setDefaultAble(a)}}function setDefaultAble(e){defaultAble=e}function isVideoClick(){const e=document.querySelector(".toggleSwitch2"),t=document.querySelector(".toggleSwitch6");e.onchange=()=>{const a=e.checked?1:2;t.checked=e.checked,setDefaultIsVideo(a)},t.onchange=()=>{const a=t.checked?1:2;e.checked=t.checked,setDefaultIsVideo(a)}}function setDefaultIsVideo(e){"1"==(defaultIsVideo=e)?"T1"===contryT?$(".info_time").text(videoTransText.video_timeT1):"T2"===contryT?$(".info_time").text(videoTransText.video_timeT2):$(".info_time").text(videoTransText.video_timeT3):"T1"===contryT?$(".info_time").text(videoTransText.audio_timeT1):"T2"===contryT?$(".info_time").text(videoTransText.audio_timeT2):$(".info_time").text(videoTransText.audio_timeT3)}function proofreadClick(){const e=document.querySelector(".toggleSwitch3");e.onchange=()=>{const t=e.checked?1:2;setDefaultProofread(t),1===t&&gtag("event","script_videotranslate_proof")}}function setDefaultProofread(e){defaultProofread=e}function showLarge(){$(".dialog_mask").addClass("show"),$(".dialog_content").addClass("show"),videoDom.pause(),$(".play_btn").show()}async function toEdit(){const e=getCookie("access_token")||"",t="tab1"===curTab?upload_task_id:youtube_task_id;if(e){const e="tab1"===curTab?upload_task_id:youtube_task_id;winRefCommon=window.open("","_blank"),gtag("event","click_videotranslate_edit"),setCookie("st2","editvideotranslate"),$(".btnM").addClass("edit_loading"),await setJumpToEdit({task_id:e,keyname:"video_key",pcTag:"editvideotranslate"}),$(".btnM").removeClass("edit_loading")}else showLoginWindow({wait:[t],fn:(e=null)=>{e&&("tab1"===curTab?translateDownloadData=e:translateDownloadDataY=e),initPage()}});$(".btn.download_video, .btn_download, .click_download").removeClass("pointer_none")}function showDemo(e,t){$(".pre_btn").show(),$(".next_btn").show(),0==e&&$(".pre_btn").hide(),e==demoList.length-1&&$(".next_btn").hide(),$("#demo_video").attr("poster",t.cover_url),$("#demo_video").attr("src",t.video_url),$("#demo_video").attr("data-index",e),$(".demo_dialog_name").text(t.name),$(".dialog_mask").addClass("show"),$(".demo_container").addClass("show")}function closeDemo(){$(".dialog_mask").removeClass("show"),$(".demo_container").removeClass("show"),$(".demo_play_icon").show(),videoDemo.pause(),videoDemo.currentTime=0}function showSwitch(){document.querySelectorAll(".switch").forEach((e=>{e.classList.remove("disable")}))}function showTip(e){switch($(".tip_box").addClass("show"),"progress"!=e&&showSwitch(),e){case"suc":$(".tip_content").addClass("success");break;case"fail":$(".tip_content").addClass("failed");break;case"progress":$(".tip_content").addClass("progress")}}function closeTip(){$(".tip_box").removeClass("show"),$(".tip_content").removeClass("success failed progress")}function showFailed(e){switch($(".title_text_tip").text(videoTransText.failed_title),$(".tip_failed").removeClass("notvip"),$(".tip_failed").removeClass("enough"),document.body.clientWidth<=1200&&$(".tip_content").css("width","95%"),$(".failed_btn").html(videoTransText.failed_btn),$(".failed_btn").off("click").on("click",(function(){closeTip()})),e){case"network":$(".title_text_tip").text(videoTransText.network_failed),$(".title_text_des").text(videoTransText.failed_des2);break;case"fail":$(".title_text_des").text(videoTransText.failed_des1);break;case"fail_useTime":$(".title_text_des").text(videoTransText.failed_des20);break;case"format":let e;e=isSafari()||isIOS()||isMacOS()?videoTransText.failed_des23:videoTransText.failed_des6,$(".title_text_des").text(e);break;case"duration":$(".title_text_des").text(videoTransText.failed_des5);break;case"download":$(".title_text_des").text(videoTransText.failed_des3);break;case"upload":$(".title_text_des").text(videoTransText.failed_des4);break;case"max":1===header_credit.getCreditsData().is_credit_subscription?$(".title_text_des").text(videoTransText.failed_des8_1g):$(".title_text_des").text(videoTransText.failed_des8);break;case"videoLan":$(".title_text_des").text(videoTransText.failed_des9);break;case"videoLan_useTime":$(".title_text_des").text(videoTransText.failed_des19);break;case"download_file":$(".title_text_des").text(videoTransText.failed_des10);break;case"download_file2":$(".title_text_des").text(videoTransText.failed_des24);break;case"upload_file":$(".title_text_des").text(videoTransText.failed_des11);break;case"limit":document.body.clientWidth<=1200&&$(".tip_content").css("width","5.4rem"),1===(userinfo=header_credit.getCreditsData()).is_credit_subscription?($(".title_text_tip").text(videoTransText.limit_failed),$(".title_text_des").text(videoTransText.failed_des7),$(".tip_failed").removeClass("notvip"),$(".failed_btn").html(videoTransText.failed_btn),$(".failed_btn").off("click").on("click",(function(){closeTip()}))):(gtag("event","show_videotranslate_max"),$(".failed_btn").html(`${videoTransText.unlocknow}`),$(".title_text_tip").text(videoTransText.limit_failed),$(".title_text_des").text(videoTransText.failed_des13),$(".tip_failed").addClass("notvip"),$(".notvip .failed_btn").off("click").on("click",(function(){closeTip(),gtag("event","click_videotranslate_max"),setCookie("st","translator_timemaxlimit")})));break;case"noAudio":$(".title_text_des").text(videoTransText.failed_des12);break;case"noAudio_useTime":$(".title_text_des").text(videoTransText.failed_des18);break;case"url_limit":gtag("event","toomany_videotranslate_urlparse"),$(".title_text_des").text(videoTransText.failed_des14);break;case"min_limit":$(".title_text_des").text(videoTransText.failed_des15);break;case"only_one_drag":$(".title_text_des").text(videoTransText.failed_des17);break;case"url_fail":gtag("event","failed_videotranslate_urlparse"),$(".title_text_des").text(videoTransText.failed_des16);break;case"not_enough":let t;if(gtag("event","show_videotranslate_nocredit"),"tab1"===curTab){t=getMins((videoDuration1<60?60:videoDuration1)-useMin)}else{t=getMins((videoDuration2<60?60:videoDuration2)-useMin)}document.body.clientWidth<=1200&&$(".tip_content").css("width","5.4rem"),$(".tip_failed").addClass("enough"),$(".title_text_tip").text(videoTransText.min_notEnough),$(".title_text_des").html(videoTransText.failed_des21.replace("%s",t)),$(".failed_btn").html(`\n\t\t\t\t\t<img src="/dist/img/video-translate/icon_time.svg" class="fail_icon_time" />\n\t\t\t\t\t<div class="text">${videoTransText.get_more}</div>\n\t\t\t\t`),$(".failed_btn").off("click").on("click",(function(){gtag("event","click_videotranslate_nocredit"),setCookie("st","translator_notime"),closeTip()}));break;case"not_youtube":gtag("event","notytb_videotranslate_urlparse"),$(".title_text_des").text(videoTransText.failed_des22)}showTip("fail"),"download"!=e&&"duration"!=e&&"format"!=e&&"max"!=e&&"url_fail"!=e&&("tab1"===curTab?tab1_defaultOriginLan.key&&curUploadFile?$(".translate_btn").addClass("active"):$(".translate_btn").removeClass("active"):tab2_defaultOriginLan.key&&curYoutubeFile?$(".translate_btn").addClass("active"):$(".translate_btn").removeClass("active"),$(".translate_btn_text").html(videoTransText.btn_tra1))}let timer,proofread_timer;function handleAddNum(){let e;e="tab1"===curTab?videoDuration1:videoDuration2,$("#loading_progress").text(0);let t=0,a=0,i=0;clearInterval(timer),timer=null,t="1"==defaultIsVideo?2.5*e:e,timer=setInterval((()=>{a+=90/t,i=Math.round(a),i>=90&&(i=90,clearInterval(timer),timer=null),$("#loading_progress").text(i)}),1e3)}function handleAddProofreadNum(){$(".proofread_loading").text(0),$(".loading_tip_progress").css("width","0%");let e=0;clearInterval(proofread_timer),proofread_timer=null,proofread_timer=setInterval((()=>{e++,e>=90&&(e=90,clearInterval(proofread_timer),proofread_timer=null),$(".proofread_loading").text(e),$(".loading_tip_progress").css("width",`${e}%`)}),1e3)}async function uploadFile(e){if(!e)return;$(".tra_box.step1").addClass("loading");let t=$(".translate_btn").attr("class");$(".translate_btn").removeClass("active"),ableSelect(!1),tab1_orVideo_script=[],tab1_taVideo_script=[],tab1_edit_orVideo_script=[],tab1_edit_taVideo_script=[],tab1_choose_country=null,urlObj=null,isFileChange=!0;let a=500;1===header_credit.getCreditsData().is_credit_subscription&&(a=1024);const i=1048576*a,o=e.name.split(".").pop().toLowerCase();let n,s;if(isSafari()||isIOS()||isMacOS()?(n=["m4v","mp4","mov"],s=["video/mp4","video/quicktime"]):(n=["m4v","mp4","mov","webm"],s=["video/mp4","video/quicktime","video/webm"]),videoDom.pause(),n.includes(o)||s.includes(e.type))if(e.size>i)gtag("event","max_videotranslate_upload"),showFailed("max"),$(".tra_box.step1").removeClass("loading"),t.includes("active")&&$(".translate_btn").addClass("active"),ableSelect(!0);else{const t=URL.createObjectURL(e),a=document.getElementById("getLoadedDom_video1");a.src=t,a.addEventListener("loadedmetadata",(async()=>{const i=a.duration;if(i<10)showFailed("duration");else if(i>10800)showFailed("min_limit");else{curUploadFile=e,videoDuration1=i,tab_url1=t;const o=await getVideoCoverImage(a);o?(tab_image1=o,$(".pre_img").attr("poster",tab_image1),$(".step_src_style1 .small_img").attr("src",tab_image1)):$("step_src_style1 .small_img").css("background","#000"),tab1_defaultOriginLan.key&&"tab1"===curTab&&$(".translate_btn").addClass("active"),$(".pre_img").attr("src",tab_url1),$(".tra_box.step1").addClass("active1"),$(".step_src_style1 .video_info_title").text(e.name),$(".step_src_style1 .video_info_duration").text(videoTransText.video_info_duration.replace("%s",formatTime(videoDuration1))),$(".tra_left").removeClass("genertor upload translate").addClass("upload"),$(".play_btn1").show(),isTimeIconShow()}$(".tra_box.step1").removeClass("loading"),ableSelect(!0)}),{once:!0})}else showFailed("format"),$(".tra_box.step1").removeClass("loading"),t.includes("active")&&$(".translate_btn").addClass("active"),ableSelect(!0)}function ableSelect(e){const t=document.querySelectorAll(".switch");e?($(".step_tab_box").css("pointer-events",""),$(".step_src_style").css("pointer-events",""),$(".step_content").css("pointer-events",""),$(".select_contry").css("pointer-events",""),$(".select_able").css("pointer-events",""),$(".select_video").css("pointer-events",""),$(".get_url_icon").css("pointer-events",""),$(".get_url_icon").removeClass("loading"),$(".delete_icon").css("pointer-events",""),$(".back_icon").css("pointer-events",""),t.forEach((e=>{e.classList.remove("disable")}))):($(".step_tab_box").css("pointer-events","none"),$(".step_src_style").css("pointer-events","none"),$(".step_content").css("pointer-events","none"),$(".select_contry").css("pointer-events","none"),$(".select_able").css("pointer-events","none"),$(".select_video").css("pointer-events","none"),$(".get_url_icon").css("pointer-events","none"),$(".get_url_icon").addClass("loading"),$(".delete_icon").css("pointer-events","none"),$(".back_icon").css("pointer-events","none"),t.forEach((e=>{e.classList.add("disable")})))}async function getVideoCoverImage(e){return e.setAttribute("crossOrigin","anonymous"),new Promise(((t,a)=>{e.play(),e.muted=!0,setTimeout((()=>{e.pause()}),1e3),setTimeout((()=>{try{let a=document.createElement("canvas");a.width=e.videoWidth,a.height=e.videoHeight,a.getContext("2d").drawImage(e,0,0,a.width,a.height);let i=a.toDataURL("image/jpeg");t(i)}catch(e){console.log("获取第一帧失败",e),t(!1)}}),1500)}))}function readfile(e){return new Promise(((t,a)=>{let i=new FileReader;i.readAsBinaryString(e),i.onload=e=>{t(!0)},i.onerror=e=>{t(!1)}}))}function handleFaildReq(e,t){ableSelect(!0),showFailed(1===userinfo?.is_credit_subscription?t:e),$(".play_btn").hide(),$(".play_btn1").hide(),$(".proofread_content").removeClass("loading"),clearInterval(timer),timer=null,"tab1"===curTab?(tab1_choose_country=null,uploadVideoRes&&!isFileChange?($(".tra_left").removeClass("genertor").addClass("translate"),videoDom.paused?$(".play_btn").show():$(".play_btn").hide()):($(".tra_left").removeClass("genertor").addClass("upload"),videoPre.paused?$(".play_btn1").show():$(".play_btn1").hide())):(tab2_choose_country=null,youtubeVideoRes&&!isYoutubeFileChange?($(".tra_left").removeClass("genertor").addClass("translate"),videoDom.paused?$(".play_btn").show():$(".play_btn").hide()):($(".tra_left").removeClass("genertor").addClass("upload"),videoPre.paused?$(".play_btn1").show():$(".play_btn1").hide())),closeProofread()}function showProofread(e=!0){if(gtag("event","show_videotranslate_script"),"tab1"===curTab){$(".proofread_video").attr("src",tab_url1),$(".proofread_video").attr("poster",tab_image1);const e=formatTime(videoDuration1);let t;t=hasHH(e)?"00:00:00":"00:00",$(".duration_show").html(`${t}/${e}`),uploadVideoRes&&!isFileChange?(videoDom.pause(),videoDom.currentTime=0,$(".play_btn").show()):curUploadFile&&(videoPre.pause(),videoPre.currentTime=0,$(".play_btn1").show())}else{$(".proofread_video").attr("src",tab_url2),$(".proofread_video").attr("poster",tab_image2);const e=formatTime(videoDuration2);let t;t=hasHH(e)?"00:00:00":"00:00",$(".duration_show").html(`${t}/${e}`),youtubeVideoRes&&!isYoutubeFileChange?(videoDom.pause(),videoDom.currentTime=0,$(".play_btn").show()):curYoutubeFile&&(videoPre.pause(),videoPre.currentTime=0,$(".play_btn1").show())}progressbar.value=0,progressbar.style.backgroundSize="0% 100%",voicebar.style.backgroundSize="20% 100%",voicebar.value=20,videoProof.volume=.2,e?($(".proofread_content").addClass("loading"),handleAddProofreadNum()):"tab1"===curTab?tab1_edit_orVideo_script.length>0&&renderSubtitle(tab1_edit_orVideo_script,tab1_edit_taVideo_script):tab2_edit_orVideo_script.length>0&&renderSubtitle(tab2_edit_orVideo_script,tab2_edit_taVideo_script),$(".voice_num").html(voicebar.value),$(".voice_box").removeClass("active"),$(".dialog_proofread").addClass("active"),$(".playpause_box").removeClass("pause"),document.body.style.overflow="hidden"}function closeProofread(){$(".dialog_proofread").removeClass("active"),$(".voice_box").removeClass("active"),videoProof.currentTime=0,progressbar.value=0,progressbar.style.backgroundSize="0% 100%",videoProof.pause(),videoProof.src="",$(".duration_show").html("00:00/00:00"),$(".playpause_box").removeClass("pause"),$(".translate_btn").addClass("active"),$(".translate_btn_text").html(videoTransText.btn_tra1),$(".subtitle_item").removeClass("disabled getfocus"),document.body.style.overflow=""}async function translateVideo(e){if(!navigator.onLine)return void showFailed("network");let t,a,i;if(closeProofread(),ableSelect(!1),"tab1"===curTab?(t=tab1_edit_taVideo_script,a=tab1_choose_country,i=tab1_defaultCountry):(t=tab2_edit_taVideo_script,a=tab2_choose_country,i=tab2_defaultCountry),gtag("event","trans_videotranslate_btn"),e)$(".translate_btn").removeClass("active"),$(".translate_btn_text").html(videoTransText.btn_tra2),$(".tra_left").removeClass("upload translate").addClass("genertor"),$(".video_loading_icon").hide(),$(".play_btn1").hide(),$(".play_btn").hide(),videoPre.pause(),videoPre.currentTime=0,videoDom.pause(),videoDom.currentTime=0,handleAddNum();else if(a?.country_name!==i?.country_name&&1==defaultProofread&&0===t.length)$(".translate_btn").removeClass("active"),$(".translate_btn_text").html(videoTransText.btn_tra2);else{if(1==defaultProofread&&0!==t.length)return showProofread(!1),void ableSelect(!0);$(".translate_btn").removeClass("active"),$(".translate_btn_text").html(videoTransText.btn_tra2),$(".tra_left").removeClass("upload translate").addClass("genertor"),$(".video_loading_icon").hide(),$(".play_btn1").hide(),$(".play_btn").hide(),videoPre.pause(),videoPre.currentTime=0,videoDom.pause(),videoDom.currentTime=0,handleAddNum()}if("tab1"===curTab)if(urlObj?.key)createTask();else{if(!await readfile(curUploadFile))return void handleFaildReq("upload","upload");try{const e=await postReq(`${requesHost}/ai/source/temp-upload-url`,{file_name:"Vidqu_VideoTranslate_"+(new Date).getTime()+curUploadFile.name});if(200!==e.code)return void handleFaildReq("upload_file","upload_file");{const t=(urlObj=e.data).upload_url||"";let a=200;t&&(a=await putUrl(t,curUploadFile));if(!await getFileUrlRequest(urlObj.access_url)||200!==a)return void handleFaildReq("upload_file","upload_file");createTask()}}catch(e){console.log("err",e),handleFaildReq("network","network")}}else createTask()}async function putUrl(e,t){let a=0;for(;;){try{const i=await putReq(e,t);return 200!==i&&(a++,a>=3)?(handleFaildReq("upload_file","upload_file"),i):i}catch(e){if(a++,a>=3)return console.log(err),void handleFaildReq("upload_file","upload_file")}await new Promise((e=>setTimeout(e,2e3)))}}function getYoutubeVideoTask(e){if(!e.includes("youtu"))return void showFailed("not_youtube");let t=2;(isIOSBelowx(16)||isMacOSBelow14())&&(t=1),ableSelect(!1);postReq(`${requesHost}/ai/ai-tool/add-task`,{action:"link_download",param:{url:e,option:"video-translate",type:"youtube",is_to_mp4:t}},{"X-TASK-VERSION":"2.0.0"}).then((e=>{200===e.code?checkYoutubeVideo(e.data.task_id):3002===e.code?(ableSelect(!0),showFailed("url_limit"),isTimeIconShow()):(ableSelect(!0),showFailed("url_fail"))})).catch((e=>{console.log(e),ableSelect(!0),showFailed("url_fail")}))}async function checkYoutubeVideo(e){let t=0;for(;;){try{const a=await postReq(`${requesHost}/ai/tool/get-task`,{id:e}),i=a.message;if(i.includes("duration too long"))return gtag("event","max_videotranslate_urlparse"),ableSelect(!0),showFailed("min_limit"),void $(".get_url_icon").removeClass("loading");if(i.includes("filesize too big"))return gtag("event","max_videotranslate_urlparse"),ableSelect(!0),showFailed("max"),void $(".get_url_icon").removeClass("loading");if(i.includes("duration too short"))return gtag("event","max_videotranslate_urlparse"),ableSelect(!0),showFailed("duration"),void $(".get_url_icon").removeClass("loading");if(200!==a.code){if(t++,t>=5)return ableSelect(!0),showFailed("url_fail"),void $(".get_url_icon").removeClass("loading")}else t=0;const o=a.data.status;if(0===o)return void handleYoutube(a.data);if(![0,-1,-2].includes(o))return ableSelect(!0),showFailed("url_fail"),void $(".get_url_icon").removeClass("loading")}catch(e){if(t++,t>=5)return console.error(e,"error"),ableSelect(!0),navigator.onLine?showFailed("url_fail"):showFailed("network"),void $(".get_url_icon").removeClass("loading")}await new Promise((e=>setTimeout(e,3e3)))}}async function handleYoutube(e){const{additional_data:t}=e;if(t.min_duration>t.duration)return void showFailed("duration");const a=document.getElementById("getLoadedDom_video2");a.src=t.url,isYoutubeFileChange=!0,a.addEventListener("loadedmetadata",(async function(){const e=a.duration;curYoutubeFile=t.url,videoDuration2=e,tab_url2=t.url,tab_fileName2=t.title,tab_image2=t.thumbnail_url,tab_key2=t.key,$(".pre_img").attr("poster",tab_image2),$(".step_src_style2 .small_img").attr("src",tab_image2),tab2_defaultOriginLan.key&&"tab2"===curTab&&$(".translate_btn").addClass("active"),$(".pre_img").attr("src",tab_url2),$(".tra_box.step1").addClass("active2").removeClass("youtube"),$(".step_src_style2 .video_info_title").text(tab_fileName2),$(".step_src_style2 .video_info_duration").text(videoTransText.video_info_duration.replace("%s",formatTime(videoDuration2))),$(".tra_left").removeClass("genertor upload translate").addClass("upload"),$(".play_btn1").show(),isTimeIconShow(),ableSelect(!0)})),a.load()}function isTimeIconShow(){if("tab1"===curTab){let e=getTranslateText("btn_credit",{val:getMins(videoDuration1)<1?1:getMins(videoDuration1)},!0);$(".time_text").text(e)}else{let e=getTranslateText("btn_credit",{val:getMins(videoDuration2)<1?1:getMins(videoDuration2)},!0);$(".time_text").text(e)}1===header_credit.getCreditsData().is_credit_subscription||translateUseLimit>=translateLimit?($(".time_icon_box").addClass("active"),$("#free_show").hide()):($("#free_show").show(),$(".time_icon_box").removeClass("active"))}function createTask(){let e,t,a;1==defaultAble?gtag("event","enable_videotranslate_subtitles"):gtag("event","disable_videotranslate_subtitles"),1==defaultIsVideo?gtag("event","all_videotranslate_video"):gtag("event","only_videotranslate_audio"),"tab1"===curTab?(e=tab1_edit_taVideo_script,t=tab1_choose_country,a=tab1_defaultCountry):(e=tab2_edit_taVideo_script,t=tab2_choose_country,a=tab2_defaultCountry);const i={key:"tab1"===curTab?urlObj.key:tab_key2,tts_config:a.list_config[0].tts_config,is_subtitles:Number(defaultAble),is_lipsync:Number(defaultIsVideo),is_proofread_video_script:Number(defaultProofread),original_language:"tab1"===curTab?tab1_defaultOriginLan?.key:tab2_defaultOriginLan?.key,duration:"tab1"===curTab?videoDuration1:videoDuration2,erase_original_subtitles:document.querySelector(".toggleSwitch2_1").checked?1:2};e.length>0&&(i.target_proofread_video_script=e),postReq(`${requesHost}/ai/ai-tool/add-task`,{action:"credit_video_translate",param:i},{"X-TASK-VERSION":"2.0.0"}).then((i=>{if(200===i.code){const o=i.data.task_id;t?.country_name!==a?.country_name&&1==defaultProofread&&0===e.length&&showProofread(),checkCreateVideo(o)}else if(3002===i.code)videoTransText.failed_des7=videoTransText.failed_des7.replace("%ss",i.message),translateLimit=i.message,translateUseLimit=translateLimit,isTimeIconShow(),gtag("event","alert_videotranslate_maxlimit"),handleFaildReq("limit","limit");else if(3015===i.code){let e;const t=getMins(useMin=Number(i.message));e=t<=1?document.body.clientWidth<=1200?videoTransText.m_head_min2.replace("%s",t):videoTransText.head_min2.replace("%s",t):document.body.clientWidth<=1200?videoTransText.m_head_min1.replace("%s",t):videoTransText.head_min1.replace("%s",t),$(".video_tra_head_text").html(e),handleFaildReq("not_enough","not_enough")}else 3008===i.code?handleFaildReq("not_enough","not_enough"):handleFaildReq("fail","fail")})).catch((e=>{console.log(e),handleFaildReq("network","network")}))}function getFileUrlRequest(e){return new Promise(((t,a)=>{var i=new XMLHttpRequest;i.open("GET",e,!0),i.send(),i.addEventListener("readystatechange",(function(e){if(2==i.readyState){let e=i.getResponseHeader("Content-Length");t(!!(e&&e/1024>1)),i.abort()}}),!1),i.onerror=e=>{console.log(e),handleFaildReq("network","network")}}))}async function checkCreateVideo(e){let t,a,i=0;for("tab1"===curTab?(t=tab1_edit_taVideo_script,a=tab1_choose_country,defaultCountry=tab1_defaultCountry):(t=tab2_edit_taVideo_script,a=tab2_choose_country,defaultCountry=tab2_defaultCountry);;){try{const o=await postReq(`${requesHost}/ai/tool/get-task`,{id:e}),n=o.message;if(n.includes("No default align-model for language:"))return void handleFaildReq("videoLan","videoLan_useTime");if(n.includes("original audio speech to text fail")||n.includes("no audio"))return void handleFaildReq("noAudio","noAudio_useTime");if(200!==o.code){if(i++,i>=5)return void handleFaildReq("fail","fail_useTime")}else i=0;const s=o.data.status;if(0===s)return a?.country_name!==defaultCountry?.country_name&&1==defaultProofread&&0===t.length?handleProofreadTask(o.data):("tab1"===curTab?translateDownloadData=await setDownloadData("video-translate",o):translateDownloadDataY=await setDownloadData("video-translate",o),handleTask(o.data),gtag("event","show_videotranslate_edit"),"tab1"===curTab?(upload_task_id=e,uploadVideoRes=o.data):(youtube_task_id=e,youtubeVideoRes=o.data),translateUseLimit++),await header_credit.updateInfo(),await getT(),void isTimeIconShow();if(![0,-1,-2].includes(s))return void handleFaildReq("fail","fail_useTime")}catch(e){if(i++,i>=5)return console.error(e,"error"),void(navigator.onLine?handleFaildReq("fail","fail_useTime"):handleFaildReq("network","network"))}await new Promise((e=>setTimeout(e,3e3)))}}function handleTask(e){clearInterval(timer),timer=null,$("#pre_video").attr("src",e.additional_data.video_url),$("#pre_video").attr("poster",e.additional_data.cover_url),$("#large_video").attr("src",e.additional_data.video_url),$("#large_video").attr("poster",e.additional_data.cover_url);let t,a=Number($("#loading_progress").text());t=setInterval((()=>{if(a+=1,$("#loading_progress").text(a),a>=100){if(a=100,clearInterval(t),t=null,ableSelect(!0),$(".tra_left").removeClass("genertor upload").addClass("translate"),$(".play_btn").show(),$(".translate_btn_text").html(videoTransText.btn_tra1),$(".translate_btn").addClass("active"),urlObj=null,"tab1"===curTab?(isFileChange=!1,tab1_orVideo_script=[],tab1_taVideo_script=[],tab1_edit_orVideo_script=[],tab1_edit_taVideo_script=[],tab1_originVal="",tab1_currentVal="",tab1_targetVal="",tab1_choose_country=null):(isYoutubeFileChange=!1,tab2_orVideo_script=[],tab2_taVideo_script=[],tab2_edit_orVideo_script=[],tab2_edit_taVideo_script=[],tab2_originVal="",tab2_currentVal="",tab2_targetVal="",tab2_choose_country=null),"1"==defaultIsVideo?"T1"===contryT?$(".tip_time").text(videoTransText.video_timeT1):"T2"===contryT?$(".tip_time").text(videoTransText.video_timeT2):$(".tip_time").text(videoTransText.video_timeT3):"T1"===contryT?$(".tip_time").text(videoTransText.audio_timeT1):"T2"===contryT?$(".tip_time").text(videoTransText.audio_timeT2):$(".tip_time").text(videoTransText.audio_timeT3),1===userinfo?.is_credit_subscription){let t;const a=getMins(useMin=e.available_duration);t=a<=1?document.body.clientWidth<=1200?videoTransText.m_head_min2.replace("%s",a):videoTransText.head_min2.replace("%s",a):document.body.clientWidth<=1200?videoTransText.m_head_min1.replace("%s",a):videoTransText.head_min1.replace("%s",a),$(".video_tra_head_text").html(t)}translateUseLimit>=translateLimit&&1!==userinfo?.is_credit_subscription&&($(".tip").hide(),$("#free_show").hide(),$("#p_free_show").hide()),$(".upgrade_banner").show(),gtag("event","succ_videotranslate_btn")}}),50)}function handleProofreadTask(e){clearInterval(proofread_timer),proofread_timer=null;let t,a=Number($(".proofread_loading").text());t=setInterval((()=>{a+=1,$(".proofread_loading").text(a),$(".loading_tip_progress").css("width",`${a}%`),a>=100&&(a=100,clearInterval(t),t=null,ableSelect(!0),$(".proofread_content").removeClass("loading"),"tab1"===curTab?(isFileChange=!0,tab1_choose_country=tab1_defaultCountry,tab1_orVideo_script=e.additional_data.origin_proofread_video_script.sort(((e,t)=>e.index-t.index)),tab1_taVideo_script=e.additional_data.target_proofread_video_script.sort(((e,t)=>e.index-t.index)),tab1_edit_orVideo_script=JSON.parse(JSON.stringify(tab1_orVideo_script)),tab1_edit_taVideo_script=JSON.parse(JSON.stringify(tab1_taVideo_script)),renderSubtitle(tab1_edit_orVideo_script,tab1_edit_taVideo_script)):(isYoutubeFileChange=!0,tab2_choose_country=tab2_defaultCountry,tab2_orVideo_script=e.additional_data.origin_proofread_video_script.sort(((e,t)=>e.index-t.index)),tab2_taVideo_script=e.additional_data.target_proofread_video_script.sort(((e,t)=>e.index-t.index)),tab2_edit_orVideo_script=JSON.parse(JSON.stringify(tab2_orVideo_script)),tab2_edit_taVideo_script=JSON.parse(JSON.stringify(tab2_taVideo_script)),renderSubtitle(tab2_edit_orVideo_script,tab2_edit_taVideo_script)),$(".tra_left").attr("class").includes("translate")||$(".tra_left").removeClass("genertor upload translate").addClass("upload"))}),50)}function renderSubtitle(e,t){const a="tab1"===curTab?tab1_defaultOriginLan:tab2_defaultOriginLan,i="tab1"===curTab?tab1_defaultCountry:tab2_defaultCountry;$(".subtitle_content").html("");let o=`\n\t<div class="contry_info">\n\t\t<div class="contry_info_item origin">\n\t\t\t<img src="${a.img_url}" />\n\t\t\t<div class="contry_info_item_name">${a.name}</div>\n\t\t</div>\n\t\t<div class="contry_info_item target">\n\t\t\t<img src="${i.img_url}" />\n\t\t\t<div class="contry_info_item_name">${i.country_name}</div>\n\t\t</div>\n\t</div>\n\t`;t.forEach(((t,a)=>{const i=e[a];o+=`\n\t\t<div class="subtitle_item" data-index=${a}>\n\t\t\t<div class="subtitle_time" data-index=${a}>${t.stime}-${t.etime}</div>\n\t\t\t<div class="subtitle_text">\n\t\t\t\t<div class="subtitle_item_text origin">\n\t\t\t\t\t<label data-index=${a} class="label_box origin" for="origin_sub_${a}">${i.title}</label>\n\t\t\t\t\t<textarea data-index=${a} id="origin_sub_${a}" class="origin_input" spellcheck="false" autocomplete="off"></textarea>\n\t\t\t\t</div>\n\t\t\t\t<div class="subtitle_item_text target">\n\t\t\t\t\t<label data-index=${a} class="label_box target" for="target_sub_${a}">${t.title}</label>\n\t\t\t\t\t<textarea data-index=${a} id="target_sub_${a}" class="target_input" spellcheck="false" autocomplete="off"></textarea>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="subtitle_btn_box">\n        <div class="cancel_btn" data-index=${a}>${videoTransText.btn_cancel}</div>\n        <div class="save_btn" data-index=${a}>\n          <div class="text">${videoTransText.btn_save}</div>\n          <div class="icon"></div>\n        </div>\n      </div>\n\t\t</div>\n\t\t`})),$(".subtitle_content").html(o),$(".label_box").on("click",(function(){const e=$(this).innerHeight(),t=$(this).parent().parent().find(".label_box.origin"),a=$(this).parent().parent().find(".label_box.target");let i;i=$(this).hasClass("origin")?a.innerHeight():t.innerHeight();const o=i>=e?i:e;$(this).parent().parent().css("height",o+"px"),t.css("height",o+"px"),a.css("height",o+"px"),$(this).hide();const n=$(this).next();n.css("height",o+"px"),n.val($(this).text()),n.show()})),$(".origin_input, .target_input").on("focus",(function(e){this.setSelectionRange(this.value.length,this.value.length),this.scrollTop=this.scrollHeight,$(".subtitle_item").addClass("disabled"),$(this).parent().parent().parent().addClass("getfocus").removeClass("disabled");const a=Number($(this).attr("data-index")),i=getCurtime(t[a].stime);videoProof.currentTime=i,$(this).hasClass("origin_input")?"tab1"===curTab?tab1_originVal=e.target.value:tab2_originVal=e.target.value:"tab1"===curTab?tab1_targetVal=e.target.value:tab2_targetVal=e.target.value})),$(".origin_input, .target_input").on("input",(function(t){const a=Number($(this).attr("data-index"));let i,o,n=t.target.value.trim();if("tab1"===curTab?(tab1_currentVal=n,o=tab1_orVideo_script,taVideo_script=tab1_taVideo_script):(tab2_currentVal=n,o=tab2_orVideo_script,taVideo_script=tab2_taVideo_script),$(this).hasClass("origin_input")){i=2*o[a].title.trim().length,n.length>=i&&(n=n.substring(0,i),$(this).val(n));"tab1"===curTab?tab1_originVal=n:tab2_originVal=n,n.trim()!==e[a].title.trim()&&$(this).parent().parent().parent().find(".save_btn").attr("data-origin",1)}else{i=3*taVideo_script[a].title.trim().length,n.length>=i&&(n=n.substring(0,i),$(this).val(n));"tab1"===curTab?tab1_targetVal=n:tab2_targetVal=n,n.trim()!==e[a].title.trim()&&$(this).parent().parent().parent().find(".save_btn").attr("data-target",1)}})),$(".save_btn").on("click",(async function(){gtag("event","save_videotranslate_script");const a="tab1"===curTab?tab1_defaultCountry:tab2_defaultCountry,i=Number($(this).attr("data-index")),o=e[i],n=t[i],s=a?.list_config[0]?.tts_config?.language,r=$(this).attr("data-origin"),l=$(this).attr("data-target");let d,c;if("tab1"===curTab?(d=tab1_originVal,c=tab1_targetVal):(d=tab2_originVal,c=tab2_targetVal),r)try{$(this).addClass("loading");const e=await postReq(`${Vidnoz_API}/ai/translation/text`,{to:s,text:d});if(200===e.code){const{data:t}=e,a=t.translated;"tab1"===curTab?tab1_targetVal=a:tab2_targetVal=a,n.title=a,o.title=d,$(this).parent().parent().find(".target_input").val(n.title),$(this).parent().parent().find(".label_box.target").text(n.title),$(this).parent().parent().find(".label_box.origin").text(o.title),ToolTip({text:videoTransText.save_suc})}else $(this).parent().parent().find(".origin_input").val(o.title),$(this).parent().parent().find(".target_input").val(n.title),ToolTip({text:videoTransText.save_fail,type:"error"})}catch(e){console.log(e),$(this).parent().parent().find(".origin_input").val(o.title),$(this).parent().parent().find(".target_input").val(n.title),ToolTip({text:videoTransText.save_fail,type:"error"})}finally{$(this).removeClass("loading")}else l&&(c?(n.title=c,ToolTip({text:videoTransText.save_suc})):($(this).parent().parent().find(".origin_input").val(o.title),$(this).parent().parent().find(".target_input").val(n.title),ToolTip({text:videoTransText.save_fail,type:"error"})));$(this).removeAttr("data-origin"),$(this).removeAttr("data-target"),$(".subtitle_item").removeClass("disabled getfocus"),currentVal="","tab1"===curTab?tab1_currentVal=currentVal:tab2_currentVal=currentVal})),$(".cancel_btn").on("click",(function(){gtag("event","cancel_videotranslate_script");const a=Number($(this).attr("data-index")),i=e[a],o=t[a];$(".subtitle_item").removeClass("disabled getfocus"),currentVal="",$(this).parent().parent().find(".origin_input").val(i.title),$(this).parent().parent().find(".target_input").val(o.title),$(this).parent().parent().find(".label_box.origin").text(i.title),$(this).parent().parent().find(".label_box.target").text(o.title),$(this).next().removeAttr("data-origin"),$(this).next().removeAttr("data-target")})),$(".bottom_content_btn").off("click").on("click",(function(){gtag("event","download_videotranslate_script"),downloadSRT(t)}))}function getCurtime(e){const t=e.match(/^(\d{2}):(\d{2}):(\d{2}),(\d{3})$/);if(!t)return 0;return 3600*parseInt(t[1],10)+60*parseInt(t[2],10)+parseInt(t[3],10)}function downloadSRT(e){const t="tab1"===curTab?tab1_defaultOriginLan:tab2_defaultOriginLan,a="tab1"===curTab?tab1_defaultCountry:tab2_defaultCountry;let i="";e.forEach((e=>{i+=`${e.index}\n${e.stime} --\x3e ${e.etime}\n${e.title}\n\n`})),i=i.trim();const o=new Blob([i],{type:"text/plain"}),n=URL.createObjectURL(o),s=document.createElement("a");s.href=n,s.download=`${t.name}_to_${a?.country_name}.srt`,document.body.appendChild(s),s.click(),URL.revokeObjectURL(n),document.body.removeChild(s)}function downLoadProgress(e,t){return new Promise(((a,i)=>{isDownload=!0;const o=document.createElement("a");o.download=t,o.href=e,o.click(),o.remove(),a()}))}async function downloadLocal(){if(isDownload)removeAllDownDisabled(),showTip("progress");else{$(".progress_container .progress").css({width:"0",transition:"none"}),setTimeout((()=>{$(".progress_container .progress").css({transition:"width 5s",width:"99%"})}),20),showTip("progress");let e="tab1"===curTab?uploadVideoRes.additional_data.video_key:youtubeVideoRes.additional_data.video_key;postReq(`${requesHost}/ai/source/get-access-url`,{key:e,file_name:`Vidqu_videotranslator.${e.split(".")[1]}`,action:"download"}).then((t=>{200===t.code?(removeAllDownDisabled(),getFileUrlRequest(t.data.url).then((a=>{a?downLoadProgress(t.data.url,`Vidqu_videotranslator.${e.split(".")[1]}`).then((()=>{closeTip(),showTip("suc"),gtag("event","dwsucc_videotranslate_res"),isDownload=!1,$(".progress_container .progress").css({transition:"none"})})):(removeAllDownDisabled(),isDownload=!1,closeTip(),showFailed("download_file2"))}))):(removeAllDownDisabled(),isDownload=!1,closeTip(),showFailed("download_file"))})).catch((e=>{removeAllDownDisabled(),isDownload=!1,closeTip(),showFailed("download_file")}))}}async function handleDownload(){downloadLocal()}function demoDownload(e){gtag("event","dw_videotranslate_demo");const t=document.createElement("a");t.href=e,(document.body||document.documentElement).appendChild(t),t.click(),t.remove()}function renderDemo(e){let t="";e.forEach(((e,a)=>{let i=isMobileDevice()?`\n    <video src="${e.video_url}" id="demoVideoEl_${a}" class="mobile_demo_video"></video>\n    `:"";t+=`\n    <div class="demo_item" data-index="${a}">\n      <div class="img_box">\n        <img class="cover_img" src="${e.cover_url}" />\n        <div class="demo_downicon">\n          <div class="downicon" data-index="${a}"></div>\n        </div>\n        <div class="demo_icon"></div>\n        <div class="demo_duration">${formatTime(e.duration)}</div>\n        <img class="demo_country" src="${e.img_url}" />\n      </div>\n      <div class="demo_name">${e.name}</div>\n      <div class="demo_time">${e.create_at}</div>\n      ${i}\n    </div>\n    `})),$(".demo_box").html(t),$(".demo_item").on("click",(function(){const e=Number($(this).attr("data-index")),t=demoList[e];isMobileDevice()?mobileShowDemo(t,e):showDemo(e,t)})),$(".downicon").on("click",(function(e){e.stopPropagation();const t=Number($(this).attr("data-index"));demoDownload(demoList[t].video_url)}))}function mobileShowDemo(e,t){const a=document.getElementById("demoVideoEl_"+t);function i(){document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||(document.removeEventListener("fullscreenchange",i),document.removeEventListener("webkitfullscreenchange",i),document.removeEventListener("mozfullscreenchange",i),document.removeEventListener("MSFullscreenChange",i),a.pause())}a.play(),a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen(),document.addEventListener("fullscreenchange",i),document.addEventListener("webkitfullscreenchange",i),document.addEventListener("mozfullscreenchange",i),document.addEventListener("MSFullscreenChange",i)}async function isUseMin(){try{const e=await getReq(`${requesHost}/ai/user-usage/is-giveaway`);200===e.code?isUse=2==e.data.is_giveaway:401===e.code&&(localStorage.clear(),setCookie("refresh_token","",-1),setCookie("access_token","",-1),setCookie("user_info","",-1),location.reload())}catch(e){console.log(e)}}function changeUpgradeInfo(){let e,t,a,i,o;userinfo=header_credit.getCreditsData(),1!==userinfo?.is_credit_subscription&&(headMin=0),e=headMin<=1?document.body.clientWidth<=1200?videoTransText.m_head_min2.replace("%s",headMin):videoTransText.head_min2.replace("%s",headMin):document.body.clientWidth<=1200?videoTransText.m_head_min1.replace("%s",headMin):videoTransText.head_min1.replace("%s",headMin),$(".user_menu_item.list_credits").hide();const n=`\n\t\t<div class="video_tra_head_icon1"></div>\n\t\t<div class="video_tra_head_text">${e}</div>\n\t\t<div class="video_tra_head_icon2"></div>\n\t`;$(".credit-box .nav_title").html(n),$(".credit_des_q").text(videoTransText.head_min_q),$(".credit_des_a").text(videoTransText.head_min_a),1===userinfo?.is_credit_subscription?(gtag("event","show_videotranslate_probanner"),$(".upgrade_banner_item.item5").hide(),isUse?(t=videoTransText.head_min_title3,a=videoTransText.head_min_btn3,o=videoTransText.upgrade_btn_pro_use,i=videoTransText.upgrade_title_pro_use):(t=videoTransText.head_min_title2,a=videoTransText.head_min_btn2,o=videoTransText.upgrade_btn_pro_nouse,i=videoTransText.upgrade_title_pro_nouse),$(document.body).addClass("is_credit_subscription"),$(".upload_text .des").html(videoTransText.upload_des_ios_pro)):($(document.body).removeClass("is_credit_subscription"),$(".upload_text .des").html(videoTransText.upload_des_ios),gtag("event","show_videotranslate_freebanner"),$(".upgrade_banner_item.item5").show(),t=videoTransText.head_min_title1,a=videoTransText.head_min_btn1,o=videoTransText.upgrade_btn_free,i=videoTransText.upgrade_title_free);const s=getGiveAwayText(videoTransText.head_min_item3_one,videoTransText.head_min_item3),r=`\n\t\t\t<div class="credit_des_bg_title">${t}</div>\n\t\t\t<div class="credit_des_bg_item">\n          <div class="credit_des_bg_item">${videoTransText.head_min_item1}</div>\n          <div class="credit_des_bg_item">${videoTransText.head_min_item2}</div>\n          <div class="credit_des_bg_item">${s}</div>\n          <div class="credit_des_bg_item">${videoTransText.head_min_item4}</div>\n      </div>\n\t\t\t<a href="/pricing.html" id="videotranslate_pro" onclick="linkClick()" target="_blank" class="get_btn">${a}</a>\n\t`;$(".credit_des_bg_content").html(r),$(".upgrade_banner_title").text(i),$(".upgrade_banner_btn").text(o),document.body.clientWidth<=1200&&($(".header-credits-box .credit_des_bg").css({borderRadius:".34rem",background:"linear-gradient(111deg, #FFF6D9 0%, #FFEFE8 100%) 0% 0%"}),$("#m_list_credits").hide(),$(".credit_des_bg_icon").show(),$(".header-credits").html(n))}function linkClick(){1===userinfo?.is_credit_subscription?isUse?(gtag("event","click_videotranslate_progetbtnused"),setCookie("st","translator_progettimeused")):(gtag("event","click_videotranslate_progetbtn"),setCookie("st","translator_progettime")):(gtag("event","click_videotranslate_freegetbtn"),setCookie("st","translator_freegettime"))}function ToolTip(e){const{text:t="",type:a="",showtime:i=""}=e;$("body").append(`\n    <bottom-message\n      text="${t}"\n      type="${a}"\n      showtime="${i}"\n      >\n    </bottom-message>`)}function handleProofreadBar(e){let t=e.target.value/100;videoProof.currentTime=videoProof.duration*t,updateProgress()}function updateProgress(){const e=videoProof.currentTime/videoProof.duration*100||0;let t,a;a="tab1"===curTab?videoProof.duration?formatTime(videoProof.duration):formatTime(videoDuration1):videoProof.duration?formatTime(videoProof.duration):formatTime(videoDuration2),t=formatTime(videoProof.currentTime),hasHH(a)&&!hasHH(t)&&(t="00:"+t),$(".duration_show").html(`${t}/${a}`),progressbar.style.backgroundSize=`${e}% 100%`,progressbar.value=e}function handleVoiceBar(e){$(".voice_num").html(Math.round(e.target.value)),videoProof.volume=e.target.value/100,voicebar.style.backgroundSize=`${e.target.value}% 100%`}function getGiveAwayText(e,t){let a;return a=giveawayMin<=1?e.replace("%s",giveawayMin):t.replace("%s",giveawayMin),a}async function initPage(e){ableSelect(!1),$("#origin_lan").attr("placeholder",videoTransText.original_lan),await getT(),e&&(await getContry(),ableClick(),isVideoClick(),proofreadClick(),$(".home-header .appsigninbtn").attr("product-position","isTool-no-reloading"),isMobileDevice()&&isIOSBelowx(15)&&$(".proofread_content").css("paddingBottom","3rem"),(isSafari()||isIOS()||isMacOS())&&($(".video_upload_input").attr("accept",".m4v, .mp4, .mov"),$(".upload_text .des").html(videoTransText.upload_des_ios)),$("#Login").click((()=>{gtag("event","login_videotranslate_header")})),$("#SignUp").click((()=>{gtag("event","signup_videotranslate_header")})),$(".signupfootbtn").attr("onclick",'gtag("event", "signup_videotranslate_footer")')),(curUploadFile||curYoutubeFile)&&isTimeIconShow(),(uploadVideoRes||youtubeVideoRes)&&isTimeIconShow();const t=getGiveAwayText(videoTransText.upgrade_item3_one,videoTransText.upgrade_item3);$(".upgrade_banner_item.item3").text(t),curToken=getCookie("access_token")||"",curToken?(await isUseMin(),$(".head-portrait .appsigninbtn").click((function(e){e.stopPropagation(),e.preventDefault()})),changeUpgradeInfo()):gtag("event","open_videotranslate_page"),1===userinfo?.is_credit_subscription||translateUseLimit>0?$(".upgrade_banner").show():$(".upgrade_banner").hide(),ableSelect(!0)}async function setHoverInfoTime(e){1!==e?.is_credit_subscription?("1"==defaultIsVideo?"T1"===contryT?($(".info_time").text(videoTransText.video_timeT1),$(".tip_time").text(videoTransText.video_timeT1)):"T2"===contryT?($(".info_time").text(videoTransText.video_timeT2),$(".tip_time").text(videoTransText.video_timeT2)):($(".info_time").text(videoTransText.video_timeT3),$(".tip_time").text(videoTransText.video_timeT3)):"T1"===contryT?($(".info_time").text(videoTransText.audio_timeT1),$(".tip_time").text(videoTransText.audio_timeT1)):"T2"===contryT?($(".info_time").text(videoTransText.audio_timeT2),$(".tip_time").text(videoTransText.audio_timeT2)):($(".info_time").text(videoTransText.audio_timeT3),$(".tip_time").text(videoTransText.audio_timeT3)),$("#free_show").show()):($(".tip").hide(),translateUseLimit<translateLimit?$("#free_show").show():$("#free_show").hide(),$("#p_free_show").hide())}$((function(){ableSelect(!1),$(".demo_video").hide(),(isSafari()||isIOS()||isMacOS())&&($(".video_upload_input").attr("accept",".m4v, .mp4, .mov"),$(".upload_text .des").html(videoTransText.upload_des_ios)),document.querySelector("header-credit").addEventListener("creditsLoad",(function(){initPage(!0)}),{once:!0})})),$((function(){if(window.videoDom=document.querySelector("#pre_video"),window.videoLargeDom=document.querySelector("#large_video"),window.videoDemo=document.querySelector("#demo_video"),window.videoPre=document.querySelector(".pre_img"),window.videoProof=document.querySelector(".proofread_video"),window.progressbar=document.querySelector(".progressbar"),window.voicebar=document.querySelector(".voicebar"),getUserinfo().then((e=>{contryT=e.county_type,setHoverInfoTime(e),userinfo=e})),$("#header_login").click((()=>{gtag("event","login_videotranslate_header")})),$("#header_user>.signout").click((()=>{gtag("event","click_videotranslate_profileoutbtn")})),$("#header_user").on("mouseenter",(()=>{gtag("event","show_videotranslate_profilepop")})),$(".signout").click((()=>{setTimeout((()=>{location.reload()}),50)})),progressbar.addEventListener("input",(function(e){handleProofreadBar(e)})),voicebar.addEventListener("input",(function(e){e.stopPropagation(),handleVoiceBar(e)}),!1),videoProof.addEventListener("timeupdate",(function(){updateProgress()})),videoProof.addEventListener("ended",(function(){$(".playpause_box").removeClass("pause")})),videoDom.addEventListener("click",(function(){videoDom.paused||(videoDom.pause(),$(".play_btn").show())})),videoDom.addEventListener("ended",(function(){videoDom.currentTime=0,$(".play_btn").show()})),videoDom.addEventListener("waiting",(function(){$(".video_loading_icon").show(),videoDom.onprogress=function(){if(videoDom.buffered.length>0){videoDom.buffered.end(0)-videoDom.currentTime>1&&$(".video_loading_icon").hide()}}})),videoDom.addEventListener("playing",(function(){$(".video_loading_icon").hide()})),isMobileDevice()){function e(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}function t(){document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||(videoDom.pause(),videoPre.pause())}document.addEventListener("fullscreenchange",t),document.addEventListener("webkitfullscreenchange",t),document.addEventListener("mozfullscreenchange",t),document.addEventListener("MSFullscreenChange",t),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState||(videoDom.pause(),videoPre.pause())})),videoDom.setAttribute("controls","controls"),videoPre.setAttribute("controls","controls"),videoDom.addEventListener("play",(function(){$(".play_btn").hide(),e(videoDom)})),videoDom.addEventListener("pause",(function(){$(".play_btn").show()})),videoPre.addEventListener("pause",(function(){$(".play_btn1").show()})),videoPre.addEventListener("play",(function(){$(".play_btn1").hide(),e(videoPre)}))}videoPre.addEventListener("click",(function(){videoPre.paused||(videoPre.pause(),$(".play_btn1").show())})),videoPre.addEventListener("ended",(function(){videoPre.currentTime=0,$(".play_btn1").show()})),videoLargeDom.addEventListener("click",(function(){videoLargeDom.paused||(videoLargeDom.pause(),$(".large_play_icon").show())})),videoLargeDom.addEventListener("ended",(function(){videoLargeDom.currentTime=0,$(".large_play_icon").show()})),videoLargeDom.addEventListener("waiting",(function(){$(".largeVideo_loading_icon").show(),videoLargeDom.onprogress=function(){if(videoLargeDom.buffered.length>0){videoLargeDom.buffered.end(0)-videoLargeDom.currentTime>1&&$(".largeVideo_loading_icon").hide()}}})),videoLargeDom.addEventListener("playing",(function(){$(".largeVideo_loading_icon").hide()})),videoDemo.addEventListener("click",(function(){videoDemo.paused||(videoDemo.pause(),$(".demo_play_icon").show())})),videoDemo.addEventListener("ended",(function(){videoDemo.currentTime=0,$(".demo_play_icon").show()})),$(".play_btn").on("click",(function(){if(videoDom.paused){if(videoDom.play(),isMobileDevice()){let e=videoDom;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}$(this).hide()}})),$(".play_btn1").on("click",(function(){videoPre.paused&&(videoPre.play(),$(this).hide())})),$(".large_play_icon").on("click",(function(){videoLargeDom.paused&&(videoLargeDom.play(),$(this).hide())})),$(".demo_play_icon").on("click",(function(){gtag("event","play_videotranslate_demo"),videoDemo.paused&&(videoDemo.play(),$(this).hide())}));const a=$(".video_upload_input");a.on("change",(function(e){uploadFile(a[0].files[0]),setTimeout((()=>{a[0].value=""}),500)})),$(".step_src_none, .step_src_style1").on("click",(function(){gtag("event","click_videotranslate_upload"),a.click()})),$(".tra_box.step1").on("dragover",(e=>{e.preventDefault(),e.stopPropagation()})),$(".step_src_none, .step_src_style1").on("dragover",(e=>{e.preventDefault(),e.stopPropagation(),$(".tra_box.step1").addClass("drag")})),$(".step_src_none, .step_src_style1").on("dragleave",(function(e){e.preventDefault(),e.stopPropagation(),$(".tra_box.step1").removeClass("drag")})),$(".step_src_none, .step_src_style1").on("drop",(function(e){if(e.preventDefault(),e.stopPropagation(),gtag("event","drag_videotranslate_upload"),$(".tra_box.step1").removeClass("drag"),e.originalEvent.dataTransfer.files.length>1)return void showFailed("only_one_drag");uploadFile(e.originalEvent.dataTransfer.files[0])})),$(".step_tab").on("click",(function(){if($(".step_tab").removeClass("active"),$(".step1").removeClass("youtube active1 active2"),$(".translate_btn").removeClass("active"),$(this).addClass("active"),$(this).hasClass("tab1")){if(gtag("event","click_videotranslate_videotab"),$(".step1").removeClass("youtube"),curTab="tab1",$(".play_btn").hide(),$(".play_btn1").hide(),youtubeVideoRes&&(videoDom.duration=0,videoDom.pause()),curYoutubeFile&&(videoPre.duration=0,videoPre.pause()),uploadVideoRes&&!isFileChange){let e=getTranslateText("btn_credit",{val:getMins(videoDuration1)<1?1:getMins(videoDuration1)},!0);videoDom.duration=0,videoDom.pause(),isTimeIconShow(),$("#pre_video").attr("src",uploadVideoRes.additional_data.video_url),$("#pre_video").attr("poster",uploadVideoRes.additional_data.cover_url),$("#large_video").attr("src",uploadVideoRes.additional_data.video_url),$("#large_video").attr("poster",uploadVideoRes.additional_data.cover_url),$(".play_btn").show(),$(".time_text").text(e),$(".pre_img").attr("src",tab_url1),$(".pre_img").attr("poster",tab_image1),$(".step_src_style1 .small_img").attr("src",tab_image1),$(".step_src_style1 .video_info_title").text(curUploadFile.name),$(".step_src_style1 .video_info_duration").text(videoTransText.video_info_duration.replace("%s",formatTime(videoDuration1))),$(".tra_box.step1").addClass("active1"),$(".tra_left").removeClass("genertor upload translate").addClass("translate"),tab1_defaultOriginLan.key?$(".translate_btn").addClass("active"):$(".translate_btn").removeClass("active")}else if(curUploadFile){let e=getTranslateText("btn_credit",{val:getMins(videoDuration1)<1?1:getMins(videoDuration1)},!0);isTimeIconShow(),$(".play_btn1").show(),$(".time_text").text(e),$(".pre_img").attr("src",tab_url1),$(".pre_img").attr("poster",tab_image1),$(".step_src_style1 .small_img").attr("src",tab_image1),$(".step_src_style1 .video_info_title").text(curUploadFile.name),$(".step_src_style1 .video_info_duration").text(videoTransText.video_info_duration.replace("%s",formatTime(videoDuration1))),$(".tra_box.step1").addClass("active1"),$(".tra_left").removeClass("genertor upload translate").addClass("upload"),tab1_defaultOriginLan.key?$(".translate_btn").addClass("active"):$(".translate_btn").removeClass("active")}else $(".play_btn1").hide(),$(".translate_btn").removeClass("active"),$(".tra_box.step1").removeClass("active1"),$(".tra_left").removeClass("genertor upload translate"),$(".time_icon_box").removeClass("active"),translateUseLimit<translateLimit||1!==userinfo?.is_credit_subscription?$("#free_show").show():$("#free_show").hide();clearListitemActive(document.querySelector(".select_box.selectContry").querySelectorAll(".select_item")),$(`[data-name="${tab1_defaultCountry.country_name}"]`).addClass("active"),setDefaultCountryInfo({flag:null,text:tab1_defaultOriginLan.name,className:"origin_contry"}),setDefaultCountryInfo({flag:tab1_defaultCountry.img_url,text:tab1_defaultCountry.country_name,className:"contry_name"})}else{if(gtag("event","click_videotranslate_urltab"),$(".step1").addClass("youtube"),curTab="tab2",$(".play_btn").hide(),$(".play_btn1").hide(),uploadVideoRes&&(videoDom.duration=0,videoDom.pause()),curUploadFile&&(videoPre.duration=0,videoPre.pause()),youtubeVideoRes&&!isYoutubeFileChange){let e=getTranslateText("btn_credit",{val:getMins(videoDuration2)<1?1:getMins(videoDuration2)},!0);isTimeIconShow(),$("#pre_video").attr("src",youtubeVideoRes.additional_data.video_url),$("#pre_video").attr("poster",youtubeVideoRes.additional_data.cover_url),$("#large_video").attr("src",youtubeVideoRes.additional_data.video_url),$("#large_video").attr("poster",youtubeVideoRes.additional_data.cover_url),$(".play_btn").show(),$(".time_text").text(e),$(".pre_img").attr("src",tab_url2),$(".pre_img").attr("poster",tab_image2),$(".step_src_style2 .small_img").attr("src",tab_image2),$(".step_src_style2 .video_info_title").text(curYoutubeFile.name),$(".step_src_style2 .video_info_duration").text(videoTransText.video_info_duration.replace("%s",formatTime(videoDuration2))),$(".tra_box.step1").addClass("active2").removeClass("youtube"),$(".tra_left").removeClass("genertor upload translate").addClass("translate"),tab2_defaultOriginLan.key?$(".translate_btn").addClass("active"):$(".translate_btn").removeClass("active")}else if(curYoutubeFile){let e=getTranslateText("btn_credit",{val:getMins(videoDuration2)<1?1:getMins(videoDuration2)},!0);isTimeIconShow(),$(".play_btn1").show(),$(".time_text").text(e),$(".pre_img").attr("src",tab_url2),$(".pre_img").attr("poster",tab_image2),$(".step_src_style2 .small_img").attr("src",tab_image2),$(".step_src_style2 .video_info_title").text(tab_fileName2),$(".step_src_style2 .video_info_duration").text(videoTransText.video_info_duration.replace("%s",formatTime(videoDuration2))),$(".tra_box.step1").addClass("active2").removeClass("youtube"),$(".tra_left").removeClass("genertor upload translate").addClass("upload"),tab2_defaultOriginLan.key?$(".translate_btn").addClass("active"):$(".translate_btn").removeClass("active")}else $(".play_btn1").hide(),$(".tra_box.step1").removeClass("active"),$(".translate_btn").removeClass("active2"),$(".tra_left").removeClass("genertor upload translate"),$(".time_icon_box").removeClass("active"),translateUseLimit<translateLimit||1!==userinfo?.is_credit_subscription?$("#free_show").show():$("#free_show").hide();clearListitemActive(document.querySelector(".select_box.selectContry").querySelectorAll(".select_item")),$(`[data-name="${tab2_defaultCountry.country_name}"]`).addClass("active"),setDefaultCountryInfo({flag:null,text:tab2_defaultOriginLan.name,className:"origin_contry"}),setDefaultCountryInfo({flag:tab2_defaultCountry.img_url,text:tab2_defaultCountry.country_name,className:"contry_name"})}})),$(".back_icon").on("click",(function(){gtag("event","back_videotranslate_script"),closeProofread()})),$(".playpause_box").on("click",(function(e){$(".playpause_box").hasClass("pause")?($(".playpause_box").removeClass("pause"),videoProof.pause()):($(".playpause_box").addClass("pause"),videoProof.play())})),$(".voice_icon").on("click",(function(e){e.stopPropagation(),$(".voice_box").hasClass("active")?$(".voice_box").removeClass("active"):$(".voice_box").addClass("active")})),$(".input_url").on("input",(function(e){const t=e.target.value.trim();t?($(".input_box").addClass("oninput"),youtubeUrl=t):$(".input_box").removeClass("oninput")})),$(".delete_icon").on("click",(function(e){e.stopPropagation(),$(".step1").removeClass("active1 active2"),$(".translate_btn").removeClass("active"),$(".pre_img").attr("src",""),$(".pre_img").attr("poster",""),$(".play_btn1").hide(),$("#pre_video").attr("src",""),$(".tra_left").removeClass("genertor upload translate"),$(".time_icon_box").removeClass("active"),1!==userinfo?.is_credit_subscription?$("#free_show").show():$("#free_show").hide(),"tab1"===curTab?(videoDuration1="",tab_image1="",tab_url1="",curUploadFile="",uploadVideoRes="",tab1_orVideo_script=[],tab1_taVideo_script=[],tab1_edit_orVideo_script=[],tab1_edit_taVideo_script=[],tab1_currentVal="",tab1_originVal="",tab1_targetVal="",tab1_choose_country=null,$("step_src_style1 .small_img").attr("src","")):(videoDuration2="",tab_image2="",tab_url2="",curYoutubeFile="",youtubeVideoRes="",tab2_orVideo_script=[],tab2_taVideo_script=[],tab2_edit_orVideo_script=[],tab2_edit_taVideo_script=[],tab2_currentVal="",tab2_originVal="",tab2_targetVal="",tab2_choose_country=null,$(".input_url").val(""),$("step_src_style2 .small_img").attr("src",""),$(".step1").addClass("youtube"),$(".input_box").removeClass("oninput"))})),$(".get_url_icon").on("click",(function(){gtag("event","click_videotranslate_urlparse"),getYoutubeVideoTask(youtubeUrl)})),$(".upgrade_banner_btn").on("click",(function(){1===userinfo?.is_credit_subscription?isUse?(gtag("event","click_videotranslate_probannerused"),setCookie("st","translator_probannerused")):(gtag("event","click_videotranslate_probanner"),setCookie("st","translator_probanner")):(gtag("event","click_videotranslate_freebanner"),setCookie("st","translator_freebanner"))})),$(".select_contry").on("click",(function(){if(!$(this).hasClass("select_contry1"))if($(this).hasClass("active"))$(this).removeClass("active");else if($(this).addClass("active"),$(this).hasClass("select_contry")){document.querySelector(".select_box.selectContry").querySelectorAll(".select_item").forEach((e=>{const t=e.querySelector(".contry_name");t.scrollWidth>t.clientWidth?e.setAttribute("title",e.textContent.trim()):e.removeAttribute("title")}))}})),$(".original_lan").on("click",(function(){$(".select_contry1").hasClass("active")?($("#origin_lan").blur(),$(".select_contry1").removeClass("active")):$("#origin_lan").focus()})),$("#origin_lan").on("focus",(function(){$(".select_contry1").addClass("active");const e=$("#origin_lan").val().toLowerCase(),t=originalLanList?.filter((t=>t.name.toLowerCase().includes(e)));let a;a="tab1"===curTab?tab1_defaultOriginLan:tab2_defaultOriginLan,0===t?.length?($("#origin_lan").val(""),renderOriginLanList(originalLanList)):renderOriginLanList(a?.key?originalLanList:t)})),$("#origin_lan").on("input",(function(e){$(".translate_btn").removeClass("active");const t=e.target.value.trim().toLowerCase(),a=originalLanList?.filter((e=>e.name.toLowerCase().includes(t)));renderOriginLanList(a),"tab1"===curTab?(tab1_defaultOriginLan={key:"",name:""},tab1_edit_taVideo_script=[]):(tab2_defaultOriginLan={key:"",name:""},tab2_edit_taVideo_script=[])})),$(".dialog_content .close_icon").on("click",(function(){$(".dialog_mask").removeClass("show"),$(".dialog_content").removeClass("show"),videoLargeDom.pause(),videoLargeDom.currentTime=0,$(".large_play_icon").show()})),$(".suc_btn, .tip_close_icon").on("click",(function(){closeTip()})),$(".btn.zoom").on("click",(function(){gtag("event","zoomin_videotranslate_res"),showLarge()})),$(".btn_edit").on("click",(function(){$(".btn.download_video, .btn_download, .click_download").addClass("pointer_none"),toEdit()})),$(".btn.share, .btn_share").on("click",(function(){gtag("event","share_videotranslate_res"),videoDom.pause(),$(".play_btn").show(),videoLargeDom.pause(),videoLargeDom.currentTime=0,$(".large_play_icon").show(),shareDialogEl.changeTips({content:videoTransText.shareTitle});const e="tab1"===curTab?uploadVideoRes:youtubeVideoRes,t="tab1"===curTab?upload_task_id:youtube_task_id;shareDialogEl.showShare({url:e.additional_data.video_url,action:"videotranslateshare",imageKey:e.additional_data.cover_key,videoKey:e.additional_data.video_key,poster:e.additional_data.cover_url,text:videoTransText.shareText,title:videoTransText.shareTitle,task_id:t,id:t,backParams:function(e=[]){return{id:t,key:e.video_key,action:"credit_video_translate"}}})})),$(".btn.download_video, .btn_download, .click_download").on("click",(function(){gtag("event","download_videotranslate_res"),setCookie("st2","dlvideotranslate"),curToken=getCookie("access_token")||"";const e="tab1"===curTab?upload_task_id:youtube_task_id;isBlank(curToken)?(gtag("event","alert_videotranslate_dwlogin"),showLoginWindow({wait:[e],fn:(e=null)=>{e&&("tab1"===curTab?translateDownloadData=e:translateDownloadDataY=e),initPage()}})):($(".btn.download_video, .btn_download, .click_download").addClass("downDisabled"),$(".btn_edit").addClass("pointer_none"),handleDownload())})),$(".demo_download").on("click",(function(e){e.stopPropagation();const t=Number($("#demo_video").attr("data-index"));demoDownload(demoList[t].video_url)})),$(".demo_share").on("click",(function(){gtag("event","share_videotranslate_demo");const e=Number($("#demo_video").attr("data-index")),t=demoList[e];try{const e=t.video_url,a=document.createElement("input");a.value=e,document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a),$("body").append(`\n    <bottom-message\n      text="${videoTransText.copy_suc}"\n      type=""\n      showtime=""\n      >\n    </bottom-message>`)}catch(e){$("body").append(`\n    <bottom-message\n      text="${videoTransText.copy_fail}"\n      type=""\n      showtime=""\n      >\n    </bottom-message>`)}})),$(".demo_close").on("click",(function(){closeDemo()})),$(".next_btn").on("click",(function(){$(".pre_btn").show();const e=Number($("#demo_video").attr("data-index"));e+1>=demoList.length-1&&$(this).hide();const t=demoList[e+1];t&&($(".demo_dialog_name").text(t.name),$("#demo_video").attr("poster",t.cover_url),$("#demo_video").attr("src",t.video_url),$("#demo_video").attr("data-index",e+1),$(".demo_play_icon").show())})),$(".pre_btn").on("click",(function(){$(".next_btn").show();const e=Number($("#demo_video").attr("data-index"));e-1<=0&&$(this).hide();const t=demoList[e-1];t&&($(".demo_dialog_name").text(t.name),$("#demo_video").attr("poster",t.cover_url),$("#demo_video").attr("src",t.video_url),$("#demo_video").attr("data-index",e-1),$(".demo_play_icon").show())})),$(".translate_btn, .proofread_translate_btn").on("click",(function(){$(this).hasClass("proofread_translate_btn")?translateVideo(!0):translateVideo()})),$(".info").on("mouseenter",(function(){gtag("event","show_videotranslate_tip")})),$(".info_choose6").on("click",(function(){$(".info_choose1").removeClass("info_box_click"),$(".info_choose2").removeClass("info_box_click"),$(".info_choose3").removeClass("info_box_click"),$(".info_choose4").removeClass("info_box_click"),$(".info_choose5").removeClass("info_box_click"),isMobileDevice()&&(gtag("event","show_videotranslate_tip"),$(".info_choose6").addClass("info_box_click"))})),$(".info_choose5").on("click",(function(){$(".info_choose1").removeClass("info_box_click"),$(".info_choose2").removeClass("info_box_click"),$(".info_choose3").removeClass("info_box_click"),$(".info_choose4").removeClass("info_box_click"),$(".info_choose6").removeClass("info_box_click"),isMobileDevice()&&(gtag("event","show_videotranslate_tip"),$(".info_choose5").addClass("info_box_click"))})),$(".info_choose4").on("click",(function(){$(".info_choose1").removeClass("info_box_click"),$(".info_choose2").removeClass("info_box_click"),$(".info_choose3").removeClass("info_box_click"),$(".info_choose6").removeClass("info_box_click"),$(".info_choose5").removeClass("info_box_click"),isMobileDevice()&&(gtag("event","show_videotranslate_tip"),$(".info_choose4").addClass("info_box_click"))})),$(".info_choose3").on("click",(function(){$(".info_choose1").removeClass("info_box_click"),$(".info_choose2").removeClass("info_box_click"),$(".info_choose6").removeClass("info_box_click"),$(".info_choose4").removeClass("info_box_click"),$(".info_choose5").removeClass("info_box_click"),isMobileDevice()&&(gtag("event","show_videotranslate_tip"),$(".info_choose3").addClass("info_box_click"))})),$(".info_choose2").on("click",(function(){$(".info_choose1").removeClass("info_box_click"),$(".info_choose6").removeClass("info_box_click"),$(".info_choose3").removeClass("info_box_click"),$(".info_choose4").removeClass("info_box_click"),$(".info_choose5").removeClass("info_box_click"),isMobileDevice()&&(gtag("event","show_videotranslate_tip"),$(".info_choose2").addClass("info_box_click"))})),$(".info_choose2_1").on("click",(function(){isMobileDevice()&&(gtag("event","show_videotranslate_tip"),$(".info_choose2_1").addClass("info_box_click"))}))})),$((function(){document.querySelector("my-component").addEventListener("loginsuccess",(function(){initPage(),getUserinfo().then((e=>{contryT=e.county_type,setHoverInfoTime(e)}))}))})),window.addEventListener("googleonetopsuccess",(function(){initPage()})),document.addEventListener("mouseup",(e=>{let t=document.querySelector(".select_contry1"),a=document.querySelector(".select_contry2"),i=document.querySelector(".voice_set");if(t&&!t.contains(e.target)){$(".select_contry1").removeClass("active");const e=$("#origin_lan").val().trim().toLowerCase(),t=originalLanList?.find((t=>t.name.toLowerCase()==e));t&&("tab1"===curTab?tab1_defaultOriginLan=t:tab2_defaultOriginLan=t,renderOriginLanList(originalLanList),setDefaultCountryInfo({flag:null,text:t.name,className:"origin_contry"}))}a&&!a.contains(e.target)&&$(".select_contry2").removeClass("active"),i&&!i.contains(e.target)&&$(".voice_box ").removeClass("active")}),!1),document.addEventListener("touchstart",(e=>{$(".info_choose3").removeClass("info_box_click"),$(".info_choose2").removeClass("info_box_click"),$(".info_choose2_1").removeClass("info_box_click"),$(".info_choose4").removeClass("info_box_click"),$(".info_choose5").removeClass("info_box_click"),$(".info_choose6").removeClass("info_box_click")}));class CustomSwiperOne{constructor({container:e="",children:t=""}){this.container=e,this.children=t,this.swiperItemIndex=0,this.init()}init(){this.containerDom=document.querySelector(this.container),this.containerItemDom=this.containerDom.querySelectorAll(this.children),this.containerItemLen=this.containerItemDom.length,this.render()}render(){let e='<div class="swiper__dots">';for(let t=0;t<this.containerItemLen;t++){const a=this.containerItemDom[t];a.style.left=100*t+"%";let i="";0===t&&(i="active"),e+=`<span class="swiper__dots-item ${i}" data-i="${t}"></span>`,this.moveItemByTouch(a)}this.containerDom.insertAdjacentHTML("beforeend",e),this.dotsClick()}clearDotActive(){for(let e=0;e<this.dotsItem.length;e++){this.dotsItem[e].classList.remove("active")}}dotAddActive(){for(let e=0;e<this.dotsItem.length;e++){const t=this.dotsItem[e];t.classList.remove("active"),e===this.swiperItemIndex&&t.classList.add("active")}}dotsClick(){this.dotsItem=this.containerDom.querySelectorAll(".swiper__dots-item");for(let e=0;e<this.dotsItem.length;e++){const t=this.dotsItem[e];t.onclick=()=>{this.clearDotActive(),this.moveSwiperItem(t.dataset.i),t.classList.add("active")}}}moveSwiperItem(e=0){const t=e-this.swiperItemIndex;for(let e=0;e<this.containerItemLen;e++){const a=this.containerItemDom[e];let i=parseInt(a.style.left);i-=100*t,a.style.left=`${i}%`}this.swiperItemIndex=e,this.dotAddActive()}moveItemByTouch(e=null){if(!e)return;let t,a,i,o;e.addEventListener("touchstart",(function(e){t=e.touches[0].clientX,a=e.touches[0].clientY}),!1),e.addEventListener("touchmove",(function(e){if(!t||!a)return;i=e.touches[0].clientX-t,o=e.touches[0].clientY-a,Math.abs(i)>Math.abs(o)&&e.preventDefault()}),!1),e.addEventListener("touchend",(()=>{if(Math.abs(i)>50){let e=this.swiperItemIndex;i>0?(this.swiperItemIndex<=0?e=0:e--,this.handleSwiperItem(e)):i<0&&(this.swiperItemIndex>=this.containerItemLen-1?e=this.containerItemLen-1:e++,this.handleSwiperItem(e))}t=null,a=null,i=0,o=0}),!1)}handleSwiperItem(e){this.moveSwiperItem(e)}}const faqsTranslatorItems=document.querySelectorAll(".faqs__translator_item");function faqsTranslatorItemsClick(){for(let e=0;e<faqsTranslatorItems.length;e++){const t=faqsTranslatorItems[e],a=t.querySelector(".faqs__translator_item-header"),i=t.querySelector(".faqs__translator_item-body");a.onclick=()=>{const e="0px"===i.style.maxHeight||""===i.style.maxHeight;i.style.maxHeight=e?i.scrollHeight+"px":"0",e?a.classList.add("show"):a.classList.remove("show")}}}const MaximizePcBoxsHeader=document.querySelectorAll(".Maximize_pc_boxs_header"),MaximizePcBoxsLi=document.querySelectorAll(".Maximize_pc_boxs_li");function clearMaximizePcBoxsLiAcive(){for(let e=0;e<MaximizePcBoxsLi.length;e++){const t=MaximizePcBoxsLi[e];t.classList.remove("active");t.querySelector(".Maximize_pc_boxs_ceontent").style.maxHeight=0}}function MaximizePcBoxsHeaderClick(){const e=document.querySelectorAll(".Maximize_pc_boxs_img img");function t(){for(let t=0;t<e.length;t++){e[t].style.display="none"}}for(let a=0;a<MaximizePcBoxsHeader.length;a++){const i=MaximizePcBoxsHeader[a],o=i.nextElementSibling;0===a&&(o.style.maxHeight=o.scrollHeight+"px"),i.onclick=function(){t(),e[a].style.display="block",e[a].animate([{transform:"scale(0.8)",opacity:0},{transform:"scale(1)",opacity:1}],{duration:300,easing:"cubic-bezier(0.2, 0, 0.2, 1)"});("0px"===o.style.maxHeight||""===o.style.maxHeight)&&(clearMaximizePcBoxsLiAcive(),this.parentNode.classList.add("active"),o.style.maxHeight=o.scrollHeight+"px")}}}let lock=!1;function hideFlags(){let e=document.querySelectorAll(".country__flags_boxs-item"),t=document.querySelector(".country__flags_showOrHide");function a(t="hide"){if(e=Array.from(e),"hide"===t){const t=e.slice(15);for(let e=0;e<t.length;e++){t[e].style.display="none"}}else if("show"===t)for(let t=0;t<e.length;t++){e[t].style.display="flex"}}a(),t.onclick=()=>{lock?(a(),lock=!1,t.innerHTML=videoTransText.seeAllLangauges,document.querySelector(".country__flags").scrollIntoView()):(a("show"),lock=!0,t.innerHTML=videoTransText.goBack)};for(let t=0;t<e.length;t++){const a=e[t];a.onclick=()=>{document.querySelector(`[data-name="${(a?.textContent||"").trim()}"]`).click();document.querySelector(".select_contry").classList.remove("active"),window.scrollTo(0,0),gtag("event","upclick_videotranslate_chooselang")}}}const renderCountryHTML=(e=[])=>{const t=document.querySelector(".country__flags_boxs");let a="";for(let t=0;t<e.length;t++){const i=e[t];a+=`<div class="country__flags_boxs-item">\n        <img src="${i.img_url}" />\n        <span>${i.country_name}</span>\n      </div>`}t.innerHTML="",t.insertAdjacentHTML("beforeend",a),hideFlags()},initScrollBarPos=()=>{const e=document.querySelector(".recommende__article_swiper .swiper-wrapper");e&&e.scrollTo(300,0)};function showLoginWindow(e={}){const{fn:t=()=>{},productName:a="ai",isReloading:i=!1,wait:o=null}=e;$("my-component").off("loginsuccess").on("loginsuccess",(function(e){e?.detail?t(e.detail):t(),chatLogin()})),localStorage.setItem("loginProductName",a),i?localStorage.setItem("toolsPosition",i):localStorage.setItem("toolsPosition","false"),$("my-component").length&&$("my-component")[0].showLoginDialog(o)}$((function(){faqsTranslatorItemsClick(),MaximizePcBoxsHeaderClick()}));