$(document).ready((function(){const t=jsonData.creditHistory.javascript;function e(t){$(".history_content").removeClass("payment credit record"),"payment"===t?$(".history_content").addClass("payment"):"credit"===t?$(".history_content").addClass("credit"):"record"===t&&$(".history_content").addClass("record")}function n(t){const e=new Date(1e3*t);return`${e.getFullYear()}/${String(e.getMonth()+1).padStart(2,"0")}/${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`}function c(t){"payment"==t&&w?i(s):"credit"==t&&g&&o(r)}async function i(c){if(!p){p=!0;try{const i=await fetchGet(`api/sockpuppet-credits/payments?page=${c||""}`);if(200===i.code){const{data:c}=i;c.page?(w=!0,s=c.page):w=!1,u=[...u,...c.list];const o=u.find((t=>"ai-sockpuppet-credits-subscription"===t.product));d=o;for(const t of u)if(t.id===o.id){t.cancel=!0;break}l=c.next_subscription_status?1:0,u.length?function(c){if(!c.length)return;let i="";c.forEach((e=>{let c,o=t.paid;2==e.pay_status&&(o=t.unpaid),c="ai-sockpuppet-credits-disposable"==e.product?`${formatter.format(e.credit)} ${t.credits}`:1==e.num?t.type1:6==e.num?t.type2:12==e.num?t.type3:t.unknown,e.cancel&&l&&window.gtagClick("show_credithistory_cancel"),i+=`\n          <div class="list_item">\n            <div class="pay_info_l">\n              <div class="pay_type">${c}</div>\n              <div class="date_no">\n                <span class="date">${n(e.created_at)}</span>\n                <span class="no">${t.trID} ${e.order_no}</span>\n                ${e.cancel&&l?`<span class="cancel_btn">${t.cancel}</span>`:""}\n                ${e.cancel?`<a target="_blank" href=/ai-tool-pricing.html?st=creditrenew&renew=1 class="renew_btn" style="${e.cancel&&!l?"":"display: none;"}">${t.renew}</a>`:""}\n              </div>\n            </div>\n            <div class="pay_info_r">\n              <div class="pay_state">${o}</div>\n              <div class="pay_price">${e.symbol}${e.price}</div>\n            </div>\n          </div>\n        `})),$(".payment_list").append(i),$(".cancel_btn").on("click",(function(){const t=1e3*d.created_at;$(".dis_subtime").text(function(t,e){const n=new Date(t),c={year:"numeric",month:"long",day:"numeric"};n.setMonth(n.getMonth()+e);return new Intl.DateTimeFormat(localeArea[getPreferredLanguage()],c).format(n)}(t,d.num)),a("confirm"),window.gtagClick("click_credithistory_cancel")})),$(".renew_btn").on("click",(function(){setSessionCookie("st","creditrenew"),window.gtagClick("click_credithistory_renew")})),e("payment")}(c.list):e("record")}}catch(t){console.log(t)}finally{p=!1}}}async function o(c){if(!_){_=!0;try{const i=await fetchGet(`api/sockpuppet-credits?page=${c||""}`);if(200===i.code){const{data:c}=i;c.page?(g=!0,r=c.page):g=!1,y=[...y,...c.list],y.length?function(e){if(!e.length)return;let c="";e.forEach((e=>{let i;21==e.type?i=t.type4:20==e.type?i=t.type5:14==e.type?i=t.type13:22==e.type||23==e.type?i=t.type14:10==e.type?"ai-sockpuppet-credits-subscription"==e.project.type?1==e.project.num?i=t.type6:6==e.project.num?i=t.type7:12==e.project.num&&(i=t.type8):i=t.type9:i=100==e.type?t.type10:13==e.type?t.type11:11==e.type?t.type12:12==e.type||121==e.type?t.type15:t.other,c+=`\n        <div class="list_item">\n          <div class="use_info_l">\n            <div class="use_type">${i}</div>\n            <div class="use_date">${n(e.created_at)}</div>\n          </div>\n          <div class="use_info_r">\n            <div class="use_num"><span class="credit_change">${String(e.credit).includes("-")?e.credit:`+${e.credit}`}</span> ${1==e.credit||-1==e.credit?t.credit:t.credits}</div>\n          </div>\n        </div>\n      `})),$(".credit_list").append(c)}(c.list):e("record")}}catch(t){console.log(t)}finally{_=!1}}}function a(t){switch($(".dialog_pay_mask").addClass("show"),$(".cancel_dialog").removeClass("showconfirm showsuc showerr"),t){case"confirm":$(".cancel_dialog").addClass("showconfirm"),window.gtagClick("show_credithistory_cancelpop");break;case"suc":$(".cancel_dialog").addClass("showsuc"),window.gtagClick("show_credithistory_cancelsucc");break;case"fail":$(".cancel_dialog").addClass("showerr"),window.gtagClick("show_credithistory_cancelfail")}}let s,r,d,l,p=!1,_=!1,u=[],y=[],w=!1,g=!1,h={};initLoginProducts();const f=setInterval((function(){$("login-user")?.[0]?.creditInfo?.countrycode&&(h=$("login-user")[0].creditInfo,$(".credits_num").text(formatter.format(h.credit)),h.credit>0&&$(".more_credits").show(),clearInterval(f))}),10);async function m(){window.gtagClick("show_credit_account"),getCookie("access_token")?(await async function(){const t=await orderList(0);if(200===t.code){const{data:e}=t;window.productList=e,"ai-sockpuppet-credits-disposable"===e[0].type&&$("products-list")[0].setOneoffData(e)}}(),await o(),await i(),$("#credit_history_loading").hide()):window.location.href="/"}$((function(){m()})),window.addEventListener("scroll",(async function(){const t=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)-((window.innerHeight||document.documentElement.clientHeight)+(window.scrollY||window.pageYOffset||document.body.scrollTop+(document.documentElement.scrollTop||0)));let e;e=document.body.clientWidth<1200?2153:657,t<=e&&($("#payment_history").hasClass("active")?c("payment"):c("credit"))})),$(".cancel_close, .no_confirm_btn, .ok_btn, .fail_btn").on("click",(function(){$(".dialog_pay_mask").removeClass("show"),$(".cancel_dialog").removeClass("showconfirm showsuc showerr"),$(this).hasClass("no_confirm_btn")?window.gtagClick("click_credithistory_cancelpop_notnow"):$(this).hasClass("ok_btn")?window.gtagClick("show_credithistory_cancelpop"):$(this).hasClass("fail_btn")&&window.gtagClick("click_credithistory_cancelfail_tryagain")})),$(".confirm_btn").on("click",(function(){window.gtagClick("click_credithistory_cancelpop_confirm"),$(".confirm_btn").addClass("loading"),fetchPost("api/order/cancel-subscript").then((t=>{200===t.code?(a("suc"),$(".cancel_btn").remove(),$(".renew_btn").show(),window.gtagClick("show_credithistory_renew")):a("fail"),$(".confirm_btn").removeClass("loading")})).catch((t=>{a("fail"),$(".confirm_btn").removeClass("loading")}))})),$(".tab_item").on("click",(function(){$(".tab_item").removeClass("active"),$(this).addClass("active"),this.id.includes("payment")?u.length?e("payment"):e("record"):y.length?e("credit"):e("record")})),$(".credits_buy").on("click",(function(){window.open("/ai-tool-pricing.html"),setSessionCookie("st","accountbuy"),window.gtagClick("click_credit_buybtn")})),$(".close_icon, .dialog_pay_mob .close_icon").on("click",(function(){($(".dialog_pay").hasClass("showsuc")||$(".dialog_pay_mob").hasClass("showsuc"))&&window.location.reload(),window.gtagClick("close_creditpricing_cart"),$("products-list")[0].closeCar()}))}));