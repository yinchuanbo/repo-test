let env=location.host.includes("www.vidqu.ai")?"pro":"dev",isPro="pro"===env,lan=jsonData.aiImageGenerate.javascript;function chickIsNotWork(){return!!navigator.onLine||($Popup({type:"error",errorType:"network"}),!1)}function getGeneratePromptRand(e){return _$$.getComm("generate/prompt/rand",e).catch((()=>{if(!chickIsNotWork())return!1;$Popup({type:"error",errorType:"normal"})}))}function getTaskList({page:e}){return _$$.getComm("generate/image/history-task?page="+e)}function postCreateTask(e){return _$$.postComm("generate/image/create-task",e).catch((()=>{if(!chickIsNotWork())return!1;$Popup({type:"error",errorType:"normal"})}))}let taskTimer={};function getTaskState(e){return _$$.getComm("generate/image/task-state?task_id="+e)}function postDeleteTask(e){return _$$.postComm("generate/image/delete-task",e)}function postDeleteImage(e){return _$$.postComm("generate/image/delete",e)}function postRetryTask(e){return _$$.postComm("generate/image/retry-task",e)}function getImageParams({id:e,task_id:t}){let i="";return e&&t?i=i+"id="+e+"&task_id="+t:e?i=i+"id="+e:t&&(i=i+"task_id="+t),_$$.getComm("generate/image/params?"+i)}function reloadImage(e){e.retryCount||(e.retryCount=0),e.retryCount++,e.retryCount<=3?setTimeout((()=>{e.src=e.src}),2e3):console.error("Image failed to load after 3 attempts:",e.src)}class aiImageGenerate{constructor(){this.setInfoId=null,this.disabled=!0,this.zoomInBoxEl=$(".zoom-in-box")[0],this.aiImageGeneratorBoxEl=$(".ai-image-generatorBox")[0],this.quantityBoxEl=$(".ai-image-generatorBox .image-quantity-box"),this.modeBoxEl=$(".ai-image-generatorBox .image-mode-box"),this.sizeBoxEl=$(".ai-image-generatorBox .image-size-box"),this.generateBtnEl=$(".ai-image-generatorBox .prompts-box .generate-btn")[0],this.mGenerateBtnEl=$(".ai-image-generatorBox .m-magic-box .m-generate-btn")[0],this.promptsBoxEl=$(".ai-image-generatorBox .prompts-box")[0],this.infoImageEl=$(".ai-image-generatorBox .info-img")[0],this.infoMessageNameEl=$(".ai-image-generatorBox .info-message-name")[0],this.showContentBoxEl=$(".ai-image-generatorBox .show-content-box")[0],this.generationHistoryBoxEl=$(".ai-image-generatorBox .generation-history-box")[0],this.setInfoBoxBoxEl=$(".ai-image-generatorBox .set-info-box")[0],this.noDataBoxEl=$(".ai-image-generatorBox .no-data-box")[0],this.privateBoxEl=$(".basic-settings-box .private-mode-box input")[0],this.privateModeIconEl=$(".ai-image-generatorBox .private-mode-box .private-mode-icon")[0],this.promptsNumberEl=$(".ai-image-generatorBox .generate-btn-box .txt-num")[0],this.mPromptsNumberEl=$(".ai-image-generatorBox .m-prompts-box .m-txt-num")[0],this.negativePromptsTextareaEl=$(".ai-image-generatorBox .negative-prompts-value-textarea")[0],this.negativePromptsNumberEl=$(".ai-image-generatorBox .negative-prompts-value-number")[0],this.promptsTextareaTextEl=$(".ai-image-generatorBox .prompts-textarea-text")[0],this.promptsTextareaEl=$(".ai-image-generatorBox .prompts-textarea")[0],this.generationHistoryContentBoxEl=$(".ai-image-generatorBox .generation-history-content-box")[0],this.backTopEl=$(".ai-image-generatorBox .back-top-icon")[0],this.mPromptsTextareaTextEl=$(".ai-image-generatorBox .m-prompts-textarea-text")[0],this.mPromptsTextareaEl=$(".ai-image-generatorBox .m-prompts-textarea")[0],this.generateSelect1=null,this.generateSelect2=null,this.generateSelect3=null,this.pageNum=1,this.pageCount=1,this.negativePromptsMaxLength=500,this.negativePromptsTextareaValue="",this.dataLoading=!1,this.initTimer=0,this.objImageSizeMap={1:[{value:"512 X 512 [ 1 : 1 ]",key:"512X512"},{value:"384 X 512 [ 3 : 4 ]",key:"384X512"},{value:"288 X 512 [ 9 : 16 ]",key:"288X512"},{value:"512 X 384 [ 4 : 3 ]",key:"512X384"},{value:"512 X 288 [ 16 : 9 ]",key:"512X288"}],2:[{value:"768 X 768 [ 1 : 1 ]",key:"768X768"},{value:"576 X 768 [ 3 : 4 ]",key:"576X768"},{value:"432 X 768 [ 9 : 16 ]",key:"432X768"},{value:"768 X 576 [ 4 : 3 ]",key:"768X576"},{value:"768 X 432 [ 16 : 9 ]",key:"768X432"}],3:[{value:"1024 X 1024 [ 1 : 1 ]",key:"1024X1024"},{value:"768 X 1024  [ 3 : 4 ]",key:"768X1024"},{value:"576 X 1024 [ 9 : 16 ]",key:"576X1024"},{value:"1024 X 768 [ 4 : 3 ]",key:"1024X768"},{value:"1024 X 576 [ 16 : 9 ]",key:"1024X576"}]},this.list2=[{value:lan.jsText1,key:"1"},{value:lan.jsText2,key:"2"},{value:lan.jsText3,key:"3"}],this.list1=[{value:1,key:"1"},{value:2,key:"2"},{value:3,key:"3"},{value:4,key:"4"}],this.modelId=null,this.imageQuantityValue=null,this.imageModeValue=null,this.imageSizeValue=null,this.privateValue=!1,this.promptsTextareaValue="",this.magicLoading=!1,this.modelLogo=null,this.modelName=null,this.showContentList=[],this.taskTimerList=[],this.isLoading=!1,this.zoomInImageId=null,this.zoomInImageSrc=null,this.isScroll=!1,gtag("event","open_generator_page"),this.init()}init(){const e=this,t=new URL(window.location.href),i=new URLSearchParams(t.search);this.setInfoId=i.get("setInfoId")||null,this.dataLoading=!0,getImageParams({id:this.setInfoId}).then((e=>{200===e.code&&(this.aiImageGeneratorBoxEl.classList.remove("dataLoading"),this.dataLoading=!1,this.remixItem(e.data))}));const s=JSON.stringify(this.list1);this.generateSelect1=$(`<generate-select title="${lan.jsText4}" activeKey="${this.imageQuantityValue}" list='${s}'></generate-select>`),this.generateSelect1.on("selectItem",(e=>{gtag("event","change_generator_quantity"),this.imageQuantityValue=e.originalEvent.detail.key})),this.quantityBoxEl.append(this.generateSelect1);const a=JSON.stringify(this.list2);this.generateSelect2=$(`<generate-select title="${lan.jsText5}" activeKey="${this.imageModeValue}" list='${a}'></generate-select>`),this.generateSelect2.on("selectItem",(e=>{gtag("event","change_generator_mode");let t=e.originalEvent.detail.key;this.imageModeValue=t,this.imageSizeValue=this.generateSelect3[0].activeKey=this.objImageSizeMap[t][0].key,this.generateSelect3[0].list=this.objImageSizeMap[t],this.generateSelect3[0].changeShowItem()})),this.modeBoxEl.append(this.generateSelect2);const o=JSON.stringify(this.objImageSizeMap[this.list2[0].key]);this.generateSelect3=$(`<generate-select title="${lan.jsText6}" activeKey='${this.imageSizeValue}' list='${o}'></generate-select>`),this.generateSelect3.on("selectItem",(e=>{gtag("event","change_generator_size"),this.imageSizeValue=e.originalEvent.detail.key})),this.sizeBoxEl.append(this.generateSelect3),this.privateBoxEl.addEventListener("change",(e=>{gtag("event","change_generator_private"),this.privateValue=e.target.checked})),$(".ai-image-generatorBox .prompts-box")[0].addEventListener("click",(e=>{e.target.classList.contains("prompts-box")&&this.promptsTextareaEl.focus()})),this.backTopEl.addEventListener("click",(e=>{this.backTopEl.style.display="",isMobileDevice()?(this.isScroll=!0,window.scrollTo({top:0,behavior:"smooth"}),setTimeout((()=>{this.isScroll=!1}),1e3)):this.generationHistoryContentBoxEl.scrollTop=0}));let n=!1;this.promptsTextareaEl.addEventListener("compositionstart",(()=>{n=!0})),this.promptsTextareaEl.addEventListener("compositionend",(e=>{n=!1,this.changePrompts(e.target)})),this.promptsTextareaEl.addEventListener("input",(e=>{n||this.changePrompts(e.target)}));let r=!1;this.mPromptsTextareaEl.addEventListener("compositionstart",(()=>{r=!0})),this.mPromptsTextareaEl.addEventListener("compositionend",(e=>{r=!1,this.changePrompts(e.target)})),this.mPromptsTextareaEl.addEventListener("input",(e=>{r||this.changePrompts(e.target)})),setTimeout((()=>{this.changeWindow()}),10),window.addEventListener("resize",this.changeWindow.bind(this)),document.addEventListener("click",this.selfAllClick.bind(this)),this.generationHistoryContentBoxEl.addEventListener("click",(e=>{setTimeout((()=>{this.generationClick(e)}),0)})),this.zoomInBoxEl.addEventListener("click",(e=>{setTimeout((()=>{let t=e.target;t.classList.contains("share-icon")&&renderShare({image_id:this.zoomInImageId}),t.classList.contains("download_icon")&&this.toDownload(this.zoomInImageSrc),(t.classList.contains("close_icon")||t.classList.contains("zoom-in-box"))&&(this.zoomInBoxEl.style.display="")}),0)})),this.setInfoBoxBoxEl.addEventListener("click",(e=>{setTimeout((()=>{this.setInfoClick(e)}),0)}));let l=!1;function m(t){if(e.magicLoading)return;gtag("event","click_generator_aiprompts");let i=t.target;e.magicLoading=!0,i.classList.add("loading"),getGeneratePromptRand().then((t=>{e.magicLoading=!1,i.classList.remove("loading"),200===t.code&&(e.generateBtnEl.classList.remove("disable"),e.mGenerateBtnEl.classList.remove("disable"),e.changeAllPromptsTextarea(t.data.prompt),e.promptsNumberEl.innerText=t.data.prompt.length+"/2000",e.mPromptsNumberEl.innerText=t.data.prompt.length+"/2000")})).catch((e=>{this.magicLoading=!1,i.classList.remove("loading")}))}function g(t){if(""===e.promptsTextareaValue.trim()||e.isLoading)return!1;gtag("event","click_generator_gen");let i={modelId:e.modelId,quantity:Number(e.imageQuantityValue),mode:Number(e.imageModeValue),width:Number(e.imageSizeValue.split("X")[0]),height:Number(e.imageSizeValue.split("X")[1]),display:!e.privateValue,prompt:e.promptsTextareaValue.trim(),negative_prompt:e.negativePromptsTextareaValue.trim()};e.isLoading=!0,e.generateBtnEl.classList.add("disable"),e.mGenerateBtnEl.classList.add("disable"),e.generateBtnEl.innerHTML=e.mGenerateBtnEl.innerHTML=`${lan.jsText7}<span>.</span><span>.</span><span>.</span>`,postCreateTask(i).then((t=>{e.isLoading=!1,e.generateBtnEl.classList.remove("disable"),e.mGenerateBtnEl.classList.remove("disable"),e.generateBtnEl.innerHTML=e.mGenerateBtnEl.innerHTML=lan.jsText8,200===t.code?(e.changeAllPromptsTextarea(""),e.promptsNumberEl.style.color=e.mPromptsNumberEl.style.color="",e.promptsNumberEl.style.opacity=e.mPromptsNumberEl.style.opacity="",e.promptsNumberEl.innerText=e.mPromptsNumberEl.innerText="0/2000",e.generateBtnEl.classList.add("disable"),e.mGenerateBtnEl.classList.add("disable"),i.task_id=t.data.task_id,i.isUpdate=!0,i.status=1,i.deleted=0,i.modelLogo=e.modelLogo,i.modelName=e.modelName,e.showContentList.unshift(i),e.showAllContent()):3017===t.code?(gtag("event","alert_generator_maxlimit"),$Popup({type:"limit",errorType:"limit",limits:t.message})):gtag("event","alert_generator_failed")})).catch((()=>{gtag("event","alert_generator_failed"),e.isLoading=!1,e.generateBtnEl.classList.remove("disable"),e.mGenerateBtnEl.classList.remove("disable"),e.generateBtnEl.innerHTML=e.mGenerateBtnEl.innerHTML=lan.jsText8}))}this.negativePromptsTextareaEl.addEventListener("compositionstart",(()=>{l=!0})),this.negativePromptsTextareaEl.addEventListener("compositionend",(e=>{l=!1,this.changeNegativePrompts(e.target)})),this.negativePromptsTextareaEl.addEventListener("input",(e=>{l||this.changeNegativePrompts(e.target)})),$(".ai-image-generatorBox .prompts-box .magic-icon")[0].addEventListener("click",m),$(".ai-image-generatorBox .m-magic-box .m-magic-icon")[0].addEventListener("click",m),this.generateBtnEl.addEventListener("click",g),this.mGenerateBtnEl.addEventListener("click",g),this.privateModeIconEl.addEventListener("mouseover",(e=>{if(isMobileDevice())return!1;e.target.parentNode.querySelector(".private-mode-icon-bubble").style.display="flex"})),this.privateModeIconEl.addEventListener("mouseout",(e=>{if(isMobileDevice())return!1;e.target.parentNode.querySelector(".private-mode-icon-bubble").style.display=""})),this.privateModeIconEl.addEventListener("click",(e=>{let t=e.target.parentNode.querySelector(".private-mode-icon-bubble");""===t.style.display?t.style.display="flex":t.style.display=""})),window.addEventListener("scroll",(()=>{if(this.isScroll||!isMobileDevice())return!1;window.scrollY>100?this.backTopEl.style.display="flex":this.backTopEl.style.display=""})),this.generationHistoryContentBoxEl.addEventListener("scroll",(e=>{const t=e.target,i=t.scrollHeight-(t.scrollTop+t.clientHeight);if(t.scrollTop<600?this.backTopEl.style.display="":this.backTopEl.style.display="flex",i<=50&&this.pageCount>this.pageNum&&!this.isLoading){this.pageNum++,this.isLoading=!0;for(let e=0;e<2;e++){const e=document.createElement("div");e.className="image-loading-box",e.innerHTML='<div class="loading-top"></div>\n                                      <div class="loading-bottom">\n                                        <div class="loading-bottom-img"></div>\n                                        <div class="loading-bottom-img"></div>\n                                        <div class="loading-bottom-img"></div>\n                                        <div class="loading-bottom-img"></div>\n                                      </div>',this.generationHistoryContentBoxEl.appendChild(e)}getTaskList({page:this.pageNum}).then((e=>{this.isLoading=!1,200===e.code&&e.data.list.length>0&&(this.pageCount=e.data.pageCount,this.pageNum=e.data.page,this.showContentList=[...this.showContentList,e.data.list],this.generationHistoryContentBoxEl.querySelectorAll(".image-loading-box").forEach((e=>e.remove())),e.data.list.forEach((e=>{const t=document.createElement("div");t.className="generation-item",t.setAttribute("task_id",e.task_id||e.id);let i="";e.images.forEach((e=>{i+=`<div class="item-image" data-image-id="${e.id}">\n                            <img crossorigin="anonymous" src="${e.url}" onerror="reloadImage(this)" alt="">\n                            <div class="MShow show-mobile-btn"></div>\n                            <div class="img-tools">\n                                <div class="MShow img-tools-zoomIn"></div>\n                                <div class="img-tools-download"></div>\n                                <div class="img-tools-share"></div>\n                                <div class="img-tools-delete"></div>\n                            </div>\n                        </div>`})),t.innerHTML=this.getGenerationItemHtml(e,i),this.generationHistoryContentBoxEl.appendChild(t)})))})).catch((()=>{this.isLoading=!1}))}})),this.getFirstHFN(),document.querySelector("my-component").addEventListener("loginsuccess",(()=>{this.getFirstHFN()}))}getFirstHFN(){this.pageNum=1,this.generationHistoryContentBoxEl.innerHTML='<lottie-player src="/dist/img/IGhome/loading.json" background="transparent" speed="1" style="width: 160px; height: 160px;" loop autoplay class="lottie-loading"></lottie-player>',getTaskList({page:this.pageNum}).then((e=>{this.initTimer=0,200===e.code&&e.data.list.length>0&&(this.showContentList=e.data.list,this.pageCount=e.data.pageCount,this.pageNum=e.data.page),this.showAllContent(!0)})).catch((e=>{this.initTimer++,this.initTimer<4?setTimeout((()=>{this.getFirstHFN()}),3e3):this.initTimer=0}))}showAllContent(e=!1){if(!(this.showContentList.length>0))return this.generationHistoryBoxEl.style.display="none",this.noDataBoxEl.style.display="",!1;this.generationHistoryBoxEl.style.display="",this.noDataBoxEl.style.display="none",this.generationHistoryContentBoxEl.querySelector(".lottie-loading")&&(this.generationHistoryContentBoxEl.innerHTML="");let t=$(".ai-image-generatorBox .generation-history-content-box .generation-item").toArray();this.showContentList.forEach((i=>{let s=null;t.some((e=>(Number(e.getAttribute("task_id"))===i.task_id||Number(e.getAttribute("task_id"))===i.id)&&(i?.isUpdate&&(s=e),!0)))||this.addLabelItem(i,e)}))}addLabelItem(e,t){const i=document.createElement("div");i.className="generation-item",i.setAttribute("task_id",e.task_id||e.id);let s="";for(let t=0;t<e.quantity-e.deleted;t++)e?.images&&e?.images[t]?s+=`<div class="item-image" data-image-id="${e.images[t].id}">\n                            <img crossorigin="anonymous" src="${e.images[t].url}" onerror="reloadImage(this)" alt="">\n                            <div class="MShow show-mobile-btn"></div>\n                            <div class="img-tools">\n                                <div class="MShow img-tools-zoomIn"></div>\n                                <div class="img-tools-download"></div>\n                                <div class="img-tools-share"></div>\n                                <div class="img-tools-delete"></div>\n                            </div>\n                        </div>`:1===e.status&&(s+='<div class="item-image generating">\n                            <div class="generating-icon"></div>\n                            <div class="generating-value">0%</div>\n                        </div>');if(i.innerHTML=this.getGenerationItemHtml(e,s),t)this.generationHistoryContentBoxEl.appendChild(i);else{const e=this.generationHistoryContentBoxEl.firstChild;this.generationHistoryContentBoxEl.insertBefore(i,e)}let a={task_id:e.task_id||e.id,el:i,quantity:e.quantity,deleted:e.deleted};e.quantity!==e?.images?.length&&1===e.status&&(i.classList.add("disable"),i.classList.add("generating"),taskTimer[e.task_id]=0,a.timer=setInterval((()=>{this.getTaskStateFn(a)}),5e3)),this.taskTimerList.push(a)}getTaskStateFn(e){let t=e.el,i=t.querySelectorAll(".item-image"),s="";getTaskState(e.task_id).then((a=>{if(200===a.code&&1!==a.data.status)a.data.progress.forEach(((t,s)=>{100===t&&a.data.images[s]?.url&&!i[s].querySelector(".img-tools")?(this.showContentList.some((t=>{if(t.task_id===e.task_id)return t.images=a.data.images,!0})),i[s].classList.remove("generating"),i[s].setAttribute("data-image-id",a.data.images[s].id),i[s].innerHTML=`<img crossorigin="anonymous" src="${a.data.images[s].url}" onerror="reloadImage(this)" alt="">\n                                        <div class="MShow show-mobile-btn"></div>\n                                        <div class="img-tools">\n                                            <div class="MShow img-tools-zoomIn"></div>\n                                            <div class="img-tools-download"></div>\n                                            <div class="img-tools-share"></div>\n                                            <div class="img-tools-delete"></div>\n                                        </div>`):i[s].querySelector(".generating-value")&&(i[s].querySelector(".generating-value").innerText=t+"%")})),0===a.data.status&&e.timer&&(delete taskTimer[e.task_id],t.classList.remove("disable"),t.classList.remove("generating"),clearInterval(e.timer));else if(1===a.data.status){for(let t=0;t<e.quantity-e.deleted;t++)i[t].classList.remove("generating"),i[t].classList.add("failed"),a.data?.images&&a.data?.images[t]?(i[t].classList.remove("failed"),i[t].setAttribute("data-image-id",a.data.images[t].id),s=`<img crossorigin="anonymous" src="${a.data.images[t].url}" onerror="reloadImage(this)" alt="">\n                            <div class="MShow show-mobile-btn"></div>\n                            <div class="img-tools">\n                                <div class="MShow img-tools-zoomIn"></div>\n                                <div class="img-tools-download"></div>\n                                <div class="img-tools-share"></div>\n                                <div class="img-tools-delete"></div>\n                            </div>`):s=`<div class="failed-text">${lan.jsText9}</div>\n                            <div class="failed-retry-btn">${lan.jsText10}</div>`,i[t].innerHTML=s;gtag("event","alert_generator_failed"),t.classList.remove("generating"),clearInterval(e.timer)}})).catch((()=>{if(taskTimer[e.task_id]=taskTimer[e.task_id]+1,taskTimer[e.task_id]<5)return!1;for(let t=0;t<e.quantity-e.deleted;t++)i[t].classList.remove("generating"),i[t].classList.add("failed"),s=`<div class="failed-text">${lan.jsText9}</div>\n                            <div class="failed-retry-btn">${lan.jsText10}</div>`,i[t].innerHTML=s;if(gtag("event","alert_generator_failed"),t.classList.remove("disable"),t.classList.remove("generating"),clearInterval(e.timer),delete taskTimer[e.task_id],!chickIsNotWork())return!1;$Popup({type:"error",errorType:"normal"})}))}changeNegativePrompts(e){let t=e.value;this.negativePromptsNumberEl.style.color="",this.negativePromptsNumberEl.style.opacity="";/[@#￥$%&*]+$/.test(t)&&(t=t.replace(/[@#$￥%&*]/g,""),e.value=t),t.length>=this.negativePromptsMaxLength&&(this.negativePromptsNumberEl.style.color="red",this.negativePromptsNumberEl.style.opacity="1",t=t.substring(0,this.negativePromptsMaxLength)),this.negativePromptsTextareaValue=e.value=t,this.negativePromptsNumberEl.innerText=t.length+"/"+this.negativePromptsMaxLength}changePrompts(e){let t=e.value;this.promptsNumberEl.style.color=this.mPromptsNumberEl.style.color="",this.promptsNumberEl.style.opacity=this.mPromptsNumberEl.style.opacity="",""===t.trim()?(this.generateBtnEl.classList.add("disable"),this.mGenerateBtnEl.classList.add("disable")):(this.generateBtnEl.classList.remove("disable"),this.mGenerateBtnEl.classList.remove("disable"));/[@#$￥%&*]+$/.test(t)&&(t=t.replace(/[@#$￥%&*]/g,""),e.value=t);2e3-t.length<=0&&(this.promptsNumberEl.style.color=this.mPromptsNumberEl.style.color="red",this.promptsNumberEl.style.opacity=this.mPromptsNumberEl.style.opacity="1",t=t.slice(0,2e3),e.value=t),this.changeAllPromptsTextarea(t),this.promptsNumberEl.innerText=this.mPromptsNumberEl.innerText=t.length+"/2000",isMobileDevice()||(this.generationHistoryContentBoxEl.style.height=this.showContentBoxEl.offsetHeight-this.promptsBoxEl.offsetHeight-81+"px")}changeAllPromptsTextarea(e){this.promptsTextareaValue=this.mPromptsTextareaTextEl.innerHTML=this.mPromptsTextareaEl.value=this.promptsTextareaTextEl.innerText=this.promptsTextareaEl.value=e}getGenerationItemHtml(e,t){let i="",s="",a=this.runDate(e.created_at||(new Date).valueOf());switch(e.width+"X"+e.height){case"384X512":case"576X768":case"768X1024":s="size34";break;case"288X512":case"432X768":case"576X1024":s="size916";break;case"512X384":case"768X576":case"1024X768":s="size43";break;case"512X288":case"768X432":case"1024X576":s="size169"}return i=`<div class="item-tools">\n        <div class="item-tools-reuse-icon">\n          <div class="item-tools-reuse-tips">${lan.jsText11}</div>\n        </div>\n        <div class="item-tools-text-box close">\n          <div class="item-tools-text">${e.prompt}</div>\n          <div class="item-tools-text-copy"></div>\n          <div class="item-tools-text-up"></div>\n        </div>\n        <div class="item-tools-model-box">\n          <img src="${e.modelLogo||e.model.logo}" alt="">\n            <span>${e.modelName||e.model.name}</span>\n        </div>\n        <div style="display: flex;align-items: center">\n            <div class="item-tools-time-box">${a}</div>\n            <div class="item-tools-more-box">\n                <div class="item-tools-more-btn"></div>\n                <div class="item-tools-more-btn-box">\n                    <div class="self-more-btn view">${lan.jsText12}</div>\n                    <div class="self-more-btn share">${lan.jsText13}</div>\n                    <div class="self-more-btn delete">${lan.jsText14}</div>\n                </div>\n            </div>\n        </div>\n      </div>\n      <div class="item-image-box ${s}">\n        ${t}\n      </div>`,i}changeWindow(){this.showContentBoxEl.style.height=this.setInfoBoxBoxEl.offsetHeight+"px"}selfAllClick(e){this.closeOpen(e)}setInfoClick(e){let t=e.target;if(t.classList.contains("open-self-btn")){if(this.dataLoading)return!1;gtag("event","click_generator_advanced"),$(".ai-image-generatorBox .advanced-settings-box")[0].classList.toggle("open")}if(t.classList.contains("reset-defaults-btn")&&(gtag("event","click_generator_default"),this.imageQuantityValue=this.generateSelect1[0].activeKey=this.list1[0].key,this.generateSelect1[0].list=this.list1,this.generateSelect1[0].changeShowItem(),this.imageModeValue=this.generateSelect2[0].activeKey=this.list2[0].key,this.generateSelect2[0].list=this.list2,this.generateSelect2[0].changeShowItem(),this.imageSizeValue=this.generateSelect3[0].activeKey=this.objImageSizeMap[this.list2[0].key][0].key,this.generateSelect3[0].list=this.objImageSizeMap[this.list2[0].key],this.generateSelect3[0].changeShowItem(),this.privateBoxEl.checked=!1,this.privateValue=!1,this.negativePromptsTextareaValue=this.negativePromptsTextareaEl.value="",this.negativePromptsNumberEl.innerText="0/"+this.negativePromptsMaxLength,this.negativePromptsNumberEl.style.color=""),t.classList.contains("info-switch-btn")){if(this.dataLoading)return!1;gtag("event","click_generator_switchbtn"),$ModelSelector.showModelSelector(!0);let e=this;$("model-selector").off("getModelSelectorParams").on("getModelSelectorParams",(function(t){e.modelId=t.originalEvent.detail.id,e.modelName=e.infoMessageNameEl.title=e.infoMessageNameEl.innerText=t.originalEvent.detail.name,e.modelLogo=e.infoImageEl.src=t.originalEvent.detail.logo,$("model-selector")[0].showModelSelector(!1)}))}}generationClick(e){if(this.isLoading)return!1;let t=e.target;if(t.classList.contains("item-tools-more-btn")){let e=t.parentNode.querySelector(".item-tools-more-btn-box");""===e.style.display?e.style.display="block":e.style.display=""}if(t.classList.contains("self-more-btn")){let e=this.byClassNameGetEl(t,"generation-item"),i=Number(e.getAttribute("task_id"));t.classList.contains("view")?this.toView(Number(i)):t.classList.contains("delete")?(gtag("event","click_generator_delbtn"),this.toDeleteTask(i,e)):t.classList.contains("share")&&(gtag("event","click_generator_sharebtn"),renderShare({task_id:i}))}if(t.classList.contains("item-tools-text-up")&&(gtag("event","click_generator_togglebtn"),t.parentNode.classList.toggle("close")),t.classList.contains("item-tools-text-copy")&&(gtag("event","click_generator_copybtn"),this.toCopy(t)),t.classList.contains("item-tools-reuse-icon")){gtag("event","click_generator_reusebtn");let e=t.parentNode.querySelector(".item-tools-text").innerText;this.generateBtnEl.classList.remove("disable"),this.mGenerateBtnEl.classList.remove("disable"),this.promptsNumberEl.innerText=this.mPromptsNumberEl.innerText=e.length+"/2000",this.promptsNumberEl.style.color=this.mPromptsNumberEl.style.color=e.length<2e3?"":"red",this.promptsNumberEl.style.opacity=this.mPromptsNumberEl.style.opacity=e.length<2e3?"":"1",this.changeAllPromptsTextarea(e)}if(t.classList.contains("img-tools-download")){gtag("event","download_generator_img");let e=t.parentNode.parentNode.querySelector("img").src;this.toDownload(e)}if(t.classList.contains("img-tools-share")){gtag("event","share_generator_img");let e=Number(t.parentNode.parentNode.getAttribute("data-image-id"));renderShare({image_id:e})}if(t.classList.contains("show-mobile-btn")){let e=t.parentNode.querySelector(".img-tools");t.classList.contains("open")?(t.classList.remove("open"),e.classList.remove("open")):(t.classList.add("open"),e.classList.add("open"))}if(t.classList.contains("img-tools-delete")){let e=t.parentNode.parentNode;if(e.classList.contains("failed"))return!1;gtag("event","del_generator_img");let i=$Popup({title:lan.jsText15,content:lan.jsText16,closeBtn:lan.jsText14,applyBtn:lan.jsText17,autoClose:!1,exist:"taskDeletePopup",onClose:()=>{i.loading.start();let s=Number(e.getAttribute("data-image-id"));postDeleteImage({id:s}).then((a=>{if(200===a.code){let a=this.byClassNameGetEl(t,"generation-item"),o=Number(a.getAttribute("task_id"));this.showContentList.some(((e,t)=>{if(e.id===o||e.task_id===o)return e.deleted++,e.images.some(((t,i)=>{if(t.id===s)return e.images.splice(i,1),!0})),0===e.images.length&&e.deleted===e.quantity&&(a.remove(),this.showContentList.splice(t,1),setTimeout((()=>{0===this.showContentList.length&&this.getFirstHFN()}),100)),!0})),e.remove(),i.close()}})).catch((e=>{if(i.close(),!chickIsNotWork())return!1;$Popup({type:"error",errorType:"normal"})}))},onApply:()=>{i.close()}})}if(t.classList.contains("failed-retry-btn")){let e=this.byClassNameGetEl(t,"generation-item"),i=Number(e.getAttribute("task_id"));this.isLoading=!0,postRetryTask({id:i}).then((t=>{200===t.code&&this.taskTimerList.some((t=>{if(t.task_id===i){let i="";for(let e=0;e<t.quantity-t.deleted;e++)i+='<div class="item-image generating">\n                            <div class="generating-icon"></div>\n                            <div class="generating-value">0%</div>\n                        </div>';return e.querySelector(".item-image-box").innerHTML=i,t.timer=setInterval((()=>{this.getTaskStateFn(t)}),5e3),!0}})),this.isLoading=!1})).catch((e=>{if(this.isLoading=!1,!chickIsNotWork())return!1;$Popup({type:"error",errorType:"normal"})}))}if(!(t.classList.contains("failed-retry-btn")||t.classList.contains("img-tools-delete")||t.classList.contains("img-tools-share")||t.classList.contains("show-mobile-btn")||t.classList.contains("img-tools-download"))){let e=t.parentNode;t.classList.contains("img-tools-zoomIn")&&(e=t.parentNode.parentNode);let i=Number(e.getAttribute("data-image-id"));i&&(gtag("event","view_generator_img"),this.zoomInImageId=i,this.zoomInImageSrc=this.zoomInBoxEl.querySelector(".zoom-in-image").src=e.querySelector("img").src,this.zoomInBoxEl.style.display="block")}}toView(e){gtag("event","click_generator_viewinfobtn"),$("#task-info")[0].showLoading(),$("#task-info")[0].bindCallBack((e=>{gtag("event","click_generator_tryitbtn"),this.remixItem(e),this.generationHistoryContentBoxEl.scrollTop=0})),getImageParams({task_id:e}).then((t=>{200===t.code?(gtag("event","show_generator_viewinfo"),$("#task-info")[0].showOverlay(t.data,e)):ToolTip({text:"",type:"error"})})).catch((e=>{if($("#task-info")[0].hideOverlay(),!chickIsNotWork())return!1;$Popup({type:"error",errorType:"normal"})}))}toDownload(e){getCookie("access_token")?fetch(e).then((e=>e.blob())).then((e=>{const t=window.URL.createObjectURL(e),i=document.createElement("a");i.href=t,i.download=lan.jsText18,document.body.appendChild(i),i.click(),document.body.removeChild(i)})).catch((e=>{console.error("There has been a problem with your fetch operation:",e)})):showLeadLogin("download")}remixItem(e){this.modelId=e.model_id,this.modelLogo=this.infoImageEl.src=e.model?.logo,this.modelName=this.infoMessageNameEl.title=this.infoMessageNameEl.innerText=e.model?.name,this.imageQuantityValue=this.generateSelect1[0].activeKey=""+e.quantity,this.generateSelect1[0].list=this.list1,this.generateSelect1[0].changeShowItem(),this.imageModeValue=this.generateSelect2[0].activeKey=""+e.mode,this.generateSelect2[0].list=this.list2,this.generateSelect2[0].changeShowItem(),this.imageSizeValue=this.generateSelect3[0].activeKey=e.width+"X"+e.height,this.generateSelect3[0].list=this.objImageSizeMap[e.mode],this.generateSelect3[0].changeShowItem(),this.privateBoxEl.checked=this.privateValue=!e.display,this.negativePromptsTextareaValue=this.negativePromptsTextareaEl.value=e.negative_prompt,this.negativePromptsNumberEl.innerText=e.negative_prompt.length+"/"+this.negativePromptsMaxLength;let t=e.prompt.trim();const i=2e3-e.prompt.length;this.promptsNumberEl.style.color=this.mPromptsNumberEl.style.color=i<=0?"red":"",this.promptsNumberEl.style.opacity=this.mPromptsNumberEl.style.opacity=i<=0?"1":"",i<=0&&(t=e.prompt.slice(0,2e3)),""!==t&&(this.generateBtnEl.classList.remove("disable"),this.mGenerateBtnEl.classList.remove("disable")),this.changeAllPromptsTextarea(t),this.promptsNumberEl.innerText=this.mPromptsNumberEl.innerText=e.prompt.length+"/2000"}toDeleteTask(e,t){let i=$Popup({title:lan.jsText15,content:lan.jsText16,closeBtn:lan.jsText14,applyBtn:lan.jsText17,autoClose:!1,exist:"taskDeletePopup",onClose:()=>{i.loading.start(),postDeleteTask({id:e}).then((s=>{200===s.code&&(i.close(),t.remove(),this.showContentList.some(((t,i)=>{if(t.id===e||t.task_id===e)return this.showContentList.splice(i,1),setTimeout((()=>{0===this.showContentList.length&&this.getFirstHFN()}),100),!0})))})).catch((()=>{if(i.close(),!chickIsNotWork())return!1;$Popup({type:"error",errorType:"normal"})}))},onApply:()=>{i.close()}})}runDate(e){const t=new Date(e);return`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}`}toCopy(e){let t=e.parentNode.querySelector(".item-tools-text").innerText;_$$.copyText(t),ToolTip({text:lan.jsText19})}closeOpen(e){let t=$(".generation-item .item-tools-more-btn-box").toArray();t.forEach((e=>{e.style.display=""})),(e.target.classList.contains("self-more-btn")||e.target.classList.contains("item-tools-more-btn-box"))&&t.forEach((t=>{this.byClassNameGetEl(e.target,"item-tools-more-btn-box")===t&&(t.style.display="")})),e.target.classList.contains("private-mode-icon")||(this.privateModeIconEl.style.display="")}byClassNameGetEl(e,t){return e.classList.contains("ai-image-generatorBox")?null:e.classList.contains(t)?e:this.byClassNameGetEl(e.parentNode,t)}disconnectedCallback(){window.removeEventListener("resize",this.changeWindow),document.removeEventListener("click",this.selfClick)}}$(window).ready((function(){window.aiImageGenerate=new aiImageGenerate,$(".back_history").on("click",(function(){showLeadLogin("back")}))}));