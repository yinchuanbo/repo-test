"use strict";function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){_defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Language=function(e){return e.en="en",e.ar="ar",e.tw="tw",e.kr="kr",e.jp="jp",e.it="it",e.fr="fr",e.de="de",e.pt="pt",e.es="es",e}(Language||{}),Env=function(e){return e.Production="production",e.Test="test",e}(Env||{});const httpsTempLib=function(e){return`https://${e}/`},hostLib=location.host;let langLib,domainPrefix,curDomain,environment,baseApiLib,baseApiOldLib,siteName="vidnoz",xDeviceId=localStorage.getItem("xDeviceId")||"";const setEnvByWebite=function(e){curDomain=`${domainPrefix}.${e}.com`,environment=hostLib.includes(curDomain)?Env.Production:Env.Test;const t=environment===Env.Production,n="vidqu"===e?"ai":"com";baseApiLib=httpsTempLib(t?`tool-api.${e}.${n}`:`tool-api-test.${e}.${n}`),"vidnoz"===e&&(baseApiOldLib=httpsTempLib(t?`api.${e}.com`:`api-test.${e}.com`))},errorTips=function(e=""){throw new Error(`${e}`)},initialize=function(e,t){switch(e in Language?(langLib=e,domainPrefix=langLib===Language.en?"www":langLib):errorTips("Language not supported"),siteName=t,t){case"vidnoz":case"miocreate":case"vidqu":setEnvByWebite(t);break;default:errorTips("Website name not supported")}};class Memory{setItem(e,t){e&&(e=e.toString(),t="string"==typeof t?t:JSON.stringify(t),window.localStorage.setItem(e,t))}getItem(e){try{const t=localStorage.getItem(e);return null===t?null:JSON.parse(t)}catch(e){return null}}removeItem(e){e?"string"==typeof e?window.localStorage.removeItem(e):Array.isArray(e)&&e.forEach((function(e){return window.localStorage.removeItem(e)})):window.localStorage.clear()}getCookie(e){const t=document.cookie.split(";");for(const n of t){const[t,o]=n.trim().split("=");if(t===e)return decodeURIComponent(o)}return null}}class Methods{isMobile(){const e=navigator.userAgent;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e)}isIosOrAndroid(){const e=navigator.userAgent.toLowerCase().indexOf("android")>-1,t=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;return e?"android":t?"ios":void 0}async copyText(e){function t(e){const t=document.createElement("textarea");t.value=e,t.style.width="100px",t.style.position="fixed",t.style.left="-999px",t.style.top="10px",document.body.appendChild(t),t.focus(),t.select(),document.execCommand("copy"),document.body.removeChild(t)}if(navigator.clipboard&&navigator.permissions)try{await navigator.clipboard.writeText(e)}catch(n){console.error("Failed to copy text using Clipboard API:",n),t(e)}else t(e)}watchFileUpload(e,t){e.addEventListener("change",(function(e){var n;const o=null===(n=e.target.files)||void 0===n?void 0:n[0];o&&t(o)}))}getType(e){const t=Object.prototype.toString,n={undefined:"undefined",number:"number",boolean:"boolean",string:"string","[object Function]":"function","[object RegExp]":"regexp","[object Array]":"array","[object Date]":"date","[object Error]":"error"};return n[typeof e]||n[t.call(e)]||(e?"object":"null")}checkClickOutside(e,t){return!e.contains(t.target)}scrollToTop(){var e=this;const t=document.documentElement.scrollTop||document.body.scrollTop;t>0&&(window.requestAnimationFrame((function(){return e.scrollToTop()})),window.scrollTo(0,t-t/8))}smoothScroll(e){var t;null===(t=document.querySelector(e))||void 0===t||t.scrollIntoView({behavior:"smooth"})}continueRequestOnUnload1(e="",t={}){fetch(e,{method:"POST",body:JSON.stringify(t),keepalive:!0})}continueRequestOnUnload2(e="",t={}){navigator.sendBeacon(e,JSON.stringify(t))}flipAnimate(e,t=500){const n=e.getBoundingClientRect();window.getComputedStyle(e).opacity;e.style.transform=`translate(${n.left}px, ${n.top}px)`,e.style.opacity="0",e.offsetWidth;const o=e.getBoundingClientRect(),r=(window.getComputedStyle(e).opacity,n.left-o.left),i=n.top-o.top;e.style.transform="translate(0, 0)",e.style.opacity="1",e.animate([{transform:`translate(${r}px, ${i}px)`,opacity:"0"},{transform:"translate(0, 0)",opacity:"1"}],{duration:t,easing:"ease-in-out"})}cloneData(e){return e?JSON.parse(JSON.stringify(e)):e}qsLib(...e){const t=null==e?void 0:e.length;return 0===t||t>2?null:1===t?document.querySelector(e[0]):2===t?e[0].querySelector(e[1]):null}}class Service extends Memory{constructor(){super(),this.getHeaders=this.getHeaders.bind(this),this.get=this.get.bind(this),this.post=this.post.bind(this),this.postFormData=this.postFormData.bind(this),this.put=this.put.bind(this)}getHeaders(){const e={"Content-Type":"application/json","X-TASK-VERSION":window.XTASKVERSION||"2.0.0","Request-Language":langLib,"Request-Origin":siteName},t=this.getCookie("access_token");return t&&(e.Authorization="Bearer "+t),xDeviceId&&(e["x-device-id"]=xDeviceId,localStorage.setItem("xDeviceId",xDeviceId)),e}get(e,t={}){return fetch(e,{method:"GET",headers:_objectSpread(_objectSpread({},this.getHeaders()),t)}).then((function(e){const t=e.headers.get("X-Device-Id");return t&&!xDeviceId&&(xDeviceId=t),e.json()}))}post(e,t,n={}){return fetch(e,{method:"POST",headers:_objectSpread(_objectSpread({},this.getHeaders()),n),body:JSON.stringify(t)}).then((function(e){const t=e.headers.get("X-Device-Id");return t&&!xDeviceId&&(xDeviceId=t),e.json()}))}postFormData(e,t,n={}){const o=_objectSpread(_objectSpread({},this.getHeaders()),n);delete o["Content-Type"];const r=new FormData;for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&r.append(e,t[e]);return fetch(e,{method:"POST",headers:o,body:r}).then((function(e){return e.json()}))}put(e,t,n={}){return fetch(e,{method:"PUT",headers:n,body:t}).then((function(e){return e.status}))}}class API extends Service{constructor(){super(),_defineProperty(this,"ApiUrls",{"add-task":"ai/ai-tool/add-task","get-task":"ai/tool/get-task","get-access-url":"ai/source/get-access-url","temp-upload-url":"ai/source/temp-upload-url","can-task":"ai/tool/can-task","get-upload-url":"ai/source/get-upload-url",dance:"ai/tool/dance","create-task":"generate/image/create-task"}),this.postTemp=this.postTemp.bind(this),this.postComm=this.postComm.bind(this),this.getComm=this.getComm.bind(this),this.addTask=this.addTask.bind(this),this.danceTask=this.danceTask.bind(this),this.getTask=this.getTask.bind(this),this.getAccessUrl=this.getAccessUrl.bind(this),this.tempUploadUrl=this.tempUploadUrl.bind(this),this.vidquCreateTask=this.vidquCreateTask.bind(this),this.canTask=this.canTask.bind(this),this.getUploadUrl=this.getUploadUrl.bind(this),this.loopTask=this.loopTask.bind(this),this.uploadAssets=this.uploadAssets.bind(this),this.downloadAssets=this.downloadAssets.bind(this)}async postTemp(e={},t="",n=""){try{const o=await this.post(n||`${baseApiLib}${this.ApiUrls[t]}`,e);return Promise.resolve(o)}catch(e){return Promise.reject(e)}}async postComm(e="",t={},n={}){try{const o=await this.post(`${baseApiLib}${e}`,t,n);return Promise.resolve(o)}catch(e){return Promise.reject(e)}}async getComm(e="",t={}){try{const n=await this.get(`${baseApiLib}${e}`,t);return Promise.resolve(n)}catch(e){return Promise.reject(e)}}async addTask(e={}){return await this.postTemp(e,"add-task")}async danceTask(e={}){return await this.postTemp(e,"dance")}async getTask(e={}){return await this.postTemp(e,"get-task")}async getAccessUrl(e={}){return await this.postTemp(e,"get-access-url")}async tempUploadUrl(e={}){return await this.postTemp(e,"temp-upload-url")}async vidquCreateTask(e={}){return await this.postTemp(e,"create-task")}async canTask(e={}){return await this.postTemp(e,"can-task")}async getUploadUrl(e={}){const t=`${baseApiOldLib||baseApiLib}${this.ApiUrls["get-upload-url"]}`;return await this.postTemp(e,"",t)}async loopTask(e={},t="",n=function(){},o=function(){}){const r=this;try{var i,s,a;let c=null;c="dance"===t?await this.danceTask(e):await this.addTask(e);const l=null===(i=c)||void 0===i?void 0:i.code,d=null===(s=c)||void 0===s||null===(a=s.data)||void 0===a?void 0:a.task_id;if(200!==l||!d)return Promise.resolve({code:l});try{const e=await async function(e,t=function(){}){let n=0;for(;;){try{var i;const n=await r.getTask({id:e}),a=null==n||null===(i=n.data)||void 0===i?void 0:i.status;var s;if(0===a)return await(null==t?void 0:t(n)),Promise.resolve((null==n||null===(s=n.data)||void 0===s?void 0:s.additional_data)??{});if(![0,-1,-2].includes(a))return Promise.reject(n);null==o||o(n)}catch(e){if(n>=5)return Promise.reject(e);n++}await new Promise((function(e){return setTimeout(e,5e3)}))}}.call(this,d,n);return Promise.resolve({code:200,task_id:d,data:e})}catch(e){return Promise.reject(e)}}catch(e){return Promise.reject(e)}}async uploadAssets({fileName:e,file:t,permanent:n=!1}){try{var o,r;const i=await(n?this.getUploadUrl:this.tempUploadUrl)({file_name:e||`default.${t.type}`}),s=null==i?void 0:i.code,a=null==i||null===(o=i.data)||void 0===o?void 0:o.upload_url,c=null==i||null===(r=i.data)||void 0===r?void 0:r.key;if(200===s&&a){const e=new Blob([t],{type:t.type}),n=await function(e){return new Promise((function(t){const n=new FileReader;n.onload=function(){t(!0)},n.onerror=function(e){t(!1)},n.readAsArrayBuffer(e)}))}(e);if(!n)return Promise.resolve({code:404,message:"no such file"});return 200===await this.put(a,e)?Promise.resolve({code:200,key:c}):Promise.reject()}return Promise.reject()}catch(e){return Promise.reject(e)}}async downloadAssets({key:e,filename:t="",callback:n=function(){}}){try{var o,r;const i=await this.getAccessUrl({key:e}),s=null==i?void 0:i.code,a=null==i||null===(o=i.data)||void 0===o?void 0:o.static_url,c=null==i||null===(r=i.data)||void 0===r?void 0:r.url,l=a||c;if(200===s&&l){let e=!1;this.get(l).then((function(t){var o;if(!t.ok)return e=!0,void(null==n||n({status:t.status,error:!0}));e=!1;const r=t.headers.get("Content-Length"),i=parseInt(r||"0",10);let s=0;const a=null===(o=t.body)||void 0===o?void 0:o.getReader();if(!a)throw new Error("Response body is not readable");return new ReadableStream({start:t=>function o(){return a.read().then((function({done:e,value:r}){if(e)return void t.close();s+=r.length;const a=i>0?Math.round(s/i*100):0;return null==n||n({progress:a,error:!1}),t.enqueue(r),o()})).catch((function(){throw null==n||n({error:!0}),t.error(e),e}))}()})})).then((function(e){return new Response(e)})).then((function(e){return e.blob()})).then((function(o){if(e)null==n||n({error:!0});else{const e=URL.createObjectURL(o),n=document.createElement("a");n.href=e,n.download=t,n.click(),URL.revokeObjectURL(e)}})).catch((function(){null==n||n({error:!0})}))}else null==n||n({error:!0})}catch(e){null==n||n({error:!0})}}}const $LIB=function(e=Language.en,t="vidnoz"){initialize(e,t);const n=new Memory,o=new Methods,r=new Service,i=new API;return new Proxy({},{get:(e,t)=>t in n?"function"==typeof n[t]?n[t].bind(n):n[t]:t in o?"function"==typeof o[t]?o[t].bind(o):o[t]:t in r?"function"==typeof r[t]?r[t].bind(r):r[t]:t in i?"function"==typeof i[t]?i[t].bind(i):i[t]:void 0})};