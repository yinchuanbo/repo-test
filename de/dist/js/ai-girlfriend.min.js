"use strict";function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _createForOfIteratorHelper(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,s=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,n=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw n}}}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}function _regeneratorRuntime(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,i=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},n="function"==typeof Symbol?Symbol:{},s=n.iterator||"@@iterator",c=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function d(e,t,r,i){var n=t&&t.prototype instanceof m?t:m,s=Object.create(n.prototype),c=new F(i||[]);return a(s,"_invoke",{value:G(e,r,c)}),s}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var u="suspendedStart",g="suspendedYield",_="executing",p="completed",f={};function m(){}function v(){}function y(){}var b={};l(b,s,(function(){return this}));var C=Object.getPrototypeOf,k=C&&C(C(j([])));k&&k!==r&&i.call(k,s)&&(b=k);var $=y.prototype=m.prototype=Object.create(b);function x(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function r(a,n,s,c){var o=h(e[a],e,n);if("throw"!==o.type){var l=o.arg,d=l.value;return d&&"object"==_typeof(d)&&i.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,s,c)}),(function(e){r("throw",e,s,c)})):t.resolve(d).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,c)}))}c(o.arg)}var n;a(this,"_invoke",{value:function(e,i){function a(){return new t((function(t,a){r(e,i,t,a)}))}return n=n?n.then(a,a):a()}})}function G(t,r,i){var a=u;return function(n,s){if(a===_)throw Error("Generator is already running");if(a===p){if("throw"===n)throw s;return{value:e,done:!0}}for(i.method=n,i.arg=s;;){var c=i.delegate;if(c){var o=M(c,i);if(o){if(o===f)continue;return o}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(a===u)throw a=p,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);a=_;var l=h(t,r,i);if("normal"===l.type){if(a=i.done?p:g,l.arg===f)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(a=p,i.method="throw",i.arg=l.arg)}}}function M(t,r){var i=r.method,a=t.iterator[i];if(a===e)return r.delegate=null,"throw"===i&&t.iterator.return&&(r.method="return",r.arg=e,M(t,r),"throw"===r.method)||"return"!==i&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+i+"' method")),f;var n=h(a,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,f;var s=n.arg;return s?s.done?(r[t.resultName]=s.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,f):s:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,f)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function F(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function j(t){if(t||""===t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,n=function r(){for(;++a<t.length;)if(i.call(t,a))return r.value=t[a],r.done=!1,r;return r.value=e,r.done=!0,r};return n.next=n}}throw new TypeError(_typeof(t)+" is not iterable")}return v.prototype=y,a($,"constructor",{value:y,configurable:!0}),a(y,"constructor",{value:v,configurable:!0}),v.displayName=l(y,o,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,l(e,o,"GeneratorFunction")),e.prototype=Object.create($),e},t.awrap=function(e){return{__await:e}},x(w.prototype),l(w.prototype,c,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,i,a,n){void 0===n&&(n=Promise);var s=new w(d(e,r,i,a),n);return t.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},x($),l($,o,"Generator"),l($,s,(function(){return this})),l($,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var i in t)r.push(i);return r.reverse(),function e(){for(;r.length;){var i=r.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},t.values=j,F.prototype={constructor:F,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(A),!t)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function a(i,a){return c.type="throw",c.arg=t,r.next=i,a&&(r.method="next",r.arg=e),!!a}for(var n=this.tryEntries.length-1;n>=0;--n){var s=this.tryEntries[n],c=s.completion;if("root"===s.tryLoc)return a("end");if(s.tryLoc<=this.prev){var o=i.call(s,"catchLoc"),l=i.call(s,"finallyLoc");if(o&&l){if(this.prev<s.catchLoc)return a(s.catchLoc,!0);if(this.prev<s.finallyLoc)return a(s.finallyLoc)}else if(o){if(this.prev<s.catchLoc)return a(s.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return a(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&i.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var n=a;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var s=n?n.completion:{};return s.type=e,s.arg=t,n?(this.method="next",this.next=n.finallyLoc,f):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),A(r),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var i=r.completion;if("throw"===i.type){var a=i.arg;A(r)}return a}}throw Error("illegal catch attempt")},delegateYield:function(t,r,i){return this.delegate={iterator:j(t),resultName:r,nextLoc:i},"next"===this.method&&(this.arg=e),f}},t}function asyncGeneratorStep(e,t,r,i,a,n,s){try{var c=e[n](s),o=c.value}catch(e){return void r(e)}c.done?t(o):Promise.resolve(o).then(i,a)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(i,a){var n=e.apply(t,r);function s(e){asyncGeneratorStep(n,i,a,s,c,"next",e)}function c(e){asyncGeneratorStep(n,i,a,s,c,"throw",e)}s(void 0)}))}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,_toPropertyKey(i.key),i)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var winRef=null,tryTimes=0,evt=document.createEvent("HTMLEvents");evt.initEvent("input",!0,!0);var AiGirlFriend=function(){return _createClass((function e(){_classCallCheck(this,e);var t=this;if(this.proxy=new Proxy(this.data(),{set:function(e,r,i){return"editMcType"===r&&(t.oldEditType=t.editMcType),setTimeout(_asyncToGenerator(_regeneratorRuntime().mark((function a(){var n,s;return _regeneratorRuntime().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:"mc_Avatar"===r&&(e.mc_Avatar?($(".createMc_container .avatar").addClass("has"),$(".avatar .addImage span").text(jsonAiGirlFriend.createMc.avatar_btnAdd)):($(".createMc_container .avatar").removeClass("has"),$(".avatar .addImage span").text(jsonAiGirlFriend.createMc.avatar_btnSet))),"mc_Background"===r?e.mc_Background?($(".createMc_container .background").addClass("has"),$(".background .addImage span").text(jsonAiGirlFriend.createMc.background_btnAdd)):($(".createMc_container .background").removeClass("has"),$(".background .addImage span").text(jsonAiGirlFriend.createMc.background_btnSet)):"mc_Desc"===r?$(".whiteMeOut").val(i):"mc_Name"===r?$(".createMC_name").val(i):"mc_Gender"===r?$(".createMC_gender").val(i):"mc_Persona"===r?$(".createMC_persona").val(i):"mc_Greeting"===r?$(".createMC_Greeting").val(i):"mc_Scenario"===r?$(".createMC_Scenario").val(i):"mc_Dialogue"===r?$(".createMC_Dialogue").val(i):"mc_visibility"===r?($(".createMc_select .select_content").text(i),$(".createMc_select .select_list_item").removeClass("active"),$(".createMc_select .select_list_item[data-type='".concat(i,"']")).addClass("active")):"mc_Categories"===r?("",s=i.length>1?jsonAiGirlFriend.createMc.Categories_tips:jsonAiGirlFriend.createMc.Categories_tip,n=s.replace("%ss",i.length),$(".checkNum").text(n),$(".createMc_radio").prop("checked",!1),$(".createMc_radio").each((function(){var e=this,t=$(this).attr("value");i.forEach((function(r){r==t&&$(e).prop("checked",!0)}))}))):"editMcType"===r?i?($("#myCharacters").click(),$(".myCharacters_Box,.noFoundMc,.Mycharacters_loading").hide(),$(".createMyCharacter_Box").show(),$(".createBtn").addClass("active"),$(".myCharactersBox .classify").hide(),"create"===i?(gtag("event","show_aigirlfriend_create"),$(".createMc_container").removeClass("editStart")):(gtag("event","show_aigirlfriend_edit"),$(".createMc_container").addClass("editStart"))):($(".myCharactersBox .classify").show(),t.composeClassify($(".myCharactersBox"))):"homeTag"===r?t.initCharacters():"mcTag"!==r&&"primary"!==r||t.GetMyCharacters(),"tab"!=r&&"CharactersCount"!=r&&"MyCharactersCount"!=r||t.pageProcess();case 3:case"end":return a.stop()}}),a)}))),10),e[r]=i,!0},get:function(e,t){return e[t]}}),Object.setPrototypeOf(e.prototype,this.proxy),this.access_token=getCookie("access_token")?getCookie("access_token"):"",getCookie("aiGirlSort")&&this.access_token){var r=getCookie("aiGirlSort");this.sort=r;var i=$(".character_select .select_list_item[data-sort='".concat(r,"']"));$(".character_select .select_list_item[data-sort]").removeClass("active"),i.addClass("active"),i.parents(".select_list").siblings(".select_content").text(i.text()),"top"==this.sort&&$(".select_time").css("display","flex")}$(window).bind("beforeunload",(function(){this.access_token=getCookie("access_token")?getCookie("access_token"):"",this.access_token||setCookie("aiGirlSort","")}))}),[{key:"data",value:function(){return{access_token:"",charactersList:[],mycharactersList:[],recentCharacters:[],sort:"",sort_time:"",tab:"all",isLoading:!1,isMyLoading:!1,isLike:!1,num:0,numMy:0,CharactersPage:0,MyCharactersPage:0,CharactersCount:0,MyCharactersCount:0,editMcType:"",classifys:[],homeTag:[],mcTag:[],primary:"",mc_Avatar:"",mc_Name:"",mc_Desc:"",mc_Gender:"",mc_Background:"",mc_Persona:"",mc_visibility:jsonAiGirlFriend.classifySelect.Public,mc_Categories:[],mc_Greeting:"",mc_Scenario:"",mc_Dialogue:"",my_characters_id:0,head_portrait:[],head_portrait_background:[],mc_roleId:"",is_draft:!1,oldRoleInfo:{},isUploadAvatar:!1,isUploadBackground:!1}}},{key:"init",value:(u=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initCharacters();case 2:this.pageProcess(),this.GetMyCharacters(),this.GetRecentChatting(),this.GetClassify(),this.clickFn(),this.eventLoginsuccess(),this.composeBrief();case 9:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"initCharacters",value:(h=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,i,a,n,s,c=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!(c.length>0&&void 0!==c[0])||c[0],this.num++,this.isShowCharacterLoading(!0,!t),r=this.sort?this.sort:"hot",t?this.CharactersPage=0:this.CharactersPage++,e.prev=6,e.next=9,fetchGet("chat/user/get-role-list?sort=".concat(r,"&sort_time=").concat(this.sort_time,"&is_like=").concat(this.isLike?1:2,"&page=").concat(this.CharactersPage,"&tag=").concat(this.homeTag.join(",")));case 9:200===(i=e.sent).code&&(a=i.data.list,this.CharactersCount=i.data.page_count,n="",s=0,a.forEach((function(e,t){var r,i,a;s>=6?s=1:s++;var c=null===(r=e.json)||void 0===r?void 0:r.tag.split(",");n+='<div class="characters_item" data-indexId="'.concat(e.id,'" data-id="').concat(e.role_id,'">\n          <div class="headPortrait">\n            <img src="').concat(null===(i=e.head_portrait[0])||void 0===i?void 0:i.url,'" alt="" class="avatar">\n            <div class="share_icon">\n              <img src="/dist/img/aiGirlFriend/btn_more_normal.svg" />\n            </div>\n            <div class="head_shareBox">\n            ').concat(1==e.is_self?'<div class="editInbox" >\n                <div class="icon"></div>'.concat(jsonAiGirlFriend.edit,"\n              </div>"):"",'\n              <div class="shareInbox">\n                <div class="icon"></div>').concat(jsonAiGirlFriend.Share,'\n              </div>\n            </div>\n            <div class="chat_info">\n              <img src="/dist/img/aiGirlFriend/icon_chat.svg" alt="">\n              <span>').concat(formatNumber(e.msg_num),'</span>\n            </div>\n          </div>\n          <div class="character_info">\n            <div class="character_name">').concat(e.name,'</div>\n            <div class="infoBox">\n              <div class="info_l">\n                <div class="like_icon ').concat(1===e.is_like?"active":"",'" data-likes="').concat(e.like_num,'"></div>\n                <span class="num">').concat(formatNumber(e.like_num),'</span>\n                <div class="like_num">').concat(e.like_num>1?jsonAiGirlFriend.likes:jsonAiGirlFriend.like,'</div>\n               </div>\n              <div class="info_r">\n                <button class="chatNow">').concat(jsonAiGirlFriend.chatNow,'</button>\n              </div>\n            </div>\n          </div>\n          <div class="brief_hover"></div>\n          <div class="brief">\n            <div class="brief_top">\n              <img class="brief_avatar" src="').concat(null===(a=e.head_portrait[0])||void 0===a?void 0:a.url,'"/>\n              <div class="tagBox">\n                <div class="brief_tag" style="display:').concat(c.length>1&&c[c.length-2]?"block":"none",'">').concat(c[c.length-2],'</div>\n                <div class="brief_tag" style="display:').concat(c.length>0&&c[c.length-1]?"block":"none",'">').concat(c[c.length-1],'</div>\n              </div>\n            </div>\n            <div class="brief_name">').concat(e.json.Character_name,'</div>\n            <div class="brief_created">').concat(e.json.Created,'</div>\n            <div class="brief_des">').concat(e.json.Character_des,"</div>\n          </div>\n        </div>")})),t?(this.charactersList=a,$(".characters").html(n)):(this.charactersList=[].concat(_toConsumableArray(this.charactersList),_toConsumableArray(a)),$(".characters").append(n))),this.num--,this.isShowCharacterLoading(!1),e.next=20;break;case 15:e.prev=15,e.t0=e.catch(6),this.num--,this.isShowCharacterLoading(!1),console.log(e.t0,"error Failed to initialize all characters");case 20:case"end":return e.stop()}}),e,this,[[6,15]])}))),function(){return h.apply(this,arguments)})},{key:"GetMyCharacters",value:(d=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,i,a,n,s,c=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!(c.length>0&&void 0!==c[0])||c[0],e.prev=1,this.numMy++,this.isShowMyCharacterLoading(!0,!t),t?this.MyCharactersPage=0:this.MyCharactersPage++,e.next=7,fetchGet("chat/user/get-role-list?type=my_characters&page=".concat(this.MyCharactersPage,"&tag=").concat(this.mcTag.join(","),"&role_type=").concat(this.primary.toLowerCase()));case 7:200===(r=e.sent).code&&(i=r.data.list,this.MyCharactersCount=r.data.page_count,a="",n=0,s=$(".edit:not(.recent)").hasClass("active"),i.forEach((function(e,t){var r,i,c;n>=6?n=1:n++;var o=null===(r=e.json)||void 0===r?void 0:r.tag.split(",");a+='<div class="myCharacters_item" data-indexId="'.concat(e.id,'" data-id="').concat(e.role_id,'" data-status="').concat(e.status,'">\n                        <div class="headPortrait">\n                          <img src="').concat(null===(i=e.head_portrait[0])||void 0===i?void 0:i.url,'" alt="" class="avatar" />\n                          <div class="share_icon" style="display: ').concat(s?"none":"flex",';">\n                            <img src="/dist/img/aiGirlFriend/btn_more_normal.svg" />\n                          </div> \n                          <div class="lock_icon" style="display:').concat(2==e.type?"block":"none",'"></div>\n                          <div class="head_shareBox">\n                            <div class="editInbox">\n                              <div class="icon"></div>').concat(jsonAiGirlFriend.edit,"\n                            </div>\n                            ").concat(1==e.status&&2!=e.type?'<div class="shareInbox" style="display:">\n                              <div class="icon"></div>'.concat(jsonAiGirlFriend.Share,"\n                            </div>"):"",'\n                          </div>\n                          <div class="deleteChat ').concat(s?"active":"",'">\n                            <img src="/dist/img/aiGirlFriend/btn_close_big_normal.svg" alt="" class="" />\n                          </div>\n                        </div>\n                        \n                        <div class="character_info">\n                          <div class="character_name">').concat(e.name,'</div>\n                          <div class="infoBox">\n                            <div class="info_l">\n                              <div class="like_icon ').concat(1===e.is_like?"active":"",'"" data-likes="').concat(e.like_num,'" style="display:').concat(4!=e.status?"block":"none",'"></div>\n                                    </div>\n                            <div class="info_r">\n                            ').concat(4!=e.status?'<button class="chatNow">'.concat(jsonAiGirlFriend.chatNow,"</button>"):'<button class="editDraft"><div class="icon"></div>'.concat(jsonAiGirlFriend.edit,"</button>"),'\n                            </div>\n                          </div>\n                        </div>\n                        <div class="brief_hover"></div>\n                        <div class="brief">\n                          <div class="brief_top">\n                            <img class="brief_avatar" src="').concat(null===(c=e.head_portrait[0])||void 0===c?void 0:c.url,'"/>\n                            <div class="tagBox">\n                              <div class="brief_tag" style="display:').concat(o.length>1&&o[o.length-2]?"block":"none",'">').concat(o[o.length-2],'</div>\n                                    <div class="brief_tag" style="display:').concat(o.length>0&&o[o.length-1]?"block":"none",'">').concat(o[o.length-1],'</div>\n                          </div>\n                        </div>\n                        <div class="brief_name">').concat(e.json.Character_name,'</div>\n                        <div class="brief_created">').concat(e.json.Created,'</div>\n                        <div class="brief_des">').concat(e.json.Character_des,"</div>\n                      </div>\n                      </div>")})),t?(this.mycharactersList=i,$(".myCharacters").html(a)):(this.mycharactersList=[].concat(_toConsumableArray(this.mycharactersList),_toConsumableArray(i)),$(".myCharacters").append(a)),this.numMy--,this.isShowMyCharacterLoading(!1)),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(1),this.numMy--,this.isShowMyCharacterLoading(!1),console.log(e.t0,"error Failed to initialize my chat partner");case 16:case"end":return e.stop()}}),e,this,[[1,11]])}))),function(){return d.apply(this,arguments)})},{key:"GetRecentChatting",value:(l=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,i,a,n=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetchGet("chat/user/get-role-list?type=recent_chatting");case 3:200===(t=e.sent).code&&((r=t.data.list).length>0?(i=$(".edit.recent").hasClass("active"),$(".Recent_hr").css("display","flex"),$(".RecentChatting").css("display","flex"),this.recentCharacters=r,a="",r.forEach((function(e,t){var r;a+='<div class="Recent_item" data-index="'.concat(t,'" data-id="').concat(e.chat_id,'">\n                          <img src="').concat(null===(r=e.head_portrait[0])||void 0===r?void 0:r.url,'" alt="" class="recent_head_port"/>\n                          <div class="name">').concat(e.name,'</div>\n                          <div class="deleteChat recent ').concat(i?"active":"",'" style="display: ').concat(i?"flex":"none",';">\n                            <img src="/dist/img/aiGirlFriend/btn_close_normal.svg" alt="" class="" />\n                          </div>\n                        </div>')})),$(".RecentChattingBox").html(a),setTimeout((function(){n.composeRecent()}),200)):($(".Recent_hr").hide(),$(".RecentChatting").hide(),$(".RecentChattingBox").html(""),$(".edit.recent").removeClass("active").text(jsonAiGirlFriend.edit))),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0,"error Failed to initialize recentCharacters");case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return l.apply(this,arguments)})},{key:"GetClassify",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,i,a,n=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetchGet("chat/user/get-setting?type=tag");case 3:200===(t=e.sent).code&&(r=t.data).length>0&&(this.classifys=r,i="<div class=\"classify_item active\" data-tag=''>".concat(jsonAiGirlFriend.AllCharacters,"</div>"),a="",r.forEach((function(e){i+='<div class="classify_item" data-tag=\''.concat(e,"'>").concat(e,"</div>"),a+='<div class="check_item">\n                                <input type="checkbox" value="'.concat(e,'" class="createMc_radio" />\n                                <label for="').concat(e,'">').concat(e,"</label>\n                              </div>")})),$(".classify_box_container").append(i),$(".createMc_checkbox").html(a),setTimeout((function(){n.composeClassify($(".SegmentBox")),n.composeClassify($(".myCharactersBox"))}),200)),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0,"error Failed to initialize classify");case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return o.apply(this,arguments)})},{key:"GetSettingInfo",value:(c=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,i,a=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,e.next=4,fetchPost("ai/tool/get-task",{id:t});case 4:if(200!==(r=e.sent).code){e.next=20;break}if(0!==r.data.status){e.next=18;break}return i=r.data.additional_data,this.mc_Dialogue=i.example_chat,this.mc_Greeting=i.greeting,this.mc_Persona=i.persona,this.mc_Scenario=i.scenario,$(".createMC_persona").val(this.mc_Persona).get(0).dispatchEvent(evt),$(".createMC_Greeting").val(this.mc_Greeting).get(0).dispatchEvent(evt),$(".createMC_Scenario").val(this.mc_Scenario).get(0).dispatchEvent(evt),$(".createMC_Dialogue").val(this.mc_Dialogue).get(0).dispatchEvent(evt),this.editMcType="edit",e.abrupt("return");case 18:e.next=29;break;case 20:if(!(tryTimes<=3)){e.next=27;break}return console.log("try repeat1 -",tryTimes),tryTimes++,setTimeout((function(){a.GetSettingInfo(t)}),3e3),e.abrupt("return");case 27:case 41:return $Popup({title:jsonAiGirlFriend.failedMsg.normalTitle,content:jsonAiGirlFriend.failedMsg.generateError,type:"error"}),e.abrupt("return");case 29:e.next=43;break;case 31:if(e.prev=31,e.t0=e.catch(1),console.log(e.t0,"error"),!(tryTimes<=3)){e.next=41;break}return console.log("try repeat2 -",tryTimes),tryTimes++,setTimeout((function(){a.GetSettingInfo(t)}),3e3),e.abrupt("return");case 43:return e.next=45,new Promise((function(e){return setTimeout(e,2e3)}));case 45:e.next=0;break;case 47:case"end":return e.stop()}}),e,this,[[1,31]])}))),function(e){return c.apply(this,arguments)})},{key:"addTaskGetSettingInfo",value:(s=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetchPost("ai/ai-tool/add-task",{action:"aichat_role_generate",param:{type:2,name:this.mc_Name,description:this.mc_Desc}});case 3:if(t=e.sent,tryTimes=0,200==t.code){e.next=8;break}return $Popup({title:jsonAiGirlFriend.failedMsg.normalTitle,content:jsonAiGirlFriend.failedMsg.generateError,type:"error"}),e.abrupt("return");case 8:return e.next=10,this.GetSettingInfo(t.data.task_id);case 10:e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),$Popup({title:jsonAiGirlFriend.failedMsg.normalTitle,content:jsonAiGirlFriend.failedMsg.generateError,type:"error"}),console.log(e.t0,"error get-task");case 16:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(){return s.apply(this,arguments)})},{key:"GetRoleInfo",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,i,a,n,s,c,o,l=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.length>1&&void 0!==l[1]?l[1]:2,i=l.length>2&&void 0!==l[2]?l[2]:0,e.prev=2,e.next=5,fetchGet("chat/user/get-role-info?id=".concat(t,"&is_my_characters=").concat(r,"&my_characters_id=").concat(i));case 5:200===(a=e.sent).code&&(o=a.data,this.my_characters_id=o.my_characters_id,this.mc_Avatar=o.head_portrait[0].url,this.mc_Name=o.name,this.mc_Desc=o.json.Character_des,this.mc_Background=null===(n=o.head_portrait_background[0])||void 0===n?void 0:n.url,this.mc_Persona=o.persona,this.mc_Gender=o.json.gender,this.is_draft=4==o.status,this.mc_visibility=1==o.type?jsonAiGirlFriend.classifySelect.Public:jsonAiGirlFriend.classifySelect.Private,this.mc_Categories=o.json.tag.length>0?o.json.tag.split(","):[],this.mc_Greeting=o.role_content.greeting.toString(),this.mc_Scenario=o.role_content["scene description"],this.mc_Dialogue=o.role_content.context,this.head_portrait=o.head_portrait,this.head_portrait_background=o.head_portrait_background,this.mc_roleId=o.role_id,$("#createMC_background_img").attr("src",null===(s=o.head_portrait_background[0])||void 0===s?void 0:s.url),$("#createMC_avatar_img").attr("src",null===(c=o.head_portrait[0])||void 0===c?void 0:c.url),$(".whiteMeOut").val(this.mc_Desc).get(0).dispatchEvent(evt),$(".createMC_name").val(this.mc_Name).get(0).dispatchEvent(evt),$(".createMC_gender").val(this.mc_Gender).get(0).dispatchEvent(evt),$(".createMC_persona").val(this.mc_Persona).get(0).dispatchEvent(evt),$(".createMC_Greeting").val(this.mc_Greeting).get(0).dispatchEvent(evt),$(".createMC_Scenario").val(this.mc_Scenario).get(0).dispatchEvent(evt),$(".createMC_Dialogue").val(this.mc_Dialogue).get(0).dispatchEvent(evt),this.oldRoleInfo={role_id:this.mc_roleId,name:this.mc_Name,type:this.mc_visibility,is_draft:this.is_draft,tag:this.mc_Categories.join(","),description:this.mc_Desc,persona:this.mc_Persona,scene:this.mc_Scenario,greeting:this.mc_Greeting,context:this.mc_Dialogue,head_portrait:JSON.stringify(this.head_portrait),head_portrait_background:JSON.stringify(this.head_portrait_background)}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),console.log(e.t0,"error get role info");case 12:case"end":return e.stop()}}),e,this,[[2,9]])}))),function(e){return n.apply(this,arguments)})},{key:"GetAiDesc",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,i,a,n=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:function(){},e.prev=1,e.next=4,fetchGet("chat/user/get-setting?type=role");case 4:200===(r=e.sent).code&&(i=r.data,a=randomchoice(i),$(".whiteMe").val(a().description),null==t||t()),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.log(e.t0,"error get role info");case 11:case"end":return e.stop()}}),e,null,[[1,8]])}))),function(){return a.apply(this,arguments)})},{key:"roleEdit",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,i,a,n,s,c,o,l,d=this,h=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=h.length>0&&void 0!==h[0]?h[0]:function(){},r=h.length>1&&void 0!==h[1]?h[1]:function(){},e.prev=2,this.mc_visibility==jsonAiGirlFriend.classifySelect.Public?(i=1,gtag("event","public_aigirlfriend_edit")):(i=2,gtag("event","private_aigirlfriend_edit")),a=this.is_draft?1:2,n=this.head_portrait,s=this.head_portrait_background,delete n.url,delete s.url,c={role_id:this.mc_roleId,my_characters_id:this.my_characters_id,name:this.mc_Name.trim(),type:i,is_draft:a,persona:this.mc_Persona.trim(),gender:this.mc_Gender.trim(),tag:this.mc_Categories.join(","),description:this.mc_Desc.trim(),scene:this.mc_Scenario.trim(),greeting:this.mc_Greeting.trim(),context:this.mc_Dialogue.trim(),head_portrait:JSON.stringify(n),head_portrait_background:JSON.stringify(s)},e.next=11,fetchPost("chat/user/role-edit",c,{},!1);case 11:401==(o=e.sent).code?(gtag("event","alert_aigirlfriend_loginwinedit"),l=$Popup({title:jsonAiGirlFriend.createMc.bootLoginTitle,content:jsonAiGirlFriend.createMc.bootLoginDesc,closeBtn:jsonAiGirlFriend.login,applyBtn:jsonAiGirlFriend.createMc.NotNow,autoClose:!1,exist:"bootLogin",onClose:function(){gtag("event","login_aigirlfriend_loginwinedit"),l.close(),showLoginWindow({fn:function(){gtag("evet","succ_aigirlfriend_loginwinedit")}})},onApply:function(){gtag("event","notnow_aigirlfriend_loginwindit"),l.close(),d.closeCD(),d.clearInput(),d.editMcType=""},topCloseFn:function(){gtag("event","close_aigirlfriend_loginwinedit")}}),null==r||r()):200===o.code?null==t||t():(this.is_draft?$Popup({title:jsonAiGirlFriend.failedMsg.normalTitle,content:jsonAiGirlFriend.failedMsg.draftSaveError,type:"error"}):$Popup({title:jsonAiGirlFriend.failedMsg.normalTitle,content:jsonAiGirlFriend.failedMsg.publishError,type:"error"}),null==r||r()),e.next=21;break;case 15:e.prev=15,e.t0=e.catch(2),console.log(r,"error"),this.is_draft?$Popup({title:jsonAiGirlFriend.failedMsg.normalTitle,content:jsonAiGirlFriend.failedMsg.draftSaveError,type:"error"}):$Popup({title:jsonAiGirlFriend.failedMsg.normalTitle,content:jsonAiGirlFriend.failedMsg.publishError,type:"error"}),null==r||r(),console.log(e.t0," create or edit role error");case 21:case"end":return e.stop()}}),e,this,[[2,15]])}))),function(){return i.apply(this,arguments)})},{key:"addRecentChatting",value:function(e){var t=this;console.log(e,"addRecentChatting");var r,i,a=e.chat_id,n=this.recentCharacters.findIndex((function(e){return e.chat_id==a})),s=$(".edit.recent").hasClass("active"),c="";-1!=n?($(".RecentChattingBox").children().eq(n).insertBefore($(".RecentChattingBox").children().eq(0)),$(".Recent_item").eq(0).find(".recent_head_port").attr("src",null===(r=e.head_portrait[0])||void 0===r?void 0:r.url),$(".Recent_item").eq(0).find(".name").text(e.name),this.recentCharacters.splice(n,1),this.recentCharacters.unshift(e)):(c='<div class="Recent_item" data-id="'.concat(e.chat_id,'">\n        <img src="').concat(null===(i=e.head_portrait[0])||void 0===i?void 0:i.url,'" alt="" class=\'recent_head_port\'/>\n        <div class="name">').concat(e.name,'</div>\n        <div class="deleteChat recent ').concat(s?"active":"",'" style="display: ').concat(s?"flex":"none",';">\n          <img src="/dist/img/aiGirlFriend/btn_close_normal.svg" alt="" class="" />\n        </div>\n      </div>'),$(".RecentChattingBox").prepend(c),this.recentCharacters.unshift(e));$(".Recent_hr").css("display","flex"),$(".RecentChatting").css("display","flex"),setTimeout((function(){t.composeRecent()}),500)}},{key:"clickFn",value:function(){var e=this;$(".chatSelect").click((function(){$(this).hasClass("active")?($(this).children(".select_list").slideUp(),$(this).removeClass("active")):($(this).children(".select_list").slideDown(),$(this).addClass("active"),$(this).siblings(".chatSelect").children(".select_list").slideUp())})),$(".select_list_item").click((function(){var t=$(this).data("sort_time"),r=$(this).data("sort"),i=$(this).data("type"),a=$(this).data("primary");if(0!=$(this).parents("#select_sort_time").length&&(e.sort_time=t),0!=$(this).parents("#select_sort").length&&(e.sort=r,"top"==r?$(".select_time").css("display","flex"):$(".select_time").hide()),ttsBlank(i)||(e.mc_visibility=i),0!=$(this).parents(".classify").length)switch(e.composeClassify($(".myCharactersBox")),e.primary=a,a){case"":gtag("event","all_aigirlfriend_filter");break;case jsonAiGirlFriend.classifySelect.Public:gtag("event","public_aigirlfriend_filter");break;case jsonAiGirlFriend.classifySelect.Private:gtag("event","private_aigirlfriend_filter");break;case jsonAiGirlFriend.classifySelect.Draft:gtag("event","draft_aigirlfriend_filter")}if("sort"===Object.keys($(this).data())[0]&&0!=$(this).parents(".character_select").length)switch(getCookie("access_token")?setCookie("aiGirlSort",r):setCookie("aiGirlSort",""),!0){case"top"==r:gtag("event","top_aigirlfriend_hfilter");break;case"hot"==r:gtag("event","hot_aigirlfriend_hfilter")}else switch(!0){case"day"==t:gtag("event","top_aigirlfriend_hdayfilter");break;case"week"==t:gtag("event","top_aigirlfriend_hweekfilter");break;case"month"==t:gtag("event","top_aigirlfriend_hmonthfilter");break;case"year"==t:gtag("event","top_aigirlfriend_hyearfilter");break;case""==t:gtag("event","top_aigirlfriend_halltimefilter")}$(this).addClass("active"),$(this).siblings(".select_list_item").removeClass("active"),$(this).parents(".select_list").siblings(".select_content").text($(this).text()),0==$(this).parents(".createMyCharacter_Box ").length&&$(".description")[0].scrollIntoView({behavior:"smooth",block:"start",inline:"end"}),e.initCharacters()})),$(".heart").click((function(){$(".Characters_hr")[0].scrollIntoView({behavior:"instant",block:"start",inline:"end"}),$(this).hasClass("active")?e.isLike=!1:(e.isLike=!0,gtag("event","like_aigirlfriend_hfilter")),$(this).toggleClass("active"),e.initCharacters()})),$(".Segment_item").click((function(){$(".Segment_item").removeClass("active"),$("body")[0].scrollIntoView({behavior:"instant",inline:"nearest"}),$(this).addClass("active"),"myCharacters"===$(this).attr("id")?(gtag("event","click_aigirlfriend_mytab"),e.tab="my",$(".myCharactersBox").show(),$(".SegmentBox").hide(),e.composeClassify($(".myCharactersBox"))):(gtag("event","click_aigirlfriend_htab"),e.tab="all",$(".SegmentBox").show(),$(".myCharactersBox").hide(),e.composeRecent(),e.composeClassify($(".SegmentBox")))})),$(".edit").click((function(){$(this).hasClass("active")?($(this).removeClass("active"),$(this).text(jsonAiGirlFriend.edit),$(this).hasClass("recent")?($(".Recent_item .deleteChat").removeClass("active").hide(),gtag("event","click_aigirlfriend_hrctedit")):($(".myCharacters_item .deleteChat").removeClass("active").hide(),gtag("event","click_aigirlfriend_mycedit"),$(".myCharacters_item .share_icon").css("display","flex"))):($(this).addClass("active"),$(this).text(jsonAiGirlFriend.Done),$(this).hasClass("recent")?($(".Recent_item .deleteChat").addClass("active").css("display","flex"),gtag("event","click_aigirlfriend_hrctedit")):($(".myCharacters_item .deleteChat").addClass("active").show(),gtag("event","click_aigirlfriend_mycedit"),$(".myCharacters_item .share_icon").hide()))})),$(".createMc").click((function(){e.editMcType="create",$(this).hasClass("createBtn")?gtag("event","click_aigirlfriend_create"):gtag("event","click_aigirlfriend_nodatacreate")})),$(".create_back_box,.mc_btn.discard").click((function(){if("edit"==e.editMcType)if($(this).hasClass("discard")?gtag("event","discard_aigirlfriend_edit"):gtag("event","back_aigirlfriend_edit"),getCookie("access_token")){var t={role_id:e.mc_roleId,name:e.mc_Name,type:e.mc_visibility,is_draft:e.is_draft,tag:e.mc_Categories.join(","),description:e.mc_Desc,scene:e.mc_Scenario,persona:e.mc_Persona,greeting:e.mc_Greeting,context:e.mc_Dialogue,head_portrait:JSON.stringify(e.head_portrait),head_portrait_background:JSON.stringify(e.head_portrait_background)};if(areObjectsEqual(t,e.oldRoleInfo))e.closeCD(),e.clearInput(),e.editMcType="";else var r=$Popup({title:jsonAiGirlFriend.toSaveTitle,content:jsonAiGirlFriend.toSaveDesc,closeBtn:jsonAiGirlFriend.save,applyBtn:jsonAiGirlFriend.createMc.NotNow,autoClose:!1,exist:"bootLogin",onClose:function(){r.loading.start(),e.is_draft=!0,e.editDraftUpload((function(){r.close(),e.editMcType=""}),(function(){r.close()}))},onApply:function(){r.close(),e.closeCD(),e.clearInput(),e.editMcType=""}})}else{gtag("event","alert_aigirlfriend_loginwinedit");var i=$Popup({title:jsonAiGirlFriend.createMc.bootLoginTitle,content:jsonAiGirlFriend.createMc.bootLoginDesc,closeBtn:jsonAiGirlFriend.login,applyBtn:jsonAiGirlFriend.createMc.NotNow,autoClose:!1,exist:"bootLogin",onClose:function(){gtag("event","login_aigirlfriend_loginwinedit"),i.close(),showLoginWindow({fn:function(){gtag("evet","succ_aigirlfriend_loginwinedit")}})},onApply:(a=_asyncToGenerator(_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return gtag("event","notnow_aigirlfriend_loginwindit"),i.close(),t.next=4,e.closeCD();case 4:e.clearInput(),e.editMcType="";case 6:case"end":return t.stop()}}),t)}))),function(){return a.apply(this,arguments)}),topCloseFn:function(){gtag("event","close_aigirlfriend_loginwinedit")}})}else e.closeCD(),e.clearInput(),e.editMcType="";var a})),$("#createMc").click(_asyncToGenerator(_regeneratorRuntime().mark((function t(){var r;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=!0,e.mc_Avatar?$(".erorrTip[data-type='avatar']").css("visibility","hidden"):($(".erorrTip[data-type='avatar']").find(".image_error").text(jsonAiGirlFriend.createMc.avatar_not),$(".erorrTip[data-type='avatar']").css("visibility","visible"),r=!1),e.mc_Name&&0!=$(".maxLength[data-input='name'] span").text()?$(".erorrTip[data-type='name']").css("visibility","hidden"):($(".erorrTip[data-type='name']").css("visibility","visible"),r=!1),e.mc_Desc&&0!=$(".maxLength[data-input='description'] span").text()?$(".erorrTip[data-type='description']").css("visibility","hidden"):($(".erorrTip[data-type='description']").css("visibility","visible"),r=!1),r){t.next=6;break}return t.abrupt("return");case 6:return gtag("event","click_aigirlfriend_aicreate"),e.oldRoleInfo={role_id:e.mc_roleId,name:e.mc_Name,type:e.mc_visibility,is_draft:e.is_draft,tag:e.mc_Categories.join(","),description:e.mc_Desc,scene:e.mc_Scenario,greeting:e.mc_Greeting,persona:e.persona,context:e.mc_Dialogue,head_portrait:JSON.stringify(e.head_portrait),head_portrait_background:JSON.stringify(e.head_portrait_background)},$(this).addClass("loading"),$(".createMc_item,.create_back_box").addClass("loading"),t.next=12,e.addTaskGetSettingInfo();case 12:$(this).removeClass("loading"),$(".createMc_item,.create_back_box").removeClass("loading");case 14:case"end":return t.stop()}}),t,this)})))),$("#editMc").click(_asyncToGenerator(_regeneratorRuntime().mark((function t(){var r,i,a,n=this;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(gtag("event","publish_aigirlfriend_edit"),r=!0,e.mc_Avatar?$(".erorrTip[data-type='avatar']").css("visibility","hidden"):($(".erorrTip[data-type='avatar']").find(".image_error").text(jsonAiGirlFriend.createMc.avatar_not),$(".erorrTip[data-type='avatar']").css("visibility","visible"),r=!1),e.mc_Name&&0!=$(".maxLength[data-input='name'] span").text()?$(".erorrTip[data-type='name']").css("visibility","hidden"):($(".erorrTip[data-type='name']").css("visibility","visible"),r=!1),e.mc_Persona&&0!=$(".maxLength[data-input='persona'] span").text()?$(".erorrTip[data-type='persona']").css("visibility","hidden"):($(".erorrTip[data-type='persona']").css("visibility","visible"),r=!1),e.mc_Desc&&0!=$(".maxLength[data-input='description'] span").text()?$(".erorrTip[data-type='description']").css("visibility","hidden"):($(".erorrTip[data-type='description']").css("visibility","visible"),r=!1),0==e.mc_Categories.length?($(".erorrTip[data-type='Categories']").css("visibility","visible"),r=!1):$(".erorrTip[data-type='Categories']").css("visibility","hidden"),e.mc_Greeting&&0!=$(".maxLength[data-input='Greeting'] span").text()?$(".erorrTip[data-type='Greeting']").css("visibility","hidden"):($(".erorrTip[data-type='Greeting']").css("visibility","visible"),r=!1),e.mc_Scenario&&0!=$(".maxLength[data-input='Scenario'] span").text()?$(".erorrTip[data-type='Scenario']").css("visibility","hidden"):($(".erorrTip[data-type='Scenario']").css("visibility","visible"),r=!1),r){t.next=11;break}return t.abrupt("return");case 11:if(getCookie("access_token")){t.next=15;break}return gtag("event","alert_aigirlfriend_loginwinedit"),i=$Popup({title:jsonAiGirlFriend.createMc.bootLoginTitle,content:jsonAiGirlFriend.createMc.bootLoginDesc,closeBtn:jsonAiGirlFriend.login,applyBtn:jsonAiGirlFriend.createMc.NotNow,autoClose:!1,exist:"bootLogin",onClose:function(){gtag("event","login_aigirlfriend_loginwinedit"),i.close(),showLoginWindow({fn:function(){gtag("evet","succ_aigirlfriend_loginwinedit")}})},onApply:function(){gtag("event","notnow_aigirlfriend_loginwindit"),e.editMcType="",i.close(),e.closeCD()},topCloseFn:function(){gtag("event","close_aigirlfriend_loginwinedit")}}),t.abrupt("return");case 15:return e.is_draft=!1,$(this).addClass("loading"),a=function(){return $(n).removeClass("loading")},t.next=20,e.editDraftUpload(a,a,"all");case 20:case"end":return t.stop()}}),t,this)})))),$("#draftMc").click(_asyncToGenerator(_regeneratorRuntime().mark((function t(){var r,i,a=this;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(gtag("event","draft_aigirlfriend_edit"),getCookie("access_token")){t.next=5;break}return gtag("event","alert_aigirlfriend_loginwinedit"),r=$Popup({title:jsonAiGirlFriend.createMc.bootLoginTitle,content:jsonAiGirlFriend.createMc.bootLoginDesc,closeBtn:jsonAiGirlFriend.login,applyBtn:jsonAiGirlFriend.createMc.NotNow,autoClose:!1,exist:"bootLogin",onClose:function(){gtag("event","login_aigirlfriend_loginwinedit"),r.close(),showLoginWindow({fn:function(){gtag("evet","succ_aigirlfriend_loginwinedit")}})},onApply:function(){gtag("event","notnow_aigirlfriend_loginwindit"),r.close(),e.closeCD()},topCloseFn:function(){gtag("event","close_aigirlfriend_loginwinedit")}}),t.abrupt("return");case 5:return e.is_draft=!0,$(this).addClass("loading"),i=function(){return $(a).removeClass("loading")},t.next=10,e.editDraftUpload(i,i,"draft");case 10:case"end":return t.stop()}}),t,this)})))),$(".addImage").click((function(){0!=$(this).parents(".avatar").length?$("#createMC_avatar").click():$("#createMC_background").click()})),$("#createMC_avatar").on("change",function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function t(r){var i=this;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.isUploadAvatar=!0,e.uploadImage($(".avatar"),r,this,"avatar",(function(){$(i).val("")}));case 2:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()),$("#createMC_background").on("change",function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function t(r){var i=this;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.isUploadBackground=!0,e.uploadImage($("#background"),r,this,"background",(function(){$(i).val("")}));case 2:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()),$(".delete_image").click((function(){0!=$(this).parents(".avatar").length?e.mc_Avatar="":e.mc_Background=""})),$(".writeMe").click((function(){gtag("event","show_aigirlfriend_aiwrite");var t=$Popup({type:"createMC",title:jsonAiGirlFriend.createMc.writeMe_title,content:$(".whiteMeContent").html(),closeBtn:jsonAiGirlFriend.createMc.Generate,applyBtn:jsonAiGirlFriend.createMc.Apply,autoClose:!1,exist:"exist",onClose:function(){gtag("event","generate_aigirlfriend_aiwrite"),t.loading.start(),e.GetAiDesc((function(){t.loading.end()}))},onApply:function(){gtag("event","apply_aigirlfriend_aiwrite");var r=$(".createMC .whiteMe").val();r.length>0&&(e.mc_Desc=r,t.close())}})})),$(".whiteMe,.whiteMeOut").on("input",(function(){var t=e.inputCharacter($(this),500,"description");$(this).hasClass("whiteMeOut")&&(e.mc_Desc=t)})),$(".createMC_name").on("input",(function(){var t=e.inputCharacter($(this),30,"name");e.mc_Name=t})),$(".createMC_gender").on("input",(function(){var t=e.inputCharacter($(this),30,"gender");e.mc_Gender=t})),$(".createMC_persona").on("input",(function(){var t=e.inputCharacter($(this),500,"persona");e.mc_Persona=t})),$(".createMC_Greeting").on("input",(function(){var t=e.inputCharacter($(this),330,"Greeting");e.mc_Greeting=t})),$(".createMC_Scenario").on("input",(function(){var t=e.inputCharacter($(this),500,"Scenario");e.mc_Scenario=t})),$(".createMC_Dialogue").on("input",(function(){var t=e.inputCharacter($(this),700,"Dialogue");e.mc_Dialogue=t})),$("body").on("mouseup",function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function t(r){var i,a,n,s,c,o,l,d,h,u,g,_,p,f,m,v,y,b,C,k,x,w,G,M,T,A,F,j,R,L;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=$(r.target),a=0!=i.parents(".characters_item").length||i.hasClass("characters_item"),n=0!=i.parents(".myCharacters_item").length||i.hasClass("myCharacters_item"),a&&(c=i.parents(".characters_item").attr("data-indexid"),s=e.charactersList.findIndex((function(e){return parseInt(e.id)==parseInt(c)}))),n&&(o=i.parents(".myCharacters_item").attr("data-indexid"),l=e.mycharactersList.findIndex((function(e){return parseInt(e.id)==parseInt(o)})),s=l>=0?l:s),0!=i.parents(".chatSelect").length||i.hasClass("chatSelect")||$(".chatSelect").removeClass("active").children(".select_list").slideUp(),0==i.parents(".head_shareBox").length&&$(".head_shareBox").hide(),!i.hasClass("like_icon")){t.next=18;break}if(d=i.parents(".characters_item").data("id")||i.parents(".myCharacters_item").data("id"),0==(h=i.parents(".myCharacters_item").find(".deleteChat")).length||!h.hasClass("active")){t.next=12;break}return t.abrupt("return");case 12:return 0!=i.parents(".characters_item").length?(u=i.data("likes"),i.hasClass("active")?(u>0?u--:u=0,i.siblings(".num").text(formatNumber(u)),i.siblings(".like_num").text(u>1?jsonAiGirlFriend.likes:jsonAiGirlFriend.like),i.data("likes",u),e.charactersList[s].is_like=2):(u++,i.siblings(".num").text(formatNumber(u)),i.siblings(".like_num").text(u>1?jsonAiGirlFriend.likes:jsonAiGirlFriend.like),i.data("likes",u),gtag("event","click_aigirlfriend_hlikebtn"),e.charactersList[s].is_like=1)):i.hasClass("active")?e.mycharactersList[s].is_like=2:(gtag("event","click_aigirlfriend_myclikebtn"),e.mycharactersList[s].is_like=1),i.toggleClass("active"),e.changeLike(d),t.abrupt("return");case 18:if(0==i.parents(".share_icon").length){t.next=24;break}return(g=i.parents(".share_icon").siblings(".head_shareBox")).hasClass("active")?g.removeClass("active").hide():g.addClass("active").show(),t.abrupt("return");case 24:if(!i.hasClass("shareInbox")){t.next=30;break}return a?(gtag("event","click_aigirlfriend_hshare"),_=e.charactersList[s],e.showShare(_.role_id,_.head_portrait[0].value)):(gtag("event","click_aigirlfriend_mycshare"),p=e.mycharactersList[s],e.showShare(p.role_id,p.head_portrait[0].value)),$(".head_shareBox").hide(),t.abrupt("return");case 30:if(!i.hasClass("editInbox")){t.next=47;break}if(e.editMcType="edit",$("body")[0].scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),0==i.parents(".characters_item").length){t.next=40;break}return gtag("event","click_aigirlfriend_hedit"),f=e.charactersList[s],t.next=38,e.GetRoleInfo(f.role_id,1,f.my_chat_id);case 38:t.next=44;break;case 40:return gtag("event","click_aigirlfriend_mycchatedit"),m=e.mycharactersList[s],t.next=44,e.GetRoleInfo(m.role_id,1,m.my_characters_id);case 44:case 85:return t.abrupt("return");case 47:if(!i.hasClass("classify_item")){t.next=55;break}return $(".description")[0].scrollIntoView({behavior:"smooth",block:"start",inline:"end"}),v=0!=i.parents(".SegmentBox").length,y=i.data("tag"),ttsBlank(y)?v?(e.homeTag=[],gtag("event","htag_aigirlfriend_allcharacters"),$(".SegmentBox .classify_item").removeClass("active"),$(".SegmentBox .classify_item").eq(0).addClass("active")):(e.mcTag=[],gtag("event","mytag_aigirlfriend_allcharacters"),$(".myCharactersBox .classify_item").removeClass("active"),$(".myCharactersBox .classify_item").eq(0).addClass("active")):(v?($(".SegmentBox .classify_item").eq(0).removeClass("active"),-1!==(b=e.homeTag.findIndex((function(e){return e===y})))?e.homeTag.splice(b,1):(e.homeTag.push(y),C=(C=i.attr("data-tag")).replace(/\s+/g,"").toLowerCase(),gtag("event","htag_aigirlfriend_".concat(C))),k=e.homeTag,e.homeTag=k,0==e.homeTag.length&&$(".SegmentBox .classify_item").eq(0).addClass("active")):($(".myCharactersBox .classify_item").eq(0).removeClass("active"),-1!==(x=e.mcTag.findIndex((function(e){return e===y})))?e.mcTag.splice(x,1):(e.mcTag.push(y),w=(w=i.attr("data-tag")).replace(/\s+/g,"").toLowerCase(),gtag("event","mytag_aigirlfriend_".concat(w))),G=e.mcTag,e.mcTag=G,0==e.mcTag.length&&$(".myCharactersBox .classify_item").eq(0).addClass("active")),i.toggleClass("active")),t.abrupt("return");case 55:if(!i.hasClass("createMc_radio")){t.next=60;break}return setTimeout((function(){if(i.is(":checked"))e.mc_Categories.push(i.attr("value"));else{var t=i.attr("value"),r=e.mc_Categories.findIndex((function(e){return e==t}));e.mc_Categories.splice(r,1)}var a=e.mc_Categories;e.mc_Categories=a;var n;n=(e.mc_Categories.length>1?jsonAiGirlFriend.createMc.Categories_tips:jsonAiGirlFriend.createMc.Categories_tip).replace("%ss",e.mc_Categories.length),$(".checkNum").text(n)}),5),t.abrupt("return");case 60:if(0==i.parents(".deleteChat").length){t.next=64;break}i.parents(".deleteChat").hasClass("recent")?(gtag("event","click_aigirlfriend_hrctdelete"),T=i.parents(".Recent_item").attr("data-id"),M=$Popup({title:jsonAiGirlFriend.deleteRecentTitle,content:jsonAiGirlFriend.deleteRecentText,closeBtn:jsonAiGirlFriend.Delete,otherBtns:'<button class="cannel">'.concat(jsonAiGirlFriend.Cancel,"</button>"),autoClose:!1,exist:"deletePop",onClose:function(){gtag("event","del_aigirlfriend_hrctdelete"),M.loading.start(),e.deleteChat(T,_asyncToGenerator(_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.GetRecentChatting();case 2:M.close();case 3:case"end":return t.stop()}}),t)}))))}}),$(".modal .cannel").click((function(){gtag("event","cancel_aigirlfriend_hrctdelete"),M.close()}))):(gtag("event","click_aigirlfriend_mycdelete"),A=e.mycharactersList[s].my_characters_id,M=$Popup({title:jsonAiGirlFriend.deleteMyChatTitle,content:jsonAiGirlFriend.deleteMyChatText,closeBtn:jsonAiGirlFriend.Delete,otherBtns:'<button class="cannel">'.concat(jsonAiGirlFriend.Cancel,"</button>"),autoClose:!1,exist:"deletePop",onClose:function(){gtag("event","del_aigirlfriend_mycdelete"),M.loading.start(),e.deleteMyChat(A,_asyncToGenerator(_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.GetMyCharacters();case 2:return t.next=4,e.GetRecentChatting();case 4:M.close();case 5:case"end":return t.stop()}}),t)}))))}}),$(".modal .cannel").click((function(){gtag("event","cancel_aigirlfriend_mycdelete"),M.close()}))),t.next=97;break;case 64:if(0==i.parents(".characters_item").length){t.next=70;break}return i.hasClass("chatNow")?gtag("event","click_aigirlfriend_hchatbtn"):gtag("event","click_aigirlfriend_hcard"),aiChatting.init(e.charactersList[s]),t.abrupt("return");case 70:if(0==i.parents(".myCharacters_item").length){t.next=88;break}if(i.hasClass("chatNow")?gtag("event","click_aigirlfriend_mycchatbtn"):gtag("event","click_aigirlfriend_myccard"),!i.parents(".myCharacters_item").find(".deleteChat").hasClass("active")){t.next=74;break}return t.abrupt("return");case 74:if(F=i.parents(".myCharacters_item"),4==F.attr("data-status")){t.next=80;break}aiChatting.init(e.mycharactersList[s]),t.next=85;break;case 80:return gtag("event","click_aigirlfriend_myccardedit"),e.editMcType="edit",j=e.mycharactersList[s],t.next=85,e.GetRoleInfo(j.role_id,1,j.my_characters_id);case 88:if(0==i.parents(".Recent_item").length){t.next=97;break}if(!i.parents(".Recent_item").find(".deleteChat").hasClass("active")){t.next=91;break}return t.abrupt("return");case 91:return gtag("event","click_aigirlfriend_hrctcard"),R=i.parents(".Recent_item").attr("data-id"),L=e.recentCharacters.findIndex((function(e){return e.chat_id==R})),console.log(e.recentCharacters[L],"that.recentCharacters[index]"),aiChatting.init(e.recentCharacters[L]),t.abrupt("return");case 97:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),$(".view,.viewMore,.back").click((function(){$(".Recent_item,.RecentChattingBox").css("transform","translateX(0px)"),$(this).hasClass("active")?($(".view").text(jsonAiGirlFriend.view),$(this).removeClass("active"),$(".RecentChatting").removeClass("viewAll"),e.composeRecent(),$(".viewMore").removeClass("active")):($(".view").text(jsonAiGirlFriend.viewLess),$(this).addClass("active"),$(".btn_left,.btn_right").hide(),$(".RecentChatting").addClass("viewAll"),$(".back").addClass("active"))}))}},{key:"editDraftUpload",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,i){var a,n,s=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if($(".createMc_item,.create_back_box").addClass("loading"),e.prev=1,!this.isUploadAvatar){e.next=7;break}return e.next=5,uploadImagePromise(this.mc_Avatar);case 5:a=e.sent,this.head_portrait=[{key:"head_portrait",url:a.res.data.access_url,value:a.res.data.key}];case 7:if(!this.isUploadBackground){e.next=12;break}return e.next=10,uploadImagePromise(this.mc_Background);case 10:n=e.sent,this.head_portrait_background=[{key:"head_portrait_background",url:n.res.data.access_url,value:n.res.data.key}];case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(1),null==r||r(),$(".createMc_item,.create_back_box").removeClass("loading");case 18:return e.next=20,this.roleEdit((function(){null==t||t(),$(".createMc_item,.create_back_box").removeClass("loading"),"all"==i?($(".myCharactersBox .classify_select .select_list_item").removeClass("active"),$(".myCharactersBox .classify_select .select_list_item").eq(0).addClass("active"),$(".myCharactersBox .classify_select .select_content").text(jsonAiGirlFriend.classifySelect.All),s.primary=""):"draft"==i&&($(".myCharactersBox .classify_select .select_list_item").removeClass("active"),$(".myCharactersBox .classify_select .select_list_item").eq(3).addClass("active"),$(".myCharactersBox .classify_select .select_content").text(jsonAiGirlFriend.classifySelect.Draft),s.primary=jsonAiGirlFriend.classifySelect.Draft),$(".classify_box_container .classify_item").removeClass("active"),$(".SegmentBox .classify_item").eq(0).addClass("active"),$(".myCharactersBox .classify_item").eq(0).addClass("active"),s.homeTag=[],s.mcTag=[],s.clearInput(),s.closeCD(),s.editMcType=""}),(function(){null==r||r(),$(".createMc_item,.create_back_box").removeClass("loading")}));case 20:case"end":return e.stop()}}),e,this,[[1,14]])}))),function(e,t,i){return r.apply(this,arguments)})},{key:"isShowCharacterLoading",value:function(e){e&&arguments.length>1&&void 0!==arguments[1]&&arguments[1]?$(".characters_loading").show():e||0!=this.num?($(".noFound").hide(),$(".characters").hide(),$(".characters_loading").show()):(this.isLoading=e,0==this.charactersList.length?$(".noFound").show():$(".characters").show(),$(".characters_loading").hide())}},{key:"isShowMyCharacterLoading",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log("isShowMyCharacterLoading",e,t,""==this.editMcType,this.editMcType),""==this.editMcType?e&&t?$(".Mycharacters_loading").show():e||0!=this.numMy?($(".noFoundMc").hide(),$(".myCharacters_Box").hide(),$(".Mycharacters_loading").show()):(this.isMyLoading=e,0==this.mycharactersList.length?$(".noFoundMc").show():$(".myCharacters_Box").show(),$(".createBtn").hasClass("active")&&$(".myCharacters_Box,.noFoundMc").hide(),$(".Mycharacters_loading").hide()):$(".Mycharacters_loading").hide()}},{key:"changeLike",value:function(e){fetchPost("chat/user/role-like",{role_id:e}).catch((function(e){console.log("role-like",e)}))}},{key:"deleteChat",value:function(e,t){fetchPost("chat/user/del-recent-chatting",{chat_id:e}).then((function(){null==t||t()})).catch((function(e){console.log("del-recent-chatting",e)}))}},{key:"deleteMyChat",value:function(e,t){fetchPost("chat/user/del-my-characters",{my_characters_id:e}).then((function(){null==t||t()})).catch((function(e){console.log("del-my-characters",e)}))}},{key:"composeRecent",value:function(){var e=$(".RecentChatting").width(),t=$(".Recent_item").width(),r=$(".Recent_item").css("margin-right"),i=$(".RecentChatting"),a=$(".RecentChattingBox");a.css("transform","translateX(0px)");var n=(t+parseFloat(r))*$(".Recent_item").length,s=0,c=3*(t+16);isShowBtnLR(s,-(n-e)),$(".btn_right").click((function(){Math.abs(s-c)>=n-e?s=-(n-e):s-=c,a.css("transform","translateX(".concat(s,"px)")),transformBtn(s,-(n-e))})),$(".btn_left").click((function(){s+c>0?s=0:s+=c,a.css("transform","translateX(".concat(s,"px)")),transformBtn(s,-(n-e))})),n>e&&"pc"!=userModel?($(".viewMore").css("visibility","visible"),$(".back").css("display","")):($(".viewMore").css("visibility","hidden"),$(".back").hide(),i.off())}},{key:"composeClassify",value:function(e){var t=e.find(".classify_item"),r=e.find(".classify_box_container").width(),i=e.find(".classify_btn_left"),a=e.find(".classify_btn_right");t.css("transform","translateX(0px)");var n=0;e.find(".classify_item").each((function(){var e=0;e+=$(this).width(),e+=parseFloat($(this).css("margin-right")),e+=parseFloat($(this).css("padding-right")),e+=parseFloat($(this).css("padding-left")),e+=2*parseFloat($(this).css("border-width")),n+=e}));var s=0,c=300;n>r&&"pc"==userModel&&transformBtn(s,-(n-r),i,a),a.click((function(){Math.abs(s-c)>=n-r?s=-(n-r):s-=c,t.css("transform","translateX(".concat(s,"px)")),transformBtn(s,-(n-r),i,a)})),i.click((function(){s+c>0?s=0:s+=c,t.css("transform","translateX(".concat(s,"px)")),transformBtn(s,-(n-r),i,a)}))}},{key:"composeBrief",value:function(){var e=this;$("body").on("mouseover",(function(t){var r=$(t.target);if("pc"==userModel&&(0!=r.parents(".characters_item").length||r.hasClass("characters_item")||0!=r.parents(".myCharacters_item").length||r.hasClass("myCharacters_item"))){var i,a,n;0!=r.parents(".characters_item").length?(i=r.parents(".characters_item").find(".brief"),a=r.parents(".characters_item"),n=e.charactersList.findIndex((function(e){return parseInt(e.id)==parseInt(a.attr("data-indexid"))}))):0!=r.parents(".myCharacters_item").length?(i=r.parents(".myCharacters_item").find(".brief"),a=r.parents(".myCharacters_item"),n=e.mycharactersList.findIndex((function(e){return parseInt(e.id)==parseInt(a.attr("data-indexid"))}))):(i=r.find(".brief"),a=r),i.removeClass("brief_left");var s=$(".aiGirlFriend").width(),c=a.width();n++;var o=Math.floor(s/c);(Number.isInteger(n/o)?1:n/o%1)>.5&&i.addClass("brief_left")}}))}},{key:"showShare",value:function(e,t){gtag("event","share_aigirlfriend_winshow"),$Popup({title:$(".sharePop .shareTitle").html(),content:$(".sharePop .shareBox").html(),type:"share"});var r=TOOL_API+"chat/user/share?s="+btoa(t+","+window.location.origin+window.location.pathname+"?openShare="+e+",en");$('meta[name="twitter:image"]').attr("content",t),$("meta[property='og:image']").attr("content",t),$(".shareIco.x").click((function(){gtag("event","share_aigirlfriend_tw"),openWindow("https://twitter.com/intent/tweet?url=".concat(r,"?play_source=Twitter&text=").concat(encodeURIComponent(jsonAiGirlFriend.shareText)))})),$(".shareIco.facebook").click((function(){gtag("event","share_aigirlfriend_fb"),openWindow("https://www.facebook.com/sharer.php?u=".concat(r,"?play_source=Facebook&text=").concat(encodeURIComponent(jsonAiGirlFriend.shareText))),$("meta[property='og:url']").attr("content",r)})),$(".shareIco.Link").click((function(){gtag("event","share_aigirlfriend_link"),copyText(window.location.origin+window.location.pathname+"?openShare="+e);try{ToolTip({text:"Copied successfully"})}catch(e){ToolTip({text:"Copied failed"})}}))}},{key:"eventLoginsuccess",value:function(){var e=this;document.querySelector("my-component").addEventListener("loginsuccess",function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function t(r){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return isLogin(!0),t.next=3,e.initCharacters();case 3:e.GetMyCharacters(),e.GetRecentChatting();case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),$(".signout").on("click",_asyncToGenerator(_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.initCharacters();case 2:e.GetMyCharacters(),e.GetRecentChatting();case 4:case"end":return t.stop()}}),t)}))))}},{key:"inputCharacter",value:function(e,t,r){var i=t-1,a=e.val(),n=0,s=0;"name"==r&&(a=a.replace(/[/*&\\%$#@]/g,""));var c,o="",l=_createForOfIteratorHelper(a);try{for(l.s();!(c=l.n()).done;){var d=c.value;if(s++,(n=(o+=d).trim().length)>i)break}}catch(e){l.e(e)}finally{l.f()}return n>=t?$(".maxLength[data-input='".concat(r,"']")).addClass("error"):$(".maxLength[data-input='".concat(r,"']")).removeClass("error"),n>i&&(n=t),$(".maxLength[data-input='".concat(r,"'] span")).text(n),e.val(a.substring(0,s)),a.substring(0,s)}},{key:"uploadImage",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,i,a,n){var s,c,o,l,d,h;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=this,r.target.files&&r.target.files[0]){e.next=5;break}return console.log("there is no file"),null==n||n(),e.abrupt("return");case 5:if(c=i.files[0],checkFileType(c)){e.next=12;break}return t.siblings(".erorrTip").find(".image_error").text(jsonAiGirlFriend.imageNoSupported),t.siblings(".erorrTip").css("visibility","visible"),$(i).val(null),null==n||n(),e.abrupt("return",!1);case 12:if(!((null==c?void 0:c.size)>104857600)){e.next=18;break}return t.siblings(".erorrTip").find(".image_error").text(jsonAiGirlFriend.imageSizeError),t.siblings(".erorrTip").css("visibility","visible"),$(i).val(null),null==n||n(),e.abrupt("return",!1);case 18:return e.next=20,resizeImageByFile(c);case 20:o=e.sent,l=o.blog,d=URL.createObjectURL(l),(h=new Image).src=d,h.onload=function(){var e=this.naturalHeight,r=this.naturalWidth;if("background"===a){if(e<128||r<128)return t.siblings(".erorrTip").find(".image_error").text(jsonAiGirlFriend.backGround_Error),t.siblings(".erorrTip").css("visibility","visible"),!1;s.mc_Background=c,$("#createMC_background_img").attr("src",d)}else{if(e<32||r<32)return t.siblings(".erorrTip").find(".image_error").text(jsonAiGirlFriend.avatar_error),t.siblings(".erorrTip").css("visibility","visible"),!1;s.mc_Avatar=c,$("#createMC_avatar_img").attr("src",d)}t.siblings(".erorrTip").css("visibility","hidden")},h.error=function(){console.log("Error image loading")},null==n||n();case 28:case"end":return e.stop()}}),e,this)}))),function(e,r,i,a,n){return t.apply(this,arguments)})},{key:"clearInput",value:function(){this.mc_Avatar="",this.mc_Name="",this.mc_Desc="",this.mc_Gender="",this.mc_Background="",this.mc_Persona="",this.mc_visibility=jsonAiGirlFriend.classifySelect.Public,this.mc_Categories=[],this.mc_Greeting="",this.mc_Scenario="",this.mc_Dialogue="",this.head_portrait=[],this.head_portrait_background=[],this.isUploadAvatar=!1,this.isUploadBackground=!1,this.oldRoleInfo={},this.my_characters_id=0,this.is_draft=!1,this.mc_roleId="",$(".maxLength span").text(0),$(".erorrTip").css("visibility","hidden")}},{key:"closeCD",value:(e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:$(".createBtn").removeClass("active"),$(".createMyCharacter_Box").hide(),$("#myCharacters").click(),$("body")[0].scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),setTimeout(_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.GetMyCharacters();case 2:t.initCharacters(),t.GetRecentChatting();case 4:case"end":return e.stop()}}),e)}))),10);case 5:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})},{key:"pageProcess",value:function(){var e=this;$(window).off("scroll");var t,r,i="all"==this.tab;i?(t=this.CharactersPage+1,r=this.CharactersCount):(t=this.MyCharactersPage+1,r=this.MyCharactersCount),t>=r||""!=this.editMcType||(console.log("pageProcess"),$(window).on("scroll",(function(t){var r=$(".hr_pagePorgress").offset().top+parseFloat($(".hr_pagePorgress").css("padding-bottom"));window.scrollY+$(window).height()>=r&&($(".hr_pagePorgress")[0].scrollIntoView({behavior:"instant",inline:"end",block:"end"}),i?(!e.isLoading&&e.initCharacters(!1),e.isLoading=!0):(!e.isMyLoading&&e.GetMyCharacters(!1),e.isMyLoading=!0))})))}}]);var e,t,r,i,a,n,s,c,o,l,d,h,u}();function ToolTip(e){var t=e.text,r=void 0===t?"":t,i=e.type,a=void 0===i?"":i,n=e.showtime,s=void 0===n?"":n;$("body").append('\n    <bottom-message\n      text="'.concat(r,'"\n      type="').concat(a,'"\n      showtime="').concat(s,'"\n      >\n    </bottom-message>'))}function isShowBtnLR(e,t){var r=$(".RecentChatting").width(),i=$(".Recent_item").width(),a=$(".Recent_item").css("margin-right");(i+parseFloat(a))*$(".Recent_item").length>r&&"pc"==userModel?($(".view").show(),$(".view").hasClass("active")?$(".btn_left,.btn_right").hide():transformBtn(e,t)):$(".btn_left,.btn_right,.view").hide()}function transformBtn(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:$(".btn_left"),i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:$(".btn_right");0==e?r.hide():r.css("display","flex"),e==t?i.hide():i.css("display","flex")}function copyText(e){var t=e,r=document.createElement("input");r.value=t,document.body.appendChild(r),r.select(),document.execCommand("copy"),document.body.removeChild(r)}function openWindow(e){winRef&&!winRef.closed?winRef.location.href=e:window.open(e)}function formatNumber(e){if(e<1e3)return"".concat(e);if(e<1e6){var t=e/1e3;if(Number.isInteger(t))return"".concat(t.toFixed(0),"K");var r=t.toFixed(1);return r.endsWith(".0")?"".concat(t.toFixed(0),"K"):"".concat(r,"K")}var i=e/1e6;if(Number.isInteger(i))return"".concat(i.toFixed(0),"M");var a=i.toFixed(1);return a.endsWith(".0")?"".concat(i.toFixed(0),"M"):"".concat(a,"M")}checkFileType=function(e,t){var r=e.type,i=e.name.split("."),a=i[i.length-1].toLowerCase();return!(!["image/jpeg","image/png","image/webp","application/octet-stream"].includes(r)||!["jpeg","png","webp","jpg"].includes(a))},$(document).ready((function(){console.log("%cCurrent version: V".concat(currentVersion),"color: red;font-size: 24px;font-weight: bold;text-decoration: underline;"),window.aiChatting=new AiGirlfriendTalking,window.aiGirlFriend=new AiGirlFriend,aiChatting.bindEvent();var e=getUrlVal("openShare"),t=function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,aiGirlFriend.init();case 2:e&&aiChatting.getAiInfo(e,2,""),(getCookie("access_token")?getCookie("access_token"):"")||gtag("event","open_aigirlfriend_page"),window.addEventListener("resize",(function(){aiGirlFriend.composeRecent()}));case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t()}));